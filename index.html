<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script>var x3dom={canvases:[],x3dNS:"http://www.web3d.org/specifications/x3d-namespace",x3dextNS:"http://philip.html5.org/x3d/ext",xsltNS:"http://www.w3.org/1999/XSL/x3dom.Transform",xhtmlNS:"http://www.w3.org/1999/xhtml"};function defineClass(e,t,i){function o(){}if(e&&(o.prototype=e.prototype,t.prototype=new o,(t.prototype.constructor=t).superClass=e),i)for(var s in i)t.prototype[s]=i[s];return t}function array_to_object(e){for(var t={},i=0;i<e.length;i++)t[e[i]]="";return t}x3dom.about={version:"1.8.3",build:"7482",revision:"03da6d38708e4eafc94c2305fdc175312a880321",date:"Tue Aug 1 11:18:17 2023 +0200"},x3dom.nodeTypes={},x3dom.nodeTypesLC={},x3dom.components={},x3dom.geoCache=[],x3dom.BUFFER_IDX={INDEX:0,POSITION:1,NORMAL:2,TEXCOORD:3,TEXCOORD_0:3,COLOR:4,COLOR_0:4,ID:5,TANGENT:6,BITANGENT:7,TEXCOORD_1:8},x3dom.BRDF_LUT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAMAdJREFUeNrsXduWIruOlGjOzP8/zdceNA+QmbZ19yVJKFh79a6ChKqCkBQRkm38v/8QABBA++/zf+JD2r8k35/4lqIXd1zA/yj7i/ij7rP67jy+psRP77vszG87Lph4T3PnHYEIAAGe/x43BCAoH9L+bZ4i/jwMfotAAEjqxfx+7QL5pvyGAP6vHbxSfFb8TuPXDl6fe0O6bvYH+lm3OwDxP+b1L1ZYtN+O4ykAREJ45MKA5Efj8aB+UcTYCKTc546C3gzd6ZhLfVjfdLvjRj1Q/Ds3uPjpX/m0moujb7SZ8zrTfwBP9iu7d/b9PtFXiBXY8Ye+6eaW/IMCyRndKwUqO5KekgsDPCTBtPSfp0PjibwbakJgZCjc75aoAOBmd6yIjV8E2FN6wkD6vAfTf/X0us7YL5hK/30EabqM+Zo8Pfd1ysteGkAEdIt1swTLgcG4UDoMMMrXc+nffM86IuHMm1uQfyGRqQBIouKUEx7KesBiR5hzdWxNnAN3UDzob3b8p0RKQfeLrJC5XxAS4ueWveyO8AKXQVcqrOspUw2MsKtja+Jp7F/SG81veBqkOl+ECaS/kK0X2qANw7GKAABKesCRyJKrk9XEWfsyl85jkFpI7rOv6eHuL/g8HaS/ubNygUqGYxUB6SVdXqSx+WAYpOhQVteKxS0eCRFet4TefEjujfyaEeoyAvewC1TD1BLHUrSArSX0LO6GgUuHhtJ/GaUgx/ZFbsHu+9/RuINFoHKBIvalKB/99O+J2mD55pR9PP2DWWemOKFrQ+hKemB1VI5zHqECNIiJ6IHyymZ6x30WgN+I9dN211RPoqtlomoEaktgem4d6Phps1jQINz5nS0FEh1P3yE1ZbE8DTE+8DNgj4ZgnfycO1L+YPUImrmfGxIj7mfwzpYCiY5nX5vMLgKaNZRj7fsVU9N/pJEXB/ofmbqZImqny1w3BhQKVDqe0nyy2yazGVHjO6VYUMeL9KT/OkovzX8WFIHmld6rtEcaXu7Tj3Foi7dguk0WGhbSraF0WQh3ynoiIdAmO0f++q92JVNoYhFYFwN3ROIDYeJcWkO4I1c66V+hsClCb9SBCenffAuz4D5pyP6UGOhmL1erA3cEEr1/UJpfEZnrzlbYTCbO5u06MCf91y++qBM8ORjyYHSf0YfvuUogHgMQt0FfFKhe+KIGA/p6wPBSfSibxk4oNsw6MLq2K7kk5a+tR5lo7AzGgHEn8DXBoLSBNTIQbZMxWRxcRSDO6CcaXoGJhr61XWVUD/KfKxqTa2rCXLtzPAYsFwikHCy3ycB3SJufxhFg1IG4uanWAVDdm9GVK4Hx6bVKdwaET2tmnW/sBOnQ8/6jDwDS5KbjkJI/xalxodDq9QAdsrvF9sxF/+B+QQXH+c/C4rBYmZ7Qqc3GACTvF/oA4K1isWWxyoUgP8gZpkNqSIy5+FZUrNlh5Qtcy7md2j5YazHDrxf6AM38fYcsttwhmrBkMWIQiXVgSvofzK9n7zjyjs7AxE7t3FLAr69EMOj4TsliSxjEhswm1gGAznnJ0KCOwoWm7AQxLTwQgE71MVNRMSUGIM+IYG+EacxE4+IRWawVAU5LosMO4O/gYN2pW0OjwPUk+yX4j4SdiVAeIUJTRG1HeMCxHkBKsVoODspiZxJOn97p3sFBxHGbrcGSBCNffwYdOlfprmMy2fuNhzYKtBn2YEytgWqq2Du6qePQ5ghQig7FHdK+9e8hKAeI1jshHgPyCT4m5lP4xJQP9aP359cYyMoa/mzZ4PSAPYUanJiIe/waUueQoiuNjgr4YHe9y8ecldpTWBefWItgPStr7EWbbLM3eRYlQYIOJeuA28zqWIAyzoWm859Q7zbw6w16OOendluFORpA6AN4qtddzKUNURvEye55RWRxpA5oBk7WCApyoSuq4V65ssLZnMvmIykfon0AXfVCYfvY7qfdA6b6LylfMCQG2Pva0+tFNYRGqfyw+270vD/Cs4dwP2uEzXeTHygpENW/BG6ywO/doi+LxXk4FaAYGuDh6bZ/B8LAUEPnQ2vU9hwX30N9Kn7Hzc1uQPdlfWaD5l2XlCzevwmN9Gxdm4TFqdSBxL77kBCviYcCA+FvY0fF77aoHdvn5Xez+b5IuCMS2JkeR2UxxVwmg5n4bk+YzGR7um/hQleeHTpBuXaHQZb/FDboxoSCxwoZF1jUJbyRSdm0iro9Sjc68bW5gWk2GAa3spvMecR7uopAx/3TmU+Q3kQuKGzQ7eMX9EDhoGFggNmhTBD1fLR5ZutZNfMebOhO4y3DJ3y9awExnihbB1N+POu3LhAERm6ie1HpFwQbuoI7lPE6I32uoInZf8hf+LSbcwjPyQ3akYdGMnqqLFQuEBRpHlyyHpHFEHWHBMTH2Lnb59LqQKgUTG3oTvRG36KGu2NgJN+PpPzgNSA2wg62ow/qaIXCjZNIPVHZOYQvDidyI4pse3TkBFjIdN86wq+nOzsWAyt8GwgtjM2VBfHKdkmk6EiqjQJ3fs51h2pkOwDN9q3MiQxfznad++2zrNjpyydQ/WxB6iM2S12dbMrn8dCuB4AU6XedzYA7xPU3/01AmoQL1QGQV8MEywJ46547w8NrYL9BFgeKwAiDn+jqDKZ8QQTjpgNaIrTLUMO3Maeag+5QDtkd8wtdkgC8tT4d1eAt3mi0CIRjYApveVfKB74ksoSp2AoINQp08wdMd6iJJaBY0ypr+SclgVsKAIZ3ibuGJu4QuIOcZ6LY7Uj5zfX1KMSW7CFAVHih2OErCwOvA9AkeJECgb60JeLtGHwm62N2SNXIFkNLLVEf6/UVgyjHDBxn5XvQd6mRKZAwDKcAfVajwF3hDjodAqVL4EcLqwOQQn+NiAj6ozs6Xr4OwIwwWEdp4qOs4vsvu0AgAX1KowCCC4JrxgVd+zKodSO2WEfGcYwLnTbMPAvoYA6K4hitT0VC6spsvhf6AE8vU/Ze9F5VX6MAUguCixlSyHQJQkS/q907iwulBPGZm5DaMQAzwqAvEqbke1AXxSsuEBRADzYK0iYpKZpboUOQlLkW1Ylt7WhAlpSKHFmnLw5On1MlzlG3Hcm7L99nWxmCDQqKCyRyHrtRAMr8HOR3ebDpUFYWy4ERntcHs1WcRf+VTSEILB2eGwaD4LYPQ3Fv9SyQ5AKJnCfbKNA6yhpfgjAdgkG7k0WX+Fwwd7nLoj9+HtlbigDEls9Pd2+WPl0NgGoaVLdW7OVa4Gpfl+1IezC2+EZrrgH0OgBuqyusiUGa7SE9geF0bJ5YB2aZmCegufs9O2xQzQVqc7bRL9uWEUNg7EcIA4lNAbvGlcVQV4yovwl+KZDvUWZ7Utumu8elTVS6iUArxr0m+jaD1k13sie5AiCVxAbqtgiS4r4XcGlrhdFGMAsFKLNx7fsbk8XcITW4U7e9o3EhGATuQB1YsatPH7JpHoinFEVUK4DE77VSYHAeCM76m+6QyMEEkgPt0IRdMaIUX6E0vuHj7YvYERWX2lV3UNTSAuxOiZNiFMIOAz08IqI51UbgvlOcDgmMSK8DcjAwSkOKYce5ENC80/LOOu0UkjugTMnutPLPSQdA9Yaj0xAAj/NAeI8TS1KD3LI16JBtj4p1AAIjD5By+qXZHujeYaU3BiYO+msP4xiUp2uA7pu8JBJADwPR9VeYkmaDNu4QgKOMwaRDXL/KoQKW6w9MPwCFEn+HhE2UhcsYo9fhOdmbXfaPUYjWCyrIX/WQDmjOlFyHxx5BBWl/RZmd6znbdv2tHB+z+UFZkQxeQ75jd62lgLaSenhr9Sskdfe3asehgdEbkAb0K5sIQyUiKprdRWF1UZK1AcvZsjI2M3QLTXPkwRK1+nLK8VR3wi4SS42XS4VHQYFQxro6KRS4v3vIVAwDkQ5xWdxRB4xSAOGRB9FQSkFfveasImBxmwVk7Arjse2+QAB6GIiTQub92SHTRvi60zsgcf2OOuAkeO9igwsZfeJcXu89oX4FUi+4t8tQBRDYvxgGhV42+mIgrRGzPaVoUDFxAp4stug+ayb00XqH0MdOIQilw/x205OztvTOXz8e0KkASKWBI4pgw5apwoPd7w6ZWoJBCipg202DJ4st6RzI7uUfyD9tiihdc0+4HBPII/oEG+n6Z4D7FIhPfZRsnmNdS/kQGJ2whQQq3o5gt0lNAOjg+kp2d1kNxJu+kh6As1a6zIwB/B4ChC0Fqr38yvBRGJEA98DoRERIiN6OAXFQDOko148JVjHwohk9owcs9L9DEH8ElPsrQLM5TJwRlaMQEB6d6AkPxQN1ZbFooaZiybBHU2SGzMjJKYT3xsCJvblTKBBbEwwMwSIjErEL5UhF12SRWyVkh86FuDfdAMoBTWBakxEyY3ij/eL4M+sAXu/n3kuG0WR30LpjXARr2K0XDYM7cWSEB2v3gpSVyXDuItMNYYoPXkZXX8SDYVQh9MbALOvmUtq3+5epG2F6GDSsQywFMna1UpCcOAL2asIHiepDYh3Q4gQlgMhPQfXK7glefB9iousbzy0luPI1722bT+f6bWoUw4AFjI1py2wFVf5SvYslSIxfpfJ6HQBlvt/5GFBwDty339Abb+Q0b0/qePqr3Xe0IqPUwDZPdRmRSGPAG52wTFJtdk2iQ6D3blN1wAiVSOUJMXucN21Db4IqfRjWfQ0ghkGEEQEwYeBJiJCpKr24C1CxlAmPgjzkA6Zm7WP2dAEi8UcyevYVBA0QCQMkwY4US0F8pMI1SWUuxKqAQWNA2Y4KTLeHKPYZKGXHpU/fVATwMnAPPp1tiyJuEs/XBogJXsrWqtgVA8Y0SdVFwEqfNZLpQd/TAerqFFKxqMoP+MoYmI17PPGJ2GiAhr0MMaLgZJEYMLpJymU3KEfeAlfGpL9fbqHQJUeHyxmBL83OptfE/flw79EAPYyo7hCDO1lEEJ1IBd2qr8Op/ePRcjZDete8pjsGtI3505/9+iIwvlDhNMTHr69mgQTzR7szyIjEySKd/YOyAobne9TYtrEUK1YHLAYf7mHFkYHvg+O7dOeKJ3ZHiDALpFGd6k7tMuptIOiKWagPEtumiDhz6wB4aR7lImNH1FIev4gpnQ99fEeE3J+5lHOYHQokKTzSLlOeKIcBObC2oqgOJBd8RnjYJF4g/bhyXxsaQ9v59vyYF7QO9DkXSJSzArEJJ34xqCKuEXhzFqIkEJBalxLUH7KDZGgWbYYg/ghVmno6rnnlvti4N+ILuY7ksWEm/khgGK4RGNsBoWUBYZaxhCVBUFGsSJA9KDyXSi1i6njWC975/r8o2imS1SMi3uFIumsEZoOZ6wdgQ3LiB49d5z7bEM/xjbwYGDxKHrtWTvZfH/hx+A7ch88HkGZksYbaolJgcyTQesBaB5fd739CykNRiC+LARielsPPuRjPfamKAlUcgfFmIbPybB2RCvHAIIvh8KIBwbm0rjpgPErBEJpnCmES/vEysgL9sy5bHRuv8wFI0YjqyA1XCxhzjcizfQINOJv9U8fZ5/kY6HE8OwYlrsSkz7zstPh5USBN+1YI5jkJWQyES4EYXSiBOH5nxZFAn1ugOTEw2cHMvGa8IY0r02fHz5oCfZz3FxXbo3PSz7M4ClIBQA4DUjIfSRyX+CwA+31U9m84oSms98ZAQhMHTl8cun4lVlZfc86vio4LJLEdTenailksBRqtiiNeZv/a1Kc2Y4Nn14HUMoBpJCeQmN8Cu9QFS3+BdlE8mWEgWkCVYg4/RaRVTQeA6zltfI0M4ThQB1bN24QVKgZ+4mAMDGLXDexpr7/m6ffm067EQFD7lpgWn0KybaIpbI1WtYgXkYqyNSSrWCMGIKqYO92ejCDGwRiAVQGwFJ3nVJW75L3XH3+M8FiY1sWxpgFA3ASFI17XLRjEtJG3hl2jifbiGzkGvgPfpz16Vw8B9MLAuEB2jXRxDGx1vAZloVyANMmcgXuqVYzJGLA+mNSUxAibH2BBK9L/W2IV1D4AL+cBlKNGu5sLXEYk8h9TaYCijIWkK82EynDvA7qd6QcEMa5RtHhiAJyM/u63JUCBlDA4crl4vRckbRiQqXpR4DntHlgBZONAHYijPG74YJd27Pmwe4sAnhVO57/m86G7uq4kS4p6gwR0vlSpXuUVWmSDpRziOsGlK0GUR+bSMN7wCqiLuQ/hKWF2fuIHcVG8pl9HwsCylZo+cRDi5HF9/jGkaE/WMnLf65gmjkKtOwZMdK6+/7TIzL5m1QeglAK2SY5N63UHCVC1WW18O75nvA5497v1oZuiZD/v1Rn9veg/RwofIphcFsS+pdml4AgYCMWMJgnUGAA/MNDGdLZudJlCGJbOWYqC9IYA6MDraYzoDkg0zPUhjGwycKxLYVDazG5UhJxQPd9jRp5i19KC8ZS8Ltn3vHJyBRxOwnH3s+4UFMFj6b+KgdiVgir1QE+uYtE+JG0BMYbvjPDs/DgdxnCGJwbACbzoTL50lzaw9b+lJO45lNVS4KZ2jArlbHHA2J0YM4U6SUg8BvrAmilr41Fx2YBRbNBAGFAv7kdLgf1tng7ZHTEMeKYY2H1oIT8JhMoKWL9LLUx3iiQbVDtUmmK4B+lgo1mlIGZMWfjurQPoiVEMUOFoidAKUW8dwKmvv45uwbldZxRsUAYvCoI7kv7NUjCU++PfBu0j3Wm1gZ6Ao2v4hNcZI00IiSvXikWmEHIbFNwuWDAMhkMC5oYEpCsDmtICTbCG6kMvTCNXdpaFCwfAUlPoTkhZ/ycdBjbWx7SE8S2GK0Mw4xpYR685gFkGrxhKCSkyzII6YZ1vOb9xVPsurTPXv+3I5YPhEX+oXBIZsJKMxhmaHqiB9RxHChCYWRl9YhWa/tz3UqM7pCoA6lIhgG+0wyOIewPHtkNqz2sEFILBhbAXfNiVSkP65EQW9JYAmBIbVgUgCOds9zIWKjjGlJBmgD48aGQQGLSjxQZojOdEwJR+kQB3mh4Apxmj8ddMaoA+vEpflycHp8oCBioGdtmjGKgMGCgOCJmiYWtl3TON1IrxsnCOhp4eG10uUFwDzPua3FLA5+TM3I9JphS6XpO/ItwzBCkE0GAMTCkLU6MC3jpkColG2HgF6Pi6KAUYKx2YLwsaU0J3JC7AhXJw1wiSRqgmCQbrnoB4WKR63+4RHQFw7Aw6owKgB/fj63K8IvBERHN8mgJ8RqkDGNAPOfmriwE1BmyUhyPkVwSyj97103d7sjvxkIiVAtLojac6gkDnayblgQWvUKASFWJlmBIbg9/CR/XO4JTFBtDaoPYs0BjJqfa+FbN7ETzo1g27LMSArj4rzIWQHCKk3hmuGwZNMlhWUC1MCZLviIE76bNAEbijwVsUGxRRDRhq8GrGA9rx0EBKgnWU6ihkSQSoCM34lVPU82nU6OTAWMGF6vUABhfiX7MEf0hSsywQVwt1kGBANkRCEc3wQH0gz54dMICCMcKj1gQ7NgZoknqPubDmy2JAvEDZFiXChQxzU8SlpBYSBSTiCJGX+1kdwGDF4PhT2gVoWqXBwOivA33TqZesA7BgdIJfwxphWRkgGjhSiUBFIWDszlQ8oEFyFKvHAJOxHiAkBlLFQUHwirGL1YIY3jcmHS8FhQh2+Y/B7EUzVCkLzaNiKaBGKrh0SMn9/tecC5HOfCIWEI+BmBoO1QFPP9gPrSsLl5W5vg1KcRu0uB9NUlQd/qU8isGsH0z/ZUfMqwOoyNwITdLcGEf7Fi/iB4bImuJfe+vlL7uqZrXlb4pgrnTBGWEAN/HXA3Aq4pWsT8R2gsBMly1TBxLhYRcQE8GpL1wTaRYv6sb3BUegOx5VOsH619id+HdNrJcCkp7YxoMOd2x+AVJNTxmpnlQYigFPDXeaql8aAzDc4cosiMkIX1IkASqJv6ElxEhLUwpKoMtKQOs089Re21BIFtDtzlRq1CdI8UckgdtTy64Q6GYvOCOvvysMChcoXAQQ5QtKUoQ1ESL2RKr5ukp+eAwkdQKyIBRJP2rxoF3m6VH5gqQSUCNKm7NY7xHBslloWDP67z66uUDVMSxWJMjsv/FwpLIghgGWiZ+TH1ZVUIM+7wx42gB1XiTA1GQ+cUfIevFBbXAiFxpc1w/L+lxdGsB2gQJsp0R8Ew+k3IMSI9ISP6HUTdPTPzIZYNQBzMaDIRvM3BxsGI9A/4IxcD4p6uoDuC6QXQS4umWh0ihgoso12ktBSABQJtOLEI9gPR4DWQM07hHF9In7c8+MAbjMqHNGA2RcoNYO4kWgRnYbBnaaV3hRhCC17N+2RPXc79YEx7bPGzgYiIpxXmQ9NHV98MlhEIyEGAXS0Y+iwa8UAarv2SsGsqgoS8FOdQzO416DXh2wuZCGxT5eZFuiMDIx0SsDpi8tOC0MphQEkwKZuZ+UvOsznzLl11Hxem5RCqgMhjoqIEWHlDrQjgxpuR+8YMjLWf/O7MTEjLHqifbopbJ+PBgyNqgJ+mDKbzI9NCSnDIb9M64viEAfxfQvwl3M/Z4Y8OFolog4U5rfIsiHBLx7hHMW1vUTYjwb1KD7otgFOjL6/i2x+5ErYAnrlftZl45UQVA3bVZyvy+IPfY/x9Lp9oimbuAF15tkHmRBCQ3QRkj5I5UuGEkXvI5I0kh/A26G9ZYOeZUBdVKEujAQxYAtlDGia/UpUZfxdwTVoi7BpUweHEj8jALZGoBdcOhdVijEIqDleFKCobm/GpdQKoMtA9wOGnr8R1YCnjCYZefbsuH8zgCcOPYzy/GURTCJfQAT9AL1B8n8aaKiJkL7o7SphQbllQaoE7/cEi5/pUAwIKkQ56YnatESEAaWbPW6BJCZfZjmir6JAk3HeuSyYk2wSISK+0kKjCrrb5xn/xZLoxMq9IulgOpHoagbtL0yRrDeZRnZBSEaA0bHoIvApJjMIAWCc+c9p3P6juCpKVCA/GhZ//BzoBC+LM2/mL0eDMe/hTawwB2IAXTTv14QUM/xIWpku0NroJxaYAnTpyFobWrHqSGxdYJN8iM6oVRXDBTdT2hJDtSJvMzuFcOpU75QH2IxgLFGgRMVGqAjitlN/4E2mQXlgTXEbxmIWIf1vp9rukD68wnaakAFKZKLAFToL1VBBXTOcCS4t7JYa4FJvhBqsxKxyiAHhlEHYqNE012dJUcWTBUDE+38/grwOineSP8c+vVDIuk/agIrAkcpAAH9PNmLVaKZIHK5kGyJSpDVugSi44kdyvhEZ/PkLRZP6FtNf+VKA4h+P2rdADHfVz6KUATEUnDgHiSqwwSx4IfqMYCiHoAQERLfOEMNq9XAtINsd+hquJ+e/nENyoPPkkQwqwTG65LIguocDzWsIY77/TIQ7pRVr9QxEPSAQoRsMeCr4aQd1NHZjcP3XbjHE7HeFw/l05U+gKEEGsSz65scDzWNYXAV2E7b/4Kj+cC1csggAkseoDQogZrbYw7SYdgOmrX4azXQ32uDToQ7dlYAqSHAXSCUtEETD1D7ntq/UJcFC/di/0siP/LaAGVWFO1qIBEVNFXBiDIOxUD+pNR1hwZo21MvyuuDFSBEgbJxVpmepSBuFC0I/0JdFoAZpvIzQbkTVCmMPP2DUA2y9ija1SOT/kV/8/zsvm5JwDlwR0bmcTwAkI0AkXmlcBwRV8BlB0BHv3oPKCHFq4Fcm/SQsP91G2crm8R9kF19cv24Elhh/2vXJAPAaBIzlq8GA1VKtG0LBNBv1o465eslQqsGnLVDV8PYrQPckgo2iadg+swDjt7ojc4OADApfo1CMc0TquSlVRw687Hs/xLTjdgFtRqgdiJGpBpkGFEHKQraoxMhPuUEu3NGncefOFkDaOlfrgY17QFkU9OlL+XWAZF4iaFSuorKrI5q1dtKQGkCRFjQii1PBvGdzegng36EKZFgg07FfQVCVgRAckXLqekG6JUfWpQaUpK9JkSw6QlA5YoiWcwkogpQ7zH3qOE1O8AtpDc0H/HjTr99fxEAkdSdvTXmKecsrHEGRRsB6soAzbAQqNRfJj/1L4Hkn6fdOJXojQxB2BcCZTVmqhQMiuNu4n6FWf9ZT1QqgGKcD0K/6QaU6wQEuBeVQaT+7WZB5MkAcYfnRisXuDTaAoO+kLHFUDYexhnRuodWMJ+5BYHaAHDhXp7l2A195qWWd4IYCSKb9ywgLR5ki10KEnT3CLJ9oUk9gaEwkNpkI7g8DfHjTa7IbyJUAOr+VaQmlwx9adkASN8CG4iIjANFY0DUwWCKYIjqgQ4vqD8e8vuhT4Tj3M06z+Q/LQUihfyQMh0J/vIBOeu3W+7WA9VQr7hHluxbI8htArgpsxAGqi9k20RZ9n9KKYA1s/vv4vrjNUGqALfXmmDyaA/EhuWcHykuHthfTdpXq0n8AE4TQF4GILmiSObyK00EKztBOCyoY2MVTyfA7O7YEDWnyfCdDnfLBSL3pK0I7qWMq27hXIhgkNYWNz+SlJCwNADIygEz8cBlq7tXSjD3h2akxw7Me72fM1z8cwTr+WXhTvuKsJgCPlZjZd+OhudIewo1/ma743QThYGBUM3xbBCj7scWWMgiGjvo1Q0V9L3by8Hipth0OJ5sd6oB8GAuEFcC2OiBOhgaHBpVoZmaRk15K0ctubsAWatkvHGJ0hL1DzKS2sBGZ2CWGIAZKwRg8VLGCz59gggGa7fc9F9C7IVC2/8HggH1BTHI6BAGTqV2UzIGUinapuqy4dCoDFi8kckb4R7YFsUVwdsrESlekLJ8lvTHQ22E3mDQlkTyIQjREhWYj0HKk/a/saoYxoaCYFJHrLMO0CVSe9fmuE8NYBzAKPEfLRhIX05OQbjrl2E4GHA3NGGoFJSEB/XTwZxI0PjSAP+B2c3gcTsIAzltqZ8zRwOQ6P9gfZiFJEFdDV0x/noNcSgqlMMn7WBAUJcEIFscg8rYXBCymgzotoMGhe/S/XzeOL8w96XudCMojsjQ0j8V+YwYdGjgHZFX1pN6RB9456XyL7DJ+nVgJzZX215E7A+ELFGvN3w2+59SCugSubzvBe+EdPSepDqAzPARcK9syBN6Z0rjv+wBl5ke2AllYpDY8bCnc0btsLlG+dqpA4FRuRW5f8oGJ7Ms0aXdqxW/Q9UHIPAsoHrzWpEUdfyKpN1fdgCUQ4udOxW3FJvQbRhR7HAKdRqCb69i7kWXmgmdboAuZf/X5P21BmhcIIUxU5EFX3cbW88y28SumdU6Hdb2OpYKkH+Id4QRlcUNFakDsaOtnd1Cpe6bhtEhCkRv6IKt6GTR6RHVukAEVieVH1pBKB0wEFtFgGKmB2UCFHS4d4dBaQoVvxWC5IrGuVBwJmLgnMmZdWBwGdfUEaBzoI+iC0QgEQaQFbDQ/bWPbpd+A95fg2IqjgZCAmHjOSh8YW2SlTy8ETNtAQg7nlMWhZ3UAbieEkhqgBsd3KNsBjNP0DikWqBD4u9Fer5uVoGJoFfDpYW+XQ2wzPpiN0BfjKvOBZkQH6RAsHICYhb0161foZVxdYhg4ohhAqDsc1mHtkvpH9kf0wKVbwax/0QonB+OeyhmhzKkCMVugNT/EtdPinyGd0VmzcCNoH/F9lUjoLxOPXmJ4KMCSJOV5cnV1eFFcfTv1qqOSQB5QxRBGUn3oBFkniQQw0DMvsi+iAsAF53zBQBN9fsHQHkFe3SsAkC9v+cWDx3odxxLFgNUDmyhWRpJFhlcEkTCAClGPML7BkzZJhrm9r9oDPr0kaDvrQD8+Lr6yF4EuD2f5aJ/DyotBkA/tgyU9M8iAUtJAHIrANmHhqSuCoj2AcwD9rJFoC8SYPZiSHxfsndt0/kVgGriW1WAmvY8q8GOvwfBra4DGvqNNS0gCYBgJBzA1QsCsAPi0dwgqFLGxo5DpthN7Qk3vfv7ESJ4nTwg/Sn3x+04I4zENbgS/9nZf6X5Gh+JJKJRGKkAiqNa62BoRu7YH4f1H9dm/ZgqQN4QkHx6DYuR5le2CPSZPx/n/5zAlKwjkp59gHYagg1Ocv5Tsf8CVQ+CG7WRR1C8TmA7HzWUiZ3XYgYDb3ghSDaozumD/gzE1DCYQ/+QCYl16I/inq6O+2gfgEqoFL5n0wFoKgCHflUEOO4pAXShFAQ5IBPEuIkBnvux+K8xLuXVYSYK4woy2wKbjv4LDkFcQgST2QEopyl36r9n01vTOd5wv08ZNf9i7F8Z6KhT5GaoAXV3SLSA2HmSNkCNVoCxK1a3+zlk+AxD/5tw34rgfQ6CmiEzKvZzplr17imfAAAehQVU4j6+l2Ekr6Mu/rkSEOSP+K2yHgBA2DNUHjuLnK43y/+hEPrFlb74g75YAY7cTK0MePmVBfkpK8CtJj9UU38j5avC13Z+gjeSHBg4rEwsOwOSUYN6SJTeaLN6OCUos7Ab9EZwAJ34ybhHzzA9KBDVew9Cc6xvLX9x07soSt69b1D8SwT4sGb1y33PSVsqmZKJxfoy1JZuspUAwgvqpifGFHCHBkjEEvVEmruXm7vj5WWhj+FIwMoFwkIHw5bR6xWuSC3zAYAHwo0AaPN/CqunSf90AySgh2L8o2KGdg9DkRQPCilCtJDkQjaS/iO+p5v+xYWawfiMw/SzJh2y5ZGqrRFvVCKVk5Vj9qFI/4fwpWpLFQIF+iXibwAPdicox+9J9xsGnLzlGypKWiwpmg7W/VC7CMQ/rXOOAsCvgP6s0/JaDXD0gwvyo6X/XfiWuZ+o4j8786kQfwN8tGmekA3/xJZOIqf+qKrqtg8Agg7ua8TaB7BiBvQ59NNfGfpfMg59BABTwK9ca6b/ffaBisCBWuk+mQ80YYB1SHDIRsY/NW9USu0I7cQoApuDYEemanUgWARScO+oA7Nyf3ab148GfR0Az10hip1riapzTp8BYKR/ourf44tHRYGarF9+y8HtLHwBITz8T1cnQuJgXGrUDDN2ZFxazEK/7SjgZeB4/g/aNEChgGnDRGuAbmtkm/T/ALgpiX+nQLAxn1IB70vAqlUvbJcUeRy6secjEHE3dYzr4LD7GUHtRPSvoz34RaAXKFAlghsLqI6BGxQDP2LiL0C/5/4D98+IaWwfEj58kvYLculQAiJKX0xsbEFgU1RV/ga2/oQxq74bQHgBXL7XQaoDgB8wuslZ3KjMYwuDp/v5jIQjAB4F6IvcX+KeNvZ/8H4Oeopt/WB4vCYVRpQaYfyJ3vEtEc6d9UBHZh84w5k/9kPfgHs9AGo9i4UGaLUvVbSHdpJTCIDXt4+6DuzBUKOAwNz0E6qFv4gSwzb7fihOB4G0HqAbhZjrLqVG3+ZQ/3cz/qsNRygBIPGfZ8d3b3tRnf5fvmdRAYA2oCuIL++vOsGBMBDn21Qb1FYCiokZFcHF2GzfmuAV9uXqY/C+APosAJomAFS5/yA/JJCfw/O5bU+vs/6L9jTf7l9gbVDWYYB8U2iOe7TqPrqfTOGKGppY7Z3NRUByqymcDbU/An0pAEDuAb9Gx+jA/e78EFSknxMe2n2iB0uJpGZLKhcf2tWAUyDqQb8K+phXA/ktISa0wLr3+qResNI3gN4LADgWNJZF4EB/k/tJhv4O+j39H5HAw0Acj9aOgQFhe4lqjx3wmwMGZRdXw3SI4O5MGV/5fsHbp0C/DQBBAW8B8BK+qKO/lrzP6kCPNv2/ug0ohQEq9UE7+xFixzCR7gKBPAc6KEa75W+niTk1JeOfwX0RAEivDM0DoGH/oKN/4z9PuJcV4FkQKnqzh0ED+uAKseYQbN0eFXtkfKGMOMODxoowVHdjHpmEC5Gf3p1of+jXA+AfqwClBdSwf3yZP3uENOh/8Z993nPDghwGDfQj8QCsU8GA2zGqjjNy+Yh78/ZFJ/jHcK9SIGrYP7TaF4oi8HgAaui/HdVgJzzUMB9eCqiOByUGWn0sDbSlabq0MqZsEcR7BRpQUpNwTcrv3vF87uj/FyAeOwLgtSCY4AYy86Gd6hTo37P+qxRsib/aX5O2e6i6BylWBzRFa7qithpGvYwM+j/dLhCk0D+pOn0T6I2/ogoA4v4P1MIXZPTDrXgUigpQZv2dDpVwL6OCXo+iXgGQrFNc+XnuQDn0Z72Xjq1QDHsRp0JwhXb/Gty3AfAobdDS/4HD+jy6Yxv6oYyKnfBsoKfS7akjgeoi8LyH9uOHXRZk7MUb6wygtjLmAwGBp6GfPhvragA8mj5AwXwe2xe3Iv0/4FjtRQXRf/0LB/pf8dBk+oYFlRkd/cO6q7+5tINI5jNNGGhzmhh2Y1IsqE/+4rIIjDunf6TncAQA1R0ALCgQNfynVAIb7WkrAFTor4gQ1iexamGAlv+DeltAZeropLTgid88eKZYRhN5/AUHga6G+yMA/nsTbNDD/YSa/Ijsf0v8bQWQ8n17PzFe4p31qxEh9Gj9oMWJfwMcfwf6sgvUBABAJX8fzwGhh5L+66z/+oKFBP+iTf/SWUYGEYr0ht872bto6/Dph/7iX4K+LIKxCAAh/Re4hwL6O+F5wb3kFw9WChoOYhQE4/gZJSRQapD1W9146gJwW3uMDCB9qJlzwq99f/yjB1Ui+LD/odK+Le8vsv6L9O9hwNI8oQR3VOx8+2yvsJXZw4WGtzDp6wBMWQ18/tafXxBvmwimgwId9j9UCyMfexGAog7AK/2XfEYgOTX0CaVIiBSBshXQrETxNnaekoZX6Nd1q4FntoHpq3BvBgBL/4+S/2wN4z33U/0uEbWYfu27yENCfGMxWgQwaMgofS6dl01OddONoGvi7FOnQV8uUB0APP03FOiA1KNoY+E26gzbRkPifyIGRUaE8k5VhgZwmQ+OLaG61kbhlzmk8ZOnQbcKAEUA7HtFvdL/Rvpb86c5EpIEhlPxfqj9UPsdnaEEctZ+hgX1yYAsO4o8hH8PtesDoCgCuIvg3QDdSH+T41/9AU0MgLTvZrAOBNbmvjeHjaNw2iAQjVL5PxU/mwu07WkOVCzfZRYQfwePQToGYmKnqlMzEBH5UOw5H3v8gaL2zjoc4DeC5ptKx/2/N6IyALYYeDYHKu0rkh/aeL844CkO/XMZoFGgSKZ3y0X8czUm/s0jU0+60Q/9iygQHcsAsNy5sJl/Lpyfg+5vtKf5r6XDfEkIFh+o2xwA1eX8iE/3gjuJ4w/9WgDcSmLTCIDN+TncT2LpHyXLHyQZgJlFGbQeMvRX0DBZV3xZAOxZtu0BF6T/+RWh6XXicfhkdQ9oB7lkZEBAGaPHcK7I2mk5vn/mjxIAsG0DsW+NVUw9EBXof0L/Vq1lUQc/QaBDBOZJLPHEHH60xw+dVXZWps+f2T9NBEPNf16zbUXn60j8BfRLqnP8B4XN3/Af5b2Ux4SSo/mrP+lZczXRIQj6ExB8dwX4R49HvYE9vtB/+D8I9NzZakP/EQM3tqkJKto3u09sN9BHisZAhMxHpyf3f/EwiQJtyeYGQE/0YzHz8zh0MBToVxc6gh4D7NMj6BrH0U+m+FCViX9Mel40AJ5YxNIFeobB45jwKT0fOQb4WS/NF31rq5I7M+c2hjgFf3jJ2PvLAqAKAISaxO8bnOzmD722PxEGnkEy9Wv0O4MymMfbKSMSkWDAzwHNjzXJLtDrRIkbIEJ5XkZ1dliNftIt/wM2UrKvJiri++/QepRfGzQ/7K4JAKTHDQDghi9z81giTLXrT2arC1tLlDp2QMYzTJ5O9NEPlF9MgZ6ew+3Ys/a16HEvBXyJo05aqGFEwDgShDfbd9G/ZvE7nhB4P417HQqECHSDx22rA0X6LxO/trMVRVhwatVJqg8wDlb8jZr9UfZ1fzwbYQjwb6sA9QKx47SLjuF+7b0csYOW8Zkf7P6oBqDbqwLQv+KcvMdB/ZtdPl+mTb3bM/0+zOv/6T/SpVWA2z+gfwD/XvznmALiEz6QP98Hp6LpHcMRPxR+cwWAGzz+AT5j4Hl7yBPOO/pFh4c6ZMBbNxzs2BTkR0u+LQDoRgRwuwHdNw+UXjM/RNW+bny68yUTxI0eapFwwaznD1DQZcLvV0lWV4AX/2nO/tWnO334hB+ibvh80Tbfv9s7AwAR6A7077VrOT3UBS6q3p27QdTv9hMt51Gg5y64/14BANvYc+X5iFResjIp/2a+PRB+kfjnK8A/uN0B/lUbPRCf75+BF/zzSPzF2+UqAN5fCvg4JFjr7zaLevuO/7wAdP4mCn+xJwfAUwHv6wD2ESDgQ84LWOLPzPih+d0B8J9XB0CWvyjrV+r6WOgzEfZD21eL4DvAv4r/0C9bf+jt9wmlA+BG9FTAj3JTON30/CXD3+2rAuBOcA8MNv9uv9tXBgDcCe7F9ugS+SWXF//C5qe2P7UC/E+5Ibr1BtDv/f3dvrAC/C8dO538UPnL1n8wAMiF/q8F9SE3+r3BPRrgd/vd/m4A/CP475vOU/7dfrf3i+DXaXi/2+/2NyvAr3n4u/3pAMBfAPxuf/f2/wMAQAlQpLLpCe4AAAAASUVORK5CYII=",x3dom.caps={PLATFORM:navigator.platform,AGENT:navigator.userAgent,RENDERMODE:"HARDWARE"},x3dom.registerNodeType=function(e,t,i){void 0===x3dom.components[t]&&(x3dom.components[t]={}),i._typeName=e,x3dom.components[i._compName=t][e]=i,x3dom.nodeTypes[e]=i,x3dom.nodeTypesLC[e.toLowerCase()]=i},x3dom.isX3DElement=function(e){var t=e.nodeType===Node.ELEMENT_NODE&&e.localName?e.localName.toLowerCase():null;return t&&(x3dom.nodeTypes[e.localName]||x3dom.nodeTypesLC[t]||"x3d"==t||"websg"==t||"route"==t||"import"==t||"export"==t)},x3dom.extend=function(e){function t(){}return t.prototype=e.prototype||e,new t},x3dom.getStyle=function(e,t){var i="",o=document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):null;return o?i=o.getPropertyValue(t):e.currentStyle&&(t=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),i=e.currentStyle[t]),i},x3dom.isa=function(e,t){return e instanceof t},x3dom.getGlobal=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,16)},x3dom.toggleFullScreen=function(){var e;document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():(e=document.documentElement).requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen()},x3dom.debug={INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",EXCEPTION:"EXCEPTION",isActive:!1,isFirebugAvailable:!1,isSetup:!1,isAppend:!1,numLinesLogged:0,maxLinesToLog:1e4,logContainer:null,setup:function(){if(!x3dom.debug.isSetup){try{void 0!==window.console.firebug&&(x3dom.debug.isFirebugAvailable=!0)}catch(e){x3dom.debug.isFirebugAvailable=!1}x3dom.debug.setupLogContainer(),x3dom.debug.isSetup=!0}},activate:function(e){x3dom.debug.isActive=!0,x3dom.debug.logContainer.style.display=e?"block":"none"},setupLogContainer:function(){x3dom.debug.logContainer=document.createElement("div"),x3dom.debug.logContainer.setAttribute("class","x3dom-log")},appendElement:function(e){e.appendChild(x3dom.debug.logContainer)},doLog:function(e,t){if(x3dom.debug.isActive&&(x3dom.debug.numLinesLogged===x3dom.debug.maxLinesToLog&&(e="Maximum number of log lines (="+x3dom.debug.maxLinesToLog+") reached. Deactivating logging..."),!(x3dom.debug.numLinesLogged>x3dom.debug.maxLinesToLog))){var i=document.createElement("p");switch(i.style.margin=0,t){case x3dom.debug.INFO:i.style.color="#00ff00";break;case x3dom.debug.WARNING:i.style.color="#cd853f";break;case x3dom.debug.ERROR:i.style.color="#ff4500";break;case x3dom.debug.EXCEPTION:i.style.color="#ffff00";break;default:i.style.color="#00ff00"}try{i.innerHTML=t+": "+e,x3dom.debug.logContainer.insertBefore(i,x3dom.debug.logContainer.firstChild)}catch(t){void 0!==window.console.firebug&&window.console.warn(e)}if(x3dom.debug.isFirebugAvailable)switch(t){case x3dom.debug.INFO:window.console.info(e);break;case x3dom.debug.WARNING:window.console.warn(e);break;case x3dom.debug.ERROR:window.console.error(e);break;case x3dom.debug.EXCEPTION:window.console.debug(e)}x3dom.debug.numLinesLogged++}},logInfo:function(e){x3dom.debug.doLog(e,x3dom.debug.INFO)},logWarning:function(e){x3dom.debug.doLog(e,x3dom.debug.WARNING)},logError:function(e){x3dom.debug.doLog(e,x3dom.debug.ERROR)},logException:function(e){x3dom.debug.doLog(e,x3dom.debug.EXCEPTION)},assert:function(e,t){e||x3dom.debug.doLog("Assertion failed in "+x3dom.debug.assert.caller.name+": "+t,x3dom.debug.ERROR)},typeOf:function(e){var t=typeof e;return"object"!=t||e?t:"null"},exists:function(e,t,i){return i=i||"function",(e?this.typeOf(e[t]):"null")===i},dumpFields:function(e){var t,i="";for(t in e)i+=t+", ";return x3dom.debug.logInfo(i+="\n"),i}},x3dom.debug.setup(),x3dom.X3DCanvas=function(e,t){var i=this;this._canvasIdx=t,this.x3dElem=e,this._current_dim=[0,0],this.fps_t0=(new Date).getTime(),this.lastTimeFPSWasTaken=0,this.framesSinceLastTime=0,this._totalTime=0,this._elapsedTime=0,this.doc=null,this.isSessionSupportedPromise=null,this.xrSession=null,this.xrReferenceSpace=null,this.supportsPassiveEvents=!1,this.devicePixelRatio=window.devicePixelRatio||1,this.lastMousePos={x:0,y:0},x3dom.caps.DOMNodeInsertedEvent_perSubtree=!(-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident")),e.__setAttribute=e.setAttribute,e.setAttribute=function(e,t){switch(this.__setAttribute(e,t),t=parseInt(t),e){case"width":i.canvas.setAttribute("width",t*i.devicePixelRatio),i.doc&&i.doc._viewarea&&(i.doc._viewarea._width=parseInt(i.canvas.getAttribute("width"),0),i.doc.needRender=!0);break;case"height":i.canvas.setAttribute("height",t*i.devicePixelRatio),i.doc&&i.doc._viewarea&&(i.doc._viewarea._height=parseInt(i.canvas.getAttribute("height"),0),i.doc.needRender=!0)}},this.backend=this.x3dElem.getAttribute("backend"),this.backend=this.backend?this.backend.toLowerCase():"none",this.canvas=this._createHTMLCanvas(e),x3dom.debug.appendElement(e),(this.canvas.parent=this).gl=this._initContext(this.canvas),this.backend="webgl",null==this.gl?(this.hasRuntime=!1,this._createInitFailedDiv(e)):(x3dom.caps.BACKEND=this.backend,t=e.getAttribute("runtimeEnabled"),this.hasRuntime=null!==t?"true"==t.toLowerCase():e.hasRuntime,this.showStat=e.getAttribute("showStat"),this.stateViewer=new x3dom.States(e),null!==this.showStat&&"true"==this.showStat&&this.stateViewer.display(!0),this.x3dElem.appendChild(this.stateViewer.viewer),this.showProgress=e.getAttribute("showProgress"),this.progressDiv=this._createProgressDiv(),this.progressDiv.style.display=null!==this.showProgress&&"true"==this.showProgress?"flex":"none",this.x3dElem.appendChild(this.progressDiv),this.vrDiv=this._createVRDiv(),this.x3dElem.appendChild(this.vrDiv),this.showTouchpoints=e.getAttribute("showTouchpoints"),this.showTouchpoints=!!this.showTouchpoints&&this.showTouchpoints,this.disableTouch=e.getAttribute("disableTouch"),this.disableTouch=!!this.disableTouch&&"true"==this.disableTouch.toLowerCase(),this.disableKeys=e.getAttribute("disableKeys"),this.disableKeys=!!this.disableKeys&&"true"==this.disableKeys.toLowerCase(),this.disableRightDrag=e.getAttribute("disableRightDrag"),this.disableRightDrag=!!this.disableRightDrag&&"true"==this.disableRightDrag.toLowerCase(),this.disableLeftDrag=e.getAttribute("disableLeftDrag"),this.disableLeftDrag=!!this.disableLeftDrag&&"true"==this.disableLeftDrag.toLowerCase(),this.disableMiddleDrag=e.getAttribute("disableMiddleDrag"),this.disableMiddleDrag=!!this.disableMiddleDrag&&"true"==this.disableMiddleDrag.toLowerCase(),this.detectPassiveEvents(),this.bindEventListeners())},x3dom.X3DCanvas.prototype.detectPassiveEvents=function(){var e,t,i;"undefined"!=typeof window&&"function"==typeof window.addEventListener&&(e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}}),i=function(){},window.addEventListener("testPassiveEventSupport",i,t),window.removeEventListener("testPassiveEventSupport",i,t),this.supportsPassiveEvents=e)},x3dom.X3DCanvas.prototype.bindEventListeners=function(){var f,c=this;this.onMouseDown=function(e){if(!this.isMulti){switch(this.focus(),this.classList.add("x3dom-canvas-mousedown"),e.button){case 0:this.mouse_button=1;break;case 1:this.mouse_button=4;break;case 2:this.mouse_button=2;break;default:this.mouse_button=0}e.shiftKey&&(this.mouse_button=1),e.ctrlKey&&(this.mouse_button=4),e.altKey&&(this.mouse_button=2);e=this.parent.mousePosition(e);this.mouse_drag_x=e.x,this.mouse_drag_y=e.y,this.mouse_dragging=!0,this.parent.doc.onMousePress(c.gl,this.mouse_drag_x,this.mouse_drag_y,this.mouse_button),this.parent.doc.needRender=!0}},this.onMouseUp=function(e){var t;this.isMulti||(t=this.mouse_button,this.classList.remove("x3dom-canvas-mousedown"),this.mouse_button=0,this.mouse_dragging=!1,this.parent.doc.onMouseRelease(c.gl,this.mouse_drag_x,this.mouse_drag_y,this.mouse_button,t),this.parent.doc.needRender=!0)},this.onMouseOver=function(e){this.isMulti||(this.mouse_button=0,this.mouse_dragging=!1,this.parent.doc.onMouseOver(c.gl,this.mouse_drag_x,this.mouse_drag_y,this.mouse_button),this.parent.doc.needRender=!0)},this.onMouseOut=function(e){this.isMulti||(this.mouse_button=0,this.mouse_dragging=!1,this.classList.remove("x3dom-canvas-mousedown"),this.parent.doc.onMouseOut(c.gl,this.mouse_drag_x,this.mouse_drag_y,this.mouse_button),this.parent.doc.needRender=!0)},this.onDoubleClick=function(e){this.isMulti||(this.mouse_button=0,e=this.parent.mousePosition(e),this.mouse_drag_x=e.x,this.mouse_drag_y=e.y,this.mouse_dragging=!1,this.parent.doc.onDoubleClick(c.gl,this.mouse_drag_x,this.mouse_drag_y),this.parent.doc.needRender=!0)},this.onMouseMove=function(e){var t;this.isMulti||(t=this.parent.mousePosition(e)).x==c.lastMousePos.x&&t.y==c.lastMousePos.y||(c.lastMousePos=t,this.mouse_drag_x=t.x,this.mouse_drag_y=t.y,this.mouse_dragging?(e.shiftKey&&(this.mouse_button=1),e.ctrlKey&&(this.mouse_button=4),e.altKey&&(this.mouse_button=2),(1==this.mouse_button&&!this.parent.disableLeftDrag||2==this.mouse_button&&!this.parent.disableRightDrag||4==this.mouse_button&&!this.parent.disableMiddleDrag)&&this.parent.doc.onDrag(c.gl,this.mouse_drag_x,this.mouse_drag_y,this.mouse_button)):this.parent.doc.onMove(c.gl,this.mouse_drag_x,this.mouse_drag_y,this.mouse_button),this.parent.doc.needRender=!0,e.preventDefault(),e.stopPropagation())},this.onDOMMouseScroll=function(e){var t;this.isMulti||(this.focus(),t=this.parent.mousePosition(e).y,1==this.parent.doc._scene.getNavigationInfo()._vf.reverseScroll?this.mouse_drag_y-=2*e.detail:this.mouse_drag_y+=2*e.detail,this.parent.doc.onWheel(c.gl,this.mouse_drag_x,this.mouse_drag_y,t),this.parent.doc.needRender=!0,e.preventDefault(),e.stopPropagation())},this.onKeyPress=function(e){this.parent.disableKeys||(e.preventDefault(),this.parent.doc.onKeyPress(e.charCode)),this.parent.doc.needRender=!0},this.onMouseWheel=function(e){var t;this.isMulti||(this.focus(),t=this.parent.mousePosition(e).y,1==this.parent.doc._scene.getNavigationInfo()._vf.reverseScroll?this.mouse_drag_y+=.1*e.wheelDelta:this.mouse_drag_y-=.1*e.wheelDelta,this.parent.doc.onWheel(c.gl,this.mouse_drag_x,this.mouse_drag_y,t),this.parent.doc.needRender=!0,e.preventDefault(),e.stopPropagation())},this.onKeyUp=function(e){this.parent.disableKeys||this.parent.doc.onKeyUp(e.keyCode),this.parent.doc.needRender=!0},this.onKeyDown=function(e){this.parent.disableKeys||this.parent.doc.onKeyDown(e.keyCode),this.parent.doc.needRender=!0},null!==this.canvas&&null!==this.gl&&this.hasRuntime&&(this.canvas.mouse_dragging=!1,this.canvas.mouse_button=0,this.canvas.mouse_drag_x=0,this.canvas.mouse_drag_y=0,this.canvas.isMulti=!1,this.canvas.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1},this.canvas.addEventListener("webglcontextlost",function(e){x3dom.debug.logError("WebGL context lost"),e.preventDefault()},!1),this.canvas.addEventListener("webglcontextrestored",function(e){x3dom.debug.logError("recover WebGL state and resources on context lost NYI"),e.preventDefault()},!1),this.canvas.addEventListener("mousedown",this.onMouseDown,!1),this.canvas.addEventListener("mouseup",this.onMouseUp,!1),this.canvas.addEventListener("mouseover",this.onMouseOver,!1),this.canvas.addEventListener("mouseout",this.onMouseOut,!1),this.canvas.addEventListener("dblclick",this.onDoubleClick,!1),this.canvas.addEventListener("mousemove",this.onMouseMove,!1),this.canvas.addEventListener("DOMMouseScroll",this.onDOMMouseScroll,!1),this.canvas.addEventListener("mousewheel",this.onMouseWheel,!!this.supportsPassiveEvents&&{passive:!1}),this.canvas.addEventListener("keypress",this.onKeyPress,!0),this.canvas.addEventListener("keyup",this.onKeyUp,!0),this.canvas.addEventListener("keydown",this.onKeyDown,!0),f={numTouches:0,firstTouchTime:(new Date).getTime(),firstTouchPoint:new x3dom.fields.SFVec2f(0,0),lastPos:new x3dom.fields.SFVec2f,lastDrag:new x3dom.fields.SFVec2f,lastMiddle:new x3dom.fields.SFVec2f,lastSquareDistance:0,lastAngle:0,lastLayer:[],examineNavType:1,calcAngle:function(e){var t=e.normalize().dot(new x3dom.fields.SFVec2f(1,0)),t=Math.acos(t);return t=e.y<0?Math.PI+(Math.PI-t):t},disableTouch:this.disableTouch,visMarker:this.showTouchpoints,visMarkerBag:[],visualizeTouches:function(e){if(this.visMarker){for(var t=[],i=null,o=0;o<e.touches.length;o++){var s,n=(n=e.touches[o].identifier||e.touches[o].streamId)||0;0<=this.visMarkerBag.indexOf(n)?((i=document.getElementById("visMarker"+n)).style.left=e.touches[o].pageX+"px",i.style.top=e.touches[o].pageY+"px"):((i=document.createElement("div")).appendChild(document.createTextNode("#"+n)),i.id="visMarker"+n,i.className="x3dom-touch-marker",document.body.appendChild(i),s=this.visMarkerBag.length,this.visMarkerBag[s]=n),t.push(n)}for(var r=this.visMarkerBag.length-1;0<=r;r--){var a=this.visMarkerBag[r];t.indexOf(a)<0&&(this.visMarkerBag.splice(r,1),i=document.getElementById("visMarker"+a),document.body.removeChild(i))}}}},this.disableTouch||(this.canvas.addEventListener("touchstart",function(e,t){var i,o,s,n,r;switch(this.isMulti=!0,e.preventDefault(),f.visualizeTouches(e),this.focus(),(t=null==t?this.parent.doc:t)._scene.getNavigationInfo().getType()){case"examine":f.examineNavType=1;break;case"turntable":f.examineNavType=2;break;default:f.examineNavType=0}for(f.lastLayer=[],i=0;i<e.touches.length;i++)o=this.parent.mousePosition(e.touches[i]),f.lastLayer.push([e.touches[i].identifier,new x3dom.fields.SFVec2f(o.x,o.y)]);if(f.numTouches<1&&1==e.touches.length?(f.numTouches=1,f.lastDrag=new x3dom.fields.SFVec2f(e.touches[0].screenX,e.touches[0].screenY)):f.numTouches<2&&2<=e.touches.length&&(f.numTouches=2,n=new x3dom.fields.SFVec2f(e.touches[0].screenX,e.touches[0].screenY),n=(s=new x3dom.fields.SFVec2f(e.touches[1].screenX,e.touches[1].screenY).subtract(n)).multiply(.5).add(n),r=s.dot(s),f.lastMiddle=n,f.lastSquareDistance=r,f.lastAngle=f.calcAngle(s),f.lastPos=this.parent.mousePosition(e.touches[0])),t._scene.updateVolume(),1==f.examineNavType)for(i=0;i<e.touches.length;i++)o=this.parent.mousePosition(e.touches[i]),t.onPick(c.gl,o.x,o.y),t._viewarea.prepareEvents(o.x,o.y,0,"onmouseover"),t._viewarea.prepareEvents(o.x,o.y,1,"onmousedown"),t._viewarea._pickingInfo.lastClickObj=t._viewarea._pickingInfo.pickObj;else e.touches.length&&(o=this.parent.mousePosition(e.touches[0]),t.onMousePress(c.gl,o.x,o.y,1));t.needRender=!0},!this.supportsPassiveEvents||{passive:!1}),this.canvas.addEventListener("touchmove",function(e,t){e.preventDefault(),f.visualizeTouches(e),null==t&&(t=this.parent.doc);var i,o,s,n,r,a,d,l,h=null,u=null;1==f.examineNavType?1==e.touches.length?(a=(s=new x3dom.fields.SFVec2f(e.touches[0].screenX,e.touches[0].screenY)).subtract(f.lastDrag),f.lastDrag=s,s=x3dom.fields.SFMatrix4f.rotationY(a.x/100),a=x3dom.fields.SFMatrix4f.rotationX(a.y/100),u=s.mult(a),t.onMoveView(c.gl,e,f,null,u),h=this.parent.mousePosition(e.touches[0]),t.onPick(c.gl,h.x,h.y),t._viewarea.prepareEvents(h.x,h.y,1,"onmousemove")):2<=e.touches.length&&(o=new x3dom.fields.SFVec2f(e.touches[0].screenX,e.touches[0].screenY),s=(i=new x3dom.fields.SFVec2f(e.touches[1].screenX,e.touches[1].screenY).subtract(o)).multiply(.5).add(o),n=i.dot(i),a=s.subtract(f.lastMiddle),r=n-f.lastSquareDistance,a=new x3dom.fields.SFVec3f(a.x/screen.width,-a.y/screen.height,r/(screen.width*screen.height*.2)),d=f.calcAngle(i),l=f.lastAngle-d,f.lastAngle=d,u=x3dom.fields.SFMatrix4f.rotationZ(l),f.lastMiddle=s,f.lastSquareDistance=n,t.onMoveView(c.gl,e,f,a,u)):e.touches.length&&(2==f.examineNavType&&2<=e.touches.length?(o=new x3dom.fields.SFVec2f(e.touches[0].screenX,e.touches[0].screenY),r=((n=(i=new x3dom.fields.SFVec2f(e.touches[1].screenX,e.touches[1].screenY).subtract(o)).dot(i))-f.lastSquareDistance)/(.1*(screen.width+screen.height)),f.lastPos.y+=r,f.lastSquareDistance=n,t.onDrag(c.gl,f.lastPos.x,f.lastPos.y,2)):(h=this.parent.mousePosition(e.touches[0]),t.onDrag(c.gl,h.x,h.y,1))),t.needRender=!0},!this.supportsPassiveEvents||{passive:!1}),this.canvas.addEventListener("touchend",function(e,t){if(this.isMulti=!1,e.cancelable&&e.preventDefault(),f.visualizeTouches(e),(t=null==t?this.parent.doc:t)._viewarea._isMoving=!1,2==f.numTouches&&1==e.touches.length&&(f.lastDrag=new x3dom.fields.SFVec2f(e.touches[0].screenX,e.touches[0].screenY)),0==e.touches.length){for(var i=t._nodeBag.affectedPointingSensors,o=0;o<i.length;++o)i[o].pointerReleased();t._nodeBag.affectedPointingSensors=[]}var s=!1;if(e.touches.length<2&&(1==f.numTouches&&(s=!0),f.numTouches=e.touches.length),1==f.examineNavType){for(o=0;o<f.lastLayer.length;o++){var n,r,a,d=f.lastLayer[o][1];t.onPick(c.gl,d.x,d.y),"box"!==t._scene._vf.pickMode.toLowerCase()?(t._viewarea.prepareEvents(d.x,d.y,1,"onmouseup"),t._viewarea._pickingInfo.lastClickObj=t._viewarea._pickingInfo.pickObj,t._viewarea._pickingInfo.pickObj&&t._viewarea._pickingInfo.pickObj===t._viewarea._pickingInfo.lastClickObj&&t._viewarea.prepareEvents(d.x,d.y,1,"onclick")):(n=t._viewarea.calcViewRay(d.x,d.y),r=t._scene.doIntersect(n),a=n.hitObject,r&&a&&(t._viewarea._pick.setValues(n.hitPoint),t._viewarea.checkEvents(a,d.x,d.y,1,"onclick"),x3dom.debug.logInfo("Hit '"+a._xmlNode.localName+"/ "+a._DEF+"' at pos "+t._viewarea._pick)))}s&&(e=(new Date).getTime(),f.firstTouchPoint.subtract(f.lastDrag).length()<18&&e-f.firstTouchTime<180&&t.onDoubleClick(c.gl,0,0),f.firstTouchTime=e,f.firstTouchPoint=f.lastDrag)}else f.lastLayer.length&&(d=f.lastLayer[0][1],t.onMouseRelease(c.gl,d.x,d.y,0,1));t.needRender=!0},!0)))},x3dom.X3DCanvas.prototype._initContext=function(e){x3dom.debug.logInfo("Initializing X3DCanvas for ["+e.id+"]");var t=x3dom.gfx_webgl(e,this.x3dElem);return t?(parseFloat(x3dom.caps.VERSION.match(/\d+\.\d+/)[0])<1&&x3dom.debug.logError("WebGL version "+x3dom.caps.VERSION+" lacks important WebGL/GLSL features needed for shadows, special vertex attribute types, etc.!"),t):(x3dom.debug.logError("No 3D context found..."),this.x3dElem.removeChild(e),null)},x3dom.X3DCanvas.prototype.appendParam=function(e,t,i){var o=document.createElement("param");o.setAttribute("name",t),o.setAttribute("value",i),e.appendChild(o)},x3dom.X3DCanvas.prototype._createInitFailedDiv=function(e){var t=document.createElement("div"),i=(t.setAttribute("id","x3dom-create-init-failed"),t.style.width=e.getAttribute("width"),t.style.height=e.getAttribute("height"),t.style.backgroundColor="#C00",t.style.color="#FFF",t.style.fontSize="20px",t.style.fontWidth="bold",t.style.padding="10px 10px 10px 10px",t.style.display="inline-block",t.style.fontFamily="Helvetica",t.style.textAlign="center",t.appendChild(document.createTextNode("Your Browser does not support X3DOM")),t.appendChild(document.createElement("br")),t.appendChild(document.createTextNode("Read more about Browser support on:")),t.appendChild(document.createElement("br")),document.createElement("a")),i=(i.setAttribute("href","http://www.x3dom.org/?page_id=9"),i.appendChild(document.createTextNode("X3DOM | Browser Support")),t.appendChild(i),e.getAttribute("altImg")||null);i&&((new Image).src=i,t.style.backgroundImage="url("+i+")",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="50% 50%"),e.appendChild(t),x3dom.debug.logError("Your Browser does not support X3DOM!")},x3dom.X3DCanvas.prototype._createHTMLCanvas=function(i){x3dom.debug.logInfo("Creating canvas for (X)3D element...");var n=document.createElement("canvas");n.setAttribute("class","x3dom-canvas"),i.getAttribute("style")&&x3dom.debug.logInfo("Inline X3D styles detected");for(var r=["onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onclick","ondblclick","onkeydown","onkeypress","onkeyup","ontouchstart","ontouchmove","ontouchend","ontouchcancel","ontouchleave","ontouchenter","ondragstart","ondrop","ondragover"],e=0;e<r.length;e++){var t=r[e],o=i.getAttribute(t);o&&(x3dom.debug.logInfo(t+", "+o),n.setAttribute(t,o),i.removeAttribute(t))}var s=i.getAttribute("draggable");s&&(x3dom.debug.logInfo("draggable="+s),n.setAttribute("draggable",s)),i.__addEventListener||i.__removeEventListener||(i.__addEventListener=i.addEventListener,i.__removeEventListener=i.removeEventListener,i.addEventListener=function(e,t,i){for(var o=!1,s=0;s<r.length&&!o;s++)r[s]===e&&(o=!0);o?(x3dom.debug.logInfo("addEventListener for div.on"+e),n.addEventListener(e,t,i)):(x3dom.debug.logInfo("addEventListener for X3D.on"+e),this.__addEventListener(e,t,i))},i.removeEventListener=function(e,t,i){for(var o=!1,s=0;s<r.length&&!o;s++)r[s]===e&&(o=!0);o?(x3dom.debug.logInfo("removeEventListener for div.on"+e),n.removeEventListener(e,t,i)):(x3dom.debug.logInfo("removeEventListener for X3D.on"+e),this.__removeEventListener(e,t,i))}),i.hasAttribute("ondownloadsfinished")&&i.addEventListener("downloadsfinished",function(){var e={target:i,type:"downloadsfinished"},t=i.getAttribute("ondownloadsfinished");new Function("event",t).call(i,e)},!0),i.appendChild(n);var s=i.getAttribute("id");return null!==s?n.id="x3dom-"+s+"-canvas":(s=(new Date).getTime(),n.id="x3dom-"+s+"-canvas"),i.style=i.style||{},null!==(s=i.getAttribute("width"))&&(0<=s.indexOf("%")&&x3dom.debug.logWarning("The width attribute is to be specified in pixels not in percent."),n.style.width=s,i.style.width=s,n.setAttribute("width",s)),null!==(s=i.getAttribute("height"))&&(0<=s.indexOf("%")&&x3dom.debug.logWarning("The height attribute is to be specified in pixels not in percent."),n.style.height=s,i.style.height=s,n.setAttribute("height",s)),n.setAttribute("tabindex","0"),n},x3dom.X3DCanvas.prototype._watchForResize=function(){var e;this.xrSession||(e=[parseInt(x3dom.getStyle(this.canvas,"width"))||0,parseInt(x3dom.getStyle(this.canvas,"height"))||0],this._current_dim[0]==e[0]&&this._current_dim[1]==e[1])||(this._current_dim=e,this.x3dElem.setAttribute("width",e[0]+"px"),this.x3dElem.setAttribute("height",e[1]+"px"))},x3dom.X3DCanvas.prototype._createProgressDiv=function(){var e=document.createElement("div"),t=(e.setAttribute("class","x3dom-progress"),document.createElement("div")),t=(t.setAttribute("class","x3dom-progress-spinner"),e.appendChild(t),document.createElement("div"));return t.setAttribute("id","x3domProgessCount"),t.appendChild(document.createTextNode("Loading...")),e.appendChild(t),e.oncontextmenu=e.onmousedown=function(e){return e.preventDefault(),e.stopPropagation(),!1},e},x3dom.X3DCanvas.prototype._createVRDiv=function(){var e=document.createElement("div");return e.setAttribute("class","x3dom-vr"),e.onclick=e=>{this.x3dElem.runtime.toggleVR()},e.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1},e.title="Toggle VR",e},x3dom.X3DCanvas.prototype.mousePosition=function(e){var t=e.target.getBoundingClientRect(),i=Math.round(e.clientX-t.left)*this.devicePixelRatio,e=Math.round(e.clientY-t.top)*this.devicePixelRatio;return new x3dom.fields.SFVec2f(i,e)},x3dom.X3DCanvas.prototype.tick=function(e,t){this._elapsedTime=this._totalTime?e-this._totalTime:0,this._totalTime=e;var e=this.x3dElem.runtime,i=(new Date).getTime(),o=i-this.lastTimeFPSWasTaken;this.fps_t0,this.fps_t0=i,this.doc.advanceTime(i/1e3);var s,n=(new Date).getTime()-i;this.doc.hasAnimationStateChanged()&&(this.doc.isAnimating()?e.onAnimationStarted():e.onAnimationFinished()),(this.doc.needRender||t)&&(1e3<=o&&(e.fps=this.framesSinceLastTime/(o/1e3),e.addMeasurement("FPS",e.fps),this.framesSinceLastTime=0,this.lastTimeFPSWasTaken=i),this.framesSinceLastTime++,e.addMeasurement("ANIM",n),0==e.isReady&&(e.ready(),e.isReady=!0),e.enterFrame({total:this._totalTime,elapsed:this._elapsedTime}),t||(this.doc.needRender=!1),this.doc.render(this.gl,this.getVRFrameData(t)),this.doc._scene._vf.doPickPass||e.removeMeasurement("PICKING"),e.exitFrame({total:this._totalTime,elapsed:this._elapsedTime})),this.progressDiv&&(0<this.doc.downloadCount?e.addInfo("#LOADS:",this.doc.downloadCount):e.removeInfo("#LOADS:"),"false"!==this.doc.properties.getProperty("showProgress")?this.progressDiv&&(o=Math.max(+this.doc.downloadCount,0),this.progressDiv.childNodes[1].textContent=""+o,0<this.doc.downloadCount?this.progressDiv.style.opacity="1":this.progressDiv.style.opacity="0"):this.progressDiv.style.opacity="0"),this.doc.downloadCount<=0&&0<this.doc.previousDownloadCount&&(document.createEvent?((s=document.createEvent("Events")).initEvent("downloadsfinished",!0,!0),this.x3dElem.dispatchEvent(s)):document.createEventObject&&(s=document.createEventObject(),this.x3dElem.fireEvent("ondownloadsfinished",s))),this.doc.previousDownloadCount=this.doc.downloadCount},x3dom.X3DCanvas.prototype.mainloop=function(e,t){this.doc&&this.x3dElem.runtime&&(this._watchForResize(),this.tick(e,t),this.xrSession?this.xrSession.requestAnimationFrame(this.mainloop):window.requestAnimFrame(this.mainloop))},x3dom.X3DCanvas.prototype.load=function(e,t,i){this.doc=new x3dom.X3DDocument(this.canvas,this.gl,i),this.doc.onload=()=>{this.mainloop=this.mainloop.bind(this),this.checkForVRSupport(),this.hasRuntime?this.mainloop():this.tick()},this.x3dElem.render=()=>{this.hasRuntime?this.doc.needRender=!0:this.doc.render(x3dCanvas.gl)},this.x3dElem.context=this.gl.ctx3d,this.doc.onerror=function(){alert("Failed to load X3D document")},this.doc.load(e,t)},x3dom.X3DCanvas.prototype.checkForVRSupport=function(){navigator.xr&&navigator.xr.isSessionSupported("immersive-vr").then(e=>{e&&(this.vrDiv.style.display="block")})},x3dom.X3DCanvas.prototype.enterVR=function(){this.xrSession||this.gl.ctx3d.makeXRCompatible().then(()=>{navigator.xr.requestSession("immersive-vr").then(i=>{i.requestReferenceSpace("local").then(e=>{var t=new XRWebGLLayer(i,this.gl.ctx3d),t=(i.updateRenderState({baseLayer:t}),this._oldCanvasWidth=this.canvas.width,this._oldCanvasHeight=this.canvas.height,this.canvas.width=t.framebufferWidth,this.canvas.height=t.framebufferHeight,this.gl.VRMode=2,this.xrReferenceSpace=e,this.xrSession=i,this.doc.needRender=!0,this.doc._viewarea.getViewMatrix()),e=new x3dom.fields.Quaternion(0,0,1,0),t=(e.normalize(),e.setValue(t),t.e3()),t=new XRRigidTransform({x:t.x,y:t.y,z:t.z},{x:e.x,y:e.y,z:e.z,w:e.w});this.xrReferenceSpace=this.xrReferenceSpace.getOffsetReferenceSpace(t),this.xrSession.addEventListener("end",()=>{this.exitVR()}),i.requestAnimationFrame(this.mainloop)})})})},x3dom.X3DCanvas.prototype.exitVR=function(){this.xrSession&&(this.xrSession.end(),this.xrSession=void 0,this.xrReferenceSpace=void 0,this.canvas.width=this._oldCanvasWidth,this.canvas.height=this._oldCanvasHeight,this.gl.VRMode=1,this.doc.needRender=!0,window.requestAnimationFrame(this.mainloop))},x3dom.X3DCanvas.prototype.getVRFrameData=function(i){if(i){let t=i.getViewerPose(this.xrReferenceSpace);if(t){var o,s={framebuffer:i.session.renderState.baseLayer.framebuffer,controllers:{}};for(let e of t.views)"left"===e.eye?(s.leftViewMatrix=e.transform.inverse.matrix,s.leftProjectionMatrix=e.projectionMatrix):"right"===e.eye&&(s.rightViewMatrix=e.transform.inverse.matrix,s.rightProjectionMatrix=e.projectionMatrix);for(let e of i.session.inputSources)e.gripSpace&&null!==(o=i.getPose(e.gripSpace,this.xrReferenceSpace))&&null!==o.transform&&(s.controllers[e.handedness]={gamepad:e.gamepad,type:e.profiles[0],pose:{position:[o.transform.position.x,o.transform.position.y,o.transform.position.z],orientation:[o.transform.orientation.x,o.transform.orientation.y,o.transform.orientation.z,o.transform.orientation.w]}});return s}}},x3dom.InputTypes={NAVIGATION:1,INTERACTION:2},x3dom.Viewarea=function(e,t){this._doc=e,this._scene=t,e._nodeBag.viewarea.push(this),this._pickingInfo={pickPos:new x3dom.fields.SFVec3f(0,0,0),pickNorm:new x3dom.fields.SFVec3f(0,0,1),pickObj:null,firstObj:null,lastObj:null,lastClickObj:null,shadowObjectId:-1},this._currentInputType=x3dom.InputTypes.NAVIGATION,this._rotMat=x3dom.fields.SFMatrix4f.identity(),this._transMat=x3dom.fields.SFMatrix4f.identity(),this._movement=new x3dom.fields.SFVec3f(0,0,0),this._needNavigationMatrixUpdate=!0,this._deltaT=0,this._flyMat=null,this._pitch=0,this._yaw=0,this._eyePos=new x3dom.fields.SFVec3f(0,0,0),this._width=400,this._height=300,this._dx=0,this._dy=0,this._lastX=-1,this._lastY=-1,this._pressX=-1,this._pressY=-1,this._lastButton=0,this._points=0,this._numRenderedNodes=0,this._pick=new x3dom.fields.SFVec3f(0,0,0),this._pickNorm=new x3dom.fields.SFVec3f(0,0,1),this._isAnimating=!1,this._isMoving=!1,this._lastTS=0,this._mixer=new x3dom.MatrixMixer,this._interpolator=new x3dom.FieldInterpolator,this._animationStateChanged=!1,this.vrFrameData=null,this.gamepads=null,this.vrLeftViewMatrix=new x3dom.fields.SFMatrix4f,this.vrRightViewMatrix=new x3dom.fields.SFMatrix4f,this.vrLeftProjMatrix=new x3dom.fields.SFMatrix4f,this.vrRightProjMatrix=new x3dom.fields.SFMatrix4f,this.vrControllerManager=new x3dom.VRControllerManager(this._doc),this._inverseDevicePixelRatio=1/window.devicePixelRatio,this.arc=null},x3dom.Viewarea.prototype.setVRFrameData=function(e,t){this.vrFrameData=t,this.vrFrameData&&(this.vrLeftViewMatrix.setFromArray(this.vrFrameData.leftViewMatrix),this.vrRightViewMatrix.setFromArray(this.vrFrameData.rightViewMatrix),this.vrLeftProjMatrix.setFromArray(this.vrFrameData.leftProjectionMatrix),this.vrRightProjMatrix.setFromArray(this.vrFrameData.rightProjectionMatrix))},x3dom.Viewarea.prototype.updateGamepads=function(e){this.vrControllerManager.update(this,e)},x3dom.Viewarea.prototype.tick=function(e){this._scene.getEnvironment()._vf.enableARC&&null==this.arc&&(this.arc=new x3dom.arc.AdaptiveRenderControl(this._scene)),this._mixer.isActive()&&(this._mixer._isVPtarget&&((t=this._scene.getViewpoint()).resetView(),t=t.getViewMatrix().mult(t.getCurrentTransform().inverse()),this._mixer.setEndMatrix(t)),t=this._mixer.mix(e),this._scene.getViewpoint().setView(t)),this._interpolator.isActive()&&(t=this._interpolator.interpolate(e),this._scene.getViewpoint().setZoom(t));var t=this.navigateTo(e),i=this._isAnimating;return this._lastTS=e,this._isAnimating=this._mixer.isMixing||this._interpolator.isInterpolating||t,this._isAnimating!=i?this._animationStateChanged=!0:this._animationStateChanged=!1,null!=this.arc&&this.arc.update(this.isMovingOrAnimating()?1:0,this._doc._x3dElem.runtime.getFPS()),this._isAnimating||i},x3dom.Viewarea.prototype.isMoving=function(){return this._isMoving},x3dom.Viewarea.prototype.isAnimating=function(){return this._isAnimating},x3dom.Viewarea.prototype.hasAnimationStateChanged=function(){return this._animationStateChanged},x3dom.Viewarea.prototype.isMovingOrAnimating=function(){return this._isMoving||this._isAnimating},x3dom.Viewarea.prototype.navigateTo=function(e){return this._scene.getNavigationInfo()._impl.navigateTo(this,e)},x3dom.Viewarea.prototype.moveFwd=function(){this._scene.getNavigationInfo()._impl.moveForward(this)},x3dom.Viewarea.prototype.moveBwd=function(){this._scene.getNavigationInfo()._impl.moveBackwards(this)},x3dom.Viewarea.prototype.strafeRight=function(){this._scene.getNavigationInfo()._impl.strafeRight(this)},x3dom.Viewarea.prototype.strafeLeft=function(){this._scene.getNavigationInfo()._impl.strafeLeft(this)},x3dom.Viewarea.prototype.animateTo=function(e,t,i){this._scene.getNavigationInfo()._impl.animateTo(this,e,t,i)},x3dom.Viewarea.prototype.orthoAnimateTo=function(e,t,i){this._scene.getNavigationInfo()._impl.orthoAnimateTo(this,e,t,i)},x3dom.Viewarea.prototype.zoom=function(e){this._scene.getNavigationInfo()._impl.zoom(this,e)},x3dom.Viewarea.prototype.getLights=function(){for(var e=[],t=0;t<this._doc._nodeBag.lights.length;t++)1==this._doc._nodeBag.lights[t]._vf.on&&e.push(this._doc._nodeBag.lights[t]);return e},x3dom.Viewarea.prototype.getLightsShadow=function(){for(var e=this._doc._nodeBag.lights,t=0;t<e.length;t++)if(0<e[t]._vf.shadowIntensity&&e[t]._vf.on)return!0;return!1},x3dom.Viewarea.prototype.hasPhysicalEnvironmentLight=function(){for(var e=0;e<this._doc._nodeBag.lights.length;e++){var t=this._doc._nodeBag.lights[e];if(x3dom.isa(t,x3dom.nodeTypes.PhysicalEnvironmentLight)&&t._vf.on)return!0}return!1},x3dom.Viewarea.prototype.updateSpecialNavigation=function(e,t){var i,o,s=this._scene.getNavigationInfo();"helicopter"!=s.getType()||s._heliUpdated||(i=(o=s.getTypeParams())[0],e=e.getViewMatrix().mult(t.inverse()).inverse(),this._from=e.e3(),this._at=this._from.subtract(e.e2()),this._up=new x3dom.fields.SFVec3f(0,1,0),this._from.y=o[1],this._at.y=this._from.y,t=e.e0(),o=x3dom.fields.Quaternion.axisAngle(t,i).toMatrix(),e=(e=x3dom.fields.SFMatrix4f.translation(this._from)).mult(o),o=x3dom.fields.SFMatrix4f.translation(this._from.negate()),e=e.mult(o),this._at=e.multMatrixPnt(this._at),this._flyMat=x3dom.fields.SFMatrix4f.lookAt(this._from,this._at,this._up),this._scene.getViewpoint().setView(this._flyMat.inverse()),s._heliUpdated=!0)},x3dom.Viewarea.prototype.getViewpointMatrix=function(){var e=this._scene.getViewpoint(),t=e.getCurrentTransform();return this.updateSpecialNavigation(e,t),e.getViewMatrix().mult(t.inverse())},x3dom.Viewarea.prototype.getViewMatrix=function(){return this.vrFrameData?this.vrLeftViewMatrix:this.getViewpointMatrix().mult(this._transMat).mult(this._rotMat)},x3dom.Viewarea.prototype.getViewMatrices=function(){var e;return this.vrFrameData?[this.vrLeftViewMatrix,this.vrRightViewMatrix]:[e=this.getViewpointMatrix().mult(this._transMat).mult(this._rotMat),e]},x3dom.Viewarea.prototype.getLightMatrix=function(e){var t,i=(e=e||this._doc._nodeBag.lights).length;if(0<i){var o=this._scene.getVolume();if(o.isValid()){var s=x3dom.fields.SFVec3f.MAX(),n=x3dom.fields.SFVec3f.MIN(),r=(o.getBounds(s,n),[]),o=this._scene.getViewpoint().getFieldOfView(),a=(l=n.subtract(s)).y/2/Math.tan(o/2)+l.z/2,d=l.x/2/Math.tan(o/2)+l.z/2;for(l=s.add(l.multiply(.5)),t=0;t<i;t++){var l,h,u=e[t];l=x3dom.isa(u,x3dom.nodeTypes.PointLight)?(h=u.getCurrentTransform().multMatrixPnt(u._vf.location),l.subtract(h).normalize()):(h=(h=u.getCurrentTransform().multMatrixVec(u._vf.direction)).normalize().negate(),l.add(h.multiply(1.2*(d<a?a:d)))),r.push(u.getViewMatrix(l))}return r}}return Array(i||1).fill(this.getViewMatrix())},x3dom.Viewarea.prototype.getWCtoLCMatrix=function(e){var t=this.getProjectionMatrix(),e=0===arguments.length?this.getLightMatrix()[0]:e;return t.mult(e)},x3dom.Viewarea.prototype.getWCtoLCMatricesPointLight=function(e,t,i){var o=t._vf.zNear,t=t._vf.zFar,s=this.getLightProjectionMatrix(e,o,t,!1,i);s._00=1,s._11=1;var n,r=[];r[0]=s.mult(e);for(var a=1;a<=3;a++)n=x3dom.fields.SFMatrix4f.rotationY(a*Math.PI/2),r[a]=s.mult(n.mult(e));return n=x3dom.fields.SFMatrix4f.rotationX(Math.PI/2),r[4]=s.mult(n.mult(e)),n=x3dom.fields.SFMatrix4f.rotationX(3*Math.PI/2),r[5]=s.mult(n.mult(e)),r},x3dom.Viewarea.prototype.getWCtoLCMatricesCascaded=function(e,t,i){var o=Math.max(1,Math.min(t._vf.shadowCascades,6)),s=Math.max(0,Math.min(t._vf.shadowSplitFactor,1)),n=Math.max(0,Math.min(t._vf.shadowSplitOffset,1)),r=x3dom.isa(t,x3dom.nodeTypes.SpotLight),a=t._vf.zNear,t=t._vf.zFar,a=this.getLightProjectionMatrix(e,a,t,!0,i),d=(r&&(a._00=1,a._11=1),a.mult(e)),l=[];if(1==o)l[0]=d;else for(var h=this.getShadowSplitDepths(o,s,n,!0,i),u=0;u<o;u++){var f=this.getLightFittingMatrix(d,h[u],h[u+1],i);l[u]=f.mult(d)}return l},x3dom.Viewarea.prototype.getLightProjectionMatrix=function(e,t,i,o,s){var n,r,a,d,l,s=x3dom.fields.SFMatrix4f.copy(s);return!o||0<t||0<i?(o=e.inverse().e3(),d=x3dom.fields.SFVec3f.copy(this._scene._lastMin),a=(l=x3dom.fields.SFVec3f.copy(this._scene._lastMax).subtract(d)).length()/2,d=d.add(l.multiply(.5)),l=o.subtract(d).length(),a&&(n=a<l?.8*(l-a):1,r=1.2*(l+a)),s._22=-((r=0<i?i:r)+(n=0<t?t:n))/(r-n),s._23=-2*r*n/(r-n),s):this.getLightCropMatrix(s.mult(e)).mult(s)},x3dom.Viewarea.prototype.getProjectionMatrix=function(){return this.vrFrameData?this.vrLeftProjMatrix:this._scene.getViewpoint().getProjectionMatrix(this._width/this._height)},x3dom.Viewarea.prototype.getProjectionMatrices=function(){var e;return this.vrFrameData?[this.vrLeftProjMatrix,this.vrRightProjMatrix]:[e=this._scene.getViewpoint().getProjectionMatrix(this._width/this._height),e]},x3dom.Viewarea.prototype.getViewfrustum=function(e){var t,i;return 1==this._scene.getEnvironment()._vf.frustumCulling?0==arguments.length?(t=this.getProjectionMatrix(),i=this.getViewMatrix(),new x3dom.fields.FrustumVolume(t.mult(i))):new x3dom.fields.FrustumVolume(e):null},x3dom.Viewarea.prototype.getWCtoCCMatrix=function(){var e=this.getViewMatrix();return this.getProjectionMatrix().mult(e)},x3dom.Viewarea.prototype.getCCtoWCMatrix=function(){return this.getWCtoCCMatrix().inverse()},x3dom.Viewarea.prototype.calcViewRay=function(e,t,i){var i=i||this.getCCtoWCMatrix(),e=e/(this._width-1)*2-1,t=(this._height-1-t)/(this._height-1)*2-1,o=i.multFullMatrixPnt(new x3dom.fields.SFVec3f(e,t,-1)),i=i.multFullMatrixPnt(new x3dom.fields.SFVec3f(e,t,1)).subtract(o);return new x3dom.fields.Ray(o,i)},x3dom.Viewarea.prototype.showAll=function(e,t){void 0===e&&(e="negZ"),void 0===t&&(t=!1);var i=this._scene;i.updateVolume();var o,s=x3dom.fields.SFVec3f.copy(i._lastMin),n=x3dom.fields.SFVec3f.copy(i._lastMax),r="x",a="y",d="z",l=1,h=new x3dom.fields.SFVec3f(0,0,-1);switch(e){case"posX":l=-1;case"negX":d="x",r="y",a="z",o=new x3dom.fields.SFVec3f(l,0,0);break;case"posY":l=-1;case"negY":d="y",r="z",a="x",o=new x3dom.fields.SFVec3f(0,l,0);break;case"posZ":l=-1;default:o=new x3dom.fields.SFVec3f(0,0,-l)}var e=i.getViewpoint(),i=e.getFieldOfView(),u=x3dom.isa(e,x3dom.nodeTypes.OrthoViewpoint),n=n.subtract(s),f=n.multiply(.5),f=s.add(f),t=(t&&e.setCenterOfRotation(f),Math.min(this._width/this._height,1)),f=n[d]/2,i=Math.tan(i/2),c=n[a]/2/i+f,i=n[r]/2/i+f;(n=s.add(n.multiply(.5)))[d]+=u?l*(i<c?c:i)*3.01:l*(i<c?c:i)*1.01,n[d]/=t;f=(f=x3dom.fields.Quaternion.rotateFromTo(h,o).toMatrix()).mult(x3dom.fields.SFMatrix4f.translation(n.negate()));u&&this.orthoAnimateTo(c,Math.abs(e._fieldOfView[0])),this.animateTo(f,e)},x3dom.Viewarea.prototype.fit=function(e,t,i){var o=this._scene.getViewpoint(),e=this.getFitViewMatrix(e,t,o,i);x3dom.isa(o,x3dom.nodeTypes.OrthoViewpoint)&&this.orthoAnimateTo(dist/2.01,Math.abs(o._fieldOfView[0])),this.animateTo(e,o)},x3dom.Viewarea.prototype.getFitViewMatrix=function(e,t,i,o){void 0===o&&(o=!0);var t=t.subtract(e).multiply(.5),e=e.add(t),t=t.length(),s=i.getFieldOfView(),n=x3dom.fields.SFMatrix4f.copy(this.getViewMatrix()),r=new x3dom.fields.SFVec3f(n._00,n._01,n._02),a=new x3dom.fields.SFVec3f(n._10,n._11,n._12),d=new x3dom.fields.SFVec3f(n._20,n._21,n._22),l=Math.min(this._width/this._height,1),t=t/Math.tan(s/2)/l,s=e.add(d.multiply(t));return n._03=-r.dot(s),n._13=-a.dot(s),n._23=-d.dot(s),o&&i.setCenterOfRotation(e),n},x3dom.Viewarea.prototype.resetView=function(){this._scene.getNavigationInfo()._impl.resetView(this)},x3dom.Viewarea.prototype.resetNavHelpers=function(){this._rotMat=x3dom.fields.SFMatrix4f.identity(),this._transMat=x3dom.fields.SFMatrix4f.identity(),this._movement=new x3dom.fields.SFVec3f(0,0,0),this._needNavigationMatrixUpdate=!0},x3dom.Viewarea.prototype.uprightView=function(){var e=(o=this.getViewMatrix().inverse()).e3(),t=(e.subtract(o.e2()),new x3dom.fields.SFVec3f(0,1,0)),i=o.e2().cross(t).normalize().cross(t).normalize(),i=e.add(i),o=(o=x3dom.fields.SFMatrix4f.lookAt(e,i,t)).inverse();this.animateTo(o,this._scene.getViewpoint())},x3dom.Viewarea.prototype.callEvtHandler=function(e,t,i){if(!e||!e._xmlNode)return null;try{var o,s=e._xmlNode,n=s[t],r=("function"==typeof n?n.call(s,i):s.hasAttribute(t)&&(o=s.getAttribute(t),new Function("event",o).call(s,i)),e._listeners[i.type]);if(r)for(var a=0;a<r.length;a++)r[a].call(s,i)}catch(e){x3dom.debug.logException(e)}return i.cancelBubble},x3dom.Viewarea.prototype.checkEvents=function(e,t,i,o,s){var n,r,a,d=this,l=!0,h=e&&e._xmlNode?e._xmlNode:{},u=this._doc._nodeBag.affectedPointingSensors,f={viewarea:d,target:h,type:s.substr(2,s.length-2),button:o,layerX:t*this._inverseDevicePixelRatio,layerY:i*this._inverseDevicePixelRatio,worldX:d._pick.x,worldY:d._pick.y,worldZ:d._pick.z,normalX:d._pickNorm.x,normalY:d._pickNorm.y,normalZ:d._pickNorm.z,hitPnt:d._pick.toGL(),hitObject:h,shadowObjectId:d._pickingInfo.shadowObjectId,cancelBubble:!1,stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.cancelBubble=!0}};try{var c=e;(c=c&&c._xmlNode&&c._cf.geometry&&!c._xmlNode[s]&&!c._xmlNode.hasAttribute(s)&&!c._listeners[f.type]?c._cf.geometry.node:c)&&!0===d.callEvtHandler(c,s,f)&&(l=!1)}catch(e){x3dom.debug.logException(e)}var _=function(e){e._parentNodes.forEach(function(e){if(e._xmlNode&&(e._xmlNode[s]||e._xmlNode.hasAttribute(s)||e._listeners[f.type])&&!0===d.callEvtHandler(e,s,f)&&(l=!1),0==o&&0==u.length&&("onmousemove"==s||"onmouseover"==s||"onmouseout"==s))for(a=e._childNodes.length,r=0;r<a;++r)n=e._childNodes[r],x3dom.isa(n,x3dom.nodeTypes.X3DPointingDeviceSensorNode)&&n._vf.enabled&&-1==u.indexOf(n)&&u.push(n);x3dom.isa(e,x3dom.nodeTypes.Anchor)&&"onclick"===s?(e.handleTouch(),l=!1):l&&_(e)})};return l&&e&&_(e),l},x3dom.Viewarea.prototype._notifyAffectedPointingSensors=function(e){var t,i={mousedown:"pointerPressedOverSibling",mousemove:"pointerMoved",mouseover:"pointerMovedOver",mouseout:"pointerMovedOut"}[e.type],o=this._doc._nodeBag.affectedPointingSensors,s=o.length;if(0<s&&void 0!==i)for(t=0;t<s;t++)o[t][i](e)},x3dom.Viewarea.prototype.initMouseState=function(){this._deltaT=0,this._dx=0,this._dy=0,this._lastX=-1,this._lastY=-1,this._pressX=-1,this._pressY=-1,this._lastButton=0,this._isMoving=!1,this._needNavigationMatrixUpdate=!0},x3dom.Viewarea.prototype.onMousePress=function(e,t,i){this._needNavigationMatrixUpdate=!0,this.prepareEvents(e,t,0,"onmouseover"),this.prepareEvents(e,t,i,"onmousedown"),this._pickingInfo.lastClickObj=this._pickingInfo.pickObj,this._pickingInfo.firstObj=this._pickingInfo.pickObj,this._dx=0,this._dy=0,this._lastX=e,this._lastY=t,this._pressX=e,this._pressY=t,this._lastButton=i,this._isMoving=!1,this._currentInputType==x3dom.InputTypes.NAVIGATION&&this._scene.getNavigationInfo()._impl.onMousePress(this,e,t,i)},x3dom.Viewarea.prototype.onMouseRelease=function(e,t,i,o){for(var s=this._doc._nodeBag.affectedPointingSensors,n=0;n<s.length;++n)s[n].pointerReleased();this._doc._nodeBag.affectedPointingSensors=[];var r,a,d=this._scene.getNavigationInfo(),l=d.getType(),h=this._scene._vf.pickMode.toLowerCase();if("box"!==h){if(this.prepareEvents(e,t,o,"onmouseup"),this._pickingInfo.pickObj&&this._pickingInfo.pickObj===this._pickingInfo.lastClickObj)this.prepareEvents(e,t,o,"onclick");else if(!this._pickingInfo.pickObj&&!this._pickingInfo.lastClickObj&&!this._pickingInfo.firstObj){var u="backgroundClicked";try{this._scene._xmlNode&&(this._scene._xmlNode["on"+u]||this._scene._xmlNode.hasAttribute("on"+u)||this._scene._listeners[u])&&(f={target:this._scene._xmlNode,type:u,button:o,layerX:e*this._inverseDevicePixelRatio,layerY:t*this._inverseDevicePixelRatio,cancelBubble:!1,stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.cancelBubble=!0}},this._scene.callEvtHandler("on"+u,f))}catch(e){x3dom.debug.logException("backgroundClicked: "+e)}}}else{var o=(new Date).getTime(),u=this.calcViewRay(e,t),f=this._scene.doIntersect(u),c=u.hitObject,c=(f&&c&&(this._pick.setValues(u.hitPoint),this.checkEvents(c,e,t,i,"onclick"),x3dom.debug.logInfo("Hit '"+c._xmlNode.localName+"/ "+c._DEF+"' at dist="+u.dist.toFixed(4)),"color"===h?x3dom.debug.logInfo("Ray hit color "+this._pick):"idbufid"===h||"texcoord"===h?x3dom.debug.logInfo("Ray hit data "+this._pick):x3dom.debug.logInfo("Ray hit at position "+this._pick.x.toFixed(4)+" "+this._pick.y.toFixed(4)+" "+this._pick.z.toFixed(4))),(new Date).getTime()-o);x3dom.debug.logInfo("Picking time (box): "+c+"ms"),f||(h=(a=this.getViewMatrix().e2().negate()).dot(u.pos.negate())/a.dot(u.dir),this._pick=u.pos.add(u.dir.multiply(h)))}this._pickingInfo.firstObj=null,this._currentInputType==x3dom.InputTypes.NAVIGATION&&(this._pickingInfo.pickObj||0<=this._pickingInfo.shadowObjectId)&&"lookat"===l&&this._pressX===e&&this._pressY===t&&(o=2&this._lastButton?-1:1,c=this._pickingInfo.pickPos.subtract(this._from).length()/3,(f=new x3dom.fields.SFMatrix4f).setValues(this.getViewMatrix()),(u=(f=f.inverse()).e3()).subtract(f.e2()),h=f.e1(),l=(a=this._pickingInfo.pickPos.subtract(u)).length(),a=a.normalize(),r=u.addScaled(a,l),a=a.cross(h).normalize().cross(h).normalize(),a=r.addScaled(a,c=o<0?2*(.5+l+c):c),f=(f=x3dom.fields.SFMatrix4f.lookAt(a,r,h)).inverse(),c=a.subtract(u).length(),o=Math.max(.5,Math.log((1+c)/d._vf.speed)),this.animateTo(f,this._scene.getViewpoint(),o)),this._dx=0,this._dy=0,this._lastX=e,this._lastY=t,this._lastButton=i,this._isMoving=!1},x3dom.Viewarea.prototype.onMouseOver=function(e,t,i){this._dx=0,this._dy=0,this._lastButton=0,this._isMoving=!1,this._lastX=e,this._lastY=t,this._deltaT=0},x3dom.Viewarea.prototype.onMouseOut=function(e,t,i){this._dx=0,this._dy=0,this._lastButton=0,this._isMoving=!1,this._lastX=e,this._lastY=t,this._deltaT=0;for(var o=this._doc._nodeBag.affectedPointingSensors,s=0;s<o.length;++s)o[s].pointerReleased();this._doc._nodeBag.affectedPointingSensors=[]},x3dom.Viewarea.prototype.onDoubleClick=function(e,t){this._doc._x3dElem.hasAttribute("disableDoubleClick")&&"true"===this._doc._x3dElem.getAttribute("disableDoubleClick")||this._scene.getNavigationInfo()._impl.onDoubleClick(this,e,t)},x3dom.Viewarea.prototype.handleMoveEvt=function(e,t,i){var o,s;0==i&&(this._doc._nodeBag.affectedPointingSensors=[]),this.prepareEvents(e,t,i,"onmousemove"),this._pickingInfo.pickObj!==this._pickingInfo.lastObj&&(this._pickingInfo.lastObj&&(o=this._pickingInfo.pickObj,this._pickingInfo.pickObj=this._pickingInfo.lastObj,s=this._doc._nodeBag.affectedPointingSensors,this._doc._nodeBag.affectedPointingSensors=[],this.prepareEvents(e,t,i,"onmouseout"),this._doc._nodeBag.affectedPointingSensors=s,this._pickingInfo.pickObj=o),this._pickingInfo.pickObj&&this.prepareEvents(e,t,i,"onmouseover"),this._pickingInfo.lastObj=this._pickingInfo.pickObj)},x3dom.Viewarea.prototype.onMove=function(e,t,i){this.handleMoveEvt(e,t,i),(this._lastX<0||this._lastY<0)&&(this._lastX=e,this._lastY=t),this._dx=e-this._lastX,this._dy=t-this._lastY,this._lastX=e,this._lastY=t},x3dom.Viewarea.prototype.onMoveView=function(e,t){var i,o,s;this._currentInputType==x3dom.InputTypes.NAVIGATION&&(o=this._scene.getNavigationInfo(),i=this._scene.getViewpoint(),"examine"===o.getType())&&(e&&(s=((s=this._scene._lastMax.subtract(this._scene._lastMin).length())<x3dom.fields.Eps?1:s)*o._vf.speed,e=e.multiply(s),this._movement=this._movement.add(e),this._transMat=i.getViewMatrix().inverse().mult(x3dom.fields.SFMatrix4f.translation(this._movement)).mult(i.getViewMatrix())),t&&(o=i.getCenterOfRotation(),(s=this.getViewMatrix()).setTranslate(new x3dom.fields.SFVec3f(0,0,0)),this._rotMat=this._rotMat.mult(x3dom.fields.SFMatrix4f.translation(o)).mult(s.inverse()).mult(t).mult(s).mult(x3dom.fields.SFMatrix4f.translation(o.negate()))),this._isMoving=!0)},x3dom.Viewarea.prototype.onDrag=function(e,t,i){this.handleMoveEvt(e,t,i),this._currentInputType==x3dom.InputTypes.NAVIGATION&&this._scene.getNavigationInfo()._impl.onDrag(this,e,t,i)},x3dom.Viewarea.prototype.prepareEvents=function(e,t,i,o){var s=this._doc._nodeBag.affectedPointingSensors,n=this._scene._vf.pickMode.toLowerCase(),r=null,n=(0!=n.indexOf("idbuf")&&"color"!=n&&"texcoord"!=n||!(r=this._pickingInfo.pickObj)||(this._pick.setValues(this._pickingInfo.pickPos),this._pickNorm.setValues(this._pickingInfo.pickNorm),this.checkEvents(r,e,t,i,o),"onclick"!==o)||(r._xmlNode&&x3dom.debug.logInfo('Hit "'+r._xmlNode.localName+"/ "+r._DEF+'"'),"color"===n?x3dom.debug.logInfo("Ray hit color "+this._pick):"idbufid"===n||"texcoord"===n?x3dom.debug.logInfo("Ray hit data "+this._pick):x3dom.debug.logInfo("Ray hit at position "+this._pick.x.toFixed(4)+" "+this._pick.y.toFixed(4)+" "+this._pick.z.toFixed(4))),{viewarea:this,target:{},type:o.substr(2,o.length-2),button:i,layerX:e,layerY:t,worldX:this._pick.x,worldY:this._pick.y,worldZ:this._pick.z,normalX:this._pickNorm.x,normalY:this._pickNorm.y,normalZ:this._pickNorm.z,hitPnt:this._pick.toGL(),hitObject:r&&r._xmlNode?r._xmlNode:null,shadowObjectId:this._pickingInfo.shadowObjectId,cancelBubble:!1,stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.cancelBubble=!0}});this._notifyAffectedPointingSensors(n),0<s.length?this._currentInputType=x3dom.InputTypes.INTERACTION:this._currentInputType=x3dom.InputTypes.NAVIGATION},x3dom.Viewarea.prototype.getRenderMode=function(){return this._points},x3dom.Viewarea.prototype.getShadowedLights=function(){for(var e=[],t=0,i=this.getLights(),o=0;o<i.length;o++)0<i[o]._vf.shadowIntensity&&(e[t]=i[o],t++);return e},x3dom.Viewarea.prototype.getShadowSplitDepths=function(e,t,i,o,s){var n,r=[],a=this._scene.getViewpoint(),d=a.getNear(),l=a.getFar();d+=i*(l-(r[0]=d))/10;for(var h=1;h<e;h++)n=d*Math.pow(l/d,h/e),r[h]=t*n+(1-t)*(d+h/(e*(d-l)));if(r[e]=l,!o)return r;for(var u=[],f=0;f<=e;f++)u[f]=s.multFullMatrixPnt(new x3dom.fields.SFVec3f(0,0,-r[f])).z;return u},x3dom.Viewarea.prototype.getLightCropMatrix=function(e){var t=x3dom.fields.SFVec3f.copy(this._scene._lastMin),i=x3dom.fields.SFVec3f.copy(this._scene._lastMax),o=[];for(o[0]=new x3dom.fields.SFVec3f(t.x,t.y,t.z),o[1]=new x3dom.fields.SFVec3f(t.x,t.y,i.z),o[2]=new x3dom.fields.SFVec3f(t.x,i.y,t.z),o[3]=new x3dom.fields.SFVec3f(t.x,i.y,i.z),o[4]=new x3dom.fields.SFVec3f(i.x,t.y,t.z),o[5]=new x3dom.fields.SFVec3f(i.x,t.y,i.z),o[6]=new x3dom.fields.SFVec3f(i.x,i.y,t.z),o[7]=new x3dom.fields.SFVec3f(i.x,i.y,i.z),r=0;r<8;r++)o[r]=e.multFullMatrixPnt(o[r]);for(var s=x3dom.fields.SFVec3f.copy(o[0]),n=x3dom.fields.SFVec3f.copy(o[0]),r=1;r<8;r++)s.z=Math.min(o[r].z,s.z),n.z=Math.max(o[r].z,n.z);var t=2/(n.z-s.z),i=-t*(n.z+s.z)/2,a=x3dom.fields.SFMatrix4f.identity();return a._22=t,a._23=i,a},x3dom.Viewarea.prototype.getLightFittingMatrix=function(e,t,i,o){var s=this.getViewMatrix(),n=o.mult(s).inverse(),r=[];for(r[0]=new x3dom.fields.SFVec3f(-1,-1,i),r[1]=new x3dom.fields.SFVec3f(-1,-1,t),r[2]=new x3dom.fields.SFVec3f(-1,1,i),r[3]=new x3dom.fields.SFVec3f(-1,1,t),r[4]=new x3dom.fields.SFVec3f(1,-1,i),r[5]=new x3dom.fields.SFVec3f(1,-1,t),r[6]=new x3dom.fields.SFVec3f(1,1,i),r[7]=new x3dom.fields.SFVec3f(1,1,t),l=0;l<8;l++)r[l]=n.multFullMatrixPnt(r[l]),r[l]=e.multFullMatrixPnt(r[l]);for(var a=x3dom.fields.SFVec3f.copy(r[0]),d=x3dom.fields.SFVec3f.copy(r[0]),l=1;l<8;l++)a.x=Math.min(r[l].x,a.x),a.y=Math.min(r[l].y,a.y),a.z=Math.min(r[l].z,a.z),d.x=Math.max(r[l].x,d.x),d.y=Math.max(r[l].y,d.y),d.z=Math.max(r[l].z,d.z);o=a.x,s=a.y,i=a.z,t=d.x,h=d.y,u=d.z,t=1<o||t<-1?(o=-1,1):(o=Math.max(o,-1),Math.min(t,1)),h=1<s||h<-1?(s=-1,1):(s=Math.max(s,-1),Math.min(h,1)),u=1<i||u<-1?(i=-1,1):(i=Math.max(i,-1),Math.min(u,1)),o=new x3dom.fields.SFVec3f(o,s,i),s=new x3dom.fields.SFVec3f(t,h,u);var i=new x3dom.fields.BoxVolume(o,s),t=2/(i.max.x-i.min.x),h=2/(i.max.y-i.min.y),u=-t*(i.max.x+i.min.x)/2,o=-h*(i.max.y+i.min.y)/2,s=x3dom.fields.SFMatrix4f.identity();return s._00=t,s._11=h,s._03=u,s._13=o,s},x3dom.fields={};var VecMath=x3dom.fields;function _colorParse(e){var t=0,i=0,o=0,s=1,n={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",feldspar:"#d19275",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslateblue:"#8470ff",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",violetred:"#d02090",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},r=/^rgb\((\d{1,3}),\s{0,1}(\d{1,3}),\s{0,1}(\d{1,3})\)$/.exec(e),r=(null!==r&&(t=r[1]/255,i=r[2]/255,o=r[3]/255),/^rgba\((\d{1,3}),\s{0,1}(\d{1,3}),\s{0,1}(\d{1,3}),(0+\.?\d*|1\.?0*)\)$/.exec(e));return null!==r&&(t=r[1]/255,i=r[2]/255,o=r[3]/255,s=+r[4]),(e=n[e]?n[e]:e).substr&&"#"===e.substr(0,1)&&(8===(n=(r=e.substr(1)).length)?(t=parseInt("0x"+r.substr(0,2),16)/255,i=parseInt("0x"+r.substr(2,2),16)/255,o=parseInt("0x"+r.substr(4,2),16)/255,s=parseInt("0x"+r.substr(6,2),16)/255):6===n?(t=parseInt("0x"+r.substr(0,2),16)/255,i=parseInt("0x"+r.substr(2,2),16)/255,o=parseInt("0x"+r.substr(4,2),16)/255):4===n?(t=parseInt("0x"+r.substr(0,1),16)/15,i=parseInt("0x"+r.substr(1,1),16)/15,o=parseInt("0x"+r.substr(2,1),16)/15,s=parseInt("0x"+r.substr(3,1),16)/15):3===n&&(t=parseInt("0x"+r.substr(0,1),16)/15,i=parseInt("0x"+r.substr(1,1),16)/15,o=parseInt("0x"+r.substr(2,1),16)/15)),{r:t,g:i,b:o,a:s}}function startDashVideo(e,t){function i(){var o={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,i){o[t]=i}),o}var o;i.hasOwnProperty("url")&&(e=i.url),t=document.querySelector(t),o=new Dash.di.DashContext,(o=new MediaPlayer(o)).startup(),o.attachView(t),o.setAutoPlay(!1),o.attachSource(e)}function setNamespace(t,e,i){e instanceof Element&&void 0!==e.__setAttribute&&(e.hasAttribute("id")?e.__setAttribute("id",t.toString().replace(" ","")+"__"+e.getAttribute("id")):e.hasAttribute("DEF")&&i&&(e.__setAttribute("id",t.toString().replace(" ","")+"__"+e.getAttribute("DEF")),e.id||(e.id=e.__getAttribute("id")))),e.hasChildNodes()&&e.childNodes.forEach(function(e){setNamespace(t,e,i)})}x3dom.fields.Eps=1e-6,x3dom.fields.SFMatrix4f=function(e,t,i,o,s,n,r,a,d,l,h,u,f,c,_,m){0===arguments.length?(this._00=1,this._01=0,this._02=0,this._03=0,this._10=0,this._11=1,this._12=0,this._13=0,this._20=0,this._21=0,this._22=1,this._23=0,this._30=0,this._31=0,this._32=0,this._33=1):(this._00=e,this._01=t,this._02=i,this._03=o,this._10=s,this._11=n,this._12=r,this._13=a,this._20=d,this._21=l,this._22=h,this._23=u,this._30=f,this._31=c,this._32=_,this._33=m)},x3dom.fields.SFMatrix4f.prototype.e0=function(){return new x3dom.fields.SFVec3f(this._00,this._10,this._20).normalize()},x3dom.fields.SFMatrix4f.prototype.e1=function(){return new x3dom.fields.SFVec3f(this._01,this._11,this._21).normalize()},x3dom.fields.SFMatrix4f.prototype.e2=function(){return new x3dom.fields.SFVec3f(this._02,this._12,this._22).normalize()},x3dom.fields.SFMatrix4f.prototype.e3=function(){return new x3dom.fields.SFVec3f(this._03,this._13,this._23)},x3dom.fields.SFMatrix4f.copy=function(e){return new x3dom.fields.SFMatrix4f(e._00,e._01,e._02,e._03,e._10,e._11,e._12,e._13,e._20,e._21,e._22,e._23,e._30,e._31,e._32,e._33)},x3dom.fields.SFMatrix4f.prototype.copy=function(){return x3dom.fields.SFMatrix4f.copy(this)},x3dom.fields.SFMatrix4f.identity=function(){return new x3dom.fields.SFMatrix4f(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},x3dom.fields.SFMatrix4f.zeroMatrix=function(){return new x3dom.fields.SFMatrix4f(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},x3dom.fields.SFMatrix4f.translation=function(e){return new x3dom.fields.SFMatrix4f(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1)},x3dom.fields.SFMatrix4f.rotationX=function(e){var t=Math.cos(e),e=Math.sin(e);return new x3dom.fields.SFMatrix4f(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1)},x3dom.fields.SFMatrix4f.rotationY=function(e){var t=Math.cos(e),e=Math.sin(e);return new x3dom.fields.SFMatrix4f(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1)},x3dom.fields.SFMatrix4f.rotationZ=function(e){var t=Math.cos(e),e=Math.sin(e);return new x3dom.fields.SFMatrix4f(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1)},x3dom.fields.SFMatrix4f.scale=function(e){return new x3dom.fields.SFMatrix4f(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)},x3dom.fields.SFMatrix4f.lookAt=function(e,t,i){var o,s,t=e.subtract(t).normalize(),i=i.normalize().cross(t).normalize();return i.dot(i)<x3dom.fields.Eps?(x3dom.debug.logWarning("View matrix is linearly dependent."),x3dom.fields.SFMatrix4f.translation(e)):(o=t.cross(i).normalize(),(s=x3dom.fields.SFMatrix4f.identity()).setValue(i,o,t,e),s)},x3dom.fields.SFMatrix4f.perspectiveFrustum=function(e,t,i,o,s,n){return new x3dom.fields.SFMatrix4f(2*s/(t-e),0,(t+e)/(t-e),0,0,2*s/(o-i),(o+i)/(o-i),0,0,0,-(n+s)/(n-s),-2*n*s/(n-s),0,0,-1,0)},x3dom.fields.SFMatrix4f.perspective=function(e,t,i,o){e=1/Math.tan(e/2);return new x3dom.fields.SFMatrix4f(e/t,0,0,0,0,e,0,0,0,0,(i+o)/(i-o),2*i*o/(i-o),0,0,-1,0)},x3dom.fields.SFMatrix4f.ortho=function(e,t,i,o,s,n,r){var a=(t-e)/2,d=(o-i)/2,l=n-s;return(r=void 0===r?1:r)<a/d?d=a/r:a=d*r,e=-a,t=a,i=-d,o=d,new x3dom.fields.SFMatrix4f(2/(a*=2),0,0,-(t+e)/a,0,2/(d*=2),0,-(o+i)/d,0,0,-2/l,-(n+s)/l,0,0,0,1)},x3dom.fields.SFMatrix4f.prototype.setTranslate=function(e){this._03=e.x,this._13=e.y,this._23=e.z},x3dom.fields.SFMatrix4f.prototype.setScale=function(e){this._00=e.x,this._11=e.y,this._22=e.z},x3dom.fields.SFMatrix4f.prototype.setRotate=function(e){var t=e.x*e.x,i=e.x*e.y,o=e.x*e.z,s=e.y*e.y,n=e.y*e.z,r=e.z*e.z,a=e.w*e.x,d=e.w*e.y,e=e.w*e.z;this._00=1-2*(s+r),this._01=2*(i-e),this._02=2*(o+d),this._10=2*(i+e),this._11=1-2*(t+r),this._12=2*(n-a),this._20=2*(o-d),this._21=2*(n+a),this._22=1-2*(t+s)},x3dom.fields.SFMatrix4f.parseRotation=function(e){var e=/^([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)$/.exec(e),t=+e[1],i=+e[2],o=+e[3],e=+e[4],s=Math.sqrt(t*t+i*i+o*o),s=(0===s?(t=1,i=o=0):(t/=s,i/=s,o/=s),Math.cos(e)),e=Math.sin(e),n=1-s;return new x3dom.fields.SFMatrix4f(n*t*t+s,n*t*i+e*o,n*t*o-e*i,0,n*t*i-e*o,n*i*i+s,n*i*o+e*t,0,n*t*o+e*i,n*i*o-e*t,n*o*o+s,0,0,0,0,1).transpose()},x3dom.fields.SFMatrix4f.parse=function(e){var t=!1,i=(/matrix.*\((.+)\)/.exec(e)&&(e=RegExp.$1,t=!0),e.split(/[,\s]+/).map(function(e){return+e}));return 16<=i.length?t?new x3dom.fields.SFMatrix4f(i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]):new x3dom.fields.SFMatrix4f(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15]):6===i.length?new x3dom.fields.SFMatrix4f(i[0],i[1],0,i[4],i[2],i[3],0,i[5],0,0,1,0,0,0,0,1):(x3dom.debug.logWarning("SFMatrix4f - can't parse string: "+e),x3dom.fields.SFMatrix4f.identity())},x3dom.fields.SFMatrix4f.prototype.mult=function(e){return new x3dom.fields.SFMatrix4f(this._00*e._00+this._01*e._10+this._02*e._20+this._03*e._30,this._00*e._01+this._01*e._11+this._02*e._21+this._03*e._31,this._00*e._02+this._01*e._12+this._02*e._22+this._03*e._32,this._00*e._03+this._01*e._13+this._02*e._23+this._03*e._33,this._10*e._00+this._11*e._10+this._12*e._20+this._13*e._30,this._10*e._01+this._11*e._11+this._12*e._21+this._13*e._31,this._10*e._02+this._11*e._12+this._12*e._22+this._13*e._32,this._10*e._03+this._11*e._13+this._12*e._23+this._13*e._33,this._20*e._00+this._21*e._10+this._22*e._20+this._23*e._30,this._20*e._01+this._21*e._11+this._22*e._21+this._23*e._31,this._20*e._02+this._21*e._12+this._22*e._22+this._23*e._32,this._20*e._03+this._21*e._13+this._22*e._23+this._23*e._33,this._30*e._00+this._31*e._10+this._32*e._20+this._33*e._30,this._30*e._01+this._31*e._11+this._32*e._21+this._33*e._31,this._30*e._02+this._31*e._12+this._32*e._22+this._33*e._32,this._30*e._03+this._31*e._13+this._32*e._23+this._33*e._33)},x3dom.fields.SFMatrix4f.prototype.multMatrixPnt=function(e){return new x3dom.fields.SFVec3f(this._00*e.x+this._01*e.y+this._02*e.z+this._03,this._10*e.x+this._11*e.y+this._12*e.z+this._13,this._20*e.x+this._21*e.y+this._22*e.z+this._23)},x3dom.fields.SFMatrix4f.prototype.multMatrixVec=function(e){return new x3dom.fields.SFVec3f(this._00*e.x+this._01*e.y+this._02*e.z,this._10*e.x+this._11*e.y+this._12*e.z,this._20*e.x+this._21*e.y+this._22*e.z)},x3dom.fields.SFMatrix4f.prototype.multFullMatrixPnt=function(e){var t=(t=this._30*e.x+this._31*e.y+this._32*e.z+this._33)&&1/t;return new x3dom.fields.SFVec3f((this._00*e.x+this._01*e.y+this._02*e.z+this._03)*t,(this._10*e.x+this._11*e.y+this._12*e.z+this._13)*t,(this._20*e.x+this._21*e.y+this._22*e.z+this._23)*t)},x3dom.fields.SFMatrix4f.prototype.multMatrixPlane=function(e){var t=new x3dom.fields.SFVec3f(e.x,e.y,e.z),e=t.multiply(-e.w),e=this.multMatrixPnt(e),e=-(t=this.inverse().transpose().multMatrixVec(t)).dot(e);return new x3dom.fields.SFVec4f(t.x,t.y,t.z,e)},x3dom.fields.SFMatrix4f.prototype.transpose=function(){return new x3dom.fields.SFMatrix4f(this._00,this._10,this._20,this._30,this._01,this._11,this._21,this._31,this._02,this._12,this._22,this._32,this._03,this._13,this._23,this._33)},x3dom.fields.SFMatrix4f.prototype.negate=function(){return new x3dom.fields.SFMatrix4f(-this._00,-this._01,-this._02,-this._03,-this._10,-this._11,-this._12,-this._13,-this._20,-this._21,-this._22,-this._23,-this._30,-this._31,-this._32,-this._33)},x3dom.fields.SFMatrix4f.prototype.multiply=function(e){return new x3dom.fields.SFMatrix4f(e*this._00,e*this._01,e*this._02,e*this._03,e*this._10,e*this._11,e*this._12,e*this._13,e*this._20,e*this._21,e*this._22,e*this._23,e*this._30,e*this._31,e*this._32,e*this._33)},x3dom.fields.SFMatrix4f.prototype.add=function(e){return new x3dom.fields.SFMatrix4f(this._00+e._00,this._01+e._01,this._02+e._02,this._03+e._03,this._10+e._10,this._11+e._11,this._12+e._12,this._13+e._13,this._20+e._20,this._21+e._21,this._22+e._22,this._23+e._23,this._30+e._30,this._31+e._31,this._32+e._32,this._33+e._33)},x3dom.fields.SFMatrix4f.prototype.addScaled=function(e,t){return new x3dom.fields.SFMatrix4f(this._00+t*e._00,this._01+t*e._01,this._02+t*e._02,this._03+t*e._03,this._10+t*e._10,this._11+t*e._11,this._12+t*e._12,this._13+t*e._13,this._20+t*e._20,this._21+t*e._21,this._22+t*e._22,this._23+t*e._23,this._30+t*e._30,this._31+t*e._31,this._32+t*e._32,this._33+t*e._33)},x3dom.fields.SFMatrix4f.prototype.setValues=function(e){this._00=e._00,this._01=e._01,this._02=e._02,this._03=e._03,this._10=e._10,this._11=e._11,this._12=e._12,this._13=e._13,this._20=e._20,this._21=e._21,this._22=e._22,this._23=e._23,this._30=e._30,this._31=e._31,this._32=e._32,this._33=e._33},x3dom.fields.SFMatrix4f.prototype.setValue=function(e,t,i,o){this._00=e.x,this._01=t.x,this._02=i.x,this._10=e.y,this._11=t.y,this._12=i.y,this._20=e.z,this._21=t.z,this._22=i.z,this._30=0,this._31=0,this._32=0,3<arguments.length&&(this._03=o.x,this._13=o.y,this._23=o.z,this._33=1)},x3dom.fields.SFMatrix4f.prototype.setFromArray=function(e){return this._00=e[0],this._01=e[4],this._02=e[8],this._03=e[12],this._10=e[1],this._11=e[5],this._12=e[9],this._13=e[13],this._20=e[2],this._21=e[6],this._22=e[10],this._23=e[14],this._30=e[3],this._31=e[7],this._32=e[11],this._33=e[15],this},x3dom.fields.SFMatrix4f.fromArray=function(e){var t=new x3dom.fields.SFMatrix4f;return t._00=e[0],t._01=e[4],t._02=e[8],t._03=e[12],t._10=e[1],t._11=e[5],t._12=e[9],t._13=e[13],t._20=e[2],t._21=e[6],t._22=e[10],t._23=e[14],t._30=e[3],t._31=e[7],t._32=e[11],t._33=e[15],t},x3dom.fields.SFMatrix4f.prototype.fromRotationTranslationScale=function(e,t,i){t=t||new x3dom.fields.SFVec3f,e=e||new x3dom.fields.Quaternion,i=i||new x3dom.fields.SFVec3f(1,1,1);var o=e.x,s=e.y,n=e.z,e=e.w,r=o+o,a=s+s,d=n+n,l=o*r,h=o*a,o=o*d,u=s*a,s=s*d,n=n*d,r=e*r,a=e*a,e=e*d;return this._00=(1-(u+n))*i.x,this._10=(h+e)*i.x,this._20=(o-a)*i.x,this._30=0,this._01=(h-e)*i.y,this._11=(1-(l+n))*i.y,this._21=(s+r)*i.y,this._31=0,this._02=(o+a)*i.z,this._12=(s-r)*i.z,this._22=(1-(l+u))*i.z,this._32=0,this._03=t.x,this._13=t.y,this._23=t.z,this._33=1,this},x3dom.fields.SFMatrix4f.fromRotationTranslationScale=function(e,t,i){t=t||new x3dom.fields.SFVec3f,e=e||new x3dom.fields.Quaternion,i=i||new x3dom.fields.SFVec3f(1,1,1);var o=new x3dom.fields.SFMatrix4f,s=e.x,n=e.y,r=e.z,e=e.w,a=s+s,d=n+n,l=r+r,h=s*a,u=s*d,s=s*l,f=n*d,n=n*l,r=r*l,a=e*a,d=e*d,e=e*l;return o._00=(1-(f+r))*i.x,o._10=(u+e)*i.x,o._20=(s-d)*i.x,o._30=0,o._01=(u-e)*i.y,o._11=(1-(h+r))*i.y,o._21=(n+a)*i.y,o._31=0,o._02=(s+d)*i.z,o._12=(n-a)*i.z,o._22=(1-(h+f))*i.z,o._32=0,o._03=t.x,o._13=t.y,o._23=t.z,o._33=1,o},x3dom.fields.SFMatrix4f.prototype.toGL=function(){return[this._00,this._10,this._20,this._30,this._01,this._11,this._21,this._31,this._02,this._12,this._22,this._32,this._03,this._13,this._23,this._33]},x3dom.fields.SFMatrix4f.fromGL=function(e){var t=new x3dom.fields.SFMatrix4f;return t._00=e[0],t._01=e[4],t._02=e[8],t._03=e[12],t._10=e[1],t._11=e[5],t._12=e[9],t._13=e[13],t._20=e[2],t._21=e[6],t._22=e[10],t._23=e[14],t._30=e[3],t._31=e[7],t._32=e[11],t._33=e[15],t},x3dom.fields.SFMatrix4f.prototype.at=function(e,t){return this["_"+e+t]},x3dom.fields.SFMatrix4f.prototype.setAt=function(e,t,i){return this["_"+e+t]=i,this},x3dom.fields.SFMatrix4f.prototype.sqrt=function(){for(var e=x3dom.fields.SFMatrix4f.identity(),t=x3dom.fields.SFMatrix4f.copy(this),i=0;i<6;i++)var o=t.inverse(),s=0==i?x3dom.fields.SFMatrix4f.identity():e.inverse(),n=t.det(),r=e.det(),n=Math.abs(Math.pow(n*r,-.125)),r=1/n,t=(t=(t=t.multiply(n)).addScaled(s,r)).multiply(.5),e=(e=(e=e.multiply(n)).addScaled(o,r)).multiply(.5);return t},x3dom.fields.SFMatrix4f.prototype.normInfinity=function(){var e,t=0;return(e=Math.abs(this._00))>t&&(t=e),(e=Math.abs(this._01))>t&&(t=e),(e=Math.abs(this._02))>t&&(t=e),(e=Math.abs(this._03))>t&&(t=e),(e=Math.abs(this._10))>t&&(t=e),(e=Math.abs(this._11))>t&&(t=e),(e=Math.abs(this._12))>t&&(t=e),(e=Math.abs(this._13))>t&&(t=e),(e=Math.abs(this._20))>t&&(t=e),(e=Math.abs(this._21))>t&&(t=e),(e=Math.abs(this._22))>t&&(t=e),(e=Math.abs(this._23))>t&&(t=e),(e=Math.abs(this._30))>t&&(t=e),(e=Math.abs(this._31))>t&&(t=e),(e=Math.abs(this._32))>t&&(t=e),t=(e=Math.abs(this._33))>t?e:t},x3dom.fields.SFMatrix4f.prototype.norm1_3x3=function(){var e,t=Math.abs(this._00)+Math.abs(this._10)+Math.abs(this._20);return(e=Math.abs(this._01)+Math.abs(this._11)+Math.abs(this._21))>t&&(t=e),t=(e=Math.abs(this._02)+Math.abs(this._12)+Math.abs(this._22))>t?e:t},x3dom.fields.SFMatrix4f.prototype.normInf_3x3=function(){var e,t=Math.abs(this._00)+Math.abs(this._01)+Math.abs(this._02);return(e=Math.abs(this._10)+Math.abs(this._11)+Math.abs(this._12))>t&&(t=e),t=(e=Math.abs(this._20)+Math.abs(this._21)+Math.abs(this._22))>t?e:t},x3dom.fields.SFMatrix4f.prototype.adjointT_3x3=function(){var e=x3dom.fields.SFMatrix4f.identity();return e._00=this._11*this._22-this._12*this._21,e._01=this._12*this._20-this._10*this._22,e._02=this._10*this._21-this._11*this._20,e._10=this._21*this._02-this._22*this._01,e._11=this._22*this._00-this._20*this._02,e._12=this._20*this._01-this._21*this._00,e._20=this._01*this._12-this._02*this._11,e._21=this._02*this._10-this._00*this._12,e._22=this._00*this._11-this._01*this._10,e},x3dom.fields.SFMatrix4f.prototype.equals=function(e){var t=1e-12;return Math.abs(this._00-e._00)<t&&Math.abs(this._01-e._01)<t&&Math.abs(this._02-e._02)<t&&Math.abs(this._03-e._03)<t&&Math.abs(this._10-e._10)<t&&Math.abs(this._11-e._11)<t&&Math.abs(this._12-e._12)<t&&Math.abs(this._13-e._13)<t&&Math.abs(this._20-e._20)<t&&Math.abs(this._21-e._21)<t&&Math.abs(this._22-e._22)<t&&Math.abs(this._23-e._23)<t&&Math.abs(this._30-e._30)<t&&Math.abs(this._31-e._31)<t&&Math.abs(this._32-e._32)<t&&Math.abs(this._33-e._33)<t},x3dom.fields.SFMatrix4f.prototype.getTransform=function(e,t,i,o,s){var n=null,s=(n=4<arguments.length?(n=(n=x3dom.fields.SFMatrix4f.translation(s.negate())).mult(this),s=x3dom.fields.SFMatrix4f.translation(s),n.mult(s)):x3dom.fields.SFMatrix4f.copy(this)).decompose(e,t,i,o);i.setValues(i.multiply(s))},x3dom.fields.SFMatrix4f.prototype.decompose=function(e,t,i,o){var s=x3dom.fields.SFMatrix4f.copy(this),n=x3dom.fields.SFMatrix4f.identity(),r=x3dom.fields.SFMatrix4f.identity(),a=x3dom.fields.SFMatrix4f.identity(),e=(e.x=s._03,e.y=s._13,e.z=s._23,s._03=0,s._13=0,s._23=0,s._30=0,s._31=0,s._32=0,1);return s.polarDecompose(n,r)<0&&(n=n.negate(),e=-1),t.setValue(n),r.spectralDecompose(a,i),o.setValue(a),e},x3dom.fields.SFMatrix4f.prototype.polarDecompose=function(e,t){var i,o,s=this.transpose(),n=x3dom.fields.SFMatrix4f.identity(),r=s.norm1_3x3(),a=s.normInf_3x3();do{if(i=s.adjointT_3x3(),0==(o=s._00*i._00+s._01*i._01+s._02*i._02)){x3dom.debug.logWarning("polarDecompose: Mk_det == 0.0");break}var d=i.norm1_3x3(),l=i.normInf_3x3(),d=Math.sqrt(Math.sqrt(d*l/(r*a))/Math.abs(o)),l=.5*d,d=.5/(d*o)}while(n.setValues(s),s=(s=s.multiply(l)).addScaled(i,d),l=(n=n.addScaled(s,-1)).norm1_3x3(),r=s.norm1_3x3(),a=s.normInf_3x3(),1e-12*r<l);e.setValues(s.transpose()),t.setValues(s.mult(this));for(var h=0;h<3;++h)for(var u=h;u<3;++u)t.setAt(u,h,.5*(t.at(u,h)+t.at(h,u))),t.setAt(h,u,.5*(t.at(u,h)+t.at(h,u)));return o},x3dom.fields.SFMatrix4f.prototype.spectralDecompose=function(e,t){for(var i=[1,2,0],o=[this._00,this._11,this._22],s=[this._12,this._20,this._01],n=0;n<20&&0!=Math.abs(s[0])+Math.abs(s[1])+Math.abs(s[2]);++n)for(var r=2;0<=r;--r){var a=i[r],d=i[a],l=Math.abs(s[r]),h=100*l;if(0<l){var l=0,u=o[d]-o[a],f=Math.abs(u),f=(l=f+h==f?s[r]/u:(h=.5*u/s[r],l=1/(Math.abs(h)+Math.sqrt(h*h+1)),h<0?-l:l),1/Math.sqrt(l*l+1)),c=l*f,_=c/(1+f),u=l*s[r],h=(s[r]=0,o[a]-=u,o[d]+=u,s[d]);s[d]-=c*(s[a]+_*h),s[a]+=c*(h-_*s[a]);for(var m=2;0<=m;--m){var p=e.at(m,a),x=e.at(m,d);e.setAt(m,a,e.at(m,a)-c*(x+_*p)),e.setAt(m,d,e.at(m,d)+c*(p-_*x))}}}t.x=o[0],t.y=o[1],t.z=o[2]},x3dom.fields.SFMatrix4f.prototype.log=function(){var e=x3dom.fields.SFMatrix4f.copy(this),t=x3dom.fields.SFMatrix4f.copy(this);--t._00,--t._11,--t._22,--t._33;for(var i=0;.5<t.normInfinity();)e=e.sqrt(),t.setValues(e),--t._00,--t._11,--t._22,--t._33,i++;--e._00,--e._11,--e._22,--e._33,e=e.negate(),t.setValues(e);for(var o=x3dom.fields.SFMatrix4f.copy(e),s=1;1e-12<t.normInfinity()&&s<12;)t=t.mult(e),o=o.addScaled(t,1/++s);return o.multiply(-(1<<i))},x3dom.fields.SFMatrix4f.prototype.exp=function(){for(var e=x3dom.fields.SFMatrix4f.copy(this),t=x3dom.fields.SFMatrix4f.identity(),i=x3dom.fields.SFMatrix4f.identity(),o=x3dom.fields.SFMatrix4f.identity(),s=0,n=1,r=1+parseInt(Math.log(e.normInfinity()/.693)),e=e.multiply(1/(1<<(r=r<0?0:r))),s=1;s<=6;s++)n*=(6-s+1)/(s*(12-s+1)),o=e.mult(o),i=i.addScaled(o,n),t=s%2?t.addScaled(o,-n):t.addScaled(o,n);for(o=t.inverse().mult(i),s=0;s<r;s++)o=o.mult(o);return o},x3dom.fields.SFMatrix4f.prototype.det3=function(e,t,i,o,s,n,r,a,d){return e*s*d+t*n*r+i*o*a-e*n*a-t*o*d-i*s*r},x3dom.fields.SFMatrix4f.prototype.det=function(){var e=this._00,t=this._10,i=this._20,o=this._30,s=this._01,n=this._11,r=this._21,a=this._31,d=this._02,l=this._12,h=this._22,u=this._32,f=this._03,c=this._13,_=this._23,m=this._33;return e*this.det3(n,l,c,r,h,_,a,u,m)-t*this.det3(s,d,f,r,h,_,a,u,m)+i*this.det3(s,d,f,n,l,c,a,u,m)-o*this.det3(s,d,f,n,l,c,r,h,_)},x3dom.fields.SFMatrix4f.prototype.inverse=function(){var e=this._00,t=this._10,i=this._20,o=this._30,s=this._01,n=this._11,r=this._21,a=this._31,d=this._02,l=this._12,h=this._22,u=this._32,f=this._03,c=this._13,_=this._23,m=this._33,p=this.det();return 0==p?(x3dom.debug.logWarning("Invert matrix: singular matrix, no inverse!"),x3dom.fields.SFMatrix4f.identity()):(p=1/p,new x3dom.fields.SFMatrix4f(+this.det3(n,l,c,r,h,_,a,u,m)*p,-this.det3(s,d,f,r,h,_,a,u,m)*p,+this.det3(s,d,f,n,l,c,a,u,m)*p,-this.det3(s,d,f,n,l,c,r,h,_)*p,-this.det3(t,l,c,i,h,_,o,u,m)*p,+this.det3(e,d,f,i,h,_,o,u,m)*p,-this.det3(e,d,f,t,l,c,o,u,m)*p,+this.det3(e,d,f,t,l,c,i,h,_)*p,+this.det3(t,n,c,i,r,_,o,a,m)*p,-this.det3(e,s,f,i,r,_,o,a,m)*p,+this.det3(e,s,f,t,n,c,o,a,m)*p,-this.det3(e,s,f,t,n,c,i,r,_)*p,-this.det3(t,n,l,i,r,h,o,a,u)*p,+this.det3(e,s,d,i,r,h,o,a,u)*p,-this.det3(e,s,d,t,n,l,o,a,u)*p,+this.det3(e,s,d,t,n,l,i,r,h)*p))},x3dom.fields.SFMatrix4f.prototype.getEulerAngles=function(){var e,t,i,o,s,n,r;return 1e-4<Math.abs(Math.abs(this._20)-1)?(e=-Math.asin(this._20),t=Math.PI-e,n=Math.cos(e),r=Math.cos(t),s=Math.atan2(this._21/n,this._22/n),o=Math.atan2(this._21/r,this._22/r),[s,e,Math.atan2(this._10/n,this._00/n),o,t,Math.atan2(this._10/r,this._00/r)]):[s=-1==this._20?(i=Math.PI/2,0+Math.atan2(this._01,this._02)):(i=-Math.PI/2,-0+Math.atan2(-this._01,-this._02)),i,0,s,i,0]},x3dom.fields.SFMatrix4f.prototype.toString=function(){return this._00.toFixed(6)+" "+this._10.toFixed(6)+" "+this._20.toFixed(6)+" "+this._30.toFixed(6)+" "+this._01.toFixed(6)+" "+this._11.toFixed(6)+" "+this._21.toFixed(6)+" "+this._31.toFixed(6)+" "+this._02.toFixed(6)+" "+this._12.toFixed(6)+" "+this._22.toFixed(6)+" "+this._32.toFixed(6)+" "+this._03.toFixed(6)+" "+this._13.toFixed(6)+" "+this._23.toFixed(6)+" "+this._33.toFixed(6)},x3dom.fields.SFMatrix4f.prototype.setValueByStr=function(e){var t=!1,i=(/matrix.*\((.+)\)/.exec(e)&&(e=RegExp.$1,t=!0),e.split(/[,\s]+/).map(function(e){return+e}));return 16<=i.length?(t?(this._00=i[0],this._01=i[4],this._02=i[8],this._03=i[12],this._10=i[1],this._11=i[5],this._12=i[9],this._13=i[13],this._20=i[2],this._21=i[6],this._22=i[10],this._23=i[14],this._30=i[3],this._31=i[7],this._32=i[11]):(this._00=i[0],this._01=i[1],this._02=i[2],this._03=i[3],this._10=i[4],this._11=i[5],this._12=i[6],this._13=i[7],this._20=i[8],this._21=i[9],this._22=i[10],this._23=i[11],this._30=i[12],this._31=i[13],this._32=i[14]),this._33=i[15]):6===i.length?(this._00=i[0],this._01=i[1],this._02=0,this._03=i[4],this._10=i[2],this._11=i[3],this._12=0,this._13=i[5],this._20=0,this._21=0,this._22=1,this._23=0,this._30=0,this._31=0,this._32=0,this._33=1):x3dom.debug.logWarning("SFMatrix4f - can't parse string: "+e),this},x3dom.fields.SFVec2f=function(e,t){0===arguments.length?(this.x=0,this.y=0):(this.x=e,this.y=t)},x3dom.fields.SFVec2f.copy=function(e){return new x3dom.fields.SFVec2f(e.x,e.y)},x3dom.fields.SFVec2f.parse=function(e){e=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);return null===e?new x3dom.fields.SFVec2f:new x3dom.fields.SFVec2f(+e[1],+e[2])},x3dom.fields.SFVec2f.prototype.copy=function(){return x3dom.fields.SFVec2f.copy(this)},x3dom.fields.SFVec2f.prototype.setValues=function(e){return this.x=e.x,this.y=e.y,this},x3dom.fields.SFVec2f.prototype.at=function(e){switch(e){case 0:return this.x;case 1:return this.y;default:return this.x}},x3dom.fields.SFVec2f.prototype.add=function(e){return new x3dom.fields.SFVec2f(this.x+e.x,this.y+e.y)},x3dom.fields.SFVec2f.prototype.subtract=function(e){return new x3dom.fields.SFVec2f(this.x-e.x,this.y-e.y)},x3dom.fields.SFVec2f.prototype.negate=function(){return new x3dom.fields.SFVec2f(-this.x,-this.y)},x3dom.fields.SFVec2f.prototype.dot=function(e){return this.x*e.x+this.y*e.y},x3dom.fields.SFVec2f.prototype.reflect=function(e){var t=2*this.dot(e);return new x3dom.fields.SFVec2f(this.x-t*e.x,this.y-t*e.y)},x3dom.fields.SFVec2f.prototype.normalize=function(){var e=(e=this.length())&&1/e;return new x3dom.fields.SFVec2f(this.x*e,this.y*e)},x3dom.fields.SFVec2f.prototype.multComponents=function(e){return new x3dom.fields.SFVec2f(this.x*e.x,this.y*e.y)},x3dom.fields.SFVec2f.prototype.multiply=function(e){return new x3dom.fields.SFVec2f(this.x*e,this.y*e)},x3dom.fields.SFVec2f.prototype.divideComponents=function(e){return new x3dom.fields.SFVec2f(this.x/e.x,this.y/e.y)},x3dom.fields.SFVec2f.prototype.divide=function(e){e=e?1/e:1;return new x3dom.fields.SFVec2f(this.x*e,this.y*e)},x3dom.fields.SFVec2f.prototype.equals=function(e,t){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t},x3dom.fields.SFVec2f.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},x3dom.fields.SFVec2f.prototype.toGL=function(){return[this.x,this.y]},x3dom.fields.SFVec2f.prototype.toString=function(){return this.x+" "+this.y},x3dom.fields.SFVec2f.prototype.setValueByStr=function(e){e=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);return this.x=+(e=e||[0,0,0])[1],this.y=+e[2],this},x3dom.fields.SFVec3f=function(e,t,i){0===arguments.length?(this.x=0,this.y=0,this.z=0):(this.x=e,this.y=t,this.z=i)},x3dom.fields.SFVec3f.NullVector=new x3dom.fields.SFVec3f(0,0,0),x3dom.fields.SFVec3f.OneVector=new x3dom.fields.SFVec3f(1,1,1),x3dom.fields.SFVec3f.copy=function(e){return new x3dom.fields.SFVec3f(e.x,e.y,e.z)},x3dom.fields.SFVec3f.MIN=function(){return new x3dom.fields.SFVec3f(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)},x3dom.fields.SFVec3f.MAX=function(){return new x3dom.fields.SFVec3f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},x3dom.fields.SFVec3f.parse=function(e){try{var t=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);return new x3dom.fields.SFVec3f(+t[1],+t[2],+t[3])}catch(t){e=x3dom.fields.SFColor.colorParse(e);return new x3dom.fields.SFVec3f(e.r,e.g,e.b)}},x3dom.fields.SFVec3f.prototype.copy=function(){return x3dom.fields.SFVec3f.copy(this)},x3dom.fields.SFVec3f.prototype.fromArray=function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},x3dom.fields.SFVec3f.fromArray=function(e){return new x3dom.fields.SFVec3f(e[0],e[1],e[2])},x3dom.fields.SFVec3f.prototype.setValues=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},x3dom.fields.SFVec3f.prototype.set=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},x3dom.fields.SFVec3f.prototype.at=function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:return this.x}},x3dom.fields.SFVec3f.prototype.add=function(e){return new x3dom.fields.SFVec3f(this.x+e.x,this.y+e.y,this.z+e.z)},x3dom.fields.SFVec3f.prototype.addScaled=function(e,t){return new x3dom.fields.SFVec3f(this.x+t*e.x,this.y+t*e.y,this.z+t*e.z)},x3dom.fields.SFVec3f.prototype.subtract=function(e){return new x3dom.fields.SFVec3f(this.x-e.x,this.y-e.y,this.z-e.z)},x3dom.fields.SFVec3f.prototype.subtractVectors=function(e,t){return new x3dom.fields.SFVec3f(e.x-t.x,e.y-t.y,e.z-t.z)},x3dom.fields.SFVec3f.prototype.negate=function(){return new x3dom.fields.SFVec3f(-this.x,-this.y,-this.z)},x3dom.fields.SFVec3f.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},x3dom.fields.SFVec3f.prototype.cross=function(e){return new x3dom.fields.SFVec3f(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},x3dom.fields.SFVec3f.prototype.reflect=function(e){var t=2*this.dot(e);return new x3dom.fields.SFVec3f(this.x-t*e.x,this.y-t*e.y,this.z-t*e.z)},x3dom.fields.SFVec3f.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},x3dom.fields.SFVec3f.prototype.normalize=function(){var e=(e=this.length())&&1/e;return new x3dom.fields.SFVec3f(this.x*e,this.y*e,this.z*e)},x3dom.fields.SFVec3f.prototype.multComponents=function(e){return new x3dom.fields.SFVec3f(this.x*e.x,this.y*e.y,this.z*e.z)},x3dom.fields.SFVec3f.prototype.multiply=function(e){return new x3dom.fields.SFVec3f(this.x*e,this.y*e,this.z*e)},x3dom.fields.SFVec3f.prototype.divide=function(e){e=e?1/e:1;return new x3dom.fields.SFVec3f(this.x*e,this.y*e,this.z*e)},x3dom.fields.SFVec3f.prototype.equals=function(e,t){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t&&Math.abs(this.z-e.z)<t},x3dom.fields.SFVec3f.prototype.toGL=function(){return[this.x,this.y,this.z]},x3dom.fields.SFVec3f.prototype.toString=function(){return this.x+" "+this.y+" "+this.z},x3dom.fields.SFVec3f.prototype.setValueByStr=function(e){try{var t=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);this.x=+t[1],this.y=+t[2],this.z=+t[3]}catch(t){e=x3dom.fields.SFColor.colorParse(e);this.x=e.r,this.y=e.g,this.z=e.b}return this},x3dom.fields.SFVec4f=function(e,t,i,o){0===arguments.length?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x=e,this.y=t,this.z=i,this.w=o)},x3dom.fields.SFVec4f.copy=function(e){return new x3dom.fields.SFVec4f(e.x,e.y,e.z,e.w)},x3dom.fields.SFVec4f.prototype.copy=function(){return x3dom.fields.SFVec4f(this)},x3dom.fields.SFVec4f.parse=function(e){e=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);return null===e?new x3dom.fields.SFVec4f:new x3dom.fields.SFVec4f(+e[1],+e[2],+e[3],+e[4])},x3dom.fields.SFVec4f.prototype.setValueByStr=function(e){e=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);return this.x=+(e=e||[0,0,0,0,0])[1],this.y=+e[2],this.z=+e[3],this.w=+e[4],this},x3dom.fields.SFVec4f.prototype.toGL=function(){return[this.x,this.y,this.z,this.w]},x3dom.fields.SFVec4f.prototype.toString=function(){return this.x+" "+this.y+" "+this.z+" "+this.w},x3dom.fields.Quaternion=function(e,t,i,o){0===arguments.length?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x=e,this.y=t,this.z=i,this.w=o)},x3dom.fields.SFRotation=new Proxy(x3dom.fields.Quaternion,{construct:function(e,t){t[0]=t[0]||0,t[1]=null==t[1]?1:t[1],t[2]=t[2]||0,t[3]=t[3]||0;var i,o,s={get:function(e,t){switch(t){case"0":return e.SFRotation.x;case"1":return e.SFRotation.y;case"2":return e.SFRotation.z;case"3":case"angle":return e.SFRotation.angle;default:return Reflect.get(e,t)}},set:function(e,t,i){var o=e.SFRotation,s={0:"x",1:"y",2:"z",x:"x",y:"y",z:"z",angle:"angle"};return t in s?(o[s[t]]=i,e.setValues(new x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(o.x,o.y,o.z),o.angle)),!0):(x3dom.debug.logWarning(" SFRotation: property not available - "+t),!1)}};return t[0].constructor==x3dom.fields.SFVec3f?(o=(i=t[1].constructor==x3dom.fields.SFVec3f?new x3dom.fields.Quaternion.rotateFromTo(t[0].normalize(),t[1].normalize()):new x3dom.fields.Quaternion.axisAngle(t[0],t[1])).toAxisAngle(),i.SFRotation={x:o[0].x,y:o[0].y,z:o[0].z,angle:o[1]}):(i=new x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(t[0],t[1],t[2]),t[3])).SFRotation={x:t[0],y:t[1],z:t[2],angle:t[3]},new Proxy(i,s)}}),x3dom.fields.Quaternion.prototype.getAxis=function(){var e;return"SFRotation"in this?(e=this.SFRotation,new x3dom.fields.SFVec3f(e.x,e.y,e.z)):this.toAxisAngle()[0]},x3dom.fields.Quaternion.prototype.setAxis=function(e){"SFRotation"in this?(t=this.SFRotation.angle,this.SFRotation.x=e.x,this.SFRotation.y=e.y,this.SFRotation.z=e.z):t=this.angle();var t,e=new x3dom.fields.Quaternion.axisAngle(e,t);this.setValues(e)},x3dom.fields.Quaternion.prototype.multiVec=function(e){var t=x3dom.fields.SFMatrix4f.identity();return t.setRotate(this),t.multMatrixVec(e)},x3dom.fields.Quaternion.prototype.setValues=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},x3dom.fields.Quaternion.copy=function(e){return new x3dom.fields.Quaternion(e.x,e.y,e.z,e.w)},x3dom.fields.Quaternion.prototype.multiply=function(e){var t,e=new x3dom.fields.Quaternion(this.w*e.x+this.x*e.w+this.y*e.z-this.z*e.y,this.w*e.y+this.y*e.w+this.z*e.x-this.x*e.z,this.w*e.z+this.z*e.w+this.x*e.y-this.y*e.x,this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z);return"SFRotation"in this?(t=e.toAxisAngle(),new x3dom.fields.SFRotation(t[0].x,t[0].y,t[0].z,t[1])):e},x3dom.fields.Quaternion.prototype.fromArray=function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},x3dom.fields.Quaternion.fromArray=function(e){return new x3dom.fields.Quaternion(e[0],e[1],e[2],e[3])},x3dom.fields.Quaternion.parseAxisAngle=function(e){e=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);return null===e?new x3dom.fields.Quaternion:x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(+e[1],+e[2],+e[3]),+e[4])},x3dom.fields.Quaternion.axisAngle=function(e,t){var i=e.length();return i>x3dom.fields.Eps?(i=Math.sin(t/2)/i,t=Math.cos(t/2),new x3dom.fields.Quaternion(e.x*i,e.y*i,e.z*i,t)):new x3dom.fields.Quaternion(0,0,0,1)},x3dom.fields.Quaternion.prototype.copy=function(){return x3dom.fields.Quaternion.copy(this)},x3dom.fields.Quaternion.prototype.toMatrix=function(){var e=this.x*this.x,t=this.x*this.y,i=this.x*this.z,o=this.y*this.y,s=this.y*this.z,n=this.z*this.z,r=this.w*this.x,a=this.w*this.y,d=this.w*this.z;return new x3dom.fields.SFMatrix4f(1-2*(o+n),2*(t-d),2*(i+a),0,2*(t+d),1-2*(e+n),2*(s-r),0,2*(i-a),2*(s+r),1-2*(e+o),0,0,0,0,1)},x3dom.fields.Quaternion.prototype.toAxisAngle=function(){var e,t,i=0,o=0,s=0;return 1<this.w&&this.normalize(),t=2*Math.acos(this.w),s=0==(e=Math.sqrt(1-this.w*this.w))?(i=this.x,o=this.y,this.z):(i=this.x/e,o=this.y/e,this.z/e),[new x3dom.fields.SFVec3f(i,o,s),t]},x3dom.fields.Quaternion.prototype.angle=function(){return 2*Math.acos(this.w)},x3dom.fields.Quaternion.prototype.setValue=function(e){var t,i=1,o=[0,0,0],s=0,n=[1,2,0];0<(t=e._00+e._11+e._22)?(i=Math.sqrt(t+1),this.w=.5*i,this.x=(e._21-e._12)*(i=.5/i),this.y=(e._02-e._20)*i,this.z=(e._10-e._01)*i):(s=e._11>e._00?1:0,n=n[t=n[s=e._22>e.at(s,s)?2:s]],i=Math.sqrt(e.at(s,s)-(e.at(t,t)+e.at(n,n))+1),o[s]=.5*i,i=.5/i,this.w=(e.at(n,t)-e.at(t,n))*i,o[t]=(e.at(t,s)+e.at(s,t))*i,o[n]=(e.at(n,s)+e.at(s,n))*i,this.x=o[0],this.y=o[1],this.z=o[2]),(1<this.w||this.w<-1)&&(t=1+100*x3dom.fields.Eps,(this.w>t||this.w<-t)&&x3dom.debug.logInfo("MatToQuat: BUG: |quat[4]| ("+this.w+") >> 1.0 !"),1<this.w?this.w=1:this.w=-1)},x3dom.fields.Quaternion.prototype.setFromEuler=function(e,t,i){var o=Math.sin(.5*e),e=Math.cos(.5*e),s=Math.sin(.5*t),t=Math.cos(.5*t),n=Math.sin(.5*i),i=Math.cos(.5*i);return this.x=o*t*i-e*s*n,this.y=e*s*i+o*t*n,this.z=e*t*n-o*s*i,this.w=e*t*i+o*s*n,this},x3dom.fields.Quaternion.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},x3dom.fields.Quaternion.prototype.add=function(e){return new x3dom.fields.Quaternion(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},x3dom.fields.Quaternion.prototype.subtract=function(e){return new x3dom.fields.Quaternion(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},x3dom.fields.Quaternion.prototype.setValues=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},x3dom.fields.Quaternion.prototype.equals=function(e,t){return this.dot(e)>=1-t},x3dom.fields.Quaternion.prototype.multScalar=function(e){return new x3dom.fields.Quaternion(this.x*e,this.y*e,this.z*e,this.w*e)},x3dom.fields.Quaternion.prototype.normalize=function(){var e=this.dot(this),t=1;return e&&(t=1/Math.sqrt(e)),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},x3dom.fields.Quaternion.normalize=function(e){var t=e.dot(e),i=1;return t&&(i=1/Math.sqrt(t)),e.x*=i,e.y*=i,e.z*=i,e.w*=i,e},x3dom.fields.Quaternion.prototype.negate=function(){return new x3dom.fields.Quaternion(-this.x,-this.y,-this.z,-this.w)},x3dom.fields.Quaternion.prototype.inverse=function(){var e,t=new x3dom.fields.Quaternion(-this.x,-this.y,-this.z,this.w);return"SFRotation"in this?(e=t.toAxisAngle(),new x3dom.fields.SFRotation(e[0].x,e[0].y,e[0].z,e[1])):t},x3dom.fields.Quaternion.prototype.slerp=function(e,t){var i,o=this.dot(e),e=o<0?(o=-o,e.negate()):new x3dom.fields.Quaternion(e.x,e.y,e.z,e.w),s=(o=1e-5<1-o?(o=Math.acos(o),s=Math.sin(o),i=Math.sin((1-t)*o)/s,Math.sin(t*o)/s):(i=1-t,t),this.multScalar(i).add(e.multScalar(o)));return"SFRotation"in this?(t=s.toAxisAngle(),new x3dom.fields.SFRotation(t[0].x,t[0].y,t[0].z,t[1])):s},x3dom.fields.Quaternion.rotateFromTo=function(e,t){var i,o,s=e.normalize(),n=t.normalize(),n=s.dot(n);return.99999<n?new x3dom.fields.Quaternion(0,0,0,1):n<-.99999?(o=new x3dom.fields.SFVec3f(1,0,0),(i=s.cross(o)).length()<1e-5&&(o.x=0,o.y=1,o.z=0,i=s.cross(o)),i=i.normalize(),x3dom.fields.Quaternion.axisAngle(i,Math.PI)):(s=(s=e.cross(t)).normalize(),o=Math.sqrt(.5*(1-n)),s=s.multiply(o),o=Math.sqrt(.5*(1+n)),new x3dom.fields.Quaternion(s.x,s.y,s.z,o))},x3dom.fields.Quaternion.prototype.toGL=function(){var e=this.toAxisAngle();return[e[0].x,e[0].y,e[0].z,e[1]]},x3dom.fields.Quaternion.prototype.toString=function(){return"SFRotation"in this?this.SFRotation.x+" "+this.SFRotation.y+" "+this.SFRotation.z+" "+this.SFRotation.angle:this.x+" "+this.y+" "+this.z+", "+this.w},x3dom.fields.Quaternion.prototype.setValueByStr=function(e){e=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e),e=x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(+(e=e||[0,1,0,0,0])[1],+e[2],+e[3]),+e[4]);return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},x3dom.fields.SFColor=function(e,t,i){0===arguments.length?(this.r=0,this.g=0,this.b=0):(this.r=e,this.g=t,this.b=i)},x3dom.fields.SFColor.parse=function(e){try{var t=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);return new x3dom.fields.SFColor(+t[1],+t[2],+t[3])}catch(t){return x3dom.fields.SFColor.colorParse(e)}},x3dom.fields.SFColor.copy=function(e){return new x3dom.fields.SFColor(e.r,e.g,e.b)},x3dom.fields.SFColor.prototype.copy=function(){return x3dom.fields.SFColor.copy(this)},x3dom.fields.SFColor.prototype.setHSV=function(e,t,i){var o,s=0,n=0,r=0,a=i*(1-t),d=i*(1-t*(e=e/60-(o=Math.floor(e/60)))),l=i*(1-t*(1-e));switch(o){case 0:case 6:s=i,n=l,r=a;break;case 1:s=d,n=i,r=a;break;case 2:s=a,n=i,r=l;break;case 3:s=a,n=d,r=i;break;case 4:s=l,n=a,r=i;break;case 5:s=i,n=a,r=d;break;default:x3dom.debug.logWarning("Using black for invalid case in setHSV: "+o)}return this.r=s,this.g=n,this.b=r,this},x3dom.fields.SFColor.prototype.getHSV=function(){var e=0,t={},i=this.r;if(t.name="red",t.value=this.r,this.g<i&&(i=this.g),this.b<i&&(i=this.b),this.g>t.value&&(t.name="green",t.value=this.g),this.b>t.value&&(t.name="blue",t.value=this.b),0==(i=t.value-i))e=0;else if("red"==t.name)e=(this.g-this.b)/i%6*60;else if("green"==t.name)e=60*((this.b-this.r)/i+2);else{if("blue"!=t.name)throw"Unknown maximum component: "+t.name;e=60*((this.r-this.g)/i+4)}return e<0&&(e+=360),[e,0==t.value?0:i/t.value,t.value]},x3dom.fields.SFColor.prototype.setValues=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},x3dom.fields.SFColor.prototype.equals=function(e,t){return Math.abs(this.r-e.r)<t&&Math.abs(this.g-e.g)<t&&Math.abs(this.b-e.b)<t},x3dom.fields.SFColor.prototype.add=function(e){return new x3dom.fields.SFColor(this.r+e.r,this.g+e.g,this.b+e.b)},x3dom.fields.SFColor.prototype.subtract=function(e){return new x3dom.fields.SFColor(this.r-e.r,this.g-e.g,this.b-e.b)},x3dom.fields.SFColor.prototype.multiply=function(e){return new x3dom.fields.SFColor(this.r*e,this.g*e,this.b*e)},x3dom.fields.SFColor.prototype.toUint=function(){return(Math.round(255*this.r)<<16|Math.round(255*this.g)<<8|Math.round(255*this.b))>>>0},x3dom.fields.SFColor.prototype.setFromUint=function(e){return this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e>>0&255)/255,this},x3dom.fields.SFColor.prototype.toGL=function(){return[this.r,this.g,this.b]},x3dom.fields.SFColor.prototype.toString=function(){return this.r+" "+this.g+" "+this.b},x3dom.fields.SFColor.prototype.setValueByStr=function(e){try{var t=/^\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*$/.exec(e);this.r=+t[1],this.g=+t[2],this.b=+t[3]}catch(t){e=x3dom.fields.SFColor.colorParse(e);this.r=e.r,this.g=e.g,this.b=e.b}return this},x3dom.fields.SFColor.colorParse=function(e){e=_colorParse(e);return new x3dom.fields.SFColor(e.r,e.g,e.b)},x3dom.fields.SFColorRGBA=function(e,t,i,o){0===arguments.length?(this.r=0,this.g=0,this.b=0,this.a=1):(this.r=e,this.g=t,this.b=i,this.a=o)},x3dom.fields.SFColorRGBA.parse=function(e){try{var t=/^([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)$/.exec(e);return new x3dom.fields.SFColorRGBA(+t[1],+t[2],+t[3],+t[4])}catch(t){return x3dom.fields.SFColorRGBA.colorParse(e)}},x3dom.fields.SFColorRGBA.copy=function(e){return new x3dom.fields.SFColorRGBA(e.r,e.g,e.b,e.a)},x3dom.fields.SFColorRGBA.prototype.copy=function(){return x3dom.fields.SFColorRGBA.copy(this)},x3dom.fields.SFColorRGBA.prototype.setHSV=x3dom.fields.SFColor.prototype.setHSV,x3dom.fields.SFColorRGBA.prototype.getHSV=x3dom.fields.SFColor.prototype.getHSV,x3dom.fields.SFColorRGBA.prototype.setValues=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},x3dom.fields.SFColorRGBA.prototype.equals=function(e,t){return Math.abs(this.r-e.r)<t&&Math.abs(this.g-e.g)<t&&Math.abs(this.b-e.b)<t&&Math.abs(this.a-e.a)<t},x3dom.fields.SFColorRGBA.prototype.toGL=function(){return[this.r,this.g,this.b,this.a]},x3dom.fields.SFColorRGBA.prototype.toString=function(){return this.r+" "+this.g+" "+this.b+" "+this.a},x3dom.fields.SFColorRGBA.prototype.setValueByStr=function(e){try{var t=/^([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)\s*,?\s*([+\-]?\d*\.*\d*[eE]?[+\-]?\d*?)$/.exec(e);this.r=+t[1],this.g=+t[2],this.b=+t[3],this.a=+t[4]}catch(t){e=x3dom.fields.SFColorRGBA.colorParse(e);this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a}return this},x3dom.fields.SFColorRGBA.prototype.toUint=function(){return(Math.round(255*this.r)<<24|Math.round(255*this.g)<<16|Math.round(255*this.b)<<8|Math.round(255*this.a))>>>0},x3dom.fields.SFColorRGBA.prototype.setFromUint=function(e){return this.r=(e>>24&255)/255,this.g=(e>>16&255)/255,this.b=(e>>8&255)/255,this.a=(e>>0&255)/255,this},x3dom.fields.SFColorRGBA.colorParse=function(e){e=_colorParse(e);return new x3dom.fields.SFColorRGBA(e.r,e.g,e.b,e.a)},x3dom.fields.SFImage=function(e,t,i,o){var s;0!==arguments.length&&o&&o.map?(this.width=e,this.height=t,this.comp=i,s=this.array,o.map(function(e){s.push(e)},this.array)):(this.width=0,this.height=0,this.comp=0,this.array=[])},x3dom.fields.SFImage.parse=function(e){var t=new x3dom.fields.SFImage;return t.setValueByStr(e),t},x3dom.fields.SFImage.copy=function(e){var t=new x3dom.fields.SFImage;return t.width=e.width,t.height=e.height,t.comp=e.comp,t.setPixels(e.getPixels()),t},x3dom.fields.SFImage.prototype.copy=function(){return x3dom.fields.SFImage.copy(this)},x3dom.fields.SFImage.prototype.setValueByStr=function(e){var t=e.match(/(\w+)/g),i=t.length;if(this.array=[],2<i){this.width=+t[0],this.height=+t[1],this.comp=+t[2];for(var o,s=10,n=3;n<i;n++)t[n].substr&&("x"===t[n].substr(1,1).toLowerCase()&&(s=16),o=parseInt(t[n],s),1===this.comp?this.array.push(255&o):2===this.comp?this.array.push(o>>8&255,255&o):3===this.comp?this.array.push(o>>16&255,o>>8&255,255&o):4===this.comp&&this.array.push(o>>24&255,o>>16&255,o>>8&255,255&o))}else this.width=0,this.height=0,this.comp=0},x3dom.fields.SFImage.prototype.setPixel=function(e,t,i){t=(t*this.width+e)*this.comp;return 1===this.comp&&t<this.array.length?this.array[t]=255*i.r:2===this.comp&&1+t<this.array.length?(this.array[t]=255*i.r,this.array[1+t]=255*i.g):3===this.comp&&2+t<this.array.length?(this.array[t]=255*i.r,this.array[1+t]=255*i.g,this.array[2+t]=255*i.b):4===this.comp&&3+t<this.array.length&&(this.array[t]=255*i.r,this.array[1+t]=255*i.g,this.array[2+t]=255*i.b,this.array[3+t]=255*i.a),this},x3dom.fields.SFImage.prototype.getPixel=function(e,t){var i,t=(t*this.width+e)*this.comp;return 1===this.comp&&t<this.array.length?(i=this.array[t]/255,new x3dom.fields.SFColorRGBA(i,i,i,1)):2===this.comp&&1+t<this.array.length?(i=this.array[t]/255,e=this.array[1+t]/255,new x3dom.fields.SFColorRGBA(i,i,i,e)):3===this.comp&&2+t<this.array.length?new x3dom.fields.SFColorRGBA(this.array[t]/255,this.array[1+t]/255,this.array[2+t]/255,1):4===this.comp&&3+t<this.array.length?new x3dom.fields.SFColorRGBA(this.array[t]/255,this.array[1+t]/255,this.array[2+t]/255,this.array[3+t]/255):void 0},x3dom.fields.SFImage.prototype.setPixels=function(e){var t,i=0;if(1===this.comp)for(t=0;t<e.length;t++)this.array[i++]=255*e[t].r;else if(2===this.comp)for(t=0;t<e.length;t++)this.array[i++]=255*e[t].r,this.array[i++]=255*e[t].g;else if(3===this.comp)for(t=0;t<e.length;t++)this.array[i++]=255*e[t].r,this.array[i++]=255*e[t].g,this.array[i++]=255*e[t].b;else if(4===this.comp)for(t=0;t<e.length;t++)this.array[i++]=255*e[t].r,this.array[i++]=255*e[t].g,this.array[i++]=255*e[t].b,this.array[i++]=255*e[t].a},x3dom.fields.SFImage.prototype.getPixels=function(){var e,t=[];if(1===this.comp)for(e=0;e<this.array.length;e+=this.comp){var i=this.array[e]/255;t.push(new x3dom.fields.SFColorRGBA(i,i,i,1))}else if(2===this.comp)for(e=0;e<this.array.length;e+=this.comp){var i=this.array[e]/255,o=this.array[e+1]/255;t.push(new x3dom.fields.SFColorRGBA(i,i,i,o))}else if(3===this.comp)for(e=0;e<this.array.length;e+=this.comp)t.push(new x3dom.fields.SFColorRGBA(this.array[e]/255,this.array[e+1]/255,this.array[e+2]/255,1));else if(4===this.comp)for(e=0;e<this.array.length;e+=this.comp)t.push(new x3dom.fields.SFColorRGBA(this.array[e]/255,this.array[e+1]/255,this.array[e+2]/255,this.array[e+3]/255));return t},x3dom.fields.SFImage.prototype.toGL=function(){var t=[];return this.array.map(function(e){t.push(e)}),t},x3dom.fields.MFColor=function(e){var t;e&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFColor.copy=function(e){var t=new x3dom.fields.MFColor;return e.map(function(e){t.push(e.copy())},this),t},x3dom.fields.MFColor.prototype=x3dom.extend([]),x3dom.fields.MFColor.parse=function(e){for(var t=e.match(/([+\-0-9eE\.]+)/g),i=[],o=0,s=t?t.length:0;o<s;o+=3)i.push(new x3dom.fields.SFColor(+t[o+0],+t[o+1],+t[o+2]));return new x3dom.fields.MFColor(i)},x3dom.fields.MFColor.prototype.copy=function(){return x3dom.fields.MFColor.copy(this)},x3dom.fields.MFColor.prototype.setValueByStr=function(e){this.length=0;for(var t=e.match(/([+\-0-9eE\.]+)/g),i=0,o=t?t.length:0;i<o;i+=3)this.push(new x3dom.fields.SFColor(+t[i+0],+t[i+1],+t[i+2]))},x3dom.fields.MFColor.prototype.toGL=function(){var t=[];return this.map(function(e){t.push(e.r),t.push(e.g),t.push(e.b)}),t},x3dom.fields.MFColorRGBA=function(e){var t;e&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFColorRGBA.copy=function(e){var t=new x3dom.fields.MFColorRGBA;return e.map(function(e){t.push(e.copy())},this),t},x3dom.fields.MFColorRGBA.prototype=x3dom.extend([]),x3dom.fields.MFColorRGBA.parse=function(e){for(var t=e.match(/([+\-0-9eE\.]+)/g),i=[],o=0,s=t?t.length:0;o<s;o+=4)i.push(new x3dom.fields.SFColorRGBA(+t[o+0],+t[o+1],+t[o+2],+t[o+3]));return new x3dom.fields.MFColorRGBA(i)},x3dom.fields.MFColorRGBA.prototype.copy=function(){return x3dom.fields.MFColorRGBA.copy(this)},x3dom.fields.MFColorRGBA.prototype.setValueByStr=function(e){this.length=0;for(var t=e.match(/([+\-0-9eE\.]+)/g),i=0,o=t?t.length:0;i<o;i+=4)this.push(new x3dom.fields.SFColorRGBA(+t[i+0],+t[i+1],+t[i+2],+t[i+3]))},x3dom.fields.MFColorRGBA.prototype.toGL=function(){var t=[];return this.map(function(e){t.push(e.r),t.push(e.g),t.push(e.b),t.push(e.a)}),t},x3dom.fields.MFRotation=function(e){var t;e&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFRotation.prototype=x3dom.extend([]),x3dom.fields.MFRotation.copy=function(e){var t=new x3dom.fields.MFRotation;return e.map(function(e){t.push(e.copy())},this),t},x3dom.fields.MFRotation.prototype.copy=function(){return x3dom.fields.MFRotation.copy(this)},x3dom.fields.MFRotation.parse=function(e){for(var t=e.match(/([+\-0-9eE\.]+)/g),i=[],o=0,s=t?t.length:0;o<s;o+=4)i.push(x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(+t[o+0],+t[o+1],+t[o+2]),+t[o+3]));return new x3dom.fields.MFRotation(i)},x3dom.fields.MFRotation.prototype.setValueByStr=function(e){this.length=0;for(var t=e.match(/([+\-0-9eE\.]+)/g),i=0,o=t?t.length:0;i<o;i+=4)this.push(x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(+t[i+0],+t[i+1],+t[i+2]),+t[i+3]))},x3dom.fields.MFRotation.prototype.toGL=function(){var t=[];return this.map(function(e){e=e.toAxisAngle();t.push(e[0].x),t.push(e[0].y),t.push(e[0].z),t.push(e[1])}),t},x3dom.fields.MFVec3f=function(e){var t;e&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFVec3f.prototype=x3dom.extend(Array),x3dom.fields.MFVec3f.copy=function(e){var t=new x3dom.fields.MFVec3f;return e.map(function(e){t.push(e.copy())},this),t},x3dom.fields.MFVec3f.parse=function(e){for(var t=e.match(/([+\-0-9eE\.]+)/g),i=[],o=0,s=t?t.length:0;o<s;o+=3)i.push(new x3dom.fields.SFVec3f(+t[o+0],+t[o+1],+t[o+2]));return new x3dom.fields.MFVec3f(i)},x3dom.fields.MFVec3f.prototype.copy=function(){return x3dom.fields.MFVec3f.copy(this)},x3dom.fields.MFVec3f.prototype.setValueByStr=function(e){this.length=0;for(var t=e.match(/([+\-0-9eE\.]+)/g),i=0,o=t?t.length:0;i<o;i+=3)this.push(new x3dom.fields.SFVec3f(+t[i+0],+t[i+1],+t[i+2]));return this},x3dom.fields.MFVec3f.prototype.setValues=function(e){for(var t=Math.min(e.length,this.length),i=0;i<t;i++)this[i].setValues(e[i])},x3dom.fields.MFVec3f.prototype.toGL=function(){var t=[];return this.map(function(e){t.push(e.x),t.push(e.y),t.push(e.z)}),t},x3dom.fields.MFVec3f.prototype.toString=function(){var t="";return this.forEach(function(e){t=t+e.toString()+" "}),t.trim()},x3dom.fields.MFVec2f=function(e){var t;e&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFVec2f.prototype=x3dom.extend([]),x3dom.fields.MFVec2f.copy=function(e){var t=new x3dom.fields.MFVec2f;return e.map(function(e){t.push(e.copy())},this),t},x3dom.fields.MFVec2f.parse=function(e){for(var t=e.match(/([+\-0-9eE\.]+)/g),i=[],o=0,s=t?t.length:0;o<s;o+=2)i.push(new x3dom.fields.SFVec2f(+t[o+0],+t[o+1]));return new x3dom.fields.MFVec2f(i)},x3dom.fields.MFVec2f.prototype.copy=function(){return x3dom.fields.MFVec2f.copy(this)},x3dom.fields.MFVec2f.prototype.setValueByStr=function(e){this.length=0;for(var t=e.match(/([+\-0-9eE\.]+)/g),i=0,o=t?t.length:0;i<o;i+=2)this.push(new x3dom.fields.SFVec2f(+t[i+0],+t[i+1]))},x3dom.fields.MFVec2f.prototype.toGL=function(){var t=[];return this.map(function(e){t.push(e.x),t.push(e.y)}),t},x3dom.fields.MFInt32=function(e){var t;e&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFInt32.prototype=x3dom.extend([]),x3dom.fields.MFInt32.copy=function(e){var t=new x3dom.fields.MFInt32;return e.map(function(e){t.push(e)},this),t},x3dom.fields.MFInt32.parse=function(e){for(var t=e.match(/([+\-]?\d+\s*){1},?\s*/g),i=[],o=0,s=t?t.length:0;o<s;++o)i.push(parseInt(t[o],10));return new x3dom.fields.MFInt32(i)},x3dom.fields.MFInt32.prototype.copy=function(){return x3dom.fields.MFInt32.copy(this)},x3dom.fields.MFInt32.prototype.setValueByStr=function(e){this.length=0;for(var t=e.match(/([+\-]?\d+\s*){1},?\s*/g),i=0,o=t?t.length:0;i<o;++i)this.push(parseInt(t[i],10))},x3dom.fields.MFInt32.prototype.toGL=function(){var t=[];return this.map(function(e){t.push(e)}),t},x3dom.fields.MFFloat=function(e){var t;e&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFFloat.prototype=x3dom.extend([]),x3dom.fields.MFFloat.copy=function(e){var t=new x3dom.fields.MFFloat;return e.map(function(e){t.push(e)},this),t},x3dom.fields.MFFloat.parse=function(e){for(var t=e.match(/([+\-0-9eE\.]+)/g),i=[],o=0,s=t?t.length:0;o<s;o++)i.push(+t[o]);return new x3dom.fields.MFFloat(i)},x3dom.fields.MFFloat.prototype.copy=function(){return x3dom.fields.MFFloat.copy(this)},x3dom.fields.MFFloat.prototype.setValueByStr=function(e){this.length=0;for(var t=e.match(/([+\-0-9eE\.]+)/g),i=0,o=t?t.length:0;i<o;i++)this.push(+t[i])},x3dom.fields.MFFloat.prototype.toGL=function(){var t=[];return this.map(function(e){t.push(e)}),t},x3dom.fields.MFBoolean=function(e){var t;e&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFBoolean.prototype=x3dom.extend([]),x3dom.fields.MFBoolean.copy=function(e){var t=new x3dom.fields.MFBoolean;return e.map(function(e){t.push(e)},this),t},x3dom.fields.MFBoolean.parse=function(e){for(var t=e.match(/(true|false|1|0)/gi),i=[],o=0,s=t?t.length:0;o<s;o++)i.push("1"==t[o]||"true"==t[o].toLowerCase());return new x3dom.fields.MFBoolean(i)},x3dom.fields.MFBoolean.prototype.copy=function(){return x3dom.fields.MFBoolean.copy(this)},x3dom.fields.MFBoolean.prototype.setValueByStr=function(e){this.length=0;for(var t=e.match(/(true|false|1|0)/gi),i=0,o=t?t.length:0;i<o;i++)this.push("1"==t[i]||"true"==t[i].toLowerCase())},x3dom.fields.MFBoolean.prototype.toGL=function(){var t=[];return this.map(function(e){t.push(e?1:0)}),t},x3dom.fields.MFString=function(e){var t;e&&e.map&&e.map(function(e){t.push(e)},t=this)},x3dom.fields.MFString.prototype=x3dom.extend([]),x3dom.fields.MFString.copy=function(e){var t=new x3dom.fields.MFString;return e.map(function(e){t.push(e)},this),t},x3dom.fields.MFString.parse=function(e){var t=[];if((e=e.trim()).length&&'"'==e[0])for(var i=/"((?:[^\\"]|\\\\|\\")*)"/g;o=i.exec(e);){var o=o[1].replace(/\\([\\"])/g,"$1");void 0!==o&&t.push(o)}else t.push(e);return new x3dom.fields.MFString(t)},x3dom.fields.MFString.prototype.copy=function(){return x3dom.fields.MFString.copy(this)},x3dom.fields.MFString.prototype.setValueByStr=function(e){if(this.length=0,e.length&&'"'==e[0])for(var t=/"((?:[^\\"]|\\\\|\\")*)"/g;i=t.exec(e);){var i=i[1].replace(/\\([\\"])/,"$1");void 0!==i&&this.push(i)}else this.push(e);return this},x3dom.fields.MFString.prototype.toString=function(){for(var e="",t=0,i=this.length;t<i;t++)e=e+this[t]+" ";return e},x3dom.fields.SFNode=function(e){this.type=e,this.node=null},x3dom.fields.SFNode.prototype.hasLink=function(e){return e?this.node===e:this.node},x3dom.fields.SFNode.prototype.addLink=function(e){return this.node=e,!0},x3dom.fields.SFNode.prototype.rmLink=function(e){return this.node===e&&!(this.node=null)},x3dom.fields.MFNode=function(e){this.type=e,this.nodes=[]},x3dom.fields.MFNode.prototype.hasLink=function(e){if(!e)return 0<this.length;for(var t=0,i=this.nodes.length;t<i;t++)if(this.nodes[t]===e)return!0;return!1},x3dom.fields.MFNode.prototype.addLink=function(e){return this.nodes.push(e),!0},x3dom.fields.MFNode.prototype.rmLink=function(e){for(var t=0,i=this.nodes.length;t<i;t++)if(this.nodes[t]===e)return this.nodes.splice(t,1),!0;return!1},x3dom.fields.MFNode.prototype.length=function(){return this.nodes.length},x3dom.fields.Line=function(e,t){0===arguments.length&&(this.pos=new x3dom.fields.SFVec3f(0,0,0),this.dir=new x3dom.fields.SFVec3f(0,0,1)),this.pos=x3dom.fields.SFVec3f.copy(e),this.dir=x3dom.fields.SFVec3f.copy(t)},x3dom.fields.Line.prototype.closestPoint=function(e){e=e.subtract(this.pos).dot(this.dir);return this.pos.add(this.dir.multiply(e))},x3dom.fields.Line.prototype.shortestDistance=function(e){var e=e.subtract(this.pos),t=e.dot(this.dir);return e.subtract(this.dir.multiply(t)).length()},x3dom.fields.Ray=function(e,t){0===arguments.length?(this.pos=new x3dom.fields.SFVec3f(0,0,0),this.dir=new x3dom.fields.SFVec3f(0,0,1)):(this.pos=new x3dom.fields.SFVec3f(e.x,e.y,e.z),e=(e=t.length())&&1/e,this.dir=new x3dom.fields.SFVec3f(t.x*e,t.y*e,t.z*e)),this.enter=0,this.exit=0,this.hitObject=null,this.hitPoint={},this.dist=Number.MAX_VALUE},x3dom.fields.Ray.prototype.toString=function(){return"Ray: ["+this.pos.toString()+"; "+this.dir.toString()+"]"},x3dom.fields.Ray.prototype.intersectPlane=function(e,t){var i=null,o=t.dot(this.dir);return o<0&&(e=(e.dot(t)-this.pos.dot(t))/o,i=this.pos.addScaled(this.dir,e)),i},x3dom.fields.Ray.prototype.intersect=function(e,t){var i,o,s,n=0,r=Number.MAX_VALUE;if(this.dir.x>x3dom.fields.Eps)i=1/this.dir.x,o=(e.x-this.pos.x)*i,(s=(t.x-this.pos.x)*i)<r&&(r=s),n<o&&(n=o);else if(this.dir.x<-x3dom.fields.Eps)i=1/this.dir.x,o=(t.x-this.pos.x)*i,(s=(e.x-this.pos.x)*i)<r&&(r=s),n<o&&(n=o);else if(this.pos.x<e.x||this.pos.x>t.x)return!1;if(this.dir.y>x3dom.fields.Eps){if(i=1/this.dir.y,(n=n<(o=(e.y-this.pos.y)*i)?o:n)-(r=(s=(t.y-this.pos.y)*i)<r?s:r)>=x3dom.fields.Eps)return!1}else if(this.dir.y<-x3dom.fields.Eps){if(i=1/this.dir.y,(n=n<(o=(t.y-this.pos.y)*i)?o:n)-(r=(s=(e.y-this.pos.y)*i)<r?s:r)>=x3dom.fields.Eps)return!1}else if(this.pos.y<e.y||this.pos.y>t.y)return!1;if(this.dir.z>x3dom.fields.Eps)i=1/this.dir.z,o=(e.z-this.pos.z)*i,(s=(t.z-this.pos.z)*i)<r&&(r=s),n<o&&(n=o);else if(this.dir.z<-x3dom.fields.Eps)i=1/this.dir.z,o=(t.z-this.pos.z)*i,(s=(e.z-this.pos.z)*i)<r&&(r=s),n<o&&(n=o);else if(this.pos.z<e.z||this.pos.z>t.z)return!1;return(this.enter=n)-(this.exit=r)<x3dom.fields.Eps},x3dom.fields.BoxVolume=function(e,t){arguments.length<2?(this.min=new x3dom.fields.SFVec3f(0,0,0),this.max=new x3dom.fields.SFVec3f(0,0,0),this.valid=!1):(this.min=x3dom.fields.SFVec3f.copy(e),this.max=x3dom.fields.SFVec3f.copy(t),this.valid=!0),this.updateInternals()},x3dom.fields.BoxVolume.prototype.getScalarValue=function(){var e=this.max.subtract(this.min);return e.x*e.y*e.z},x3dom.fields.BoxVolume.copy=function(e){var t=new x3dom.fields.BoxVolume(e.min,e.max);return t.valid=e.valid,t},x3dom.fields.BoxVolume.prototype.equals=function(e){return this.min.equals(e.min,1e-12)&&this.max.equals(e.max,1e-12)},x3dom.fields.BoxVolume.prototype.updateInternals=function(){this.radialVec=this.max.subtract(this.min).multiply(.5),this.center=this.min.add(this.radialVec),this.diameter=2*this.radialVec.length()},x3dom.fields.BoxVolume.prototype.setBounds=function(e,t){this.min.setValues(e),this.max.setValues(t),this.updateInternals(),this.valid=!0},x3dom.fields.BoxVolume.prototype.setBoundsByCenterSize=function(e,t){t=t.multiply(.5);this.min=e.subtract(t),this.max=e.add(t),this.updateInternals(),this.valid=!0},x3dom.fields.BoxVolume.prototype.extendBounds=function(e,t){this.valid?(this.min.x>e.x&&(this.min.x=e.x),this.min.y>e.y&&(this.min.y=e.y),this.min.z>e.z&&(this.min.z=e.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z),this.updateInternals()):this.setBounds(e,t)},x3dom.fields.BoxVolume.prototype.getBounds=function(e,t){e.setValues(this.min),t.setValues(this.max)},x3dom.fields.BoxVolume.prototype.getRadialVec=function(){return this.radialVec},x3dom.fields.BoxVolume.prototype.invalidate=function(){this.valid=!1,this.min=new x3dom.fields.SFVec3f(0,0,0),this.max=new x3dom.fields.SFVec3f(0,0,0),this.updateInternals()},x3dom.fields.BoxVolume.prototype.isValid=function(){return this.valid},x3dom.fields.BoxVolume.prototype.getCenter=function(){return this.center},x3dom.fields.BoxVolume.prototype.getDiameter=function(){return this.diameter},x3dom.fields.BoxVolume.prototype.transform=function(e){var t,i,o,s=t=e._03,n=i=e._13,r=o=e._23,a=this.max.x*e._00,d=this.min.x*e._00;d<=a?(t+=a,s+=d):(t+=d,s+=a),(a=this.max.y*e._01)>=(d=this.min.y*e._01)?(t+=a,s+=d):(t+=d,s+=a),(a=this.max.z*e._02)>=(d=this.min.z*e._02)?(t+=a,s+=d):(t+=d,s+=a),(a=this.max.x*e._10)>=(d=this.min.x*e._10)?(i+=a,n+=d):(i+=d,n+=a),(a=this.max.y*e._11)>=(d=this.min.y*e._11)?(i+=a,n+=d):(i+=d,n+=a),(a=this.max.z*e._12)>=(d=this.min.z*e._12)?(i+=a,n+=d):(i+=d,n+=a),(a=this.max.x*e._20)>=(d=this.min.x*e._20)?(o+=a,r+=d):(o+=d,r+=a),(a=this.max.y*e._21)>=(d=this.min.y*e._21)?(o+=a,r+=d):(o+=d,r+=a),(a=this.max.z*e._22)>=(d=this.min.z*e._22)?(o+=a,r+=d):(o+=d,r+=a),this.min.x=s,this.min.y=n,this.min.z=r,this.max.x=t,this.max.y=i,this.max.z=o,this.updateInternals()},x3dom.fields.BoxVolume.prototype.transformFrom=function(e,t){var i,o,s,n=i=e._03,r=o=e._13,a=s=e._23,d=t.max.x*e._00,l=t.min.x*e._00;l<=d?(i+=d,n+=l):(i+=l,n+=d),(d=t.max.y*e._01)>=(l=t.min.y*e._01)?(i+=d,n+=l):(i+=l,n+=d),(d=t.max.z*e._02)>=(l=t.min.z*e._02)?(i+=d,n+=l):(i+=l,n+=d),(d=t.max.x*e._10)>=(l=t.min.x*e._10)?(o+=d,r+=l):(o+=l,r+=d),(d=t.max.y*e._11)>=(l=t.min.y*e._11)?(o+=d,r+=l):(o+=l,r+=d),(d=t.max.z*e._12)>=(l=t.min.z*e._12)?(o+=d,r+=l):(o+=l,r+=d),(d=t.max.x*e._20)>=(l=t.min.x*e._20)?(s+=d,a+=l):(s+=l,a+=d),(d=t.max.y*e._21)>=(l=t.min.y*e._21)?(s+=d,a+=l):(s+=l,a+=d),(d=t.max.z*e._22)>=(l=t.min.z*e._22)?(s+=d,a+=l):(s+=l,a+=d),this.min.x=n,this.min.y=r,this.min.z=a,this.max.x=i,this.max.y=o,this.max.z=s,this.updateInternals(),this.valid=!0},x3dom.fields.FrustumVolume=function(e){if(this.planeNormals=[],this.planeDistances=[],this.directionIndex=[],0!==arguments.length){for(var t=[],i=0;i<6;i++)this.planeNormals[i]=new x3dom.fields.SFVec3f(0,0,0),this.planeDistances[i]=0,this.directionIndex[i]=0,t[i]=new x3dom.fields.SFVec4f(0,0,0,0);for(t[0].x=e._30-e._00,t[0].y=e._31-e._01,t[0].z=e._32-e._02,t[0].w=e._33-e._03,t[1].x=e._30+e._00,t[1].y=e._31+e._01,t[1].z=e._32+e._02,t[1].w=e._33+e._03,t[2].x=e._30+e._10,t[2].y=e._31+e._11,t[2].z=e._32+e._12,t[2].w=e._33+e._13,t[3].x=e._30-e._10,t[3].y=e._31-e._11,t[3].z=e._32-e._12,t[3].w=e._33-e._13,t[4].x=e._30+e._20,t[4].y=e._31+e._21,t[4].z=e._32+e._22,t[4].w=e._33+e._23,t[5].x=e._30-e._20,t[5].y=e._31-e._21,t[5].z=e._32-e._22,t[5].w=e._33-e._23,i=0;i<6;i++){var o=Math.sqrt(t[i].x*t[i].x+t[i].y*t[i].y+t[i].z*t[i].z);t[i].x/=o,t[i].y/=o,t[i].z/=o,t[i].w/=-o}e=function(e){var t=0;return 0<e.x&&(t|=1),0<e.y&&(t|=2),0<e.z&&(t|=4),t};this.planeNormals[3].setValues(t[0]),this.planeDistances[3]=t[0].w,this.directionIndex[3]=e(this.planeNormals[3]),this.planeNormals[2].setValues(t[1]),this.planeDistances[2]=t[1].w,this.directionIndex[2]=e(this.planeNormals[2]),this.planeNormals[5].setValues(t[2]),this.planeDistances[5]=t[2].w,this.directionIndex[5]=e(this.planeNormals[5]),this.planeNormals[4].setValues(t[3]),this.planeDistances[4]=t[3].w,this.directionIndex[4]=e(this.planeNormals[4]),this.planeNormals[0].setValues(t[4]),this.planeDistances[0]=t[4].w,this.directionIndex[0]=e(this.planeNormals[0]),this.planeNormals[1].setValues(t[5]),this.planeDistances[1]=t[5].w,this.directionIndex[1]=e(this.planeNormals[1])}},x3dom.fields.FrustumVolume.prototype.intersect=function(e,t){if(this.planeNormals.length<6)return x3dom.debug.logWarning("FrustumVolume not initialized!"),!1;var i=this,o=e.min,s=e.max,n=function(e){var t=new x3dom.fields.SFVec3f(0,0,0);return t.x=(1&e?o:s).x,t.y=(2&e?o:s).y,t.z=(4&e?o:s).z,t},r=function(e,t){return 0<=i.planeNormals[e].dot(t)-i.planeDistances[e]},a=1;t<0&&(t=0);for(var d,l,h=0;h<6;h++,a<<=1)if(0==(t&a)){if(d=h,l=void 0,l=n(7^i.directionIndex[d]),!r(d,l))return-1;d=h,l=void 0,l=n(i.directionIndex[d]),r(d,l)&&(t|=a)}return t},x3dom.BindableStack=function(e,t,i,o){this._doc=e,this._type=t,this._defaultType=i,this._defaultRoot=null,this._getter=o,this._bindBag=[],this._bindStack=[]},x3dom.BindableStack.prototype.top=function(){return 0<this._bindStack.length?this._bindStack[this._bindStack.length-1]:null},x3dom.BindableStack.prototype.push=function(e){var t=this.top();t!==e&&(t&&t.deactivate(),this._bindStack.push(e),e.activate(t))},x3dom.BindableStack.prototype.replaceTop=function(e){var t=this.top();t!==e&&t&&(t.deactivate(),(this._bindStack[this._bindStack.length-1]=e).activate(t))},x3dom.BindableStack.prototype.pop=function(e){var t;return e&&e!==(t=this.top())?null:((t=this._bindStack.pop())&&t.deactivate(),t)},x3dom.BindableStack.prototype.switchTo=function(e){var t=this.getActive(),i=this._bindBag.length,o=0,s=0,n=-1;if(!(i<=1)){switch(e){case"first":o=this._bindBag[0];break;case"last":o=this._bindBag[i-1];break;default:for(s=0;s<i;s++)if(this._bindBag[s]==t){n=s;break}if(0<=n)for(s=n;!o&&(s="next"==e?s<i-1?s+1:0:0<s?s-1:i-1)!=n;)0<=this._bindBag[s]._vf.description.length&&(o=this._bindBag[s])}o?this.replaceTop(o):x3dom.debug.logWarning("Cannot switch bindable; no other bindable with description found.")}},x3dom.BindableStack.prototype.getActive=function(){0===this._bindStack.length&&(0===this._bindBag.length?this._defaultRoot?(x3dom.debug.logInfo("create new "+this._defaultType._typeName+" for "+this._type._typeName+"-stack"),e=new this._defaultType({doc:this._doc,nameSpace:this._defaultRoot._nameSpace,autoGen:!0}),this._defaultRoot.addChild(e),e.nodeChanged()):x3dom.debug.logError("stack without defaultRoot"):x3dom.debug.logInfo("activate first "+this._type._typeName+" for "+this._type._typeName+"-stack"),this._bindStack.push(this._bindBag[0]),this._bindBag[0].activate());var e=this._bindStack[this._bindStack.length-1];return null==e._nameSpace&&(this.pop(),e=this.getActive()),e},x3dom.BindableBag=function(e){this._stacks=[],this.addType("X3DViewpointNode","Viewpoint","getViewpoint",e),this.addType("X3DNavigationInfoNode","NavigationInfo","getNavigationInfo",e),this.addType("X3DBackgroundNode","Background","getBackground",e),this.addType("X3DFogNode","Fog","getFog",e),this.addType("X3DEnvironmentNode","Environment","getEnvironment",e)},x3dom.BindableBag.prototype.addType=function(e,t,i,o){var s=x3dom.nodeTypes[e],t=x3dom.nodeTypes[t];s&&t?(o=new x3dom.BindableStack(o,s,t,i),this._stacks.push(o)):x3dom.debug.logWarning("Invalid Bindable type/defaultType: "+e+"/"+t)},x3dom.BindableBag.prototype.setRefNode=function(t){this._stacks.forEach(function(e){(e._defaultRoot=t)[e._getter]=function(){return e.getActive()}})},x3dom.BindableBag.prototype.addBindable=function(e){for(var t=0,i=this._stacks.length;t<i;t++){var o=this._stacks[t];if(x3dom.isa(e,o._type)){x3dom.debug.logInfo("register "+e.typeName()+"Bindable "+e._DEF+"/"+e._vf.description),o._bindBag.push(e);var s=o.top();if(s&&s._autoGen){o.replaceTop(e);for(var n=0,r=o._bindBag.length;n<r;n++)if(o._bindBag[n]===s){o._bindBag.splice(n,1);break}o._defaultRoot.removeChild(s)}return o}}return x3dom.debug.logError(e.typeName()+" is not a valid bindable"),null},x3dom.NodeNameSpace=function(e,t){this.name=e,this.doc=t,this.baseURL="",this.setBaseURL(t.properties.properties.baseURL),this.defMap={},this.parent=null,this.childSpaces=[],this.protos=[],this.lateRoutes=[],this.imports=new Map,this.exports=new Map,this.superInlineNode=null},x3dom.NodeNameSpace.prototype.addNode=function(e,t){(this.defMap[t]=e)._nameSpace||(e._nameSpace=this)},x3dom.NodeNameSpace.prototype.removeNode=function(e){var t=e?this.defMap[e]:null;t&&(delete this.defMap[e],t._nameSpace==this)&&(t._nameSpace=null)},x3dom.NodeNameSpace.prototype.getNamedNode=function(e){return this.defMap[e]},x3dom.NodeNameSpace.prototype.getNamedElement=function(e){e=this.defMap[e];return e?e._xmlNode:null},x3dom.NodeNameSpace.prototype.addSpace=function(e){this.childSpaces.push(e),e.parent=this},x3dom.NodeNameSpace.prototype.removeSpace=function(e){e.parent=null;for(var t=0;t<this.childSpaces.length;t++)this.childSpaces[t]==e&&this.childSpaces.splice(t,1)},x3dom.NodeNameSpace.prototype.setBaseURL=function(e){var t=e.lastIndexOf("/");this.baseURL=0<=t?e.substr(0,t+1):"",x3dom.debug.logInfo("setBaseURL: "+this.baseURL)},x3dom.NodeNameSpace.prototype.getURL=function(e){return void 0!==e&&e.length?"/"===e[0]||0<=e.indexOf(":")?e:this.baseURL+e:""},x3dom.hasElementAttribute=function(e){var t=this.__hasAttribute(e);return t=!t&&e?this.__hasAttribute(e.toLowerCase()):t},x3dom.getElementAttribute=function(e){var t=this.__getAttribute(e);return null==(t=!t&&""!=t&&e?this.__getAttribute(e.toLowerCase()):t)&&this._x3domNode?this._x3domNode._vf[e]:t},x3dom.setElementAttribute=function(e,t){this.__setAttribute(e,t);var i=this._x3domNode;i&&(x3dom.userAgentFeature.supportsMutationObserver||i.updateField(e,t),i._nameSpace.doc.needRender=!0)},x3dom.getFieldValue=function(e){var t,i=this._x3domNode;return i&&void 0!==i._vf[e]?(t=i._vf[e])instanceof Object&&"copy"in t?i._vf[e].copy():i._vf[e]:null},x3dom.setFieldValue=function(e,t){var i=this._x3domNode;i&&void 0!==i._vf[e]&&i._nameSpace&&(t instanceof Object&&"copy"in t?i._vf[e]=t.copy():i._vf[e]=t,i.fieldChanged(e),i._nameSpace.doc.needRender=!0)},x3dom.requestFieldRef=function(e){var t=this._x3domNode;return t&&t._vf[e]?t._vf[e]:null},x3dom.releaseFieldRef=function(e){var t=this._x3domNode;t&&t._vf[e]&&t._nameSpace&&(t.fieldChanged(e),t._nameSpace.doc.needRender=!0)},x3dom.attachFieldAccess=function(e){e.requestFieldRef=x3dom.requestFieldRef,e.releaseFieldRef=x3dom.releaseFieldRef,e.getFieldValue=x3dom.getFieldValue,e.setFieldValue=x3dom.setFieldValue},x3dom.NodeNameSpace.prototype.setupTree=function(i,o){var e,t,s,n,r,a,d,l,h,u=null;if(o=o||null,x3dom.isX3DElement(i)){if(i._x3domNode)return x3dom.debug.logWarning("Tree is already initialized"),null;if(void 0===i.tagName||i.__addEventListener||i.__removeEventListener||(i.__addEventListener=i.addEventListener,i.addEventListener=function(e,t,i){this._x3domNode._listeners[e]||(this._x3domNode._listeners[e]=[]),this._x3domNode._listeners[e].push(t),this.__addEventListener(e,t,i)},i.__removeEventListener=i.removeEventListener,i.removeEventListener=function(e,t,i){var o=this._x3domNode._listeners[e];if(o)for(var s=0;s<o.length;s++)o[s]==t&&(o.splice(s,1),s--);this.__removeEventListener(e,t,i)}),i.hasAttribute("USE")||i.hasAttribute("use")){if(i.hasAttribute("USE")||i.setAttribute("USE",i.getAttribute("use")),!(u=this.defMap[i.getAttribute("USE")])){var f=i.getAttribute("USE").split("__");if(2<=f.length){for(var c=this;c;)c=(u=c.name==f[0]?c.defMap[f[1]]:u)?null:c.parent;u||(u=null,x3dom.debug.logWarning("Could not USE: "+i.getAttribute("USE")))}}return u&&(i._x3domNode=u,x3dom.attachFieldAccess(i)),u}if("route"===i.localName.toLowerCase())return r=(n=i).getAttribute("fromNode")||n.getAttribute("fromnode"),_=n.getAttribute("toNode")||n.getAttribute("tonode"),t=this.defMap[r],s=this.defMap[_],h=n.getAttribute("fromField")||n.getAttribute("fromfield"),e=n.getAttribute("toField")||n.getAttribute("tofield"),t&&s?(t.setupRoute(h,s,e),n._nodeNameSpace=this):(x3dom.debug.logWarning("not yet available route - can't find all DEFs for "+h+" -> "+e),this.lateRoutes.push({route:n,fnDEF:r,tnDEF:_,fnAtt:h,tnAtt:e})),null;if("import"===i.localName.toLowerCase())return t=i.getAttribute("inlineDEF")||i.getAttribute("inlinedef"),s=i.getAttribute("importedDEF")||i.getAttribute("importeddef"),a=i.getAttribute("AS")||i.getAttribute("as"),t&&s&&(a=a||s,this.imports.get(t)||this.imports.set(t,new Map),this.imports.get(t).set(a,s),(i._nodeNameSpace=this).defMap[t])&&this.defMap[t]._childNodes[0]&&this.defMap[t]._childNodes[0]._nameSpace&&(d=(n=this.defMap[t]._childNodes[0]._nameSpace).exports.get(s))&&(r=n.defMap[d])&&(this.defMap[a]=r,this.routeLateRoutes()),null;if("export"===i.localName.toLowerCase())return d=i.getAttribute("localDEF")||i.getAttribute("localdef"),a=i.getAttribute("AS")||i.getAttribute("as"),d&&(this.exports.set(a=a||d,d),(i._nodeNameSpace=this).superInlineNode)&&this.superInlineNode._nameSpace&&this.superInlineNode._nameSpace.importNodes(this),null;x3dom.attachFieldAccess(i);var _=x3dom.nodeTypesLC[i.localName.toLowerCase()];if(void 0!==_)return!1===x3dom.userAgentFeature.supportsDOMAttrModified&&i instanceof Element&&(i.setAttribute&&!i.__setAttribute&&(i.__setAttribute=i.setAttribute,i.setAttribute=x3dom.setElementAttribute),i.getAttribute&&!i.__getAttribute&&(i.__getAttribute=i.getAttribute,i.getAttribute=x3dom.getElementAttribute),i.hasAttribute)&&!i.__hasAttribute&&(i.__hasAttribute=i.hasAttribute,i.hasAttribute=x3dom.hasElementAttribute),u=new _({doc:this.doc,runtime:this.doc._x3dElem.runtime,xmlNode:i,nameSpace:this}),i.hasAttribute("DEF")?(u._DEF=i.getAttribute("DEF"),this.defMap[u._DEF]=u):i.hasAttribute("id")&&(u._DEF=i.getAttribute("id"),u._DEF in this.defMap||(this.defMap[u._DEF]=u)),void 0===i.highlight&&(i.highlight=function(e,t){t=x3dom.fields.SFColor.parse(t);this._x3domNode.highlight(e,t),this._x3domNode._nameSpace.doc.needRender=!0}),(u._xmlNode=i)._x3domNode=u,i.querySelectorAll(":scope > *").forEach(function(e){var t=e.localName.toLowerCase();"protodeclare"==t?this.protoDeclare(e):"externprotodeclare"==t?this.externProtoDeclare(e):"protoinstance"==t&&this.protoInstance(e,i)},this),i.childNodes.forEach(function(e){var t=this.setupTree(e,u);t&&u.addChild(t,e.getAttribute("containerField"))},this),u.nodeChanged(),u;x3dom.debug.logWarning("Unrecognised X3D element &lt;"+i.localName+"&gt;.")}else i.localName&&(l=i.localName.toLowerCase(),h=this.protos.find(function(e){return l==e.name.toLowerCase()&&e.isExternProto}),o&&"x3dommetagroup"==l?i.childNodes.forEach(function(e){var t=this.setupTree(e,o);t&&o.addChild(t,e.getAttribute("containerField"))}.bind(this)):"protodeclare"==l||"externprotodeclare"==l||"protoinstance"==l?u=null:"is"==i.localName.toLowerCase()?0==i.querySelectorAll("connect").length&&x3dom.debug.logWarning("IS statement without connect link: "+i.parentElement.localName):h?this.loadExternProtoAsync(h,i,i,i.parentElement):(x3dom.debug.logWarning("Unrecognised X3D element &lt;"+i.localName+"&gt;."),u=null));return u},x3dom.NodeNameSpace.prototype.importNodes=function(i){var o,e,t,s,n;i&&i.superInlineNode&&i.superInlineNode._nameSpace==this&&(e=i.superInlineNode._DEF,t=(o=this).imports,s=i.exports,n=0,e)&&t.get(e)&&(t.get(e).forEach(function(e,t){var e=s.get(e);e&&(e=i.defMap[e])&&(o.defMap[t]=e,n++)}),0<n)&&o.routeLateRoutes()},x3dom.NodeNameSpace.prototype.routeLateRoutes=function(){var o=this;o.lateRoutes.forEach(function(e){var t=o.defMap[e.fnDEF],i=o.defMap[e.tnDEF];t&&i&&(x3dom.debug.logInfo("fixed ROUTE: from="+t._DEF+", to="+i._DEF),t.setupRoute(e.fnAtt,i,e.tnAtt),e.route._nodeNameSpace=o)})},x3dom.NodeNameSpace.prototype.protoInstance=function(e,t){var i,o,s,n;e.localName&&!e._x3dom&&(i=e.getAttribute("name"),e.hasAttribute("USE")&&(n=e.getAttribute("USE"),o=this.defMap[n],i=o?o.constructor._typeName:t.getRootNode().querySelector("[DEF="+n+"]").getAttribute("name")),null!=(o=this.protos.find(function(e){return e.name==i}))?(s=document.createElement(i),e.hasAttribute("DEF")?s.setAttribute("DEF",e.getAttribute("DEF")):e.hasAttribute("USE")&&s.setAttribute("USE",e.getAttribute("USE")),e.hasAttribute("containerField")&&s.setAttribute("containerField",e.getAttribute("containerField")),e.querySelectorAll(":scope > fieldValue , :scope > fieldvalue").forEach(function(e){var t=e.getAttribute("name"),i=e.querySelectorAll(":scope > *");0<i.length?i.forEach(function(e){e.setAttribute("containerField",t),s.appendChild(e)}):(i=e.getAttribute("value"))&&s.setAttribute(t,i)}),o.isExternProto&&o.needsLoading?this.loadExternProtoAsync(o,s,e,t):(this.doc.mutationObserver.disconnect(),e.insertAdjacentElement("afterend",s),n=this.doc._x3dElem,this.doc._scene&&(n=this.doc._scene._xmlNode),this.doc.mutationObserver.observe(n,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0}),e._x3dom=s)):x3dom.debug.logWarning("ProtoInstance without a ProtoDeclaration "+i))},x3dom.NodeNameSpace.prototype.loadExternProtoAsync=function(_,e,t,i){_.instanceQueue.push({protoInstanceDom:e,domNode:t,parentDom:i,targetChildIndex:i._x3domNode._childNodes.length+_.instanceQueue.length}),t._x3dom=e;var m=this,o=0;!function t(){var c=m.getURL(_.url[o]);m.doc.incrementDownloads(),fetch(c).then(function(e){if(e.ok)return e.text();throw new Error("Network response was not OK: "+e.status)}).then(function(e){var t=new DOMParser,i=t.parseFromString(e,"application/xml").querySelector("X3D"),t=(null==i&&(i=t.parseFromString(e,"text/html").querySelector("X3D")),c.includes("#")?c.split("#").slice(-1)[0]:""),e=i.querySelector(""==t?"ProtoDeclare":"ProtoDeclare[name='"+t+"']");e.setAttribute("name",_.name),m.confNameSpace=new x3dom.NodeNameSpace(_.name,m.doc),m.confNameSpace.setBaseURL(m.baseURL+_.name),m.confNameSpace.setupTree(i.querySelector("Scene"),i),m.confNameSpace.protos.forEach(function(e){m.protos.push(e)});t=m.protos.findIndex(function(e){return e==_});for(m.protos.splice(t,1),m.protoDeclare(e);a=_.instanceQueue.shift();){var o=a.parentDom,s=o._x3domNode,n=a.protoInstanceDom,r=a.targetChildIndex,a=(m.doc.mutationObserver.disconnect(),a.domNode!==n&&a.domNode.insertAdjacentElement("afterend",n),m.doc.mutationObserver.observe(m.doc._scene._xmlNode,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0}),m.doc.onNodeAdded(n,o),s._childNodes),n=a.length-1;if(r!==n){var d=a[r],l=a[n],h=(a[r]=l,a[n]=d,(u=o.getAttribute("containerField"))in s._cf&&s._cf[u]);if(!h)for(var u in s._cf){var f=s._cf[u];if(x3dom.isa(l,f.type)){h=f;break}}h[r]=l,h[n]=d}m.lateRoutes.forEach(function(e){var t=m.defMap[e.fnDEF],i=m.defMap[e.tnDEF];t&&i&&(x3dom.debug.logInfo("fixed ROUTE: from="+t._DEF+", to="+i._DEF),t.setupRoute(e.fnAtt,i,e.tnAtt),e.route._nodeNameSpace=m)}),m.superInlineNode&&m.superInlineNode._nameSpace&&m.superInlineNode._nameSpace.importNodes(m)}_.needsLoading=!1,m.doc.decrementDownloads()}).catch(function(e){if(x3dom.debug.logWarning(c+": ExternProto fetch failed: "+e),m.doc.decrementDownloads(),!(++o<_.url.length))return x3dom.debug.logError("ExternProto fetch failed for all urls."),_.needsLoading=!1,null;t()})}()},x3dom.NodeNameSpace.prototype.externProtoDeclare=function(e){var t=e.getAttribute("name"),e=x3dom.fields.MFString.parse(e.getAttribute("url")),t=new x3dom.ProtoDeclaration(this,t,null,null,!0,e);this.protos.push(t)},x3dom.NodeNameSpace.prototype.protoDeclare=function(e){var t=e.getAttribute("name"),i=e.querySelector("ProtoInterface"),o=[],s=(i&&i.querySelectorAll("field").forEach(function(e){o.push({name:e.getAttribute("name"),accessType:e.getAttribute("accessType"),dataType:e.getAttribute("type"),value:e.getAttribute("value"),cfValue:e.querySelectorAll(":scope > *")})}),e.querySelector("ProtoBody"));return s?(s._ISRoutes={},s.querySelectorAll("IS").forEach(function(o){for(var e=o.parentElement;"protobody"!==e.localName.toLowerCase();)e=e.parentElement;e===s&&o.querySelectorAll("connect").forEach(function(e){var t=o.parentElement,i=(0==t.hasAttribute("DEF")&&(i="_proto_"+t.tagName+"_"+x3dom.protoISDEFuid++,t.setAttribute("DEF",i),"protoinstance"==t.localName.toLowerCase())&&t._x3domNode&&(t._x3domNode._DEF=i,t._x3domNode.typeNode._nameSpace.defMap[i]=t._x3domNode),e.getAttribute("protoField")),t=t.getAttribute("DEF"),e=e.getAttribute("nodeField");s._ISRoutes[i]||(s._ISRoutes[i]=[]),s._ISRoutes[i].push({nodeDEF:t,nodeField:e})})}),(i=new x3dom.ProtoDeclaration(this,t,s,o)).registerNode(),this.protos.push(i)):x3dom.debug.logWarning("ProtoDeclare without a ProtoBody definition: "+e.name),"ProtoDeclare"},x3dom.protoISDEFuid=0,x3dom.gfx_webgl=(()=>{function f(e,t,i,o){this.ctx3d=e,this.canvas=t,this.name=i,this.x3dElem=o,this.IG_PositionBuffer=null,this.cache=new x3dom.Cache,this.stateManager=new x3dom.StateManager(e),this.VRMode=1,this.BUFFER_IDX={INDEX:0,POSITION:1,NORMAL:2,TEXCOORD:3,TEXCOORD_0:3,COLOR:4,TANGENT:6,BITANGENT:7,TEXCOORD_1:8,ID:9}}return f.prototype.getName=function(){return this.name},f.prototype.setupShape=function(a,e,t){var i,o,s,n,r,d,l,h,u=0,f=e.shape,c=f._cf.geometry.node;if(void 0!==f._webgl){e=!1;if((e=!0===f._dirty.colors&&void 0===f._webgl.shader.color&&c._mesh._colors[0].length?!0:e)&&f._cleanupGLObjects&&f._cleanupGLObjects(!0,!1),!0===f._dirty.texture){if(f._webgl.texture.length!=f.getTextures().length){for(o=0;o<f._webgl.texture.length;++o)f._webgl.texture.pop();for(i=f.getTextures(),o=0;o<i.length;++o)f._webgl.texture.push(new x3dom.Texture(a,f._nameSpace.doc,this.cache,i[o]));f._dirty.shader=!0,void 0===f._webgl.shader.texcoord&&(f._dirty.texcoords=!0)}else for(i=f.getTextures(),o=0;o<i.length;++o)i[o]!==f._webgl.texture[o].node&&(f._webgl.texture[o].texture=null,f._webgl.texture[o].node=i[o]),f._webgl.texture[o].update();f._dirty.texture=!1}if(f._webgl.shader=this.cache.getShaderByProperties(a,f,f.getShaderProperties(t)),!e&&0==f._webgl.binaryGeometry&&0==f._webgl.bufferGeometry)for(u=0;u<f._webgl.positions.length;u++){var _,m=6*u;1!=f._dirty.positions&&1!=f._dirty.indexes||(void 0!==f._webgl.shader.position&&(f._webgl.indexes[u]=c._mesh._indices[u],a.deleteBuffer(f._webgl.buffers[m+x3dom.BUFFER_IDX.INDEX]),r=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.INDEX]=r,x3dom.caps.INDEX_UINT&&65535<c._mesh._positions[0].length/3?(d=new Uint32Array(f._webgl.indexes[u]),f._webgl.indexType=a.UNSIGNED_INT):(d=new Uint16Array(f._webgl.indexes[u]),f._webgl.indexType=a.UNSIGNED_SHORT),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),a.bufferData(a.ELEMENT_ARRAY_BUFFER,d,a.STATIC_DRAW),d=null,f._webgl.positions[u]=c._mesh._positions[u],a.deleteBuffer(f._webgl.buffers[m+x3dom.BUFFER_IDX.POSITION]),n=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.POSITION]=n,a.bindBuffer(a.ARRAY_BUFFER,n),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f._webgl.buffers[m+x3dom.BUFFER_IDX.INDEX]),s=new Float32Array(f._webgl.positions[u]),a.bufferData(a.ARRAY_BUFFER,s,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,n),a.vertexAttribPointer(f._webgl.shader.position,c._mesh._numPosComponents,f._webgl.coordType,!1,f._coordStrideOffset[0],f._coordStrideOffset[1]),s=null),f._dirty.positions=!1,f._dirty.indexes=!1),1==f._dirty.colors&&(void 0!==f._webgl.shader.color&&(f._webgl.colors[u]=c._mesh._colors[u],a.deleteBuffer(f._webgl.buffers[m+x3dom.BUFFER_IDX.COLOR]),h=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.COLOR]=h,g=new Float32Array(f._webgl.colors[u]),a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,g,a.STATIC_DRAW),a.vertexAttribPointer(f._webgl.shader.color,c._mesh._numColComponents,f._webgl.colorType,!1,f._colorStrideOffset[0],f._colorStrideOffset[1]),g=null),f._dirty.colors=!1),1==f._dirty.normals&&(void 0!==f._webgl.shader.normal&&(f._webgl.normals[u]=c._mesh._normals[u],a.deleteBuffer(f._webgl.buffers[m+x3dom.BUFFER_IDX.NORMAL]),l=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.NORMAL]=l,p=new Float32Array(f._webgl.normals[u]),a.bindBuffer(a.ARRAY_BUFFER,l),a.bufferData(a.ARRAY_BUFFER,p,a.STATIC_DRAW),a.vertexAttribPointer(f._webgl.shader.normal,c._mesh._numNormComponents,f._webgl.normalType,!1,f._normalStrideOffset[0],f._normalStrideOffset[1]),p=null),f._dirty.normals=!1),1==f._dirty.texcoords&&(void 0!==f._webgl.shader.texcoord&&(f._webgl.texcoords[u]=c._mesh._texCoords[u],a.deleteBuffer(f._webgl.buffers[m+x3dom.BUFFER_IDX.TEXCOORD]),_=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.TEXCOORD]=_,x=new Float32Array(f._webgl.texcoords[u]),a.bindBuffer(a.ARRAY_BUFFER,_),a.bufferData(a.ARRAY_BUFFER,x,a.STATIC_DRAW),a.vertexAttribPointer(f._webgl.shader.texCoord,c._mesh._numTexComponents,f._webgl.texCoordType,!1,f._texCoordStrideOffset[0],f._texCoordStrideOffset[1]),x=null),f._dirty.texcoords=!1),1==f._dirty.specialAttribs&&void 0!==f._webgl.shader.particleSize&&((_=c._vf.size.toGL()).length&&(a.deleteBuffer(f._webgl.buffers[m+x3dom.BUFFER_IDX.ID]),f._webgl.buffers[m+x3dom.BUFFER_IDX.ID]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,f._webgl.buffers[m+x3dom.BUFFER_IDX.ID]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(_),a.STATIC_DRAW)),f._dirty.specialAttribs=!1)}if(!e)return}else if(!(x3dom.isa(c,x3dom.nodeTypes.Text)||x3dom.isa(c,x3dom.nodeTypes.BinaryGeometry)||x3dom.isa(c,x3dom.nodeTypes.PopGeometry)||x3dom.isa(c,x3dom.nodeTypes.BufferGeometry))&&(!c||c._mesh._positions[0].length<1))return void x3dom.debug.logError("NO VALID MESH OR NO VERTEX POSITIONS SET!");for(f.unsetDirty(),f._cleanupGLObjects||(f._cleanupGLObjects=function(e,t){if(this._webgl&&(0<arguments.length&&e||0==this._parentNodes.length)){for(var i=this._webgl.shader,o=0;o<this._webgl.positions.length;o++){var s=6*o;void 0!==i.position&&(a.deleteBuffer(this._webgl.buffers[s+x3dom.BUFFER_IDX.INDEX]),a.deleteBuffer(this._webgl.buffers[s+x3dom.BUFFER_IDX.POSITION])),void 0!==i.normal&&a.deleteBuffer(this._webgl.buffers[s+x3dom.BUFFER_IDX.NORMAL]),void 0!==i.texcoord&&a.deleteBuffer(this._webgl.buffers[s+x3dom.BUFFER_IDX.TEXCOORD]),void 0!==i.color&&a.deleteBuffer(this._webgl.buffers[s+x3dom.BUFFER_IDX.COLOR]),void 0!==i.id&&a.deleteBuffer(this._webgl.buffers[s+x3dom.BUFFER_IDX.ID]),void 0!==i.tangent&&a.deleteBuffer(this._webgl.buffers[s+x3dom.BUFFER_IDX.TANGENT]),void 0!==i.binormal&&a.deleteBuffer(this._webgl.buffers[s+x3dom.BUFFER_IDX.BITANGENT])}for(var n=0;n<this._webgl.dynamicFields.length;n++){var r=this._webgl.dynamicFields[n];void 0!==i[r.name]&&a.deleteBuffer(r.buf)}(t=void 0===t?!0:t)&&(delete this._webgl,x3dom.BinaryContainerLoader.outOfMemory=!1)}}),f._webgl={positions:c._mesh._positions,normals:c._mesh._normals,texcoords:c._mesh._texCoords,colors:c._mesh._colors,tangents:c._mesh._tangents,binormals:c._mesh._binormals,indexes:c._mesh._indices,indexType:a.UNSIGNED_SHORT,coordType:a.FLOAT,normalType:a.FLOAT,texCoordType:a.FLOAT,texCoord2Type:a.FLOAT,colorType:a.FLOAT,tangentType:a.FLOAT,binormalType:a.FLOAT,coordNormalized:!1,normalNormalized:!1,texCoordNormalized:!1,texCoord2Normalized:!1,colorNormalized:!1,tangentNormalized:!1,binormalNormalized:!1,texture:[],dirtyLighting:x3dom.Utils.checkDirtyLighting(t),binaryGeometry:0,popGeometry:0,bufferGeometry:0},i=f.getTextures(),o=0;o<i.length;++o)f._webgl.texture.push(new x3dom.Texture(a,f._nameSpace.doc,this.cache,i[o]));f._webgl.shader=this.cache.getShaderByProperties(a,f,f.getShaderProperties(t));var p,x,g,v,y,T,b,S,F,E,M=f._webgl.shader,C=0;if(f._webgl.buffers=[],f._webgl.dynamicFields=[],x3dom.isa(c,x3dom.nodeTypes.X3DBinaryContainerGeometryNode)){f._webgl.primType=[];for(var w=0;w<c._vf.primType.length;++w)f._webgl.primType.push(x3dom.Utils.primTypeDic(a,c._vf.primType[w]))}else f._webgl.primType=x3dom.Utils.primTypeDic(a,c._mesh._primType);if(x3dom.isa(c,x3dom.nodeTypes.BinaryGeometry))x3dom.BinaryContainerLoader.setupBinGeo(f,M,a,t,this);else if(x3dom.isa(c,x3dom.nodeTypes.BufferGeometry))x3dom.BinaryContainerLoader.setupBufferGeo(f,M,a,t,this);else if(x3dom.isa(c,x3dom.nodeTypes.PopGeometry))x3dom.BinaryContainerLoader.setupPopGeo(f,M,a,t,this);else{for(u=0;u<f._webgl.positions.length;u++)m=6*u,f._webgl.positions[u]&&(r=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.INDEX]=r,x3dom.caps.INDEX_UINT&&65535<f._webgl.positions[0].length/3?(d=new Uint32Array(f._webgl.indexes[u]),f._webgl.indexType=a.UNSIGNED_INT):(d=new Uint16Array(f._webgl.indexes[u]),f._webgl.indexType=a.UNSIGNED_SHORT),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),a.bufferData(a.ELEMENT_ARRAY_BUFFER,d,a.STATIC_DRAW),d=null,n=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.POSITION]=n,a.bindBuffer(a.ARRAY_BUFFER,n),s=new Float32Array(f._webgl.positions[u]),a.bufferData(a.ARRAY_BUFFER,s,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,n),a.vertexAttribPointer(M.position,c._mesh._numPosComponents,f._webgl.coordType,!1,f._coordStrideOffset[0],f._coordStrideOffset[1]),a.enableVertexAttribArray(M.position),s=null),f._webgl.normals[u]&&(l=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.NORMAL]=l,p=new Float32Array(f._webgl.normals[u]),a.bindBuffer(a.ARRAY_BUFFER,l),a.bufferData(a.ARRAY_BUFFER,p,a.STATIC_DRAW),a.vertexAttribPointer(M.normal,c._mesh._numNormComponents,f._webgl.normalType,!1,f._normalStrideOffset[0],f._normalStrideOffset[1]),a.enableVertexAttribArray(M.normal),p=null),f._webgl.texcoords[u]&&(v=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.TEXCOORD]=v,x=new Float32Array(f._webgl.texcoords[u]),a.bindBuffer(a.ARRAY_BUFFER,v),a.bufferData(a.ARRAY_BUFFER,x,a.STATIC_DRAW),a.vertexAttribPointer(M.texcoord,c._mesh._numTexComponents,f._webgl.texCoordType,!1,f._texCoordStrideOffset[0],f._texCoordStrideOffset[1]),a.enableVertexAttribArray(M.texcoord),x=null),f._webgl.colors[u]&&(h=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.COLOR]=h,g=new Float32Array(f._webgl.colors[u]),a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,g,a.STATIC_DRAW),a.vertexAttribPointer(M.color,c._mesh._numColComponents,f._webgl.colorType,!1,f._colorStrideOffset[0],f._colorStrideOffset[1]),a.enableVertexAttribArray(M.color),g=null),void 0!==M.particleSize&&(v=c._vf.size.toGL()).length&&(y=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.ID]=y,a.bindBuffer(a.ARRAY_BUFFER,y),a.bufferData(a.ARRAY_BUFFER,new Float32Array(v),a.STATIC_DRAW)),f._webgl.tangents[u]&&(y=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.TANGENT]=y,T=new Float32Array(f._webgl.tangents[u]),a.bindBuffer(a.ARRAY_BUFFER,y),a.bufferData(a.ARRAY_BUFFER,T,a.STATIC_DRAW),a.vertexAttribPointer(M.tangent,c._mesh._numTangentComponents,f._webgl.tangentType,!1,f._tangentStrideOffset[0],f._tangentStrideOffset[1]),a.enableVertexAttribArray(M.tangent),T=null),f._webgl.binormals[u]&&(T=a.createBuffer(),f._webgl.buffers[m+x3dom.BUFFER_IDX.BITANGENT]=T,b=new Float32Array(f._webgl.binormals[u]),a.bindBuffer(a.ARRAY_BUFFER,T),a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW),a.vertexAttribPointer(M.binormal,c._mesh._numBinormalComponents,f._webgl.binormalType,!1,f._binormalStrideOffset[0],f._binormalStrideOffset[1]),a.enableVertexAttribArray(M.tangent),b=null);for(var A in c._mesh._dynamicFields)c._mesh._dynamicFields.hasOwnProperty(A)&&(S=c._mesh._dynamicFields[A],f._webgl.dynamicFields[C]={buf:{},name:A,numComponents:S.numComponents},void 0!==M[A])&&(F=a.createBuffer(),f._webgl.dynamicFields[C++].buf=F,E=new Float32Array(S.value),a.bindBuffer(a.ARRAY_BUFFER,F),a.bufferData(a.ARRAY_BUFFER,E,a.STATIC_DRAW),a.vertexAttribPointer(M[A],S.numComponents,a.FLOAT,!1,0,0),E=null)}},f.prototype.setupScene=function(t,f){var e=null,c=this;if(void 0!==f._webgl){if(!f._dirty)return;void 0!==f._webgl.texture&&f._webgl.texture&&t.deleteTexture(f._webgl.texture),f._cleanupGLObjects&&f._cleanupGLObjects(),f._webgl={}}f._dirty=!1;var i,o=f.getTexUrl(),s=0;if(0<o.length&&0<o[0].length)6<=o.length&&0<o[1].length&&0<o[2].length&&0<o[3].length&&0<o[4].length&&0<o[5].length||-1!=o[0].indexOf(".dds")?(e=new x3dom.nodeTypes.Sphere,f._webgl={positions:e._mesh._positions[0],indexes:e._mesh._indices[0],buffers:[{},{}]},f._webgl.primType=t.TRIANGLES,-1!=o[0].indexOf(".dds")?(f._webgl.shader=this.cache.getShader(t,x3dom.shader.BACKGROUND_CUBETEXTURE_DDS),f._webgl.texture=x3dom.Utils.createTextureCube(t,f._nameSpace.doc,[o[0]],!1,f._vf.crossOrigin,!0,!1,!1)):(f._webgl.shader=this.cache.getShader(t,x3dom.shader.BACKGROUND_CUBETEXTURE_DDS),f._webgl.texture=x3dom.Utils.createTextureCube(t,f._nameSpace.doc,o,!1,f._vf.crossOrigin,!0,!1))):(f._webgl={positions:[-1,-1,0,-1,1,0,1,-1,0,1,1,0],indexes:[0,1,2,3],buffers:[{},{}]},o=f._nameSpace.getURL(o[0]),f._webgl.texture=x3dom.Utils.createTexture2D(t,f._nameSpace.doc,o,!0,f._vf.crossOrigin,!1,!1),f._webgl.primType=t.TRIANGLE_STRIP,f._webgl.shader=c.cache.getShader(t,x3dom.shader.BACKGROUND_TEXTURE));else if(1<f.getSkyColor().length||f.getGroundColor().length){e=new x3dom.nodeTypes.Sphere,o=t.createTexture(),f._webgl={positions:e._mesh._positions[0],texcoords:e._mesh._texCoords[0],indexes:e._mesh._indices[0],buffers:[{},{},{}],texture:o,primType:t.TRIANGLES};for(var n=(n=x3dom.Utils.nextHighestPowerOfTwo(f.getSkyColor().length+f.getGroundColor().length+2))<512?512:n,r=f._vf.groundAngle.length,a=[],d=[],l=[],h=[0],s=0;s<f._vf.skyColor.length;s++)l[s]=f._vf.skyColor[s];for(s=0;s<f._vf.skyAngle.length;s++)h[s+1]=f._vf.skyAngle[s];if(0<r||1==f._vf.groundColor.length){for(h[h.length-1]<Math.PI/2&&(h[h.length]=Math.PI/2-x3dom.fields.Eps,l[l.length]=l[l.length-1]),s=r-1;0<=s;s--)s==r-1&&Math.PI-f._vf.groundAngle[s]<=Math.PI/2&&(h[h.length]=Math.PI/2,l[l.length]=f._vf.groundColor[f._vf.groundColor.length-1]),h[h.length]=Math.PI-f._vf.groundAngle[s],l[l.length]=f._vf.groundColor[s+1];0==r&&1==f._vf.groundColor.length&&(h[h.length]=Math.PI/2,l[l.length]=f._vf.groundColor[0]),h[h.length]=Math.PI,l[l.length]=f._vf.groundColor[0]}else h[h.length-1]<Math.PI&&(h[h.length]=Math.PI,l[l.length]=l[l.length-1]);for(s=0;s<h.length;s++)h[s]/=Math.PI;h.length!=l.length&&(x3dom.debug.logError("Number of background colors and corresponding angles do not match.\nYou have to define one angle less than the count of RGB colors because the angle 0 is added automatically."),l.length=h.length=(h.length<l.length?h:l).length);var u=new x3dom.nodeTypes.ColorInterpolator;for(u._vf.key=new x3dom.fields.MFFloat(h),u._vf.keyValue=new x3dom.fields.MFColor(l),u._vf.RGB=!0,u.fieldChanged("keyValue"),s=0;s<n;s++)u._vf.set_fraction=s/(n-1),u.fieldChanged("set_fraction"),a[s]=u._vf.value_changed;a.reverse();var _=Math.floor(255*(1-f.getTransparency()));for(s=0;s<a.length;s++)d.push(Math.floor(255*a[s].r),Math.floor(255*a[s].g),Math.floor(255*a[s].b),_);var e=new Uint8Array(d),m=t.RGBA;n=e.length/4,t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,m,1,n,0,m,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null),f._webgl.shader=c.cache.getShader(t,x3dom.shader.BACKGROUND_SKYTEXTURE)}else f._webgl={};f._webgl.shader&&(o=f._webgl.shader,m=t.createBuffer(),f._webgl.buffers[x3dom.BUFFER_IDX.POSITION]=m,t.bindBuffer(t.ARRAY_BUFFER,m),e=new Float32Array(f._webgl.positions),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,m),t.vertexAttribPointer(o.position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o.position),m=t.createBuffer(),f._webgl.buffers[x3dom.BUFFER_IDX.INDEX]=m,i=new Uint16Array(f._webgl.indexes),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,m),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),i=e=null,void 0!==o.texcoord&&(m=t.createBuffer(),f._webgl.buffers[x3dom.BUFFER_IDX.TEXCOORD]=m,e=new Float32Array(f._webgl.texcoords),t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.vertexAttribPointer(o.texcoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o.texcoord),e=null),f._cleanupGLObjects=function(){var e=this._webgl.shader;void 0!==e.position&&(t.deleteBuffer(this._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),t.deleteBuffer(this._webgl.buffers[x3dom.BUFFER_IDX.POSITION])),void 0!==e.texcoord&&t.deleteBuffer(this._webgl.buffers[x3dom.BUFFER_IDX.TEXCOORD])}),f._webgl.render=function(e,t,i,o){var s,n,r=f._webgl.shader,a=1-f.getTransparency(),d=null,l=i._22,h=i._23,u=t.e3();null!=r&&null!=r.texcoord&&null!=f._webgl.texture?(e.clearColor(0,0,0,a),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),c.stateManager.frontFace(e.CCW),c.stateManager.disable(e.CULL_FACE),c.stateManager.disable(e.DEPTH_TEST),c.stateManager.disable(e.BLEND),c.stateManager.useProgram(r),r.tex||(r.tex=0),i._22=100001/99999,i._23=2e5/99999,t._03=0,t._13=0,t._23=0,d=i.mult(t),r.modelViewProjectionMatrix=d.toGL(),t._03=u.x,t._13=u.y,t._23=u.z,i._22=l,i._23=h,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,f._webgl.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),e.bindBuffer(e.ARRAY_BUFFER,f._webgl.buffers[x3dom.BUFFER_IDX.POSITION]),e.vertexAttribPointer(r.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.position),e.bindBuffer(e.ARRAY_BUFFER,f._webgl.buffers[x3dom.BUFFER_IDX.TEXCOORD]),e.vertexAttribPointer(r.texcoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.texcoord),c.setVertexAttribEyeIdx(e,r),c.drawElements(e,f._webgl.primType,f._webgl.indexes.length,e.UNSIGNED_SHORT,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.disableVertexAttribArray(r.position),e.disableVertexAttribArray(r.texcoord),c.disableVertexAttribEyeIdx(e,r),e.clear(e.DEPTH_BUFFER_BIT)):!r||!f._webgl.texture||void 0!==f._webgl.texture.textureCubeReady&&!0!==f._webgl.texture.textureCubeReady?(s=f.getSkyColor().toGL(),e.clearColor(s[0],s[1],s[2],a),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)):(e.clearColor(0,0,0,a),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),c.stateManager.frontFace(e.CCW),c.stateManager.disable(e.CULL_FACE),c.stateManager.disable(e.DEPTH_TEST),c.stateManager.disable(e.BLEND),c.stateManager.useProgram(r),r.tex||(r.tex=0),f._webgl.texture.textureCubeReady?(i._22=100001/99999,i._23=2e5/99999,t._03=0,t._13=0,t._23=0,d=i.mult(t),r.modelViewProjectionMatrix=d.toGL(),t._03=u.x,t._13=u.y,t._23=u.z,i._22=l,i._23=h,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,f._webgl.texture),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,f._webgl.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t=f._vf.scaling&&f._webgl.texture.ready?(s=1,a=new x3dom.fields.SFVec2f(c.canvas.width,c.canvas.height),d=new x3dom.fields.SFVec2f(f._webgl.texture.width,f._webgl.texture.height),a.x>a.y?(s=a.x/d.x,d.x=a.x,d.y=d.y*s):(s=a.y/d.y,d.y=a.y,d.x=d.x*s),n=a.divideComponents(d),d.subtract(a).multiply(.5).divideComponents(d)):(n=new x3dom.fields.SFVec2f(1,1),new x3dom.fields.SFVec2f(0,0)),r.scale=n.toGL(),r.translation=t.toGL()),r.isVR=-1,r.screenWidth=c.canvas.width,c.setTonemappingOperator(o,r),2==c.VRMode&&(l=(u=o.getViewMatrices()[1]).e3(),u._03=0,u._13=0,u._23=0,i=o.getProjectionMatrices()[1].mult(u),r.modelViewProjectionMatrix2=i.toGL(),u._03=l.x,u._13=l.y,u._23=l.z,r.isVR=1),c.setVertexAttribEyeIdx(e,r),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),e.bindBuffer(e.ARRAY_BUFFER,f._webgl.buffers[x3dom.BUFFER_IDX.POSITION]),e.vertexAttribPointer(r.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.position),c.drawElements(e,f._webgl.primType,f._webgl.indexes.length,e.UNSIGNED_SHORT,0),e.disableVertexAttribArray(r.position),c.disableVertexAttribEyeIdx(e,r),e.activeTexture(e.TEXTURE0),f._webgl.texture.textureCubeReady?e.bindTexture(e.TEXTURE_CUBE_MAP,null):e.bindTexture(e.TEXTURE_2D,null),e.clear(e.DEPTH_BUFFER_BIT))}},f.prototype.setupFgnds=function(e,i){var o,s,t,n,r;void 0===i._fgnd&&(o=this,i._fgnd={},i._fgnd._webgl={positions:[-1,-1,0,-1,1,0,1,-1,0,1,1,0],indexes:[0,1,2,3],buffers:[{},{}]},i._fgnd._webgl.primType=e.TRIANGLE_STRIP,i._fgnd._webgl.shader=this.cache.getShader(e,x3dom.shader.FRONTGROUND_TEXTURE),s=i._fgnd._webgl.shader,n=e.createBuffer(),i._fgnd._webgl.buffers[x3dom.BUFFER_IDX.POSITION]=n,e.bindBuffer(e.ARRAY_BUFFER,n),t=new Float32Array(i._fgnd._webgl.positions),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribPointer(s.position,3,e.FLOAT,!1,0,0),n=e.createBuffer(),i._fgnd._webgl.buffers[x3dom.BUFFER_IDX.INDEX]=n,r=new Uint16Array(i._fgnd._webgl.indexes),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW),r=t=null,i._fgnd._webgl.render=function(e,t){i._fgnd._webgl.texture=t,o.stateManager.frontFace(e.CCW),o.stateManager.disable(e.CULL_FACE),o.stateManager.disable(e.DEPTH_TEST),o.stateManager.useProgram(s),s.tex||(s.tex=0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i._fgnd._webgl.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i._fgnd._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),e.bindBuffer(e.ARRAY_BUFFER,i._fgnd._webgl.buffers[x3dom.BUFFER_IDX.POSITION]),e.vertexAttribPointer(s.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.position),o.drawElements(e,i._fgnd._webgl.primType,i._fgnd._webgl.indexes.length,e.UNSIGNED_SHORT,0,1),e.disableVertexAttribArray(s.position),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null)})},f.prototype.renderShadowPass=function(e,t,i,o,s,n,r){var a=t._scene,d=!1;this.stateManager.bindFramebuffer(e.FRAMEBUFFER,s.fbo),this.stateManager.viewport(0,0,s.width,s.height),e.clearColor(1,1,1,0),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.stateManager.depthFunc(e.LEQUAL),this.stateManager.enable(e.DEPTH_TEST),this.stateManager.enable(e.CULL_FACE),this.stateManager.disable(e.BLEND),x3dom.fields.SFVec3f.NullVector.toGL(),x3dom.fields.SFVec3f.OneVector.toGL();for(var l=a.getEnvironment()._vf.shadowExcludeTransparentObjects,h=a.drawableCollection.length,u=0;u<h;u++){var f=a.drawableCollection.get(u),c=f.transform,_=f.shape,m="transparent"==f.sortType,p=_._webgl;if(!(!p||l&&m)){var x=_._cf.geometry.node,g=_._cf.appearance.node,v=(x._mesh,_.getShaderProperties(t)),y=this.cache.getShaderByProperties(e,_,v,null,!0);if(!y)return;if(this.stateManager.useProgram(y),y.cameraView=r,y.offset=n,y.modelViewProjectionMatrix=i.mult(c).toGL(),p.coordType!=e.FLOAT&&(!p.popGeometry&&x3dom.Utils.isUnsignedType(x._vf.coordType)?y.bgCenter=x.getMin().toGL():y.bgCenter=x._vf.position.toGL(),y.bgSize=x._vf.size.toGL(),y.bgPrecisionMax=x.getPrecisionMax("coordType")),_._clipPlanes){y.modelViewMatrix=o.mult(c).toGL(),y.viewMatrixInverse=o.inverse().toGL();for(var T=0;T<_._clipPlanes.length;T++){var b=_._clipPlanes[T].plane,S=_._clipPlanes[T].trafo;y["clipPlane"+T+"_Plane"]=S.multMatrixPlane(b._vf.plane).toGL(),y["clipPlane"+T+"_CappingStrength"]=b._vf.cappingStrength,y["clipPlane"+T+"_CappingColor"]=b._vf.cappingColor.toGL()}}_.isSolid()?(this.stateManager.enable(e.CULL_FACE),_.isCCW()?this.stateManager.frontFace(e.CCW):this.stateManager.frontFace(e.CW)):this.stateManager.disable(e.CULL_FACE);var F=g?g._cf.depthMode.node:null,v=!!g&&null!=g._cf.texture.node,g=!m||v;F?F._vf.enableDepthTest?(this.stateManager.enable(e.DEPTH_TEST),this.stateManager.depthMask(!F._vf.readOnly),this.stateManager.depthFunc(x3dom.Utils.depthFunc(e,F._vf.depthFunc)),this.stateManager.depthRange(F._vf.zNearRange,F._vf.zFarRange)):this.stateManager.disable(e.DEPTH_TEST):(this.stateManager.enable(e.DEPTH_TEST),this.stateManager.depthMask(g),this.stateManager.depthFunc(e.LEQUAL)),p.popGeometry&&(m=o.mult(c),this.updatePopState(f,x,y,p,a,m,t,this.x3dElem.runtime.fps));for(var E=p.positions.length,M=0;M<E;M++){var C,w=6*M;if(void 0!==y.position&&p.buffers[w+x3dom.BUFFER_IDX.POSITION]&&p.indexes[M]){if(d=!1,p.buffers[w+x3dom.BUFFER_IDX.INDEX]&&(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,p.buffers[w+x3dom.BUFFER_IDX.INDEX]),d=!0),this.setVertexAttribPointerPosition(e,_,w,M),void 0!==y.id&&p.buffers[w+x3dom.BUFFER_IDX.ID]&&(e.bindBuffer(e.ARRAY_BUFFER,p.buffers[w+x3dom.BUFFER_IDX.ID]),0!=p.binaryGeometry)&&1==x._vf.idsPerVertex&&(e.vertexAttribPointer(y.id,1,e.FLOAT,!1,4,0),e.enableVertexAttribArray(y.id)),d&&(0<p.binaryGeometry||0<p.popGeometry))for(C=R=0,D=x._vf.vertexCount.length;R<D;R++)this.drawElements(e,p.primType[R],x._vf.vertexCount[R],p.indexType,x3dom.Utils.getByteAwareOffset(C,p.indexType,e)),C+=x._vf.vertexCount[R];else if(p.binaryGeometry<0||p.popGeometry<0)for(C=R=0,D=x._vf.vertexCount.length;R<D;R++)this.drawArrays(e,p.primType[R],C,x._vf.vertexCount[R]),C+=x._vf.vertexCount[R];else if(x.hasIndexOffset())for(var A=_.tessellationProperties(),R=0,D=A.length;R<D;R++)this.drawElements(e,p.primType,A[R].count,p.indexType,A[R].offset*x3dom.Utils.getOffsetMultiplier(p.indexType,e));else 0==p.indexes[M].length?this.drawArrays(e,p.primType,0,p.positions[M].length/3):this.drawElements(e,p.primType,p.indexes[M].length,p.indexType,0);e.disableVertexAttribArray(y.position),void 0!==y.texcoord&&p.buffers[w+x3dom.BUFFER_IDX.TEXCOORD]&&e.disableVertexAttribArray(y.texcoord),void 0!==y.color&&p.buffers[w+x3dom.BUFFER_IDX.COLOR]&&e.disableVertexAttribArray(y.color),void 0!==y.id&&p.buffers[w+x3dom.BUFFER_IDX.ID]&&e.disableVertexAttribArray(y.id)}}}}x3dom.Utils.needLineWidth&&this.stateManager.lineWidth(1),this.stateManager.depthMask(!0),F&&(this.stateManager.enable(e.DEPTH_TEST),this.stateManager.depthFunc(e.LEQUAL),this.stateManager.depthRange(0,1)),e.flush(),this.stateManager.bindFramebuffer(e.FRAMEBUFFER,null)},f.prototype.renderPickingPass=function(e,t,i,o,s,L,n,r,a,d,l){var h=t._webgl.pickScale,u=t._webgl.fboPick.height,r=r*h,a=u-1-a*h,f=!1,c=(this.stateManager.bindFramebuffer(e.FRAMEBUFFER,t._webgl.fboPick.fbo),this.stateManager.viewport(0,0,t._webgl.fboPick.width,u),e.clearColor(0,0,0,0),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t.drawableCollection.viewarea),u=t.getEnvironment(),_=t.drawableCollection.length;u._vf.smallFeatureCulling&&u._lowPriorityThreshold<1&&c.isMovingOrAnimating()&&!(_=Math.floor(_*u._lowPriorityThreshold))&&t.drawableCollection.length&&(_=1),x3dom.fields.SFVec3f.NullVector.toGL(),x3dom.fields.SFVec3f.OneVector.toGL(),this.stateManager.depthFunc(e.LEQUAL),this.stateManager.enable(e.DEPTH_TEST),this.stateManager.enable(e.CULL_FACE),this.stateManager.disable(e.BLEND),x3dom.Utils.needLineWidth&&this.stateManager.lineWidth(2);for(var m=0;m<_;m++){var p=t.drawableCollection.get(m),x=p.transform,g=p.shape,v="transparent"==p.sortType,y=g._webgl;if(y&&!(g._objectID<1)&&g._vf.isPickable){var T,b=g._cf.geometry.node,S=g._cf.appearance.node,F=(b._mesh,g.getShaderProperties(c)),E=this.cache.getShaderByProperties(e,g,F,n);if(!E)return;if(y.shader=E,this.stateManager.useProgram(E),E.screenWidth=this.canvas.width*t._webgl.pickScale,E.modelMatrix=x.toGL(),E.modelViewProjectionMatrix=o.mult(x).toGL(),E.isVR=-1,2==this.VRMode&&(T=c.getViewMatrices()[1],F=c.getProjectionMatrices()[1].mult(T),E.modelViewProjectionMatrix2=F.mult(x).toGL(),E.isVR=1),E.lowBit=(255&g._objectID)/255,E.highBit=(g._objectID>>>8)/255,E.from=s.toGL(),E.sceneSize=L,0!=y.binaryGeometry&&1==b._vf.idsPerVertex&&(E.shadowIDs=g._vf.idOffset+x3dom.nodeTypes.Shape.objectID+2),y.coordType!=e.FLOAT&&(!y.popGeometry&&x3dom.Utils.isUnsignedType(b._vf.coordType)?E.bgCenter=b.getMin().toGL():E.bgCenter=b._vf.position.toGL(),E.bgSize=b._vf.size.toGL(),E.bgPrecisionMax=b.getPrecisionMax("coordType")),1==n&&y.colorType!=e.FLOAT&&(E.bgPrecisionColMax=b.getPrecisionMax("colorType")),2==n&&y.texCoordType!=e.FLOAT&&(E.bgPrecisionTexMax=b.getPrecisionMax("texCoordType")),g._clipPlanes){E.modelViewMatrix=i.mult(x).toGL(),E.viewMatrixInverse=i.inverse().toGL(),2==this.VRMode&&(E.modelViewMatrix2=T.mult(x).toGL(),E.viewMatrixInverse2=T.inverse().toGL());for(var M=0;M<g._clipPlanes.length;M++){var C=g._clipPlanes[M].plane,O=g._clipPlanes[M].trafo;E["clipPlane"+M+"_Plane"]=O.multMatrixPlane(C._vf.plane).toGL(),E["clipPlane"+M+"_CappingStrength"]=C._vf.cappingStrength,E["clipPlane"+M+"_CappingColor"]=C._vf.cappingColor.toGL()}}g.isSolid()?(this.stateManager.enable(e.CULL_FACE),g.isCCW()?this.stateManager.frontFace(e.CCW):this.stateManager.frontFace(e.CW)):this.stateManager.disable(e.CULL_FACE);var w=S?S._cf.depthMode.node:null,F=!!S&&null!=S._cf.texture.node,v=!v||F;w?w._vf.enableDepthTest?(this.stateManager.enable(e.DEPTH_TEST),this.stateManager.depthMask(!w._vf.readOnly),this.stateManager.depthFunc(x3dom.Utils.depthFunc(e,w._vf.depthFunc)),this.stateManager.depthRange(w._vf.zNearRange,w._vf.zFarRange)):this.stateManager.disable(e.DEPTH_TEST):(this.stateManager.enable(e.DEPTH_TEST),this.stateManager.depthMask(v),this.stateManager.depthFunc(e.LEQUAL)),y.popGeometry&&(F=i.mult(x),this.updatePopState(p,b,E,y,t,F,c,this.x3dElem.runtime.fps)),(S?S._cf.pointProperties.node:null)&&(x3dom.isa(b,x3dom.nodeTypes.PointSet)||x3dom.isa(b,x3dom.nodeTypes.BinaryGeometry))&&(v=S._cf.pointProperties.node._vf,E.pointSizeAttenuation=v.attenuation.toGL(),E.pointSizeFactor=h*v.pointSizeScaleFactor,E.minPointSize=v.pointSizeMinValue,E.maxPointSize=v.pointSizeMaxValue);for(var B=y.positions.length,A=0;A<B;A++){var R,D=6*A;if(void 0!==E.position&&y.buffers[D+x3dom.BUFFER_IDX.POSITION]&&y.indexes[A]){if(f=!1,y.buffers[D+x3dom.BUFFER_IDX.INDEX]&&(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,y.buffers[D+x3dom.BUFFER_IDX.INDEX]),f=!0),this.setVertexAttribEyeIdx(e,E),this.setVertexAttribPointerPosition(e,g,D,A),1==n&&this.setVertexAttribPointerColor(e,g,D,A),2==n&&void 0!==E.texcoord&&y.buffers[D+x3dom.BUFFER_IDX.TEXCOORD]&&this.setVertexAttribPointerTexCoord(e,g,D,A),void 0!==E.id&&y.buffers[D+x3dom.BUFFER_IDX.ID]&&(e.bindBuffer(e.ARRAY_BUFFER,y.buffers[D+x3dom.BUFFER_IDX.ID]),0!=y.binaryGeometry)&&1==b._vf.idsPerVertex&&(e.vertexAttribPointer(E.id,1,e.FLOAT,!1,4,0),e.enableVertexAttribArray(E.id)),f&&(0<y.binaryGeometry||0<y.popGeometry))for(R=I=0,P=b._vf.vertexCount.length;I<P;I++)this.drawElements(e,y.primType[I],b._vf.vertexCount[I],y.indexType,x3dom.Utils.getByteAwareOffset(R,y.indexType,e)),R+=b._vf.vertexCount[I];else if(y.binaryGeometry<0||y.popGeometry<0)for(R=I=0,P=b._vf.vertexCount.length;I<P;I++)this.drawArrays(e,y.primType[I],R,b._vf.vertexCount[I]),R+=b._vf.vertexCount[I];else if(f&&0<y.bufferGeometry)this.drawElements(e,y.primType[0],b._vf.vertexCount[0],y.indexType,g._indexOffset);else if(y.bufferGeometry<0)this.drawArrays(e,y.primType[0],0,b._vf.vertexCount[0]);else if(b.hasIndexOffset())for(var N=g.tessellationProperties(),I=0,P=N.length;I<P;I++)this.drawElements(e,y.primType,N[I].count,y.indexType,N[I].offset*x3dom.Utils.getOffsetMultiplier(y.indexType,e));else 0==y.indexes[A].length?this.drawArrays(e,y.primType,0,y.positions[A].length/3):this.drawElements(e,y.primType,y.indexes[A].length,y.indexType,0);e.disableVertexAttribArray(E.position),void 0!==E.texcoord&&y.buffers[D+x3dom.BUFFER_IDX.TEXCOORD]&&e.disableVertexAttribArray(E.texcoord),void 0!==E.color&&y.buffers[D+x3dom.BUFFER_IDX.COLOR]&&e.disableVertexAttribArray(E.color),void 0!==E.id&&y.buffers[D+x3dom.BUFFER_IDX.ID]&&e.disableVertexAttribArray(E.id),this.disableVertexAttribEyeIdx(e,E)}}}}x3dom.Utils.needLineWidth&&this.stateManager.lineWidth(1),this.stateManager.depthMask(!0),w&&(this.stateManager.enable(e.DEPTH_TEST),this.stateManager.depthFunc(e.LEQUAL),this.stateManager.depthRange(0,1)),e.flush();try{var V=new Uint8Array(4*d*l);e.readPixels(r,a,d,l,e.RGBA,e.UNSIGNED_BYTE,V),t._webgl.fboPick.pixelData=V}catch(e){t._webgl.fboPick.pixelData=[],x3dom.debug.logException(e+" (cannot pick)")}this.stateManager.bindFramebuffer(e.FRAMEBUFFER,null)},f.prototype.renderShape=function(e,t,i,o,L,s,O,n,r){var B=!1,a=e.shape,d=e.transform,l="transparent"==e.sortType;if(a&&a._webgl&&d){var h=a._webgl,u=h.shader;if(u){var U=this.stateManager.useProgram(u),f=a._cf.appearance.node,c=a._cf.geometry.node,X=c._mesh,k=t._scene,_=null,m=(h.coordType!=r.FLOAT?(!h.popGeometry&&x3dom.Utils.isUnsignedType(c._vf.coordType)?u.bgCenter=c.getMin().toGL():u.bgCenter=c._vf.position.toGL(),u.bgSize=c._vf.size.toGL(),u.bgPrecisionMax=c.getPrecisionMax("coordType")):(u.bgCenter=[0,0,0],u.bgSize=[1,1,1],u.bgPrecisionMax=1),h.colorType!=r.FLOAT?u.bgPrecisionColMax=c.getPrecisionMax("colorType"):u.bgPrecisionColMax=1,h.texCoordType!=r.FLOAT?u.bgPrecisionTexMax=c.getPrecisionMax("texCoordType"):u.bgPrecisionTexMax=1,h.normalType!=r.FLOAT?u.bgPrecisionNorMax=c.getPrecisionMax("normalType"):u.bgPrecisionNorMax=1,h.tangentType!=r.FLOAT?u.bgPrecisionTangentMax=c.getPrecisionMax("tangentType"):u.bgPrecisionTangentMax=1,h.binormalType!=r.FLOAT?u.bgPrecisionBinormalMax=c.getPrecisionMax("binormalType"):u.bgPrecisionBinormalMax=1,k.getFog());m&&U&&(u.fogColor=m._vf.color.toGL(),u.fogRange=m._vf.visibilityRange,u.fogType="LINEAR"==m._vf.fogType?0:1);var p,G,x=f?f._cf.material.node:null,g=f?f._shader:null,m=!1,z=g&&x3dom.isa(g,x3dom.nodeTypes.ComposedShader);if(h.csshader?(u.diffuseColor=g._vf.diffuseFactor.toGL(),u.specularColor=g._vf.specularFactor.toGL(),u.emissiveColor=g._vf.emissiveFactor.toGL(),u.shininess=g._vf.shininessFactor,u.ambientIntensity=(g._vf.ambientFactor.x+g._vf.ambientFactor.y+g._vf.ambientFactor.z)/3,u.transparency=1-g._vf.alphaFactor,u.environmentFactor=g._vf.environmentFactor.x,u.normalBias=g._vf.normalBias.toGL(),g.getDisplacementMap()?(_=x3dom.Utils.findTextureByName(h.texture,"displacementMap"),u.displacementWidth=_.texture.width,u.displacementHeight=_.texture.height,u.displacementFactor=g._vf.displacementFactor,u.displacementAxis="x"==g._vf.displacementAxis?0:"y"==g._vf.displacementAxis?1:2):g.getDiffuseDisplacementMap()&&(_=x3dom.Utils.findTextureByName(h.texture,"diffuseDisplacementMap"),u.displacementWidth=_.texture.width,u.displacementHeight=_.texture.height,u.displacementFactor=g._vf.displacementFactor,u.displacementAxis="x"==g._vf.displacementAxis?0:"y"==g._vf.displacementAxis?1:2)):x&&x3dom.isa(x,x3dom.nodeTypes.PhysicalMaterial)?("roughnessMetallic"==x._vf.model?(u.diffuseColor=[x._vf.baseColorFactor.r,x._vf.baseColorFactor.g,x._vf.baseColorFactor.b],u.specularColor=[x3dom.Utils.lerp(.04,x._vf.baseColorFactor.r,x._vf.metallicFactor),x3dom.Utils.lerp(.04,x._vf.baseColorFactor.g,x._vf.metallicFactor),x3dom.Utils.lerp(.04,x._vf.baseColorFactor.b,x._vf.metallicFactor)],u.shininess=1-x._vf.roughnessFactor,u.metallicFactor=x._vf.metallicFactor,u.transparency=1-x._vf.baseColorFactor.a):(u.diffuseColor=[x._vf.diffuseFactor.r,x._vf.diffuseFactor.g,x._vf.diffuseFactor.b],u.specularColor=[x._vf.specularFactor.r,x._vf.specularFactor.g,x._vf.specularFactor.b],u.shininess=x._vf.glossinessFactor,u.transparency=1-x._vf.diffuseFactor.a),u.emissiveColor=x._vf.emissiveFactor.toGL(),u.normalBias=x._vf.normalBias.toGL(),u.ambientIntensity=1,u.alphaCutoff=x._vf.alphaCutoff):x?(u.diffuseColor=x._vf.diffuseColor.toGL(),u.specularColor=x._vf.specularColor.toGL(),u.emissiveColor=x._vf.emissiveColor.toGL(),u.shininess=x._vf.shininess,u.ambientIntensity=x._vf.ambientIntensity,u.transparency=x._vf.transparency,u.environmentFactor=0,u.alphaCutoff=f._vf.alphaClipThreshold.toFixed(2),x3dom.isa(x,x3dom.nodeTypes.TwoSidedMaterial)&&(m=!0,u.backDiffuseColor=x._vf.backDiffuseColor.toGL(),u.backSpecularColor=x._vf.backSpecularColor.toGL(),u.backEmissiveColor=x._vf.backEmissiveColor.toGL(),u.backShininess=x._vf.backShininess,u.backAmbientIntensity=x._vf.backAmbientIntensity,u.backTransparency=x._vf.backTransparency)):(u.diffuseColor=[1,1,1],u.specularColor=[0,0,0],u.emissiveColor=[0,0,0],u.shininess=0,u.ambientIntensity=1,u.transparency=0,u.alphaCutoff=.1),g)if(z)for(var H in g._vf)g._vf.hasOwnProperty(H)&&"language"!==H&&null!=(G=g._vf[H])&&(G.toGL?u[H]=G.toGL():u[H]=G);else x3dom.isa(g,x3dom.nodeTypes.CommonSurfaceShader)&&(h.csshader=g);for(var v=0;v<o&&U;v++){var j=L.mult(i[v].getCurrentTransform());x3dom.isa(i[v],x3dom.nodeTypes.DirectionalLight)?(u["light"+v+"_Type"]=0,u["light"+v+"_On"]=i[v]._vf.on?1:0,u["light"+v+"_Color"]=i[v]._vf.color.toGL(),u["light"+v+"_Intensity"]=i[v]._vf.intensity,u["light"+v+"_AmbientIntensity"]=i[v]._vf.ambientIntensity,u["light"+v+"_Direction"]=j.multMatrixVec(i[v]._vf.direction).toGL(),u["light"+v+"_Attenuation"]=[1,1,1],u["light"+v+"_Location"]=[1,1,1],u["light"+v+"_Radius"]=0,u["light"+v+"_BeamWidth"]=0,u["light"+v+"_CutOffAngle"]=0,u["light"+v+"_ShadowIntensity"]=i[v]._vf.shadowIntensity):x3dom.isa(i[v],x3dom.nodeTypes.PointLight)?(u["light"+v+"_Type"]=1,u["light"+v+"_On"]=i[v]._vf.on?1:0,u["light"+v+"_Color"]=i[v]._vf.color.toGL(),u["light"+v+"_Intensity"]=i[v]._vf.intensity,u["light"+v+"_AmbientIntensity"]=i[v]._vf.ambientIntensity,u["light"+v+"_Direction"]=[1,1,1],u["light"+v+"_Attenuation"]=i[v]._vf.attenuation.toGL(),u["light"+v+"_Location"]=j.multMatrixPnt(i[v]._vf.location).toGL(),u["light"+v+"_Radius"]=i[v]._vf.radius,u["light"+v+"_BeamWidth"]=0,u["light"+v+"_CutOffAngle"]=0,u["light"+v+"_ShadowIntensity"]=i[v]._vf.shadowIntensity):x3dom.isa(i[v],x3dom.nodeTypes.SpotLight)?(u["light"+v+"_Type"]=2,u["light"+v+"_On"]=i[v]._vf.on?1:0,u["light"+v+"_Color"]=i[v]._vf.color.toGL(),u["light"+v+"_Intensity"]=i[v]._vf.intensity,u["light"+v+"_AmbientIntensity"]=i[v]._vf.ambientIntensity,u["light"+v+"_Direction"]=j.multMatrixVec(i[v]._vf.direction).toGL(),u["light"+v+"_Attenuation"]=i[v]._vf.attenuation.toGL(),u["light"+v+"_Location"]=j.multMatrixPnt(i[v]._vf.location).toGL(),u["light"+v+"_Radius"]=i[v]._vf.radius,u["light"+v+"_BeamWidth"]=i[v]._vf.beamWidth,u["light"+v+"_CutOffAngle"]=i[v]._vf.cutOffAngle,u["light"+v+"_ShadowIntensity"]=i[v]._vf.shadowIntensity):x3dom.isa(i[v],x3dom.nodeTypes.PhysicalEnvironmentLight)&&(p=i[v],o--)}if(k.getNavigationInfo()._vf.headlight&&U&&(u["light"+(o=o||0)+"_Type"]=0,u["light"+o+"_On"]=1,u["light"+o+"_Color"]=[1,1,1],u["light"+o+"_Intensity"]=1,u["light"+o+"_AmbientIntensity"]=0,u["light"+o+"_Direction"]=[0,0,-1],u["light"+o+"_Attenuation"]=[1,1,1],u["light"+o+"_Location"]=[1,1,1],u["light"+o+"_Radius"]=0,u["light"+o+"_BeamWidth"]=0,u["light"+o+"_CutOffAngle"]=0,u["light"+o+"_ShadowIntensity"]=0),a._clipPlanes)for(var y=0;y<a._clipPlanes.length;y++){var W=a._clipPlanes[y].plane,Y=a._clipPlanes[y].trafo;u["clipPlane"+y+"_Plane"]=Y.multMatrixPlane(W._vf.plane).toGL(),u["clipPlane"+y+"_CappingStrength"]=W._vf.cappingStrength,u["clipPlane"+y+"_CappingColor"]=W._vf.cappingColor.toGL()}var T=f?f._cf.depthMode.node:null,b=!!f&&null!=f._cf.texture.node,l=!l||b,b=(T?T._vf.enableDepthTest?(this.stateManager.enable(r.DEPTH_TEST),this.stateManager.depthMask(!T._vf.readOnly),this.stateManager.depthFunc(x3dom.Utils.depthFunc(r,T._vf.depthFunc)),this.stateManager.depthRange(T._vf.zNearRange,T._vf.zFarRange)):this.stateManager.disable(r.DEPTH_TEST):(this.stateManager.enable(r.DEPTH_TEST),this.stateManager.depthMask(l),this.stateManager.depthFunc(r.LEQUAL)),f?f._cf.blendMode.node:null),l=(b?(l=x3dom.Utils.blendFunc(r,b._vf.srcFactor),S=x3dom.Utils.blendFunc(r,b._vf.destFactor),!1!==l&&!1!==S?(this.stateManager.enable(r.BLEND),this.stateManager.blendFuncSeparate(l,S,r.ONE,r.ONE),this.stateManager.blendColor(b._vf.color.r,b._vf.color.g,b._vf.color.b,1-b._vf.colorTransparency),this.stateManager.blendEquation(x3dom.Utils.blendEquation(r,b._vf.equation))):this.stateManager.disable(r.BLEND)):!x||!x3dom.isa(x,x3dom.nodeTypes.PhysicalMaterial)||"BLEND"==x._vf.alphaMode?(this.stateManager.enable(r.BLEND),this.stateManager.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE)):this.stateManager.disable(r.BLEND),f?f._cf.colorMaskMode.node:null),S=(l?this.stateManager.colorMask(l._vf.maskR,l._vf.maskG,l._vf.maskB,l._vf.maskA):this.stateManager.colorMask(!0,!0,!0,!0),f?f._cf.lineProperties.node:null),q=(S?this.stateManager.lineWidth(S._vf.linewidthScaleFactor):x3dom.Utils.needLineWidth&&this.stateManager.lineWidth(1),a.isSolid()&&!m?(this.stateManager.enable(r.CULL_FACE),a.isCCW()?this.stateManager.frontFace(r.CCW):this.stateManager.frontFace(r.CW)):this.stateManager.disable(r.CULL_FACE),L.mult(d)),m=q.inverse();u.screenWidth=this.canvas.width,u.isOrthoView=1==n._33?1:0,u.modelMatrix=d.toGL(),u.modelViewMatrix=q.toGL(),u.viewMatrix=L.toGL(),u.normalMatrix=m.transpose().toGL(),u.modelViewMatrixInverse=m.toGL(),u.modelViewProjectionMatrix=s.mult(d).toGL(),u.modelViewProjectionInverseMatrix=s.mult(d).inverse().toGL(),u.viewMatrixInverse=L.inverse().toGL(),u.cameraPosWS=L.inverse().e3().toGL(),this.setTonemappingOperator(t,u),z&&(u.model=d.toGL(),u.projectionMatrix=n.toGL(),u.worldMatrix=d.toGL(),u.worldInverseTranspose=d.inverse().transpose().toGL()),2==this.VRMode?(m=t.getViewMatrices()[1],s=t.getProjectionMatrices()[1].mult(m),D=(n=m.mult(d)).inverse(),u.viewMatrix2=m.toGL(),u.modelViewMatrix2=n.toGL(),u.normalMatrix2=D.transpose().toGL(),u.modelViewMatrixInverse2=D.toGL(),u.modelViewProjectionMatrix2=s.mult(d).toGL(),u.isVR=1):u.isVR=0,h.popGeometry&&this.updatePopState(e,c,u,h,k,q,t,this.x3dElem.runtime.fps);for(var F=0,E=h.texture.length;F<E;F++)_=h.texture[F],r.activeTexture(r.TEXTURE0+F),r.bindTexture(_.type,_.texture),r.texParameteri(_.type,r.TEXTURE_WRAP_S,_.wrapS),r.texParameteri(_.type,r.TEXTURE_WRAP_T,_.wrapT),r.texParameteri(_.type,r.TEXTURE_MAG_FILTER,_.magFilter),r.texParameteri(_.type,r.TEXTURE_MIN_FILTER,_.minFilter),x3dom.caps.ANISOTROPIC&&r.texParameterf(_.type,x3dom.caps.ANISOTROPIC.TEXTURE_MAX_ANISOTROPY_EXT,_.anisotropicDegree),g&&z||u[_.samplerName]||(u[_.samplerName]=F);x3dom.isa(x,x3dom.nodeTypes.PhysicalMaterial)&&null!=p&&""!=p._vf.diffuse&&""!=p._vf.specular&&(m=p._nameSpace.getURL(p._vf.diffuse),n=p._nameSpace.getURL(p._vf.specular),D=x3dom.BRDF_LUT,s=this.cache.getTexture2D(r,a._nameSpace.doc,D,!1,"anonymous",!1,!1,!0),d=this.cache.getTextureCube(r,a._nameSpace.doc,[m],!1,"anonymous",!1,!1,!0),e=this.cache.getTextureCube(r,a._nameSpace.doc,[n],!1,"anonymous",!1,!1,!0),r.activeTexture(r.TEXTURE0+E),r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),u.brdfMap=E++,d.ready&&(r.activeTexture(r.TEXTURE0+E),r.bindTexture(r.TEXTURE_CUBE_MAP,d),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),u.diffuseEnvironmentMap=E++),e.ready)&&(r.activeTexture(r.TEXTURE0+E),r.bindTexture(r.TEXTURE_CUBE_MAP,e),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),u.specularEnvironmentMap=E++),f&&f._cf.textureTransform.node&&(k=f.texTransformMatrix(),u.texTrafoMatrix=k.toGL());for(var M,C,w,A=null,Q=h.dynamicFields.length,R=0;R<Q;R++)void 0!==u[(A=h.dynamicFields[R]).name]&&(r.bindBuffer(r.ARRAY_BUFFER,A.buf),r.vertexAttribPointer(u[A.name],A.numComponents,r.FLOAT,!1,0,0),r.enableVertexAttribArray(u[A.name]));var D,K=!1;x3dom.isa(c,x3dom.nodeTypes.ParticleSet)&&(K=!0),(f?f._cf.pointProperties.node:null)&&(x3dom.isa(c,x3dom.nodeTypes.PointSet)||x3dom.isa(c,x3dom.nodeTypes.BinaryGeometry))&&(D=f._cf.pointProperties.node._vf,u.pointSizeAttenuation=D.attenuation.toGL(),u.pointSizeFactor=D.pointSizeScaleFactor,u.minPointSize=D.pointSizeMinValue,u.maxPointSize=D.pointSizeMaxValue);for(var Z=h.positions.length,N=0;N<Z;N++){var I=6*N,B=!1;if(void 0!==u.position&&h.buffers[I+x3dom.BUFFER_IDX.POSITION]&&h.indexes[N]){if(h.buffers[I+x3dom.BUFFER_IDX.INDEX]){if(K&&"any"!=c.drawOrder()){for(var J,$=[],ee=c._cf.coord.node.getPoints(),te=ee.length==h.indexes[N].length?h.indexes[N].length:0,P=0;P<te;P++){var ie=q.multMatrixPnt(ee[P]);$.push([P,ie.z])}for("backtofront"==c.drawOrder()?$.sort(function(e,t){return e[1]-t[1]}):$.sort(function(e,t){return t[1]-e[1]}),P=0;P<te;P++)a._webgl.indexes[N][P]=$[P][0];x3dom.caps.INDEX_UINT&&65535<te?(J=new Uint32Array(a._webgl.indexes[N]),a._webgl.indexType=r.UNSIGNED_INT):(J=new Uint16Array(a._webgl.indexes[N]),a._webgl.indexType=r.UNSIGNED_SHORT),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,h.buffers[I+x3dom.BUFFER_IDX.INDEX]),r.bufferData(r.ELEMENT_ARRAY_BUFFER,J,r.DYNAMIC_DRAW),J=null}r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,h.buffers[I+x3dom.BUFFER_IDX.INDEX]),B=!0}this.setVertexAttribEyeIdx(r,u),this.setVertexAttribPointerPosition(r,a,I,N),this.setVertexAttribPointerNormal(r,a,I,N),this.setVertexAttribPointerTexCoord(r,a,I,N),this.setVertexAttribPointerTexCoord2(r,a,I,N),this.setVertexAttribPointerColor(r,a,I,N),this.setVertexAttribPointerTangent(r,a,I,N),this.setVertexAttribPointerBinormal(r,a,I,N),void 0===u.id&&void 0===u.particleSize||!a._webgl.buffers[I+x3dom.BUFFER_IDX.ID]||(r.bindBuffer(r.ARRAY_BUFFER,a._webgl.buffers[I+x3dom.BUFFER_IDX.ID]),0!=h.binaryGeometry&&1==c._vf.idsPerVertex?(r.vertexAttribPointer(u.id,1,r.FLOAT,!1,4,0),r.enableVertexAttribArray(u.id)):K&&(r.vertexAttribPointer(u.particleSize,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(u.particleSize))),0!=h.popGeometry&&h.buffers[I+x3dom.BUFFER_IDX.ID]&&(r.bindBuffer(r.ARRAY_BUFFER,h.buffers[I+x3dom.BUFFER_IDX.ID]),r.vertexAttribPointer(u.PG_vertexID,1,r.FLOAT,!1,4,0),r.enableVertexAttribArray(u.PG_vertexID));var V,oe=t.getRenderMode(),se=!!x&&0<x._vf.transparency&&!a.isSolid(),ne=function(e,t){e.frontFace(a.isCCW()?r.CCW:r.CW),e.enable(r.CULL_FACE),e.cullFace(r.FRONT),t(),e.cullFace(r.BACK),t(),e.disable(r.CULL_FACE)};if(0<oe){var re=1==oe?r.POINTS:r.LINES;if(B&&(0<h.binaryGeometry||0<h.popGeometry))for(w=M=0,C=c._vf.vertexCount.length;M<C;M++)this.drawElements(r,re,c._vf.vertexCount[M],h.indexType,x3dom.Utils.getByteAwareOffset(w,h.indexType,r)),w+=c._vf.vertexCount[M];else if(h.binaryGeometry<0||h.popGeometry<0)for(w=M=0,C=c._vf.vertexCount.length;M<C;M++)this.drawArrays(r,re,w,c._vf.vertexCount[M]),w+=c._vf.vertexCount[M];else if(B&&0<h.bufferGeometry)this.drawElements(r,h.primType[0],c._vf.vertexCount[0],h.indexType,a._indexOffset);else if(h.bufferGeometry<0)this.drawArrays(r,h.primType[0],0,c._vf.vertexCount[0]);else if(c.hasIndexOffset())for(M=0,C=(V=a.tessellationProperties()).length;M<C;M++)this.drawElements(r,re,V[M].count,h.indexType,V[M].offset*x3dom.Utils.getOffsetMultiplier(h.indexType,r));else 0==h.indexes[N].length?this.drawArrays(r,re,0,h.positions[N].length/3):this.drawElements(r,re,h.indexes[N].length,h.indexType,0)}else if(B&&(0<h.binaryGeometry||0<h.popGeometry))for(w=M=0,C=c._vf.vertexCount.length;M<C;M++)this.drawElements(r,h.primType[M],c._vf.vertexCount[M],h.indexType,x3dom.Utils.getByteAwareOffset(w,h.indexType,r)),w+=c._vf.vertexCount[M];else if(h.binaryGeometry<0||h.popGeometry<0)for(w=M=0,C=c._vf.vertexCount.length;M<C;M++)this.drawArrays(r,h.primType[M],w,c._vf.vertexCount[M]),w+=c._vf.vertexCount[M];else if(B&&0<h.bufferGeometry)this.drawElements(r,h.primType[0],c._vf.vertexCount[0],h.indexType,a._indexOffset);else if(h.bufferGeometry<0)this.drawArrays(r,h.primType[0],0,c._vf.vertexCount[0]);else if(c.hasIndexOffset())for(M=0,C=(V=a.tessellationProperties()).length;M<C;M++)this.drawElements(r,h.primType,V[M].count,h.indexType,V[M].offset*x3dom.Utils.getOffsetMultiplier(h.indexType,r));else 0==h.indexes[N].length?se?ne(this.stateManager,this.drawArrays.bind(this,r,h.primType,0,h.positions[N].length/3)):this.drawArrays(r,h.primType,0,h.positions[N].length/3):se?ne(this.stateManager,this.drawElements.bind(this,r,h.primType,h.indexes[N].length,h.indexType,0)):this.drawElements(r,h.primType,h.indexes[N].length,h.indexType,0);r.disableVertexAttribArray(u.position),void 0!==u.normal&&r.disableVertexAttribArray(u.normal),this.disableVertexAttribEyeIdx(r,u),void 0!==u.texcoord&&r.disableVertexAttribArray(u.texcoord),void 0!==u.texcoord2&&r.disableVertexAttribArray(u.texcoord2),void 0!==u.color&&r.disableVertexAttribArray(u.color),void 0!==u.tangent&&r.disableVertexAttribArray(u.tangent),void 0!==u.binormal&&r.disableVertexAttribArray(u.binormal),h.buffers[I+x3dom.BUFFER_IDX.ID]&&(void 0!==u.id?r.disableVertexAttribArray(u.id):void 0!==u.particleSize&&r.disableVertexAttribArray(u.particleSize)),0!=h.popGeometry&&void 0!==u.PG_vertexID&&r.disableVertexAttribArray(u.PG_vertexID)}}for(R=0;R<Q;R++)void 0!==u[(A=h.dynamicFields[R]).name]&&r.disableVertexAttribArray(u[A.name]);this.numCoords+=X._numCoords,this.numFaces+=X._numFaces,h.binaryGeometry||h.popGeometry||h.bufferGeometry?this.numDrawCalls+=c._vf.vertexCount.length:c.hasIndexOffset()?this.numDrawCalls+=a.tessellationProperties().length:this.numDrawCalls+=Z,this.stateManager.depthMask(!0),T&&(this.stateManager.enable(r.DEPTH_TEST),this.stateManager.depthFunc(r.LEQUAL),this.stateManager.depthRange(0,1)),b&&(this.stateManager.enable(r.BLEND),this.stateManager.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE),this.stateManager.blendColor(1,1,1,1),this.stateManager.blendEquation(r.FUNC_ADD)),l&&this.stateManager.colorMask(!0,!0,!0,!0),S&&this.stateManager.lineWidth(1);for(var ae=h.texture,E=ae?ae.length:0,F=0;F<E;F++)ae[F]&&f&&f._cf.texture.node&&(_=f._cf.texture.node.getTexture(F),r.activeTexture(r.TEXTURE0+F),x3dom.isa(_,x3dom.nodeTypes.X3DEnvironmentTextureNode)?r.bindTexture(r.TEXTURE_CUBE_MAP,null):r.bindTexture(r.TEXTURE_2D,null))}else x3dom.debug.logError("[Context|RenderShape] No Shader is set!")}else x3dom.debug.logError("[Context|RenderShape] No valid Shape!")},f.prototype.updatePopState=function(e,t,i,o,s,n,r,a){var d,l=x3dom.nodeTypes.PopGeometry.ErrorToleranceFactor*t._vf.precisionFactor,a=((a<=1||r.isMovingOrAnimating())&&(l*=x3dom.nodeTypes.PopGeometry.PrecisionFactorOnMove),16),h=(0<l&&(d=(s=s.getViewpoint()).getImgPlaneHeightAtDistOne(),s=s.getNear(),h=n.multMatrixPnt(t._vf.position),u=.5*n.multMatrixVec(t._vf.size).length(),n=.5*n.multMatrixVec(t._vf.maxBBSize).length()*2/(l*(Math.max(-h.z-u,s)*(d/r._height))),a=(a=Math.ceil(Math.log(n)/.693147180559945))<1?1:16<a?16:a),t._vf.minPrecisionLevel),u=t._vf.maxPrecisionLevel,f=(a=-1!=h&&a<h?h:a,o.levelsAvailable<(a=-1!=u&&u<a?u:a)?o.levelsAvailable:a),c=(a=f,l<=1&&(a=a==t.getNumLevels()?16:a),t._vf.indexedRendering),_=t._mesh;_._numCoords=0;for(var m=_._numFaces=0;m<f;++m){var p=o.numVerticesAtLevel[m];_._numCoords+=p,_._numFaces+=(c?t.getNumIndicesByLevel(m):p)/3}x3dom.nodeTypes.PopGeometry.numRenderedVerts+=_._numCoords,x3dom.nodeTypes.PopGeometry.numRenderedTris+=_._numFaces,_.currentLOD=a,t.adaptVertexCount(c?3*_._numFaces:_._numCoords),i.PG_maxBBSize=t._vf.maxBBSize.toGL(),i.PG_bbMin=t._bbMinBySize,i.PG_numAnchorVertices=t._vf.numAnchorVertices,i.PG_bbMaxModF=t._vf.bbMaxModF.toGL(),i.PG_bboxShiftVec=t._vf.bbShiftVec.toGL(),i.PG_precisionLevel=a,i.PG_powPrecision=x3dom.nodeTypes.PopGeometry.powLUT[a-1]},f.prototype.pickValue=function(e,t,i,o,s,n){x3dom.Utils.startMeasure("picking");var r=e._scene,a=this.ctx3d;if(!(a&&r&&r._webgl&&r.drawableCollection))return!1;var d=0;switch(r._vf.pickMode.toLowerCase()){case"box":return!1;case"idbuf":d=0;break;case"idbuf24":d=3;break;case"idbufid":d=4;break;case"color":d=1;break;case"texcoord":d=2}var s=4<arguments.length?(p=s,n):(p=e._last_mat_view,e._last_mat_scene),n=x3dom.fields.SFVec3f.copy(r._lastMin),l=x3dom.fields.SFVec3f.copy(r._lastMax),h=p.inverse().e3(),u=x3dom.fields.SFVec3f.copy(h),f=x3dom.fields.SFVec3f.copy(h),u=(u.x>n.x&&(u.x=n.x),u.y>n.y&&(u.y=n.y),u.z>n.z&&(u.z=n.z),f.x<l.x&&(f.x=l.x),f.y<l.y&&(f.y=l.y),f.z<l.z&&(f.z=l.z),r._lastMin.setValues(u),r._lastMax.setValues(f),r._lastMax.subtract(r._lastMin).length()),f=(r.getViewpoint().getFar()&&(u=Math.min(u,r.getViewpoint().getFar())),e.getCCtoWCMatrix()),n=(r._lastMin.setValues(n),r._lastMax.setValues(l),x3dom.nodeTypes.Shape.objectID+2),l=(this.renderPickingPass(a,r,p,s,h,u,d,t,i,2,2),r._webgl.fboPick.pixelData);if(l&&l.length){var c,_,m,a=new x3dom.fields.SFVec3f(0,0,0),p=new x3dom.fields.SFVec3f(0,0,1),s=0,x=l[s+3],g=1/r._webgl.pickScale;0==d?(x+=256*l[s+2],A=l[s]/255*(1/256)+l[s+1]/255,C=e.calcViewRay(t,i,f),a=h.add(C.dir.multiply(A*u)),A=l[s=4]/255*(1/256)+l[s+1]/255,b=e.calcViewRay(t+g,i,f),_=(_=h.add(b.dir.multiply(A*u))).subtract(a).normalize(),A=l[s=8]/255*(1/256)+l[s+1]/255,b=e.calcViewRay(t,i-g,f),m=(m=h.add(b.dir.multiply(A*u))).subtract(a).normalize(),p=_.cross(m).normalize()):3==d?(x+=256*l[s+2]+65536*l[s+1],A=l[s]/255,C=e.calcViewRay(t,i,f),a=h.add(C.dir.multiply(A*u)),A=l[s=4]/255,b=e.calcViewRay(t+g,i,f),_=(_=h.add(b.dir.multiply(A*u))).subtract(a).normalize(),A=l[s=8]/255,b=e.calcViewRay(t,i-g,f),m=(m=h.add(b.dir.multiply(A*u))).subtract(a).normalize(),p=_.cross(m).normalize()):4==d?(x+=256*l[s+2],c=l[s+1],c+=256*l[s],0==x&&0<c&&c<n&&(x=c)):(a.x=l[s],a.y=l[s+1],a.z=l[s+2]);var v,g="shadowObjectIdChanged",h=Math.max(o>>>8,255&o);if(n<=x){x-=n;var y=t*e._inverseDevicePixelRatio,T=i*e._inverseDevicePixelRatio,b=(4!=d?(e._pickingInfo.pickPos=a,e._pick.setValues(a),e._pickingInfo.pickNorm=p,e._pickNorm.setValues(p),e._pickingInfo.pickObj=null,e._pickingInfo.lastClickObj=null,r):(e._pickingInfo.pickObj=x3dom.nodeTypes.Shape.idMap.nodeID[c],e._pickingInfo.pickObj))._xmlNode,S=e._pickingInfo.shadowObjectId!=x;if(e._pickingInfo.lastShadowObjectId=e._pickingInfo.shadowObjectId,e._pickingInfo.shadowObjectId=x,(S||h)&&r._xmlNode&&(r._xmlNode["on"+g]||r._xmlNode.hasAttribute("on"+g)||r._listeners[g])&&(v={target:r._xmlNode,type:g,button:h,mouseup:0<o>>>8,layerX:y,layerY:T,shadowObjectId:x,worldX:a.x,worldY:a.y,worldZ:a.z,normalX:p.x,normalY:p.y,normalZ:p.z,hitPnt:a.toGL(),hitObject:b,cancelBubble:!1,stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.cancelBubble=!0}},r.callEvtHandler("on"+g,v)),r._shadowIdMap&&r._shadowIdMap.mapping&&x<r._shadowIdMap.mapping.length){for(var F,E,M=r._shadowIdMap.mapping[x].usage,C=C||e.calcViewRay(t,i,f),w=0;w<M.length;w++)if((E=r._nameSpace.defMap[M[w]])&&E.doIntersect(C)){e._pickingInfo.pickObj=E;break}for(F=0;F<r._nameSpace.childSpaces.length;F++)for(w=0;w<M.length;w++)if((E=r._nameSpace.childSpaces[F].defMap[M[w]])&&E.doIntersect(C)){e._pickingInfo.pickObj=E;break}}}else S=-1!=e._pickingInfo.shadowObjectId,e._pickingInfo.shadowObjectId=-1,S&&r._xmlNode&&(r._xmlNode["on"+g]||r._xmlNode.hasAttribute("on"+g)||r._listeners[g])&&(v={target:r._xmlNode,type:g,button:h,mouseup:0<o>>>8,layerX:y,layerY:T,shadowObjectId:e._pickingInfo.shadowObjectId,cancelBubble:!1,stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.cancelBubble=!0}},r.callEvtHandler("on"+g,v)),0<x?(e._pickingInfo.pickPos=a,e._pickingInfo.pickNorm=p,e._pickingInfo.pickObj=x3dom.nodeTypes.Shape.idMap.nodeID[x]):(e._pickingInfo.pickObj=null,e._pickingInfo.lastClickObj=null)}var A=x3dom.Utils.stopMeasure("picking");return this.x3dElem.runtime.addMeasurement("PICKING",A),!0},f.prototype.pickRect=function(e,t,i,o,s){var n=this.ctx3d,r=e?e._scene:null;if(!(n&&r&&r._webgl&&r.drawableCollection))return!1;for(var a=e._last_mat_view.inverse().e3(),d=r._lastMax.subtract(r._lastMin).length(),l=t<=o?t:o,h=s<=i?i:s,o=(1+Math.abs(o-t))*r._webgl.pickScale,t=(1+Math.abs(s-i))*r._webgl.pickScale,u=(this.renderPickingPass(n,r,e._last_mat_view,e._last_mat_scene,a,d,0,l,h,o<1?1:o,t<1?1:t),[]),f=0;r._webgl.fboPick.pixelData&&f<r._webgl.fboPick.pixelData.length;f+=4){var c=r._webgl.fboPick.pixelData[f+3]+256*r._webgl.fboPick.pixelData[f+2];0<c&&u.push(c)}u.sort();var _,u=(e=>{for(var t=[],i=e.length,o=0;o<i;o++){for(var s=o+1;s<i;s++)e[o]===e[s]&&(s=++o);t.push(e[o])}return t})(u),m=[],p=x3dom.nodeTypes.Shape.objectID+2;for(f=0;f<u.length;f++)(c=u[f])>=p?c-=p:(_=(_=x3dom.nodeTypes.Shape.idMap.nodeID[c])&&_._xmlNode?_._xmlNode:null)&&m.push(_);return m},f.prototype.renderScene=function(e,L){var t=this.ctx3d,i=e._scene;if(null!==t&&null!==i){var o,s,n,r,a,d,l,h,u,f,c=e._doc._nodeBag.renderTextures,_=c.length,m=null,p=t.UNSIGNED_BYTE,x=t.UNSIGNED_BYTE,g=(x3dom.caps.FP_TEXTURES&&(p=t.FLOAT,x=t.FLOAT,x3dom.caps.FPL_TEXTURES),[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);if(i.updateVolume(),i._webgl){var v=Math.round(this.canvas.width*i._webgl.pickScale),y=Math.round(this.canvas.height*i._webgl.pickScale);for(i._webgl._currFboWidth===v&&i._webgl._currFboHeight===y||(i._webgl._currFboWidth=v,i._webgl._currFboHeight=y,i._webgl.fboPick=x3dom.Utils.initFBO(t,v,y,i._webgl.fboPick.type,!1,!0),i._webgl.fboPick.pixelData=null,x3dom.debug.logInfo("Refreshed picking FBO to size ("+v+", "+y+")")),s=0;s<_;s++)(o=c[s])._webgl&&o._webgl.fbo&&o._webgl.fbo.width==o._vf.dimensions[0]&&o._webgl.fbo.height==o._vf.dimensions[1]||(o.invalidateGLObject(),o._cleanupGLObjects?o._cleanupGLObjects():o._cleanupGLObjects=function(e){e||t.deleteTexture(this._webgl.fbo.tex),this._webgl.fbo.dtex&&t.deleteTexture(this._webgl.fbo.dtex),this._webgl.fbo.rbo&&t.deleteRenderbuffer(this._webgl.fbo.rbo),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(this._webgl.fbo.fbo),this._webgl.fbo.rbo=null,this._webgl.fbo.fbo=null},m=o._cf.textureProperties.node,u=o.requirePingPong()?t.UNSIGNED_BYTE:p,o._webgl={},o._webgl.fbo=x3dom.Utils.initFBO(t,o._vf.dimensions[0],o._vf.dimensions[1],u,m&&m._vf.generateMipMaps,o._vf.depthMap||!o.requirePingPong()),o.requirePingPong()&&(f=o._vf.dimensions[0]+"x"+o._vf.dimensions[1],void 0===i._webgl.refinement[f]&&(i._webgl.refinement[f]=x3dom.Utils.initFBO(t,o._vf.dimensions[0],o._vf.dimensions[1],u,!1,!1)),o._webgl.texture=null),x3dom.debug.logInfo("Init/resize RenderedTexture_"+s+" to size "+o._vf.dimensions[0]+" x "+o._vf.dimensions[1]));for(d=(n=e.getShadowedLights()).length,P=0;P<d;P++)if(l=n[P]._vf.shadowMapSize,r=x3dom.isa(n[P],x3dom.nodeTypes.PointLight)?6:Math.max(1,Math.min(n[P]._vf.shadowCascades,6)),void 0===i._webgl.fboShadow[P]||i._webgl.fboShadow[P].length!=r||i._webgl.fboShadow[P][0].height!=l)for(i._webgl.fboShadow[P]=[],a=0;a<r;a++)i._webgl.fboShadow[P][a]=x3dom.Utils.initFBO(t,l,l,x,!1,!0);for(P=0;P<d;P++){for(l=i._webgl.fboShadow[P][0].height,h=!1,a=0;a<i._webgl.fboBlur.length;a++)l==i._webgl.fboBlur[a].height&&(h=!0);h||(i._webgl.fboBlur[i._webgl.fboBlur.length]=x3dom.Utils.initFBO(t,l,l,x,!1,!0))}((x3dom.SSAO.isEnabled(i)||0<i._webgl.fboShadow.length)&&void 0===i._webgl.fboScene||i._webgl.fboScene&&(this.canvas.width!=i._webgl.fboScene.width||this.canvas.height!=i._webgl.fboScene.height))&&(i._webgl.fboScene=x3dom.Utils.initFBO(t,this.canvas.width,this.canvas.height,x,!1,!0))}else{for(i._webgl={},this.setupFgnds(t,i),i._webgl.pickScale=.5,i._webgl._currFboWidth=Math.round(this.canvas.width*i._webgl.pickScale),i._webgl._currFboHeight=Math.round(this.canvas.height*i._webgl.pickScale),i._webgl.fboPick=x3dom.Utils.initFBO(t,i._webgl._currFboWidth,i._webgl._currFboHeight,t.UNSIGNED_BYTE,!1,!0),i._webgl.fboPick.pixelData=null,i._webgl.normalShader=this.cache.getShader(t,x3dom.shader.NORMAL),i._webgl.fboShadow=[],d=(n=e.getShadowedLights()).length,P=0;P<d;P++)for(l=n[P]._vf.shadowMapSize,r=x3dom.isa(n[P],x3dom.nodeTypes.PointLight)?6:Math.max(1,Math.min(n[P]._vf.shadowCascades,6)),i._webgl.fboShadow[P]=[],a=0;a<r;a++)i._webgl.fboShadow[P][a]=x3dom.Utils.initFBO(t,l,l,x,!1,!0);for((0<i._webgl.fboShadow.length||x3dom.SSAO.isEnabled(i))&&(i._webgl.fboScene=x3dom.Utils.initFBO(t,this.canvas.width,this.canvas.height,x,!1,!0)),i._webgl.fboBlur=[],P=0;P<d;P++){for(l=i._webgl.fboShadow[P][0].height,h=!1,a=0;a<i._webgl.fboBlur.length;a++)l==i._webgl.fboBlur[a].height&&(h=!0);h||(i._webgl.fboBlur[i._webgl.fboBlur.length]=x3dom.Utils.initFBO(t,l,l,x,!1,!0))}for(i._webgl.ppBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i._webgl.ppBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(g),t.STATIC_DRAW),i._webgl.refinement={stamps:new Array(2),positionBuffer:t.createBuffer()},t.bindBuffer(t.ARRAY_BUFFER,i._webgl.refinement.positionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(g),t.STATIC_DRAW),s=0;s<_;s++)m=(o=c[s])._cf.textureProperties.node,u=o.requirePingPong()?t.UNSIGNED_BYTE:p,o._webgl={},o._webgl.fbo=x3dom.Utils.initFBO(t,o._vf.dimensions[0],o._vf.dimensions[1],u,m&&m._vf.generateMipMaps,o._vf.depthMap||!o.requirePingPong()),o._cleanupGLObjects=function(e){e||t.deleteTexture(this._webgl.fbo.tex),this._webgl.fbo.dtex&&t.deleteTexture(this._webgl.fbo.dtex),this._webgl.fbo.rbo&&t.deleteFramebuffer(this._webgl.fbo.rbo),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(this._webgl.fbo.fbo),this._webgl.fbo.rbo=null,this._webgl.fbo.fbo=null},o.requirePingPong()&&(f=o._vf.dimensions[0]+"x"+o._vf.dimensions[1],void 0===i._webgl.refinement[f]&&(i._webgl.refinement[f]=x3dom.Utils.initFBO(t,o._vf.dimensions[0],o._vf.dimensions[1],u,!1,!1)),o._webgl.texture=null);e._last_mat_view=x3dom.fields.SFMatrix4f.identity(),e._last_mat_proj=x3dom.fields.SFMatrix4f.identity(),e._last_mat_scene=x3dom.fields.SFMatrix4f.identity(),this._calledViewpointChangedHandler=!1}var v=i.getEnvironment(),y=(v.checkSanity(),i.getBackground()),T=(this.setupScene(t,y),this.numFaces=0,this.numCoords=0,this.numDrawCalls=0,e.getProjectionMatrix()),b=e.getViewMatrix();if(!this._calledViewpointChangedHandler||!e._last_mat_view.equals(b)){var S,g=i.getViewpoint(),F="viewpointChanged";try{(g.hasEventListener(F)||i.hasEventListener(F))&&(E=(M=(M=g.getCurrentTransform()).inverse().mult(b)).inverse(),(R=new x3dom.fields.Quaternion(0,0,1,0)).setValue(E),O=E.e3(),S={target:g._xmlNode,type:F,matrix:M,position:O,orientation:R.toAxisAngle(),cancelBubble:!1,stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.cancelBubble=!0}},g.hasEventListener(F)&&g.callEvtHandler("on"+F,S),i.hasEventListener(F)&&i.callEvtHandler("on"+F,S),g.callEvtHandler("on"+F,S),this._calledViewpointChangedHandler=!0)}catch(e){x3dom.debug.logException(e)}}e._last_mat_view=b;var E,M,C=(e._last_mat_proj=T).mult(b),O=(e._last_mat_scene=C,i.drawableCollection=null,i.drawableCollection||(E={viewArea:e,sortTrans:v._vf.sortTrans,viewMatrix:b,projMatrix:T,sceneMatrix:C,frustumCulling:!0,smallFeatureThreshold:v._smallFeatureThreshold,context:this,gl:t},i.drawableCollection=new x3dom.DrawableCollection(E),x3dom.Utils.startMeasure("traverse"),i.collectDrawableObjects(x3dom.fields.SFMatrix4f.identity(),i.drawableCollection,!0,!1,0,[]),M=x3dom.Utils.stopMeasure("traverse"),this.x3dElem.runtime.addMeasurement("TRAVERSE",M)),x3dom.Utils.startMeasure("sorting"),i.drawableCollection.sort(),x3dom.Utils.stopMeasure("sorting"));this.x3dElem.runtime.addMeasurement("SORT",O);var w=e.getLights(),B=w.length,U=[],X=[],A=0;x3dom.Utils.startMeasure("shadow");for(var R,k=e.getLightMatrix(w),D=0;D<B;D++)if(0<w[D]._vf.shadowIntensity){var G=k[D],N=i._webgl.fboShadow[A],z=Math.max(0,Math.min(1,w[D]._vf.shadowOffset));if(x3dom.isa(w[D],x3dom.nodeTypes.PointLight))for(I=e.getWCtoLCMatricesPointLight(G,w[D],T),P=0;P<6;P++)this.renderShadowPass(t,e,I[P],b,N[P],z,!1);else for(var H=Math.max(1,Math.min(w[D]._vf.shadowCascades,6)),I=e.getWCtoLCMatricesCascaded(G,w[D],T),P=0;P<H;P++)this.renderShadowPass(t,e,I[P],b,N[P],z,!1);A++,U[U.length]=I,X[X.length]=G}for(0<A||x3dom.SSAO.isEnabled(i)?(this.renderShadowPass(t,e,C,b,i._webgl.fboScene,0,!0),R=x3dom.Utils.stopMeasure("shadow"),this.x3dElem.runtime.addMeasurement("SHADOW",R)):this.x3dElem.runtime.removeMeasurement("SHADOW"),I=e.getWCtoLCMatrix(e.getLightMatrix()[0]),s=0;s<_;s++)this.renderRTPass(t,e,c[s]);for(x3dom.Utils.startMeasure("render"),this.stateManager.bindFramebuffer(t.FRAMEBUFFER,L?L.framebuffer:null),this.stateManager.viewport(0,0,this.canvas.width,this.canvas.height),y._webgl.render(t,b,T,e),x3dom.nodeTypes.PopGeometry.numRenderedVerts=0,x3dom.nodeTypes.PopGeometry.numRenderedTris=0,d=i.drawableCollection.length,v._vf.smallFeatureCulling&&v._lowPriorityThreshold<1&&e.isMovingOrAnimating()&&!(d=Math.floor(d*v._lowPriorityThreshold))&&i.drawableCollection.length&&(d=1),this.stateManager.unsetProgram(),P=0;P<d;P++){var j=i.drawableCollection.get(P);this.renderShape(j,e,w,B,b,C,I,T,t)}if(0<A&&this.renderShadows(t,e,n,U,X,b,T,C),this.stateManager.disable(t.BLEND),this.stateManager.disable(t.DEPTH_TEST),e._numRenderedNodes=d,x3dom.SSAO.isEnabled(i)&&x3dom.SSAO.renderSSAO(this.stateManager,t,i,this.canvas),void 0!==e._visDbgBuf&&e._visDbgBuf){var g=i._vf.pickMode.toLowerCase(),W=(0!=g.indexOf("idbuf")&&"color"!=g&&"texcoord"!=g||(this.stateManager.viewport(0,3*this.canvas.height/4,this.canvas.width/4,this.canvas.height/4),i._fgnd._webgl.render(t,i._webgl.fboPick.tex)),(0<A||x3dom.SSAO.isEnabled(i))&&(this.stateManager.viewport(this.canvas.width/4,3*this.canvas.height/4,this.canvas.width/4,this.canvas.height/4),i._fgnd._webgl.render(t,i._webgl.fboScene.tex)),3),V=2;for(P=0;P<A;P++)for(N=i._webgl.fboShadow[P],a=0;a<N.length;a++)this.stateManager.viewport(V*this.canvas.width/4,W*this.canvas.height/4,this.canvas.width/4,this.canvas.height/4),i._fgnd._webgl.render(t,N[a].tex),V<2?V++:(V=0,W--);for(s=0;s<_;s++)(o=c[s])._webgl.fbo.fbo&&(this.stateManager.viewport(s*this.canvas.width/8,5*this.canvas.height/8,this.canvas.width/8,this.canvas.height/8),i._fgnd._webgl.render(t,o._webgl.fbo.tex))}t.finish();F=x3dom.Utils.stopMeasure("render");this.x3dElem.runtime.addMeasurement("RENDER",F),this.x3dElem.runtime.addMeasurement("DRAW",d?F/d:0),this.x3dElem.runtime.addInfo("#NODES:",i.drawableCollection.numberOfNodes),this.x3dElem.runtime.addInfo("#SHAPES:",e._numRenderedNodes),this.x3dElem.runtime.addInfo("#DRAWS:",this.numDrawCalls),this.x3dElem.runtime.addInfo("#POINTS:",this.numCoords),this.x3dElem.runtime.addInfo("#TRIS:",this.numFaces)}},f.prototype.renderPingPongPass=function(e,t,i){var o,t=t._scene,s=i._vf.dimensions[0]+"x"+i._vf.dimensions[1],s=t._webgl.refinement[s];0!=i._currLoadLevel||t._webgl.refinement.stamps[0]&&t._webgl.refinement.stamps[1]||(t._webgl.refinement.stamps[0]=this.cache.getTexture2D(e,i._nameSpace.doc,i._nameSpace.getURL(i._vf.stamp0),!1,"anonymous",!1,!1),t._webgl.refinement.stamps[1]=this.cache.getTexture2D(e,i._nameSpace.doc,i._nameSpace.getURL(i._vf.stamp1),!1,"anonymous",!1,!1)),i._currLoadLevel<i._loadLevel&&(i._currLoadLevel++,i._webgl.texture&&e.deleteTexture(i._webgl.texture),o=i._vf.url[0]+"/"+i._currLoadLevel+"."+i._vf.format,i._webgl.texture=x3dom.Utils.createTexture2D(e,i._nameSpace.doc,i._nameSpace.getURL(o),!1,"anonymous",!1,!1),i._vf.iterations%2==0?i._currLoadLevel%2!=0?i._repeat.x*=2:i._repeat.y*=2:i._currLoadLevel%2==0?i._repeat.x*=2:i._repeat.y*=2),i._webgl.texture.ready&&t._webgl.refinement.stamps[0].ready&&t._webgl.refinement.stamps[1].ready&&(this.stateManager.bindFramebuffer(e.FRAMEBUFFER,s.fbo),this.stateManager.viewport(0,0,s.width,s.height),this.stateManager.disable(e.BLEND),this.stateManager.disable(e.CULL_FACE),this.stateManager.disable(e.DEPTH_TEST),e.clearColor(0,0,0,1),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),o=this.cache.getShader(e,x3dom.shader.TEXTURE_REFINEMENT),this.stateManager.useProgram(o),e.bindBuffer(e.ARRAY_BUFFER,t._webgl.refinement.positionBuffer),e.vertexAttribPointer(o.position,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.position),o.stamp=0,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t._webgl.refinement.stamps[(i._currLoadLevel+1)%2]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),1<i._currLoadLevel&&(o.lastTex=1,e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i._webgl.fbo.tex),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),o.curTex=2,e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,i._webgl.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),o.mode=i._currLoadLevel-1,o.repeat=i._repeat.toGL(),e.drawArrays(e.TRIANGLES,0,6),this.stateManager.bindFramebuffer(e.FRAMEBUFFER,i._webgl.fbo.fbo),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),o.mode=0,o.curTex=2,e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,s.tex),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.drawArrays(e.TRIANGLES,0,6),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.disableVertexAttribArray(o.position),this.stateManager.bindFramebuffer(e.FRAMEBUFFER,null),this.stateManager.viewport(0,0,this.canvas.width,this.canvas.height),i._vf.autoRefinement&&i.nextLevel(),i._currLoadLevel==i._vf.maxLevel&&i._currLoadLevel++,i._webgl.fbo.mipMap&&(e.bindTexture(e.TEXTURE_2D,i._webgl.fbo.tex),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)),i.requirePingPong()||(e.deleteTexture(i._webgl.texture),delete i._webgl.texture,i._cleanupGLObjects(!0)),i._renderedImage++)},f.prototype.renderRTPass=function(e,t,i){if(x3dom.isa(i,x3dom.nodeTypes.RefinementTexture))i.requirePingPong()&&this.renderPingPongPass(e,t,i);else{switch(i._vf.update.toUpperCase()){case"NONE":return;case"NEXT_FRAME_ONLY":if(!i._needRenderUpdate)return;i._needRenderUpdate=!1}for(var o,s=t._scene,n=null,r=i.getViewMatrix(),a=i.getProjectionMatrix(),d=a.mult(r),l=t.getLightMatrix()[0],h=t.getWCtoLCMatrix(l),u=i._cf.excludeNodes.nodes,f=u.length,c=new Array(f),_=0;_<f;_++){var m=u[_].renderFlag&&u[_].renderFlag();c[_]=void 0===m?-1:!0===m?1:0,i._cf.excludeNodes.nodes[_]._vf.visible=!1}this.stateManager.bindFramebuffer(e.FRAMEBUFFER,i._webgl.fbo.fbo),this.stateManager.viewport(0,0,i._webgl.fbo.width,i._webgl.fbo.height),null===i._cf.background.node?(e.clearColor(0,0,0,1),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)):(i._cf.background.node===s.getBackground()?n=s.getBackground():(n=i._cf.background.node,this.setupScene(e,n),n))._webgl.render(e,r,a,t),this.stateManager.depthFunc(e.LEQUAL),this.stateManager.enable(e.DEPTH_TEST),this.stateManager.enable(e.CULL_FACE),this.stateManager.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE),this.stateManager.enable(e.BLEND);var p,x=t.getLights(),g=x.length,v=i._cf.scene.node;if(v&&v!==s){l={viewArea:t,sortTrans:s.getEnvironment()._vf.sortTrans,viewMatrix:r,projMatrix:a,sceneMatrix:d,frustumCulling:!1,smallFeatureThreshold:1,context:this,gl:e};if(v.numberOfNodes=0,v.drawableCollection=new x3dom.DrawableCollection(l),v.collectDrawableObjects(x3dom.fields.SFMatrix4f.identity(),v.drawableCollection,!0,!1,0,[]),v.drawableCollection.sort(),o=v.drawableCollection.length,i._vf.showNormals)this.renderNormals(e,v,s._webgl.normalShader,r,d);else for(this.stateManager.unsetProgram(),_=0;_<o;_++)(p=v.drawableCollection.get(_)).shape.renderFlag()&&this.renderShape(p,t,x,g,r,d,h,a,e)}else if(o=s.drawableCollection.length,i._vf.showNormals)this.renderNormals(e,s,s._webgl.normalShader,r,d);else for(this.stateManager.unsetProgram(),_=0;_<o;_++)p=s.drawableCollection.get(_),this.renderShape(p,t,x,g,r,d,h,a,e);for(this.stateManager.disable(e.BLEND),this.stateManager.disable(e.DEPTH_TEST),e.flush(),this.stateManager.bindFramebuffer(e.FRAMEBUFFER,null),i._webgl.fbo.mipMap&&(e.bindTexture(e.TEXTURE_2D,i._webgl.fbo.tex),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)),_=0;_<f;_++)0!==c[_]&&(i._cf.excludeNodes.nodes[_]._vf.visible=!0)}},f.prototype.renderNormals=function(e,t,i,o,s){if(i&&t){this.stateManager.depthFunc(e.LEQUAL),this.stateManager.enable(e.DEPTH_TEST),this.stateManager.enable(e.CULL_FACE),this.stateManager.disable(e.BLEND),this.stateManager.useProgram(i);for(var n=x3dom.fields.SFVec3f.NullVector.toGL(),r=x3dom.fields.SFVec3f.OneVector.toGL(),a=0,d=t.drawableCollection.length;a<d;a++){var l=t.drawableCollection.get(a),h=l.transform,u=l.shape,f=u._webgl;if(f&&u&&u.renderFlag()){var c=u._cf.geometry.node,l=c._mesh,_=o.mult(h).inverse();i.normalMatrix=_.transpose().toGL(),i.modelViewProjectionMatrix=s.mult(h).toGL(),f.coordType!=e.FLOAT?(0!=f.popGeometry||4==l._numPosComponents&&x3dom.Utils.isUnsignedType(c._vf.coordType)?i.bgCenter=c.getMin().toGL():i.bgCenter=c._vf.position.toGL(),i.bgSize=c._vf.size.toGL(),i.bgPrecisionMax=c.getPrecisionMax("coordType")):(i.bgCenter=n,i.bgSize=r,i.bgPrecisionMax=1),f.normalType!=e.FLOAT?i.bgPrecisionNorMax=c.getPrecisionMax("normalType"):i.bgPrecisionNorMax=1,u.isSolid()?(this.stateManager.enable(e.CULL_FACE),u.isCCW()?this.stateManager.frontFace(e.CCW):this.stateManager.frontFace(e.CW)):this.stateManager.disable(e.CULL_FACE);for(var m=0,p=f.positions.length;m<p;m++){var x,g=6*m;if(void 0!==i.position&&f.buffers[g+x3dom.BUFFER_IDX.POSITION]&&f.indexes[m]){if(f.buffers[g+x3dom.BUFFER_IDX.INDEX]&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.buffers[g+x3dom.BUFFER_IDX.INDEX]),this.setVertexAttribPointerPosition(e,u,g,m),this.setVertexAttribPointerNormal(e,u,g,m),0<f.binaryGeometry||0<f.popGeometry)for(x=y=0,T=c._vf.vertexCount.length;y<T;y++)this.drawElements(e,f.primType[y],c._vf.vertexCount[y],f.indexType,x3dom.Utils.getByteAwareOffset(x,f.indexType,e)),x+=c._vf.vertexCount[y];else if(f.binaryGeometry<0||f.popGeometry<0)for(x=y=0,T=c._vf.vertexCount.length;y<T;y++)this.drawArrays(e,f.primType[y],x,c._vf.vertexCount[y]),x+=c._vf.vertexCount[y];else if(indicesReady&&0<f.bufferGeometry)this.drawElements(e,f.primType[0],c._vf.vertexCount[0],f.indexType,u._indexOffset);else if(f.bufferGeometry<0)this.drawArrays(e,f.primType[0],0,c._vf.vertexCount[0]);else if(c.hasIndexOffset())for(var v=u.tessellationProperties(),y=0,T=v.length;y<T;y++)this.drawElements(e,f.primType,v[y].count,f.indexType,v[y].offset*x3dom.Utils.getOffsetMultiplier(f.indexType,e));else 0==f.indexes[m].length?this.drawArrays(e,f.primType,0,f.positions[m].length/3):this.drawElements(e,f.primType,f.indexes[m].length,f.indexType,0);e.disableVertexAttribArray(i.position),void 0!==i.normal&&e.disableVertexAttribArray(i.normal)}}}}}},f.prototype.shutdown=function(e){var t=this.ctx3d,i=e._scene;if(null!=t&&i){e=i.getBackground(),e=(e._webgl&&void 0!==e._webgl.position&&(t.deleteBuffer(e._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),t.deleteBuffer(e._webgl.buffers[x3dom.BUFFER_IDX.POSITION])),i._fgnd);void 0!==e._webgl.position&&(t.deleteBuffer(e._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),t.deleteBuffer(e._webgl.buffers[x3dom.BUFFER_IDX.POSITION]));for(var o=i.drawableCollection?i.drawableCollection.length:0,s=0;s<o;s++){var n=i.drawableCollection.get(s).shape;n._cleanupGLObjects&&n._cleanupGLObjects(!0)}this.cache.Release(t)}},f.prototype.renderShadows=function(e,t,i,o,s,n,r,a){var d=t._scene,l=x3dom.caps.MAX_TEXTURE_IMAGE_UNITS;if(!(l<7)){for(var h,u=1,f=[0],c=0;c<i.length;c++){for(var _=i[c]._vf.shadowFilterSize,m=(h=d._webgl.fboShadow[c]).length,p=0;p<m;p++)this.blurTex(e,d,h[p],_);(u+=6)>l&&(f[f.length]=c,u=7)}f[f.length]=i.length;var x=f.length-1,g=r.inverse(),v=a.inverse();this.stateManager.enable(e.BLEND),this.stateManager.blendFunc(e.DST_COLOR,e.ZERO);for(var y=0;y<x;y++){for(var T=f[y],b=f[y+1],S=[],F=T;F<b;F++)S[S.length]=i[F];var E={};E.FOG=0<d.getFog()._vf.visibilityRange?1:0;var M,C=this.cache.getShadowRenderingShader(e,S,E);this.stateManager.useProgram(C),e.bindBuffer(e.ARRAY_BUFFER,d._webgl.ppBuffer),e.vertexAttribPointer(C.position,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(C.position),C.sceneMap=0,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,d._webgl.fboScene.tex),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),C.inverseProj=g.toGL(),C.inverseViewProj=v.toGL();for(var w=0,A=0,R=S.length;A<R;A++){for(P=s[A+T],M=o[A+T],h=d._webgl.fboShadow[A+T],m=M.length,c=0;c<m;c++)e.activeTexture(e.TEXTURE1+w),e.bindTexture(e.TEXTURE_2D,h[c].tex),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),C["light"+A+"_"+c+"_ShadowMap"]=w+1,C["light"+A+"_"+c+"_Matrix"]=M[c].toGL(),w++;if(C["light"+A+"_ViewMatrix"]=P.toGL(),!x3dom.isa(S[A],x3dom.nodeTypes.PointLight))for(p=0;p<m;p++){var D=Math.max(1,Math.min(S[A]._vf.shadowCascades,6)),N=Math.max(0,Math.min(S[A]._vf.shadowSplitFactor,1)),I=Math.max(0,Math.min(S[A]._vf.shadowSplitOffset,1)),D=t.getShadowSplitDepths(D,N,I,!1,r);C["light"+A+"_"+p+"_Split"]=D[p+1]}var P=n.mult(S[A].getCurrentTransform());x3dom.isa(S[A],x3dom.nodeTypes.DirectionalLight)?(C["light"+A+"_Type"]=0,C["light"+A+"_On"]=S[A]._vf.on?1:0,C["light"+A+"_Direction"]=P.multMatrixVec(S[A]._vf.direction).toGL(),C["light"+A+"_Attenuation"]=[1,1,1],C["light"+A+"_Location"]=[1,1,1],C["light"+A+"_Radius"]=0,C["light"+A+"_BeamWidth"]=0,C["light"+A+"_CutOffAngle"]=0,C["light"+A+"_ShadowIntensity"]=S[A]._vf.shadowIntensity,C["light"+A+"_ShadowCascades"]=S[A]._vf.shadowCascades,C["light"+A+"_ShadowOffset"]=Math.max(0,Math.min(1,S[A]._vf.shadowOffset))):x3dom.isa(S[A],x3dom.nodeTypes.PointLight)?(C["light"+A+"_Type"]=1,C["light"+A+"_On"]=S[A]._vf.on?1:0,C["light"+A+"_Direction"]=[1,1,1],C["light"+A+"_Attenuation"]=S[A]._vf.attenuation.toGL(),C["light"+A+"_Location"]=P.multMatrixPnt(S[A]._vf.location).toGL(),C["light"+A+"_Radius"]=S[A]._vf.radius,C["light"+A+"_BeamWidth"]=0,C["light"+A+"_CutOffAngle"]=0,C["light"+A+"_ShadowIntensity"]=S[A]._vf.shadowIntensity,C["light"+A+"_ShadowOffset"]=Math.max(0,Math.min(1,S[A]._vf.shadowOffset))):x3dom.isa(S[A],x3dom.nodeTypes.SpotLight)&&(C["light"+A+"_Type"]=2,C["light"+A+"_On"]=S[A]._vf.on?1:0,C["light"+A+"_Direction"]=P.multMatrixVec(S[A]._vf.direction).toGL(),C["light"+A+"_Attenuation"]=S[A]._vf.attenuation.toGL(),C["light"+A+"_Location"]=P.multMatrixPnt(S[A]._vf.location).toGL(),C["light"+A+"_Radius"]=S[A]._vf.radius,C["light"+A+"_BeamWidth"]=S[A]._vf.beamWidth,C["light"+A+"_CutOffAngle"]=S[A]._vf.cutOffAngle,C["light"+A+"_ShadowIntensity"]=S[A]._vf.shadowIntensity,C["light"+A+"_ShadowCascades"]=S[A]._vf.shadowCascades,C["light"+A+"_ShadowOffset"]=Math.max(0,Math.min(1,S[A]._vf.shadowOffset)))}E.FOG&&(C.fogType=999),e.drawArrays(e.TRIANGLES,0,6),E.FOG&&(E=d.getFog(),this.stateManager.blendColor(E._vf.color.r,E._vf.color.g,E._vf.color.b,1),this.stateManager.blendFunc(e.CONSTANT_COLOR,e.ONE_MINUS_SRC_COLOR),C.fogColor=E._vf.color.toGL(),C.fogRange=E._vf.visibilityRange,C.fogType="LINEAR"==E._vf.fogType?0:1,e.drawArrays(e.TRIANGLES,0,6));var V=w+1;for(F=0;F<V;F++)e.activeTexture(e.TEXTURE0+F),e.bindTexture(e.TEXTURE_2D,null);e.disableVertexAttribArray(C.position)}this.stateManager.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)}},f.prototype.blurTex=function(e,t,i,o){if(!(o<=0)){o=o<5?3:o<7?5:7;for(var s=i.width,n=i.height,r=null,a=0,d=t._webgl.fboBlur.length;a<d;a++)if(n==t._webgl.fboBlur[a].height){r=t._webgl.fboBlur[a];break}this.stateManager.bindFramebuffer(e.FRAMEBUFFER,r.fbo),this.stateManager.viewport(0,0,s,n),this.stateManager.enable(e.BLEND),this.stateManager.blendFunc(e.ONE,e.ZERO),this.stateManager.disable(e.CULL_FACE),this.stateManager.disable(e.DEPTH_TEST),e.clearColor(1,1,1,0),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var l=this.cache.getShader(e,x3dom.shader.BLUR);this.stateManager.useProgram(l),e.bindBuffer(e.ARRAY_BUFFER,t._webgl.ppBuffer),e.vertexAttribPointer(l.position,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(l.position),l.pixelSizeHor=1/s,l.pixelSizeVert=1/n,l.filterSize=o,l.horizontal=!0,l.texture=0,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.tex),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.drawArrays(e.TRIANGLES,0,6),this.stateManager.bindFramebuffer(e.FRAMEBUFFER,i.fbo),e.clearColor(1,1,1,0),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),l.horizontal=!1,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r.tex),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.drawArrays(e.TRIANGLES,0,6),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),e.disableVertexAttribArray(l.position),e.flush(),this.stateManager.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.stateManager.bindFramebuffer(e.FRAMEBUFFER,null),this.stateManager.viewport(0,0,this.canvas.width,this.canvas.height)}},f.prototype.drawElements=function(e,t,i,o,s,n){n=null==n?1:n,n*=this.VRMode,2==x3dom.caps.WEBGL_VERSION?e.drawElementsInstanced(t,i,o,s,n):x3dom.caps.INSTANCED_ARRAYS?this.ctx3d.getExtension("ANGLE_instanced_arrays").drawElementsInstancedANGLE(t,i,o,s,n):e.drawElements(t,i,o,s)},f.prototype.drawArrays=function(e,t,i,o,s){s=null==s?1:s,s*=this.VRMode,2==x3dom.caps.WEBGL_VERSION?e.drawArraysInstanced(t,i,o,s):x3dom.caps.INSTANCED_ARRAYS?this.ctx3d.getExtension("ANGLE_instanced_arrays").drawArraysInstancedANGLE(t,i,o,s):e.drawArrays(t,i,o)},f.prototype.setVertexAttribEyeIdx=function(e,t){var i;2==x3dom.caps.WEBGL_VERSION&&null!=t.eyeIdx?(this.eyeIdxBuffer?e.bindBuffer(e.ARRAY_BUFFER,this.eyeIdxBuffer):(this.eyeIdxBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.eyeIdxBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1]),e.STATIC_DRAW)),e.vertexAttribPointer(t.eyeIdx,1,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.eyeIdx),e.vertexAttribDivisor(t.eyeIdx,1)):x3dom.caps.INSTANCED_ARRAYS&&null!=t.eyeIdx&&(i=this.ctx3d.getExtension("ANGLE_instanced_arrays"),this.eyeIdxBuffer?e.bindBuffer(e.ARRAY_BUFFER,this.eyeIdxBuffer):(this.eyeIdxBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.eyeIdxBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1]),e.STATIC_DRAW)),e.vertexAttribPointer(t.eyeIdx,1,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.eyeIdx),i.vertexAttribDivisorANGLE(t.eyeIdx,1))},f.prototype.disableVertexAttribEyeIdx=function(e,t){var i;2==x3dom.caps.WEBGL_VERSION&&null!=t.eyeIdx?(e.disableVertexAttribArray(t.eyeIdx),e.vertexAttribDivisor(t.eyeIdx,0)):x3dom.caps.INSTANCED_ARRAYS&&null!=t.eyeIdx&&(i=this.ctx3d.getExtension("ANGLE_instanced_arrays"),e.disableVertexAttribArray(t.eyeIdx),i.vertexAttribDivisorANGLE(t.eyeIdx,0))},f.prototype.setVertexAttribPointerPosition=function(e,t,i,o){var s,n=t._webgl.shader;void 0!==n.position&&t._webgl.buffers[i+x3dom.BUFFER_IDX.POSITION]&&(s=t._cf.geometry.node,e.bindBuffer(e.ARRAY_BUFFER,t._webgl.buffers[i+x3dom.BUFFER_IDX.POSITION]),e.vertexAttribPointer(n.position,s._mesh._numPosComponents,t._webgl.coordType,t._webgl.coordNormalized,t._coordStrideOffset[0],t._coordStrideOffset[1]),e.enableVertexAttribArray(n.position))},f.prototype.setVertexAttribPointerNormal=function(e,t,i,o){var s,n=t._webgl.shader;void 0!==n.normal&&t._webgl.buffers[i+x3dom.BUFFER_IDX.NORMAL]&&(s=t._cf.geometry.node,e.bindBuffer(e.ARRAY_BUFFER,t._webgl.buffers[i+x3dom.BUFFER_IDX.NORMAL]),e.vertexAttribPointer(n.normal,s._mesh._numNormComponents,t._webgl.normalType,t._webgl.normalNormalized,t._normalStrideOffset[0],t._normalStrideOffset[1]),e.enableVertexAttribArray(n.normal))},f.prototype.setVertexAttribPointerTexCoord=function(e,t,i,o){var s,n=t._webgl.shader;void 0!==n.texcoord&&t._webgl.buffers[i+x3dom.BUFFER_IDX.TEXCOORD]&&(s=t._cf.geometry.node,e.bindBuffer(e.ARRAY_BUFFER,t._webgl.buffers[i+x3dom.BUFFER_IDX.TEXCOORD]),e.vertexAttribPointer(n.texcoord,s._mesh._numTexComponents,t._webgl.texCoordType,t._webgl.texCoordNormalized,t._texCoordStrideOffset[0],t._texCoordStrideOffset[1]),e.enableVertexAttribArray(n.texcoord))},f.prototype.setVertexAttribPointerTexCoord2=function(e,t,i,o){var s,n=t._webgl.shader;void 0!==n.texcoord2&&t._webgl.buffers[i+x3dom.BUFFER_IDX.TEXCOORD_1]&&(s=t._cf.geometry.node,e.bindBuffer(e.ARRAY_BUFFER,t._webgl.buffers[i+x3dom.BUFFER_IDX.TEXCOORD_1]),e.vertexAttribPointer(n.texcoord2,s._mesh._numTex2Components,t._webgl.texCoord2Type,t._webgl.texCoord2Normalized,t._texCoord2StrideOffset[0],t._texCoord2StrideOffset[1]),e.enableVertexAttribArray(n.texcoord2))},f.prototype.setVertexAttribPointerColor=function(e,t,i,o){var s,n=t._webgl.shader;void 0!==n.color&&t._webgl.buffers[i+x3dom.BUFFER_IDX.COLOR]&&(s=t._cf.geometry.node,e.bindBuffer(e.ARRAY_BUFFER,t._webgl.buffers[i+x3dom.BUFFER_IDX.COLOR]),e.vertexAttribPointer(n.color,s._mesh._numColComponents,t._webgl.colorType,t._webgl.colorNormalized,t._colorStrideOffset[0],t._colorStrideOffset[1]),e.enableVertexAttribArray(n.color))},f.prototype.setVertexAttribPointerTangent=function(e,t,i,o){var s,n=t._webgl.shader;void 0!==n.tangent&&t._webgl.buffers[i+x3dom.BUFFER_IDX.TANGENT]&&(s=t._cf.geometry.node,e.bindBuffer(e.ARRAY_BUFFER,t._webgl.buffers[i+x3dom.BUFFER_IDX.TANGENT]),e.vertexAttribPointer(n.tangent,s._mesh._numTangentComponents,t._webgl.tangentType,t._webgl.tangentNormalized,t._tangentStrideOffset[0],t._tangentStrideOffset[1]),e.enableVertexAttribArray(n.tangent))},f.prototype.setVertexAttribPointerBinormal=function(e,t,i,o){var s,n=t._webgl.shader;void 0!==n.binormal&&t._webgl.buffers[i+x3dom.BUFFER_IDX.BITANGENT]&&(s=t._cf.geometry.node,e.bindBuffer(e.ARRAY_BUFFER,t._webgl.buffers[i+x3dom.BUFFER_IDX.BITANGENT]),e.vertexAttribPointer(n.binormal,s._mesh._numBinormalComponents,t._webgl.binormalType,t._webgl.binormalNormalized,t._binormalStrideOffset[0],t._binormalStrideOffset[1]),e.enableVertexAttribArray(n.binormal))},f.prototype.setTonemappingOperator=function(e,t){switch(e._scene.getEnvironment()._vf.tonemapping){case"none":t.tonemappingOperator=0;break;case"reinhard":t.tonemappingOperator=1;break;case"uncharted":t.tonemappingOperator=2;break;case"filmic":t.tonemappingOperator=3;break;default:t.tonemappingOperator=0}},function(e,t){var i=["webgl2","webgl","experimental-webgl","moz-webgl","webkit-3d"],o=/mac|ip(hone|od|ad)/i.test(navigator.platform),s=/safari/i.test(navigator.userAgent),n=/trident\//i.test(navigator.userAgent);o&&i.splice(0,1);for(var r=null,a=t.getElementsByTagName("Environment"),d={alpha:!0,depth:!0,stencil:!0,antialias:!(a&&a[0]&&a[0].hasAttribute("SSAO")&&"true"===a[0].getAttribute("SSAO").toLowerCase()),premultipliedAlpha:!1,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0},l=0;l<i.length;l++)try{if(x3dom.caps.RENDERMODE="HARDWARE ("+i[l]+")",(r=e.getContext(i[l],d))||(x3dom.caps.RENDERMODE="SOFTWARE",d.failIfMajorPerformanceCaveat=!1,r=e.getContext(i[l],d),d.failIfMajorPerformanceCaveat=!0),r){var h=new f(r,e,"webgl",t);try{x3dom.caps.VENDOR=r.getParameter(r.VENDOR),x3dom.caps.VERSION=r.getParameter(r.VERSION),x3dom.caps.WEBGL_VERSION=-1===x3dom.caps.VERSION.indexOf("WebGL 2.0")?1:2,x3dom.caps.RENDERER=r.getParameter(r.RENDERER),x3dom.caps.SHADING_LANGUAGE_VERSION=r.getParameter(r.SHADING_LANGUAGE_VERSION),x3dom.caps.RED_BITS=r.getParameter(r.RED_BITS),x3dom.caps.GREEN_BITS=r.getParameter(r.GREEN_BITS),x3dom.caps.BLUE_BITS=r.getParameter(r.BLUE_BITS),x3dom.caps.ALPHA_BITS=r.getParameter(r.ALPHA_BITS),x3dom.caps.DEPTH_BITS=r.getParameter(r.DEPTH_BITS),x3dom.caps.MAX_VERTEX_ATTRIBS=r.getParameter(r.MAX_VERTEX_ATTRIBS),x3dom.caps.MAX_VERTEX_TEXTURE_IMAGE_UNITS=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x3dom.caps.MAX_VARYING_VECTORS=r.getParameter(r.MAX_VARYING_VECTORS),x3dom.caps.MAX_VERTEX_UNIFORM_VECTORS=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),x3dom.caps.MAX_COMBINED_TEXTURE_IMAGE_UNITS=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS),x3dom.caps.MAX_TEXTURE_SIZE=r.getParameter(r.MAX_TEXTURE_SIZE),x3dom.caps.MAX_TEXTURE_IMAGE_UNITS=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),x3dom.caps.MAX_CUBE_MAP_TEXTURE_SIZE=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),x3dom.caps.COMPRESSED_TEXTURE_FORMATS=r.getParameter(r.COMPRESSED_TEXTURE_FORMATS),x3dom.caps.MAX_RENDERBUFFER_SIZE=r.getParameter(r.MAX_RENDERBUFFER_SIZE),x3dom.caps.MAX_VIEWPORT_DIMS=r.getParameter(r.MAX_VIEWPORT_DIMS),x3dom.caps.ALIASED_LINE_WIDTH_RANGE=r.getParameter(r.ALIASED_LINE_WIDTH_RANGE),x3dom.caps.ALIASED_POINT_SIZE_RANGE=r.getParameter(r.ALIASED_POINT_SIZE_RANGE),x3dom.caps.SAMPLES=r.getParameter(r.SAMPLES),x3dom.caps.COMPRESSED_TEXTURE=r.getExtension("WEBGL_compressed_texture_s3tc"),x3dom.caps.INDEX_UINT=r.getExtension("OES_element_index_uint"),x3dom.caps.FP_TEXTURES=r.getExtension("OES_texture_float"),x3dom.caps.FPL_TEXTURES=r.getExtension("OES_texture_float_linear"),x3dom.caps.HFP_TEXTURES=r.getExtension("OES_texture_half_float"),x3dom.caps.COLOR_BUFFER_FLOAT=r.getExtension("WEBGL_color_buffer_float"),x3dom.caps.HFPL_TEXTURES=r.getExtension("OES_texture_half_float_linear"),x3dom.caps.STD_DERIVATIVES=r.getExtension("OES_standard_derivatives"),x3dom.caps.DRAW_BUFFERS=r.getExtension("WEBGL_draw_buffers"),x3dom.caps.DEPTH_TEXTURE=r.getExtension("WEBGL_depth_texture"),x3dom.caps.DEBUGRENDERINFO=r.getExtension("WEBGL_debug_renderer_info"),x3dom.caps.ANISOTROPIC=r.getExtension("EXT_texture_filter_anisotropic"),x3dom.caps.TEXTURE_LOD=r.getExtension("EXT_shader_texture_lod"),x3dom.caps.INSTANCED_ARRAYS=r.getExtension("ANGLE_instanced_arrays"),x3dom.caps.ANISOTROPIC&&(x3dom.caps.MAX_ANISOTROPY=r.getParameter(x3dom.caps.ANISOTROPIC.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),x3dom.caps.EXTENSIONS=r.getSupportedExtensions(),x3dom.Utils.isWebGL2Enabled()&&(x3dom.caps.DEPTH_TEXTURE=null,x3dom.caps.INDEX_UINT=!0),x3dom.caps.DEBUGRENDERINFO?(x3dom.caps.UNMASKED_RENDERER_WEBGL=r.getParameter(x3dom.caps.DEBUGRENDERINFO.UNMASKED_RENDERER_WEBGL),x3dom.caps.UNMASKED_VENDOR_WEBGL=r.getParameter(x3dom.caps.DEBUGRENDERINFO.UNMASKED_VENDOR_WEBGL)):(x3dom.caps.UNMASKED_RENDERER_WEBGL="",x3dom.caps.UNMASKED_VENDOR_WEBGL="");var u=x3dom.caps.EXTENSIONS.toString().replace(/,/g,", ");x3dom.debug.logInfo(i[l]+" context found\nVendor: "+x3dom.caps.VENDOR+" "+x3dom.caps.UNMASKED_VENDOR_WEBGL+", Renderer: "+x3dom.caps.RENDERER+" "+x3dom.caps.UNMASKED_RENDERER_WEBGL+", Version: "+x3dom.caps.VERSION+", ShadingLangV.: "+x3dom.caps.SHADING_LANGUAGE_VERSION+", MSAA samples: "+x3dom.caps.SAMPLES+"\nExtensions: "+u),x3dom.caps.INDEX_UINT&&(x3dom.Utils.maxIndexableCoords=4294967295),o&&(x3dom.caps.HFP_TEXTURES=!1,x3dom.caps.FP_TEXTURES=!1),s&&(x3dom.caps.TEXTURE_LOD=!1),n&&(x3dom.caps.INSTANCED_ARRAYS=!1)}catch(e){x3dom.debug.logWarning("Your browser probably supports an older WebGL version."),h=null}return h}}catch(e){x3dom.debug.logWarning(e)}return null}})(),x3dom.SSAO={},x3dom.SSAO.isEnabled=function(e){return e.getEnvironment()._vf.SSAO},x3dom.SSAO.reinitializeShadersIfNecessary=function(e){void 0===x3dom.SSAO.shaderProgram&&(x3dom.SSAO.shaderProgram=x3dom.Utils.wrapProgram(e,new x3dom.shader.SSAOShader(e),"ssao")),void 0===x3dom.SSAO.blurShaderProgram&&(x3dom.SSAO.blurShaderProgram=x3dom.Utils.wrapProgram(e,new x3dom.shader.SSAOBlurShader(e),"ssao-blur"))},x3dom.SSAO.reinitializeRandomTextureIfNecessary=function(e,t){var i=t.getEnvironment()._vf.SSAOrandomTextureSize!=x3dom.SSAO.currentRandomTextureSize;if(void 0===x3dom.SSAO.randomTexture&&(x3dom.SSAO.randomTexture=e.createTexture()),void 0===x3dom.SSAO.randomTexture||i){e.bindTexture(e.TEXTURE_2D,x3dom.SSAO.randomTexture);for(var o=x3dom.SSAO.currentRandomTextureSize=t.getEnvironment()._vf.SSAOrandomTextureSize,i=new ArrayBuffer(o*o*4),s=new Uint8Array(i),n=0;n<o*o;++n){var r=2*Math.random()-1,a=2*Math.random()-1,d=Math.sqrt(r*r+a*a);r/=d,a/=d,s[4*n]=.5*(1+r)*255,s[4*n+1]=.5*(1+a)*255,s[4*n+2]=127.5,s[4*n+3]=255}e.texImage2D(e.TEXTURE_2D,0,e.RGBA,o,o,0,e.RGBA,e.UNSIGNED_BYTE,s),e.bindTexture(e.TEXTURE_2D,null)}},x3dom.SSAO.reinitializeFBOIfNecessary=function(e,t){var i=x3dom.SSAO.currentFBOWidth!=t.width||x3dom.SSAO.currentFBOHeight!=t.height;void 0!==x3dom.SSAO.fbo&&!i||(x3dom.SSAO.currentFBOWidth=t.width,x3dom.SSAO.currentFBOHeight=t.height,i=e.getParameter(e.FRAMEBUFFER_BINDING),void 0===x3dom.SSAO.fbo&&(x3dom.SSAO.fbo=e.createFramebuffer()),e.bindFramebuffer(e.FRAMEBUFFER,x3dom.SSAO.fbo),void 0===x3dom.SSAO.fbotex&&(x3dom.SSAO.fbotex=e.createTexture()),e.bindTexture(e.TEXTURE_2D,x3dom.SSAO.fbotex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,x3dom.SSAO.currentFBOWidth,x3dom.SSAO.currentFBOHeight,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,x3dom.SSAO.fbotex,0),e.bindFramebuffer(e.FRAMEBUFFER,i))},x3dom.SSAO.render=function(e,t,i,o,s,n){var r=t.getParameter(t.FRAMEBUFFER_BINDING),a=(null!=n&&t.bindFramebuffer(t.FRAMEBUFFER,n),e.frontFace(t.CCW),e.disable(t.CULL_FACE),e.disable(t.DEPTH_TEST),x3dom.SSAO.shaderProgram),e=(e.useProgram(a),a.depthTexture=0,a.randomTexture=1,a.radius=i.getEnvironment()._vf.SSAOradius,a.randomTextureTilingFactor=[s.width/x3dom.SSAO.currentRandomTextureSize,s.height/x3dom.SSAO.currentRandomTextureSize],i.getViewpoint()),s=e.getNear(),e=e.getFar();a.nearPlane=s,a.farPlane=e,a.depthReconstructionConstantA=(e+s)/(s-e),a.depthReconstructionConstantB=2*e*s/(s-e),a.depthBufferEpsilon=1e-4*(e-s),a.samples=[.03800223814729654,.10441029119843426,-.04479934806797181,-.03800223814729654,-.10441029119843426,.04479934806797181,-.17023209847088397,.1428416910414532,.6154407640895228,.17023209847088397,-.1428416910414532,-.6154407640895228,-.288675134594813,-.16666666666666646,-.3774214123135722,.288675134594813,.16666666666666646,.3774214123135722,.07717696785196887,-.43769233467209245,-.5201284112706428,-.07717696785196887,.43769233467209245,.5201284112706428,.5471154183401156,-.09647120981496134,-.15886420745887797,-.5471154183401156,.09647120981496134,.15886420745887797,.3333333333333342,.5773502691896253,-.8012446019636266,-.3333333333333342,-.5773502691896253,.8012446019636266,-.49994591864508653,.5958123446480936,-.15385106176844343,.49994591864508653,-.5958123446480936,.15385106176844343,-.8352823295874743,-.3040179051783715,.7825440557226517,.8352823295874743,.3040179051783715,-.7825440557226517],a.tex||(a.tex=0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,x3dom.SSAO.randomTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i._fgnd._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),t.bindBuffer(t.ARRAY_BUFFER,i._fgnd._webgl.buffers[x3dom.BUFFER_IDX.POSITION]),t.vertexAttribPointer(a.position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a.position),t.drawElements(i._fgnd._webgl.primType,i._fgnd._webgl.indexes.length,t.UNSIGNED_SHORT,0),t.disableVertexAttribArray(a.position),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),null!=n&&t.bindFramebuffer(t.FRAMEBUFFER,r)},x3dom.SSAO.blur=function(e,t,i,o,s,n,r){var a=t.getParameter(t.FRAMEBUFFER_BINDING),d=(null!=r&&t.bindFramebuffer(t.FRAMEBUFFER,r),e.frontFace(t.CCW),e.disable(t.CULL_FACE),e.disable(t.DEPTH_TEST),x3dom.SSAO.blurShaderProgram),e=(e.useProgram(d),d.SSAOTexture=0,d.depthTexture=1,d.depthThreshold=i.getEnvironment()._vf.SSAOblurDepthTreshold,i.getViewpoint()),l=e.getNear(),e=e.getFar();d.nearPlane=l,d.farPlane=e,d.depthReconstructionConstantA=(e+l)/(l-e),d.depthReconstructionConstantB=2*e*l/(l-e),d.pixelSize=[1/n.width,1/n.height],d.amount=i.getEnvironment()._vf.SSAOamount,t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i._fgnd._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),t.bindBuffer(t.ARRAY_BUFFER,i._fgnd._webgl.buffers[x3dom.BUFFER_IDX.POSITION]),t.vertexAttribPointer(d.position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(d.position),t.drawElements(i._fgnd._webgl.primType,i._fgnd._webgl.indexes.length,t.UNSIGNED_SHORT,0),t.disableVertexAttribArray(d.position),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),null!=r&&t.bindFramebuffer(t.FRAMEBUFFER,a)},x3dom.SSAO.renderSSAO=function(e,t,i,o){this.reinitializeShadersIfNecessary(t),this.reinitializeRandomTextureIfNecessary(t,i),this.reinitializeFBOIfNecessary(t,o),e.viewport(0,0,o.width,o.height),this.render(e,t,i,i._webgl.fboScene.tex,o,x3dom.SSAO.fbo),t.enable(t.BLEND),t.blendFunc(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA),this.blur(e,t,i,x3dom.SSAO.fbotex,i._webgl.fboScene.tex,o,null),t.disable(t.BLEND)},x3dom.runtime={},x3dom.Runtime=function(e,t){this.doc=e,this.canvas=t,this.config={},this.isReady=!1,this.fps=0,this.VRMode=!1,this.states={measurements:[],infos:[]}},x3dom.Runtime.prototype.addMeasurement=function(e,t){this.states.measurements[e]=t},x3dom.Runtime.prototype.removeMeasurement=function(e){this.states.measurements[e]&&delete this.states.measurements[e]},x3dom.Runtime.prototype.addInfo=function(e,t){this.states.infos[e]=t},x3dom.Runtime.prototype.removeInfo=function(e){delete this.states.infos[e]},x3dom.Runtime.prototype.initialize=function(e,t){this.doc=e,this.canvas=t,this.config={},this.isReady=!1,this.fps=0},x3dom.Runtime.prototype.noBackendFound=function(){x3dom.debug.logInfo("No backend found. Unable to render.")},x3dom.Runtime.prototype.ready=function(){x3dom.debug.logInfo("System ready.")},x3dom.Runtime.prototype.enterFrame=function(){},x3dom.Runtime.prototype.exitFrame=function(){},x3dom.Runtime.prototype.triggerRedraw=function(){this.canvas.doc.needRender=!0},x3dom.Runtime.prototype.getActiveBindable=function(e){var t,i,o,s=this.canvas.doc._bindableBag._stacks,n=[];if(!(o=x3dom.nodeTypesLC[e.toLowerCase()]))return x3dom.debug.logError('No node of type "'+e+'" found.'),null;for(t=0;t<s.length;t++)void 0!==(i=s[t].getActive())._xmlNode&&x3dom.isa(i,o)&&n.push(i);return n[0]?n[0]._xmlNode:null},x3dom.Runtime.prototype.nextView=function(){var e=this.canvas.doc._scene.getViewpoint()._stack;e?e.switchTo("next"):x3dom.debug.logError("No valid ViewBindable stack.")},x3dom.Runtime.prototype.prevView=function(){var e=this.canvas.doc._scene.getViewpoint()._stack;e?e.switchTo("prev"):x3dom.debug.logError("No valid ViewBindable stack.")},x3dom.Runtime.prototype.viewpoint=function(){return this.canvas.doc._scene.getViewpoint()},x3dom.Runtime.prototype.viewMatrix=function(){return this.canvas.doc._viewarea.getViewMatrix()},x3dom.Runtime.prototype.projectionMatrix=function(){return this.canvas.doc._viewarea.getProjectionMatrix()},x3dom.Runtime.prototype.getWorldToCameraCoordinatesMatrix=function(){return this.canvas.doc._viewarea.getWCtoCCMatrix()},x3dom.Runtime.prototype.getCameraToWorldCoordinatesMatrix=function(){return this.canvas.doc._viewarea.getCCtoWCMatrix()},x3dom.Runtime.prototype.getViewingRay=function(e,t){return this.canvas.doc._viewarea.calcViewRay(e,t)},x3dom.Runtime.prototype.shootRay=function(e,t){var i=this.canvas.doc,o=i._viewarea._pickingInfo;return i.onPick(this.canvas.gl,e,t),{pickPosition:o.pickObj?o.pickPos:null,pickNormal:o.pickObj?o.pickNorm:null,pickObject:o.pickObj?o.pickObj._xmlNode:null}},x3dom.Runtime.prototype.getWidth=function(){return this.canvas.doc._viewarea._width},x3dom.Runtime.prototype.getHeight=function(){return this.canvas.doc._viewarea._height},x3dom.Runtime.prototype.mousePosition=function(e){e=this.canvas.mousePosition(e);return[e.x,e.y]},x3dom.Runtime.prototype.calcCanvasPos=function(e,t,i){var o=window.devicePixelRatio||1,e=new x3dom.fields.SFVec3f(e,t,i),t=this.canvas.doc._viewarea.getWCtoCCMatrix().multFullMatrixPnt(e),i=this.canvas.doc._viewarea._width/o,e=this.canvas.doc._viewarea._height/o;return[Math.round((t.x+1)*(i-1)/2),Math.round((e-1)*(1-t.y)/2)]},x3dom.Runtime.prototype.calcPagePos=x3dom.Runtime.prototype.calcCanvasPos,x3dom.Runtime.prototype.getBBoxPoints=function(){var e=this.canvas.doc._scene;return e.updateVolume(),[{x:e._lastMin.x,y:e._lastMin.y,z:e._lastMin.z},{x:e._lastMax.x,y:e._lastMin.y,z:e._lastMin.z},{x:e._lastMin.x,y:e._lastMax.y,z:e._lastMin.z},{x:e._lastMax.x,y:e._lastMax.y,z:e._lastMin.z},{x:e._lastMin.x,y:e._lastMin.y,z:e._lastMax.z},{x:e._lastMax.x,y:e._lastMin.y,z:e._lastMax.z},{x:e._lastMin.x,y:e._lastMax.y,z:e._lastMax.z},{x:e._lastMax.x,y:e._lastMax.y,z:e._lastMax.z}]},x3dom.Runtime.prototype.getSceneBRect=function(){for(var e={x:Number.MAX_VALUE,y:Number.MAX_VALUE},t={x:Number.MIN_VALUE,y:Number.MIN_VALUE},i=this.getBBoxPoints(),o=0;o<i.length;o++){var s=this.calcCanvasPos(i[o].x,i[o].y,i[o].z);e.x=s[0]<e.x?s[0]:e.x,e.y=s[1]<e.y?s[1]:e.y,t.x=t.x<s[0]?s[0]:t.x,t.y=t.y<s[1]?s[1]:t.y}return{x:e.x,y:e.y,width:t.x-e.x,height:t.y-e.y}},x3dom.Runtime.prototype.calcClientPos=function(e,t,i){var o,s,n=this.canvas.canvas.offsetParent;return n?(o=n.getBoundingClientRect(),e=this.calcCanvasPos(e,t,i),t=document.defaultView.getComputedStyle(n,null),i=parseFloat(t.getPropertyValue("padding-left")),n=parseFloat(t.getPropertyValue("border-left-width")),s=parseFloat(t.getPropertyValue("padding-top")),t=parseFloat(t.getPropertyValue("border-top-width")),[o.left+i+n+e[0],o.top+s+t+e[1]]):(x3dom.debug.logError("Can't calc client pos without offsetParent."),[0,0])},x3dom.Runtime.prototype.getScreenshot=function(){var e,t="",i=this.canvas.backend,o=this.canvas.canvas;return t=o?"flash"==i?o.getScreenshot():((i=document.createElement("canvas")).width=o.width,i.height=o.height,(e=i.getContext("2d")).drawImage(o,0,0,o.width,o.height),e.scale(1,-1),e.translate(0,-o.height),i.toDataURL()):t},x3dom.Runtime.prototype.getCanvas=function(){return this.canvas.canvas},x3dom.Runtime.prototype.lightMatrix=function(){this.canvas.doc._viewarea.getLightMatrix()},x3dom.Runtime.prototype.resetView=function(){this.canvas.doc._viewarea.resetView()},x3dom.Runtime.prototype.lightView=function(){return 0<this.canvas.doc._nodeBag.lights.length?(this.canvas.doc._viewarea.animateTo(this.canvas.doc._viewarea.getLightMatrix()[0],this.canvas.doc._scene.getViewpoint()),!0):(x3dom.debug.logInfo("No lights to navigate to."),!1)},x3dom.Runtime.prototype.uprightView=function(){this.canvas.doc._viewarea.uprightView()},x3dom.Runtime.prototype.fitAll=function(e){void 0===e&&(e=!0);var t=this.canvas.doc._scene;t.updateVolume(),this.canvas.doc._viewarea.fit(t._lastMin,t._lastMax,e)},x3dom.Runtime.prototype.fitObject=function(e,t){var i,o,s;e&&e._x3domNode&&(void 0===t&&(t=!0),o=x3dom.fields.SFVec3f.MAX(),s=x3dom.fields.SFVec3f.MIN(),e._x3domNode.getVolume().getBounds(o,s),o=(i=e._x3domNode.getCurrentTransform()).multMatrixPnt(o),s=i.multMatrixPnt(s),x3dom.isa(e._x3domNode,x3dom.nodeTypes.X3DTransformNode)&&(o=(i=e._x3domNode._trafo.inverse()).multMatrixPnt(o),s=i.multMatrixPnt(s)),this.canvas.doc._viewarea.fit(o,s,t))},x3dom.Runtime.prototype.showAll=function(e,t){this.canvas.doc._viewarea.showAll(e,t)},x3dom.Runtime.prototype.showObject=function(e,t){if(e&&e._x3domNode){void 0===t&&(t="negZ");var i,o=x3dom.fields.SFVec3f.MAX(),s=x3dom.fields.SFVec3f.MIN(),e=(e._x3domNode.getVolume().getBounds(o,s),e._x3domNode.getCurrentTransform()),o=e.multMatrixPnt(o),s=e.multMatrixPnt(s),n=this.canvas.doc._viewarea,r=n._width<n._height?n._width:n._height;switch(t){case"posX":i=new x3dom.fields.SFVec3f(1,0,0);break;case"negX":i=new x3dom.fields.SFVec3f(-1,0,0);break;case"posY":i=new x3dom.fields.SFVec3f(0,1,0);break;case"negY":i=new x3dom.fields.SFVec3f(0,-1,0);break;case"posZ":i=new x3dom.fields.SFVec3f(0,0,1);break;case"negZ":i=new x3dom.fields.SFVec3f(0,0,-1)}var t=this.canvas.doc._scene.getViewpoint(),a=t.getFieldOfView()/2,a=Math.tan(a),a=(Math.abs(a)>x3dom.fields.Eps&&(r/=a),n._width-1),d=n._height-1,l=new x3dom.fields.SFVec2f(.25*a,.25*d),a=new x3dom.fields.SFVec2f(.75*a,.75*d),d=s.subtract(o).multiply(.5),s=d.length(),o=o.add(d),a=1.5*(d=a.subtract(l).multiply(.5)).length(),d=d.add(l),l=1,s=(a>x3dom.fields.Eps&&(l=s/a*Math.sqrt(d.x*d.x+d.y*d.y+r*r)),i=(i=e.multMatrixVec(i).normalize()).multiply(l),o.add(i)),a=x3dom.fields.Quaternion.rotateFromTo(new x3dom.fields.SFVec3f(0,0,1),i).toMatrix(),d=x3dom.fields.SFMatrix4f.translation(s.negate()),r=x3dom.fields.SFMatrix4f.translation(s),e=(r=r.mult(a).mult(d).mult(r)).inverse();n.animateTo(e,t)}},x3dom.Runtime.prototype.animateViewpointTo=function(e,t){var i=this.canvas.doc._viewarea,o=this.canvas.doc._scene.getViewpoint();null!=e._x3domNode&&(e=e._x3domNode),i.animateTo(e,o,t)},x3dom.Runtime.prototype.getCenter=function(e){return e&&e._x3domNode&&(this.isA(e,"X3DShapeNode")||this.isA(e,"X3DGeometryNode"))?e._x3domNode.getCenter():null},x3dom.Runtime.prototype.getCurrentTransform=function(e){return e&&e._x3domNode?e._x3domNode.getCurrentTransform():null},x3dom.Runtime.prototype.getBBox=function(e){return e&&e._x3domNode&&this.isA(e,"X3DBoundedObject")?(e=e._x3domNode.getVolume(),{min:x3dom.fields.SFVec3f.copy(e.min),max:x3dom.fields.SFVec3f.copy(e.max)}):null},x3dom.Runtime.prototype.getSceneBBox=function(){var e=this.canvas.doc._scene;return e.updateVolume(),{min:x3dom.fields.SFVec3f.copy(e._lastMin),max:x3dom.fields.SFVec3f.copy(e._lastMax)}},x3dom.Runtime.prototype.debug=function(e){var t=this.canvas.doc;return void 0===t._viewarea._visDbgBuf&&(t._viewarea._visDbgBuf="true"===t._x3dElem.getAttribute("showLog")),0<arguments.length?!0===e?(t._viewarea._visDbgBuf=!0,x3dom.debug.logContainer.style.display="block"):(t._viewarea._visDbgBuf=!1,x3dom.debug.logContainer.style.display="none"):(t._viewarea._visDbgBuf=!t._viewarea._visDbgBuf,x3dom.debug.logContainer.style.display=1==t._viewarea._visDbgBuf?"block":"none"),t.needRender=!0,t._viewarea._visDbgBuf},x3dom.Runtime.prototype.navigationType=function(){return this.canvas.doc._scene.getNavigationInfo().getType()},x3dom.Runtime.prototype.noNav=function(){this.canvas.doc._scene.getNavigationInfo().setType("none")},x3dom.Runtime.prototype.examine=function(){this.canvas.doc._scene.getNavigationInfo().setType("examine")},x3dom.Runtime.prototype.turnTable=function(){this.canvas.doc._scene.getNavigationInfo().setType("turntable")},x3dom.Runtime.prototype.fly=function(){this.canvas.doc._scene.getNavigationInfo().setType("fly")},x3dom.Runtime.prototype.freeFly=function(){this.canvas.doc._scene.getNavigationInfo().setType("freefly")},x3dom.Runtime.prototype.lookAt=function(){this.canvas.doc._scene.getNavigationInfo().setType("lookat")},x3dom.Runtime.prototype.lookAround=function(){this.canvas.doc._scene.getNavigationInfo().setType("lookaround")},x3dom.Runtime.prototype.walk=function(){this.canvas.doc._scene.getNavigationInfo().setType("walk")},x3dom.Runtime.prototype.game=function(){this.canvas.doc._scene.getNavigationInfo().setType("game")},x3dom.Runtime.prototype.helicopter=function(){this.canvas.doc._scene.getNavigationInfo().setType("helicopter")},x3dom.Runtime.prototype.resetExamin=function(){var e=this.canvas.doc._viewarea;e._rotMat=x3dom.fields.SFMatrix4f.identity(),e._transMat=x3dom.fields.SFMatrix4f.identity(),e._movement=new x3dom.fields.SFVec3f(0,0,0),e._needNavigationMatrixUpdate=!0,this.canvas.doc.needRender=!0},x3dom.Runtime.prototype.disableKeys=function(){this.canvas.disableKeys=!0},x3dom.Runtime.prototype.enableKeys=function(){this.canvas.disableKeys=!1},x3dom.Runtime.prototype.disableLeftDrag=function(){this.canvas.disableLeftDrag=!0},x3dom.Runtime.prototype.enableLeftDrag=function(){this.canvas.disableLeftDrag=!1},x3dom.Runtime.prototype.disableRightDrag=function(){this.canvas.disableRightDrag=!0},x3dom.Runtime.prototype.enableRightDrag=function(){this.canvas.disableRightDrag=!1},x3dom.Runtime.prototype.disableMiddleDrag=function(){this.canvas.disableMiddleDrag=!0},x3dom.Runtime.prototype.enableMiddleDrag=function(){this.canvas.disableMiddleDrag=!1},x3dom.Runtime.prototype.togglePoints=function(e){var t=this.canvas.doc,e=!0===e?3:2;return t._viewarea._points=++t._viewarea._points%e,t.needRender=!0,t._viewarea._points},x3dom.Runtime.prototype.pickRect=function(e,t,i,o){return this.canvas.doc.onPickRect(this.canvas.gl,e,t,i,o)},x3dom.Runtime.prototype.pickMode=function(e){return e&&!0===e.internal?this.canvas.doc._scene._vf.pickMode:this.canvas.doc._scene._vf.pickMode.toLowerCase()},x3dom.Runtime.prototype.changePickMode=function(e){switch(e=e.toLowerCase()){case"idbuf":e="idBuf";break;case"idbuf24":e="idBuf24";break;case"idbufid":e="idBufId";break;case"texcoord":e="texCoord";break;case"color":e="color";break;case"box":e="box";break;default:x3dom.debug.logWarning("Switch pickMode to "+e+" unknown intersect type"),e=void 0}return void 0!==e&&(this.canvas.doc._scene._vf.pickMode=e,x3dom.debug.logInfo("Switched pickMode to '"+e+"'."),!0)},x3dom.Runtime.prototype.speed=function(e){var t=this.canvas.doc._scene.getNavigationInfo();return e&&(t._vf.speed=e,x3dom.debug.logInfo("Changed navigation speed to "+t._vf.speed)),t._vf.speed},x3dom.Runtime.prototype.zoom=function(e){this.canvas.doc._viewarea.zoom(e),this.canvas.doc.needRender=!0},x3dom.Runtime.prototype.statistics=function(e){var t=this.canvas.stateViewer;return!!t&&((this.canvas.doc.needRender=!0)===e?(t.display(e),!0):!1===e?(t.display(e),!1):(t.display(!t.active),t.active))},x3dom.Runtime.prototype.processIndicator=function(e){var t=this.canvas.progressDiv;return!!t&&(!0===e?(t.style.display="flex",!0):!1===e?!(t.style.display="none"):"none"!=t.style.display)},x3dom.Runtime.prototype.properties=function(){return this.canvas.doc.properties},x3dom.Runtime.prototype.backendName=function(){return this.canvas.backend},x3dom.Runtime.prototype.getFPS=function(){return this.fps},x3dom.Runtime.prototype.isA=function(e,t){var i=!1;return i=t&&e&&e._x3domNode?x3dom.isa(e._x3domNode,x3dom.nodeTypesLC[(t=""===t?"X3DNode":t).toLowerCase()]):i},x3dom.Runtime.prototype.getPixelScale=function(){var e,t,i=this.viewpoint();return x3dom.isa(i,x3dom.nodeTypes.OrthoViewpoint)?(t=(i=i.getZoom())[0],e=i[3]-i[1],i=(i[2]-t)/this.getWidth(),t=e/this.getHeight(),new x3dom.fields.SFVec3f(i,t,0)):(x3dom.debug.logError("getPixelScale is only implemented for orthographic Viewpoints"),null)},x3dom.Runtime.prototype.onAnimationStarted=function(){},x3dom.Runtime.prototype.onAnimationFinished=function(){},x3dom.Runtime.prototype.enterVR=function(){this.canvas.enterVR()},x3dom.Runtime.prototype.exitVR=function(){this.canvas.exitVR()},x3dom.Runtime.prototype.toggleVR=function(){this.canvas.xrSession?(this.canvas.xrSession,this.exitVR()):this.enterVR()},x3dom.Runtime.prototype.toggleProjection=function(e,t){var i,o=document.getElementById("x3d").runtime.canvas.doc._scene.getNavigationInfo(),s=o._vf.transitionTime,n=document.getElementById(e)._x3domNode,r=document.getElementById(t)._x3domNode;return o._vf.transitionTime=0,r._bindAnimation=!1,n._bindAnimation=!1,n._vf.isActive?(r._viewMatrix=n._viewMatrix,document.getElementById(t).setAttribute("set_bind","true"),i=n._viewMatrix.e3().length()/2.2,r.setZoom(i)):r._vf.isActive&&(n._viewMatrix=r._viewMatrix,document.getElementById(e).setAttribute("set_bind","true"),i=-2.2*r._fieldOfView[2],t=r._viewMatrix.e2().normalize().multiply(i),n._viewMatrix.setTranslate(t)),o._vf.transitionTime=s,n._bindAnimation=r._bindAnimation=!0,n._vf.isActive?0:1},x3dom.Runtime.prototype.replaceWorld=function(e){for(var t,i,o=("X3D"===e.localName.toUpperCase()?e:this.doc).cloneNode(!1);t=e.firstChild;)"HEAD"==(i=1===t.nodeType?t.localName.toUpperCase():null)||"SCENE"==i?o.appendChild(t):t.remove();this.doc.parentNode.replaceChild(o,this.doc),this.doc=o,x3dom.reload()},x3dom.Runtime.prototype.createX3DFromJS=function(e,t){return t&&(e=x3dom.protoExpander.prototypeExpander(t,e)),(new x3dom.JSONParser).parseJavaScript(e)},x3dom.Runtime.prototype.createX3DFromString=function(e,t){try{var i=JSON.parse(e);return this.createX3DFromJS(i,t)}catch(t){var i=new DOMParser,o=i.parseFromString(e,"application/xml").querySelector("X3D");return o=null==o?i.parseFromString(e,"text/html").querySelector("X3D"):o}},x3dom.Runtime.prototype.createX3DFromURLPromise=function(e,t){this.canvas.doc.incrementDownloads();var i=this;return fetch(e).then(function(e){return e.text()}).then(function(e){return i.canvas.doc.decrementDownloads(),i.createX3DFromString(e,t)}).catch(function(e){return i.canvas.doc.decrementDownloads(),x3dom.debug.logError("fetch failed: "+e),null})},x3dom.Runtime.prototype.loadURL=function(t,e){var i=this;this.createX3DFromURLPromise(t,e).then(function(e){null!=e?i.replaceWorld(e):x3dom.debug.logError("loadURL: could not fetch or parse "+t)})},x3dom.userAgentFeature={supportsDOMAttrModified:!1,supportsMutationObserver:!0},(()=>{function e(){for(var e,t,i=document.getElementsByTagName("X3D"),o=[],s=0;s<i.length;s++)void 0===i[s].hasRuntime&&o.push(i[s]);var n,r,a,d,l,h,u=new x3dom.Properties,f=array_to_object(["showLog","showStat","showProgress","PrimitiveQuality","components","loadpath","disableDoubleClick","backend","altImg","runtimeEnabled","disableKeys","showTouchpoints","disableTouch","maxActiveDownloads","useGeoCache","baseURL"]),c=!1;for(s=0;s<o.length;s++){for(u.setProperty("showLog",o[s].getAttribute("showLog")||"false"),u.setProperty("showStat",o[s].getAttribute("showStat")||"false"),u.setProperty("showProgress",o[s].getAttribute("showProgress")||"true"),u.setProperty("PrimitiveQuality",o[s].getAttribute("PrimitiveQuality")||"High"),u.setProperty("useGeoCache",o[s].getAttribute("useGeoCache")||"true"),u.setProperty("baseURL",o[s].getAttribute("baseURL")||""),t=o[s].getElementsByTagName("PARAM"),e=0;e<t.length;e++)t[e].getAttribute("name")in f&&u.setProperty(t[e].getAttribute("name"),t[e].getAttribute("value"));"true"===u.getProperty("showLog")&&(c=!0)}for(1==c?x3dom.debug.activate(!0):x3dom.debug.activate(!1),o=o.map(function(e){return e.hasRuntime=!0,e}),void 0!==x3dom.about&&x3dom.debug.logInfo("X3DOM "+x3dom.about.version+", Build: "+x3dom.about.build+", Revison: <a href='https://github.com/x3dom/x3dom/tree/"+x3dom.about.revision+"'>"+x3dom.about.revision+"</a>, Date: "+x3dom.about.date),x3dom.debug.logInfo("Found "+o.length+" X3D and nodes..."),s=0;s<o.length;s++)n=o[s],r=new x3dom.X3DCanvas(n,x3dom.canvases.length),x3dom.canvases.push(r),null!==r.gl?(l=(new Date).getTime(),o[s].runtime=new x3dom.Runtime(o[s],r),o[s].runtime.initialize(o[s],r),x3dom.runtime.ready&&(o[s].runtime.ready=x3dom.runtime.ready),""==r.backend&&x3dom.runtime.noBackendFound(),r.load(o[s],s,u),"true"===u.getProperty("showStat")?o[s].runtime.statistics(!0):o[s].runtime.statistics(!1),"true"===u.getProperty("showProgress")?("bar"===u.getProperty("showProgress")&&r.progressDiv.setAttribute("class","x3dom-progress bar"),o[s].runtime.processIndicator(!0)):o[s].runtime.processIndicator(!1),l=(new Date).getTime()-l,x3dom.debug.logInfo("Time for setup and init of GL element no. "+s+": "+l+" ms.")):((l=document.createElement("div")).setAttribute("class","x3dom-nox3d"),l.setAttribute("id","x3dom-nox3d"),(a=document.createElement("p")).appendChild(document.createTextNode("WebGL is not yet supported in your browser. ")),(d=document.createElement("a")).setAttribute("href","http://www.x3dom.org/?page_id=9"),d.appendChild(document.createTextNode("Follow link for a list of supported browsers... ")),l.appendChild(a),l.appendChild(d),r.x3dElem.appendChild(l),r.stateViewer&&n.removeChild(r.stateViewer.viewer));h=null,document.createEvent?((h=document.createEvent("Events")).initEvent("load",!0,!0),document.dispatchEvent(h)):document.createEventObject&&(h=document.createEventObject(),document.body.fireEvent("onload",h))}function t(){if(x3dom.canvases&&0<x3dom.canvases.length&&x3dom.canvases[0].doc){for(var e=0;e<x3dom.canvases.length;e++)x3dom.canvases[e].doc.shutdown(x3dom.canvases[e].gl);x3dom.canvases=[]}}x3dom.reload=function(){e()},window.addEventListener?(window.addEventListener("load",e,!1),window.addEventListener("unload",t,!1),window.addEventListener("reload",t,!1)):window.attachEvent&&(window.attachEvent("onload",e),window.attachEvent("onunload",t),window.attachEvent("onreload",t)),"complete"===document.readyState&&window.setTimeout(function(){e()},20)})(),x3dom.Cache=function(){this.textures=[],this.shaders=[]},x3dom.Cache.prototype.getTexture2D=function(e,t,i,o,s,n,r,a,d){var l=i;return void 0===this.textures[l]&&(this.textures[l]=x3dom.Utils.createTexture2D(e,t,i,o,s,n,r,a,d)),this.textures[l]},x3dom.Cache.prototype.getTexture2DByDEF=function(e,t,i){t=t.name+"_"+i;return void 0===this.textures[t]&&(this.textures[t]=e.createTexture()),this.textures[t]},x3dom.Cache.prototype.getTextureCube=function(e,t,i,o,s,n,r,a){for(var d="",l=0;l<i.length;++l)d+=i[l]+"|";return void 0===this.textures[d]&&(this.textures[d]=x3dom.Utils.createTextureCube(e,t,i,o,s,n,r,a)),this.textures[d]},x3dom.Cache.prototype.getShader=function(e,t){var i=null;if(void 0===this.shaders[t]){switch(t){case x3dom.shader.PICKING:i=new x3dom.shader.PickingShader(e);break;case x3dom.shader.PICKING_24:i=new x3dom.shader.Picking24Shader(e);break;case x3dom.shader.PICKING_ID:i=new x3dom.shader.PickingIdShader(e);break;case x3dom.shader.PICKING_COLOR:i=new x3dom.shader.PickingColorShader(e);break;case x3dom.shader.PICKING_TEXCOORD:i=new x3dom.shader.PickingTexcoordShader(e);break;case x3dom.shader.FRONTGROUND_TEXTURE:i=new x3dom.shader.FrontgroundTextureShader(e);break;case x3dom.shader.BACKGROUND_TEXTURE:i=new x3dom.shader.BackgroundTextureShader(e);break;case x3dom.shader.BACKGROUND_SKYTEXTURE:i=new x3dom.shader.BackgroundSkyTextureShader(e);break;case x3dom.shader.BACKGROUND_CUBETEXTURE:i=new x3dom.shader.BackgroundCubeTextureShader(e);break;case x3dom.shader.BACKGROUND_CUBETEXTURE_DDS:i=new x3dom.shader.BackgroundCubeTextureDDSShader(e);break;case x3dom.shader.SHADOW:i=new x3dom.shader.ShadowShader(e);break;case x3dom.shader.BLUR:i=new x3dom.shader.BlurShader(e);break;case x3dom.shader.DEPTH:break;case x3dom.shader.NORMAL:i=new x3dom.shader.NormalShader(e);break;case x3dom.shader.TEXTURE_REFINEMENT:i=new x3dom.shader.TextureRefinementShader(e)}i?this.shaders[t]=x3dom.Utils.wrapProgram(e,i,t):x3dom.debug.logError("Couldn't create shader: "+t)}return this.shaders[t]},x3dom.Cache.prototype.getDynamicShader=function(e,t,i){var o,t=x3dom.Utils.generateProperties(t,i),s=t.id;return void 0===this.shaders[s]&&(o=null,o=-1!=t.CSHADER?new x3dom.shader.ComposedShader(e,i):new x3dom.shader.DynamicShader(e,t),this.shaders[s]=x3dom.Utils.wrapProgram(e,o,s)),this.shaders[s]},x3dom.Cache.prototype.getShaderByProperties=function(e,t,i,o,s){var n=i.id;if(null!=o&&(n+=o),null!=s&&(n+="S"),void 0===this.shaders[n]){var r=null;if(null!=o)r=new x3dom.shader.DynamicShaderPicking(e,i,o);else if(null!=s)r=new x3dom.shader.DynamicShadowShader(e,i);else if(-1!=i.CSHADER)r=new x3dom.shader.ComposedShader(e,t);else if(null!=i.KHR_MATERIAL_COMMONS&&0!=i.KHR_MATERIAL_COMMONS)r=new x3dom.shader.KHRMaterialCommonsShader(e,i);else{if(null!=i.EMPTY_SHADER&&0!=i.EMPTY_SHADER)return{shaderID:n};r=new x3dom.shader.DynamicShader(e,i)}this.shaders[n]=x3dom.Utils.wrapProgram(e,r,n)}return this.shaders[n]},x3dom.Cache.prototype.getShadowRenderingShader=function(e,t,i){for(var o="shadow"+Object.values(i).join(""),s=0;s<t.length;s++)x3dom.isa(t[s],x3dom.nodeTypes.SpotLight)?o+="S":x3dom.isa(t[s],x3dom.nodeTypes.PointLight)?o+="P":o+="D";return void 0===this.shaders[o]&&(i=new x3dom.shader.ShadowRenderingShader(e,t,i),this.shaders[o]=x3dom.Utils.wrapProgram(e,i,o)),this.shaders[o]},x3dom.Cache.prototype.Release=function(e){for(var t in this.textures)e.deleteTexture(this.textures[t]);for(var i in this.textures=[],this.shaders){for(var o=this.shaders[i],s=e.getAttachedShaders(o.program),n=0;n<s.length;++n)e.detachShader(o.program,s[n]),e.deleteShader(s[n]);e.deleteProgram(o.program)}this.shaders=[]},x3dom.Texture=function(e,t,i,o){this.gl=e,this.doc=t,this.cache=i,this.node=o,this.samplerName="diffuseMap",this.type=e.TEXTURE_2D,this.format=e.RGBA,this.magFilter=e.LINEAR,this.minFilter=e.LINEAR,this.wrapS=e.REPEAT,this.wrapT=e.REPEAT,this.genMipMaps=!1,this.texture=null,this.ready=!1,this.anisotropicDegree=1,this.dashtexture=!1;var s,t=this.node;this.node._x3domTexture=this,x3dom.isa(t,x3dom.nodeTypes.MovieTexture)&&-1!==t._vf.url[0].indexOf("mpd",t._vf.url[0].length-"mpd".length)&&(this.dashtexture=!0,(s=document.getElementById("AdditionalDashVideoScript"))||((s=document.createElement("script")).setAttribute("type","text/javascript"),s.setAttribute("src",x3dom.Texture.dashVideoScriptFile),s.setAttribute("id","AdditionalDashVideoScript"),s.onload=function(){for(var e;e=x3dom.Texture.loadDashVideos.pop();)x3dom.Texture.textNum++,e.update();s.ready=!0},document.getElementsByTagName("head")[0].appendChild(s)),!0===s.ready?(x3dom.Texture.textNum++,this.update()):x3dom.Texture.loadDashVideos.push(this)),this.dashtexture||this.update()},x3dom.Texture.dashVideoScriptFile="dash.all.js",x3dom.Texture.loadDashVideos=[],x3dom.Texture.textNum=0,x3dom.Texture.clampFontSize=!1,x3dom.Texture.minFontQuality=.5,x3dom.Texture.maxFontQuality=10,x3dom.Texture.prototype.update=function(){x3dom.isa(this.node,x3dom.nodeTypes.Text)?this.updateText():this.updateTexture(),this.node.validateGLObject()},x3dom.Texture.prototype.setPixel=function(e,t,i,o){var s=this.gl,i=new Uint8Array(i);s.bindTexture(this.type,this.texture),s.pixelStorei(s.UNPACK_ALIGNMENT,1),s.texSubImage2D(this.type,0,e,t,1,1,this.format,s.UNSIGNED_BYTE,i),s.bindTexture(this.type,null),o&&(this.doc.needRender=!0)},x3dom.Texture.prototype.updateTexture=function(){var e=this.gl,t=this.doc,i=this.node;if(this.samplerName=i._type,x3dom.isa(i,x3dom.nodeTypes.X3DEnvironmentTextureNode)?this.type=e.TEXTURE_CUBE_MAP:this.type=e.TEXTURE_2D,x3dom.isa(i,x3dom.nodeTypes.PixelTexture))switch(i._vf.image.comp){case 1:this.format=e.LUMINANCE;break;case 2:this.format=e.LUMINANCE_ALPHA;break;case 3:this.format=e.RGB;break;case 4:this.format=e.RGBA}else this.format=e.RGBA;null!==i._cf.textureProperties.node?(o=i._cf.textureProperties.node,this.wrapS=x3dom.Utils.boundaryModesDic(e,o._vf.boundaryModeS),this.wrapT=x3dom.Utils.boundaryModesDic(e,o._vf.boundaryModeT),this.minFilter=x3dom.Utils.minFilterDic(e,o._vf.minificationFilter),this.magFilter=x3dom.Utils.magFilterDic(e,o._vf.magnificationFilter),this.anisotropicDegree=Math.min(Math.max(o._vf.anisotropicDegree,1),x3dom.caps.MAX_ANISOTROPY),!0===o._vf.generateMipMaps?(this.genMipMaps=!0,this.minFilter==e.NEAREST?this.minFilter=e.NEAREST_MIPMAP_NEAREST:this.minFilter==e.LINEAR&&(this.minFilter=e.LINEAR_MIPMAP_LINEAR),this.texture&&(this.texture.ready||this.texture.textureCubeReady)&&(e.bindTexture(this.type,this.texture),e.generateMipmap(this.type),e.bindTexture(this.type,null))):(this.genMipMaps=!1,this.minFilter==e.LINEAR_MIPMAP_LINEAR||this.minFilter==e.LINEAR_MIPMAP_NEAREST?this.minFilter=e.LINEAR:this.minFilter!=e.NEAREST_MIPMAP_LINEAR&&this.minFilter!=e.NEAREST_MIPMAP_NEAREST||(this.minFilter=e.NEAREST))):(0==i._vf.repeatS?this.wrapS=e.CLAMP_TO_EDGE:this.wrapS=e.REPEAT,0==i._vf.repeatT?this.wrapT=e.CLAMP_TO_EDGE:this.wrapT=e.REPEAT,"displacementMap"==this.samplerName&&(this.wrapS=e.CLAMP_TO_EDGE,this.wrapT=e.CLAMP_TO_EDGE,this.minFilter=e.NEAREST,this.magFilter=e.NEAREST));var o=i._video&&!0===i._needPerFrameUpdate;if(i._isCanvas&&i._canvas)null==this.texture&&(this.texture=e.createTexture()),this.texture.width=i._canvas.width,this.texture.height=i._canvas.height,this.texture.ready=!0,e.bindTexture(this.type,this.texture),e.texImage2D(this.type,0,this.format,this.format,e.UNSIGNED_BYTE,i._canvas),this.genMipMaps&&e.generateMipmap(this.type),e.bindTexture(this.type,null);else if(x3dom.isa(i,x3dom.nodeTypes.RenderedTexture))i._webgl&&i._webgl.fbo?i._webgl.fbo.dtex&&i._vf.depthMap?this.texture=i._webgl.fbo.dtex:this.texture=i._webgl.fbo.tex:(this.texture=null,x3dom.debug.logError("Try updating RenderedTexture without FBO initialized!")),this.texture&&(this.texture.ready=!0);else if(x3dom.isa(i,x3dom.nodeTypes.PixelTexture)){0==i._vf.origChannelCount&&i.setOrigChannelCount(i._vf.image.comp),null==this.texture&&(this.node._DEF?this.texture=this.cache.getTexture2DByDEF(e,this.node._nameSpace,this.node._DEF):this.texture=e.createTexture()),this.texture.width=i._vf.image.width,this.texture.height=i._vf.image.height,this.texture.ready=!0;var s=i._vf.image.array,n=i._vf.image.width*i._vf.image.height*i._vf.image.comp,n=new Uint8Array(n);n.set(s),e.bindTexture(this.type,this.texture),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(this.type,0,this.format,i._vf.image.width,i._vf.image.height,0,this.format,e.UNSIGNED_BYTE,n),this.genMipMaps&&e.generateMipmap(this.type),e.bindTexture(this.type,null)}else if(x3dom.isa(i,x3dom.nodeTypes.MovieTexture)||o){var r=this,s=document.getElementsByTagName("body")[0];if(null==this.texture&&(this.texture=e.createTexture()),this.dashtexture){var n=document.createElement("div"),a=(n.setAttribute("class","dash-video-player"+x3dom.Texture.textNum),i._video=document.createElement("video"),i._video.setAttribute("preload","auto"),i._video.setAttribute("muted","muted"),document.createElement("script"));a.setAttribute("type","text/javascript"),a.innerHTML='startDashVideo("'+i._vf.url[0]+'",".dash-video-player'+x3dom.Texture.textNum+' video")',n.appendChild(a),n.appendChild(i._video),s.appendChild(n),i._video.style.visibility="hidden",i._video.style.display="none"}else{o||(i._video=document.createElement("video"),i._video.setAttribute("preload","auto"),i._video.setAttribute("muted","muted"),i._video.setAttribute("autoplay",""),i._video.setAttribute("playsinline",""),i._video.crossOrigin="anonymous",i._video.load());for(var d=0;d<i._vf.url.length;d++){var l=i._nameSpace.getURL(i._vf.url[d]),h=(x3dom.debug.logInfo("Adding video file: "+l),document.createElement("source"));h.setAttribute("src",l),i._video.appendChild(h)}}var u=function(){e.bindTexture(r.type,r.texture),e.texImage2D(r.type,0,r.format,r.format,e.UNSIGNED_BYTE,i._video),r.genMipMaps&&e.generateMipmap(r.type),e.bindTexture(r.type,null),r.texture.ready=!0,t.needRender=!0},f=function(){window.removeEventListener("mousedown",f),window.removeEventListener("keydown",f),i._video instanceof HTMLMediaElement?i._video.play().then(function(){i._intervalID&&(x3dom.debug.logInfo("The video has already started, startVideo() is called repeatedly."),clearInterval(i._intervalID),i._intervalID=null),i._intervalID=setInterval(u,16)}).catch(function(e){x3dom.debug.logInfo("Waiting for interaction: "+e),window.addEventListener("mousedown",f),window.addEventListener("keydown",f)}):x3dom.debug.logInfo("No video exists.")};i._video.startVideo=f,i._video.pauseVideo=function(){window.removeEventListener("mousedown",f),window.removeEventListener("keydown",f),i._video.pause(),clearInterval(i._intervalID),i._intervalID=null},i._video.addEventListener("canplaythrough",f,!0),i._video.addEventListener("ended",function(){clearInterval(i._intervalID),!(i._intervalID=null)===i._vf.loop&&(i._video.play(),i._intervalID=setInterval(u,16))},!0)}else x3dom.isa(i,x3dom.nodeTypes.X3DEnvironmentTextureNode)?this.texture=this.cache.getTextureCube(e,t,i.getTexUrl(),!1,i._vf.crossOrigin,i._vf.scale,this.genMipMaps,i._vf.flipY):this.texture=this.cache.getTexture2D(e,t,i._nameSpace.getURL(i._vf.url[0]),!1,i._vf.crossOrigin,i._vf.scale,this.genMipMaps,i._vf.flipY,i)},x3dom.Texture.prototype.updateText=function(){var e=this.gl,t=(this.wrapS=e.CLAMP_TO_EDGE,this.wrapT=e.CLAMP_TO_EDGE,this.type=e.TEXTURE_2D,this.format=e.RGBA,this.magFilter=e.LINEAR,this.minFilter=e.LINEAR_MIPMAP_LINEAR,this.genMipMaps=!0,x3dom.caps.MAX_ANISOTROPY&&(this.anisotropicDegree=x3dom.caps.MAX_ANISOTROPY),this.node._cf.fontStyle.node),i="serif",o="normal",s="left",n=1,r=1,a=2,d="FIRST";if(null!==t){i=t._vf.family.toString().trim().replace(/\'/g,"").replace(/\,/," ").split(" ").map(function(e){return"SANS"==e?"Verdana, sans-serif":"SERIF"==e?"Georgia, serif":"TYPEWRITER"==e?"monospace":""+e}).join(",");switch((o=t._vf.style.toString().replace(/\'/g,"")).toUpperCase()){case"PLAIN":o="normal";break;case"BOLD":o="bold";break;case"ITALIC":o="italic";break;case"BOLDITALIC":o="italic bold";break;default:o="normal"}var l=t._vf.leftToRight?"ltr":"rtl",h=t._vf.topToBottom,u="ltr"==l?"left":"right",f="ltr"==l?"right":"left";switch((s=t._vf.justify[0].toString().replace(/\'/g,"")).toUpperCase()){case"BEGIN":s=u;break;case"END":s=f;break;case"FIRST":s=u;break;case"MIDDLE":s="center";break;default:s=u}if(void 0===t._vf.justify[1])d="FIRST";else switch((d=t._vf.justify[1].toString().replace(/\'/g,"")).toUpperCase()){case"BEGIN":d="BEGIN";break;case"FIRST":d="FIRST";break;case"MIDDLE":d="MIDDLE";break;case"END":d="END";break;default:d="FIRST"}n=t._vf.size,r=t._vf.spacing,t._vf.horizontal,t._vf.language,a=t._vf.quality,a=Math.max(x3dom.Texture.minFontQuality,a),a=Math.min(x3dom.Texture.maxFontQuality,a),n<.1&&(n=.1),x3dom.Texture.clampFontSize&&2.3<n&&(n=2.3)}var c=this.node._vf.string,_=this.node._vf.maxExtent,m=[],t=s,p=document.createElement("canvas"),x=(p.dir=l,32*n),g=(document.body.appendChild(p),p.getContext("2d"));g.font=o+" "+x+"px "+i;for(var v,y,T=0,b=0;b<c.length;b++)(v=g.measureText(c[b]).width)>T&&(T=v),y=0|this.node._vf.length[b],m[b]=(y=0<_&&(_<y||0==y)?_:y)<=0?v:32*y;var S=.25*x,F=T+S,E=x+x*r*(c.length-1)+S,M=0,C=0,w=0,A=0,R="alphabetic";switch(s){case"center":w=-F/2,M=F/2;break;case"left":M=w=0;break;case"right":w=-F,M=F}switch(d){case"MIDDLE":A=E/2-S/2,R="middle",C=x/2;break;case"BEGIN":A=h?0:E-S,R=h?"top":"bottom",C=h?0:x;break;case"FIRST":A=h?x:E-S,R=h?"alphabetic":"bottom",C=x;break;case"END":A=h?E-S:0,R=h?"bottom":"top",C=h?x:0}var n=F*(1/32),D=1/32*E,N=x3dom.caps.MAX_TEXTURE_SIZE>>2,a=(w*=1/32,A*=1/32,p.width=Math.min(x3dom.Utils.nextHighestPowerOfTwo(F*a),N),p.height=Math.min(x3dom.Utils.nextHighestPowerOfTwo(E*a),N),p.dir=l,g.scale(p.width/F,p.height/E),g.fillStyle="rgba(0,0,0,0)",g.fillRect(0,0,g.canvas.width,g.canvas.height),g.fillStyle="white",g.textBaseline=R,g.font=o+" "+x+"px "+i,g.textAlign=t,{font_style:o,font_family:i,font_spacing:r,paragraph:c,topToBottom:h,leftToRight:l,textX:M,textY:C,textHeight:x,lengths:m});this.renderScaledText(g,1,a),null===this.texture&&(this.texture=e.createTexture()),e.bindTexture(this.type,this.texture),this.uploadTextMipmap(p,a),e.bindTexture(this.type,null),document.body.removeChild(p),this.node._mesh._positions[0]=[0+w,-D+A,0,n+w,-D+A,0,n+w,0+A,0,0+w,0+A,0],this.node.invalidateVolume(),this.node._parentNodes.forEach(function(e){e.setAllDirty()})},x3dom.Texture.prototype.renderScaledText=function(e,t,i){e.font=i.font_style+" "+i.textHeight/t+"px "+i.font_family;for(var o=i.textY,s=0;s<i.paragraph.length;s++){var n=i.topToBottom?s:i.paragraph.length-1-s,r=i.paragraph[n];e.fillText(r="rtl"==i.leftToRight?""+r:r,i.textX/t,o/t,i.lengths[n]/t),o+=i.textHeight*i.font_spacing}},x3dom.Texture.prototype.uploadTextMipmap=function(e,t){for(var i=this.gl,o=e.width,s=e.height,n=0,r=1,a=o,d=s,l=e.getContext("2d");i.texImage2D(this.type,n++,this.format,this.format,i.UNSIGNED_BYTE,l.getImageData(0,0,a,d)),1!=a||1!=d;)a=Math.max(1,a>>1),d=Math.max(1,d>>1),l.clearRect(0,0,o,s),this.renderScaledText(l,r*=2,t)},x3dom.X3DDocument=function(e,t,i){this.canvas=e,this.ctx=t,this.properties=i,this.needRender=!0,this._x3dElem=null,this._scene=null,this._viewarea=null,this.downloadCount=0,this.previousDownloadCount=0,this.mutationObserver=new MutationObserver(this.onMutation.bind(this)),this.X3DMutationObserver=new MutationObserver(this.onX3DMutation.bind(this)),this._nodeBag={timer:[],lights:[],clipPlanes:[],followers:[],trans:[],renderTextures:[],viewarea:[],affectedPointingSensors:[]},this.onload=function(){},this.onerror=function(){}},x3dom.X3DDocument.prototype.load=function(i,o){var s={},n=[i],r=this;!function e(){var t;return 0===n.length?(r._setup(s[i],s,o),r.onload(),0):(t=n.shift(),void(!x3dom.isX3DElement(t)||"x3d"!==t.localName.toLowerCase()&&"websg"!==t.localName.toLowerCase()||(s[t]=t,r._x3dElem=t,e())))}()},x3dom.findScene=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var o=e.childNodes[i];o&&o.localName&&"scene"===o.localName.toLowerCase()&&t.push(o)}return 1<t.length?(x3dom.debug.logError("X3D element has more than one Scene child (has "+e.childNodes.length+")."),null):t[0]},x3dom.X3DDocument.prototype._setup=function(e){var t=x3dom.findScene(e),e=(this.X3DMutationObserver.observe(document,{attributes:!1,attributeOldValue:!1,childList:!0,subtree:!0}),this.mutationObserver.observe(e,{attributes:!1,attributeOldValue:!1,childList:!0,subtree:!1}),this.mutationObserver.observe(t,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0}),this._bindableBag=new x3dom.BindableBag(this),new x3dom.NodeNameSpace("scene",this).setupTree(t));this._scene=e,this._bindableBag.setRefNode(e),this._viewarea=new x3dom.Viewarea(this,e),this._viewarea._width=this.canvas.width,this._viewarea._height=this.canvas.height},x3dom.X3DDocument.prototype.advanceTime=function(e){var t=0;if(this._nodeBag.timer.length)for(t=0;t<this._nodeBag.timer.length;t++)this.needRender|=this._nodeBag.timer[t].tick(e);if(this._nodeBag.followers.length)for(t=0;t<this._nodeBag.followers.length;t++)this.needRender|=this._nodeBag.followers[t].tick(e);if(this._nodeBag.trans.length)for(t=0;t<this._nodeBag.trans.length;t++)this.needRender|=this._nodeBag.trans[t].tick(e);if(this._nodeBag.viewarea.length)for(t=0;t<this._nodeBag.viewarea.length;t++)this.needRender|=this._nodeBag.viewarea[t].tick(e)},x3dom.X3DDocument.prototype.render=function(e,t){e&&this._viewarea&&(this._viewarea.setVRFrameData(e,t),this._viewarea.updateGamepads(t),e.renderScene(this._viewarea,t))},x3dom.X3DDocument.prototype.onPick=function(e,t,i){e&&this._viewarea&&e.pickValue(this._viewarea,t,i,1)},x3dom.X3DDocument.prototype.onPickRect=function(e,t,i,o,s){return e&&this._viewarea?e.pickRect(this._viewarea,t,i,o,s):[]},x3dom.X3DDocument.prototype.onMove=function(e,t,i,o){e&&this._viewarea&&(this._viewarea._scene._vf.doPickPass&&e.pickValue(this._viewarea,t,i,o),this._viewarea.onMove(t,i,o))},x3dom.X3DDocument.prototype.onMoveView=function(e,t,i,o,s){e&&this._viewarea&&this._scene.getNavigationInfo()._impl.onTouchDrag(this._viewarea,t,i,o,s)},x3dom.X3DDocument.prototype.onDrag=function(e,t,i,o){e&&this._viewarea&&(this._viewarea._scene._vf.doPickPass&&!this._viewarea._isMoving&&e.pickValue(this._viewarea,t,i,o),this._viewarea.onDrag(t,i,o))},x3dom.X3DDocument.prototype.onWheel=function(e,t,i,o){e&&this._viewarea&&(this._viewarea._scene._vf.doPickPass&&e.pickValue(this._viewarea,t,o,0),this._viewarea.onDrag(t,i,2))},x3dom.X3DDocument.prototype.onMousePress=function(e,t,i,o){e&&this._viewarea&&(this._viewarea._scene.updateVolume(),e.pickValue(this._viewarea,t,i,o),this._viewarea.onMousePress(t,i,o))},x3dom.X3DDocument.prototype.onMouseRelease=function(e,t,i,o,s){e&&this._viewarea&&(e.pickValue(this._viewarea,t,i,s<<8|o),this._viewarea.onMouseRelease(t,i,o,s))},x3dom.X3DDocument.prototype.onMouseOver=function(e,t,i,o){e&&this._viewarea&&(e.pickValue(this._viewarea,t,i,o),this._viewarea.onMouseOver(t,i,o))},x3dom.X3DDocument.prototype.onMouseOut=function(e,t,i,o){e&&this._viewarea&&(e.pickValue(this._viewarea,t,i,o),this._viewarea.onMouseOut(t,i,o))},x3dom.X3DDocument.prototype.onDoubleClick=function(e,t,i){e&&this._viewarea&&this._viewarea.onDoubleClick(t,i)},x3dom.X3DDocument.prototype.onKeyDown=function(e){switch(e){case 37:this._viewarea.strafeLeft();break;case 38:this._viewarea.moveFwd();break;case 39:this._viewarea.strafeRight();break;case 40:this._viewarea.moveBwd()}},x3dom.X3DDocument.prototype.onKeyUp=function(e){var t=null;switch(e){case 13:x3dom.toggleFullScreen();break;case 33:(t=this._scene.getViewpoint()._stack)?t.switchTo("prev"):x3dom.debug.logError("No valid ViewBindable stack.");break;case 34:(t=this._scene.getViewpoint()._stack)?t.switchTo("next"):x3dom.debug.logError("No valid ViewBindable stack.");break;case 35:(t=this._scene.getViewpoint()._stack)?t.switchTo("last"):x3dom.debug.logError("No valid ViewBindable stack.");break;case 36:(t=this._scene.getViewpoint()._stack)?t.switchTo("first"):x3dom.debug.logError("No valid ViewBindable stack.")}},x3dom.X3DDocument.prototype.onKeyPress=function(e){var t,i,o,s,n=this._scene.getNavigationInfo(),r=this._scene.getEnvironment();switch(e){case 32:var a=this.canvas.parent.stateViewer;a&&a.display(),x3dom.debug.logInfo("a: show all | i: fit view | d: show helper buffers | s: small feature culling | t: light view | m: toggle render mode | c: frustum culling | p: intersect type | \ne: examine mode | f: fly mode | y: freefly mode | w: walk mode | h: helicopter mode | l: lookAt mode | o: lookaround | g: game mode | n: turntable | u: upright position | \nv: print viewpoint info | r: reset view | home: first view | end: last view | pageUp: next view | pageDown: prev. view | +: increase speed | -: decrease speed ");break;case 43:n._vf.speed=2*n._vf.speed,x3dom.debug.logInfo("Changed navigation speed to "+n._vf.speed);break;case 45:n._vf.speed=.5*n._vf.speed,x3dom.debug.logInfo("Changed navigation speed to "+n._vf.speed);break;case 51:x3dom.nodeTypes.PopGeometry.ErrorToleranceFactor+=.5,x3dom.debug.logInfo("Changed POP error tolerance to "+x3dom.nodeTypes.PopGeometry.ErrorToleranceFactor);break;case 52:x3dom.nodeTypes.PopGeometry.ErrorToleranceFactor-=.5,x3dom.debug.logInfo("Changed POP error tolerance to "+x3dom.nodeTypes.PopGeometry.ErrorToleranceFactor);break;case 54:n._vf.typeParams[1]+=1,n._heliUpdated=!1,x3dom.debug.logInfo("Changed helicopter height to "+n._vf.typeParams[1]);break;case 55:--n._vf.typeParams[1],n._heliUpdated=!1,x3dom.debug.logInfo("Changed helicopter height to "+n._vf.typeParams[1]);break;case 56:n._vf.typeParams[0]-=.02,n._heliUpdated=!1,x3dom.debug.logInfo("Changed helicopter angle to "+n._vf.typeParams[0]);break;case 57:n._vf.typeParams[0]+=.02,n._heliUpdated=!1,x3dom.debug.logInfo("Changed helicopter angle to "+n._vf.typeParams[0]);break;case 97:this._viewarea.showAll();break;case 99:r._vf.frustumCulling=!r._vf.frustumCulling,x3dom.debug.logInfo("Viewfrustum culling "+(r._vf.frustumCulling?"on":"off"));break;case 100:void 0===this._viewarea._visDbgBuf&&(this._viewarea._visDbgBuf="true"===this._x3dElem.getAttribute("showLog")),this._viewarea._visDbgBuf=!this._viewarea._visDbgBuf,x3dom.debug.logContainer.style.display=1==this._viewarea._visDbgBuf?"block":"none";break;case 101:n.setType("examine",this._viewarea);break;case 102:n.setType("fly",this._viewarea);break;case 103:n.setType("game",this._viewarea);break;case 104:n.setType("helicopter",this._viewarea);break;case 105:this._viewarea.fit(this._scene._lastMin,this._scene._lastMax);break;case 108:n.setType("lookat",this._viewarea);break;case 109:this._viewarea._points=++this._viewarea._points%2;break;case 110:n.setType("turntable",this._viewarea);break;case 111:n.setType("lookaround",this._viewarea);break;case 112:switch(this._scene._vf.pickMode.toLowerCase()){case"idbuf":this._scene._vf.pickMode="color";break;case"color":this._scene._vf.pickMode="texCoord";break;case"texcoord":this._scene._vf.pickMode="box";break;default:this._scene._vf.pickMode="idBuf"}x3dom.debug.logInfo("Switch pickMode to '"+this._scene._vf.pickMode+"'.");break;case 114:this._viewarea.resetView();break;case 115:r._vf.smallFeatureCulling=!r._vf.smallFeatureCulling,x3dom.debug.logInfo("Small feature culling "+(r._vf.smallFeatureCulling?"on":"off"));break;case 116:0<this._nodeBag.lights.length&&this._viewarea.animateTo(this._viewarea.getLightMatrix()[0],this._scene.getViewpoint());break;case 117:this._viewarea.uprightView();break;case 118:a=this;t=a._viewarea._scene.getViewpoint(),i=a._viewarea.getViewMatrix().inverse(),(o=new x3dom.fields.Quaternion(0,0,1,0)).setValue(i),o=o.toAxisAngle(),i=i.e3(),s=t.getCenterOfRotation(),x3dom.debug.logInfo('\n&lt;Viewpoint position="'+i.x.toFixed(5)+" "+i.y.toFixed(5)+" "+i.z.toFixed(5)+'" orientation="'+o[0].x.toFixed(5)+" "+o[0].y.toFixed(5)+" "+o[0].z.toFixed(5)+" "+o[1].toFixed(5)+'" \n\tzNear="'+t.getNear().toFixed(5)+'" zFar="'+t.getFar().toFixed(5)+'" centerOfRotation="'+s.x.toFixed(5)+" "+s.y.toFixed(5)+" "+s.z.toFixed(5)+'" fieldOfView="'+t.getFieldOfView().toFixed(5)+'" description="'+t._vf.description+'"&gt;&lt;/Viewpoint&gt;');break;case 119:n.setType("walk",this._viewarea);break;case 121:n.setType("freefly",this._viewarea)}},x3dom.X3DDocument.prototype.shutdown=function(e){e&&e.shutdown(this._viewarea)},x3dom.X3DDocument.prototype.hasAnimationStateChanged=function(){return!!this._viewarea&&this._viewarea.hasAnimationStateChanged()},x3dom.X3DDocument.prototype.isAnimating=function(){return!!this._viewarea&&this._viewarea.isAnimating()},x3dom.X3DDocument.prototype.incrementDownloads=function(){this.downloadCount++},x3dom.X3DDocument.prototype.decrementDownloads=function(){this.downloadCount--},x3dom.X3DDocument.prototype.cleanNodeBag=function(e,t){for(var i=0,o=e.length;i<o;i++)if(e[i]===t){e.splice(i,1);break}},x3dom.X3DDocument.prototype.removeX3DOMBackendGraph=function(e){for(var t,o,i,s,n,r=e.childNodes,a=0,d=r.length;a<d;a++)this.removeX3DOMBackendGraph(r[a]);e._x3domNode&&(s=(t=e._x3domNode)._nameSpace,x3dom.isa(t,x3dom.nodeTypes.X3DShapeNode)?(t._cleanupGLObjects&&t._cleanupGLObjects(!0),x3dom.nodeTypes.Shape.idMap.nodeID[t._objectID]&&delete x3dom.nodeTypes.Shape.idMap.nodeID[t._objectID]):x3dom.isa(t,x3dom.nodeTypes.TimeSensor)?this.cleanNodeBag(this._nodeBag.timer,t):x3dom.isa(t,x3dom.nodeTypes.X3DLightNode)?this.cleanNodeBag(this._nodeBag.lights,t):x3dom.isa(t,x3dom.nodeTypes.X3DFollowerNode)?this.cleanNodeBag(this._nodeBag.followers,t):x3dom.isa(t,x3dom.nodeTypes.X3DTransformNode)?this.cleanNodeBag(this._nodeBag.trans,t):x3dom.isa(t,x3dom.nodeTypes.RenderedTexture)?(this.cleanNodeBag(this._nodeBag.renderTextures,t),t._cleanupGLObjects&&t._cleanupGLObjects()):x3dom.isa(t,x3dom.nodeTypes.X3DPointingDeviceSensorNode)?this.cleanNodeBag(this._nodeBag.affectedPointingSensors,t):x3dom.isa(t,x3dom.nodeTypes.Texture)||x3dom.isa(t,x3dom.nodeTypes.AudioClip)?t.shutdown():x3dom.isa(t,x3dom.nodeTypes.X3DBindableNode)?((i=t._stack)&&(t.bind(!1),this.cleanNodeBag(i._bindBag,t)),t._cleanupGLObjects&&t._cleanupGLObjects()):x3dom.isa(t,x3dom.nodeTypes.Scene)&&t._webgl&&(t._webgl=null),!s||e.getAttribute("use")||e.getAttribute("USE")||(s.removeNode(t._DEF),(o=s.superInlineNode)&&o._nameSpace&&(i=o._nameSpace.imports,s=s.exports,n=i.get(o._DEF))&&s.forEach(function(e,i){t._DEF==e&&n.forEach(function(e,t){i==e&&delete o._nameSpace.defMap[t]})})),t._xmlNode=null,delete e._x3domNode)},x3dom.X3DDocument.prototype.getParentNode=function(e){return e=e&&"x3dommetagroup"==e.localName.toLowerCase()?this.getParentNode(e.parentNode):e},x3dom.X3DDocument.prototype.onAttributeChanged=function(e,t,i){"_x3domNode"in e&&(e._x3domNode.updateField(t,i),this.needRender=!0)},x3dom.X3DDocument.prototype.onNodeRemoved=function(e,t){var i,o,s,n;e&&(e.querySelectorAll&&e.querySelectorAll("*").forEach(function(e){e.highlight=null,e.addEventListener=null,e.removeEventListener=null}),(t=this.getParentNode(t))&&"_x3domNode"in t&&"_x3domNode"in e?(t=t._x3domNode,(s=(o=e._x3domNode).findX3DDoc())&&((s=s._viewarea._pickingInfo).firstObj=null,s.lastObj=null,s.lastClickObj=null,s.pickObj=null),t&&o&&(t.removeChild(o),t.nodeChanged(),this.removeX3DOMBackendGraph(e),this._viewarea)&&this._viewarea._scene&&(this._viewarea._scene.nodeChanged(),this._viewarea._scene.updateVolume(),this.needRender=!0)):e.localName&&"ROUTE"==e.localName.toUpperCase()&&e._nodeNameSpace?(s=e._nodeNameSpace.defMap[e.getAttribute("fromNode")],o=e._nodeNameSpace.defMap[e.getAttribute("toNode")],s&&o&&s.removeRoute(e.getAttribute("fromField"),o,e.getAttribute("toField"))):e.localName&&"IMPORT"==e.localName.toUpperCase()&&e._nodeNameSpace?(t=e.getAttribute("inlineDEF")||e.getAttribute("inlinedef"),s=e.getAttribute("importedDEF")||e.getAttribute("importeddef"),i=e.getAttribute("AS")||e.getAttribute("as"),t&&s&&(i=i||s,n=(o=e._nodeNameSpace.imports).get(t))&&n.get(i)==s&&(delete e._nodeNameSpace.defMap[i],n.delete(i),0==n.size)&&o.delete(t)):e.localName&&"EXPORT"==e.localName.toUpperCase()&&e._nodeNameSpace&&(s=e.getAttribute("localDEF")||e.getAttribute("localdef"),i=e.getAttribute("AS")||e.getAttribute("as"),s)&&(n=e._nodeNameSpace.exports).get(i=i||s)==s&&n.delete(i))},x3dom.X3DDocument.prototype.onX3DNodeRemoved=function(e,t){var i=[];"querySelector"in e&&e.querySelector("X3D")&&(i=e.querySelectorAll("X3D")),(i=e.localName&&"X3D"==e.localName.toUpperCase()?[e]:i).forEach(function(e){var t=e.runtime;if(t&&t.canvas&&t.canvas.doc&&t.canvas.doc._scene){var i=t.canvas.doc._scene._xmlNode;this.removeX3DOMBackendGraph(i);for(var o=0;o<x3dom.canvases.length;o++)if(x3dom.canvases[o]===t.canvas){x3dom.canvases[o].doc.shutdown(x3dom.canvases[o].gl),x3dom.canvases.splice(o,1);break}t.canvas.doc._scene=null,t.canvas.doc._viewarea=null,t.canvas.doc=null,t.canvas=null,e.context=t=null,e.runtime=null}},this)},x3dom.X3DDocument.prototype.onNodeAdded=function(e,t){t=this.getParentNode(t);if((!t.tagName||"inline"!=t.tagName.toLowerCase())&&"_x3domNode"in t){var i=t._x3domNode;if(i&&i._nameSpace&&e instanceof Element){if("_x3domNode"in e){if(e._x3domNode._parentNodes.includes(i))return;i.removeChild(e._x3domNode),this.removeX3DOMBackendGraph(e)}x3dom.caps.DOMNodeInsertedEvent_perSubtree&&this.removeX3DOMBackendGraph(e);var o=i._nameSpace.setupTree(e),o=(i.addChild(o,e.getAttribute("containerField")),i.nodeChanged(),t.parentNode);o&&o._x3domNode&&o._x3domNode.nodeChanged(),this._viewarea&&this._viewarea._scene&&(this._viewarea._scene.nodeChanged(),this._viewarea._scene.updateVolume(),this.needRender=!0)}else x3dom.debug.logWarning("No _nameSpace in onNodeAdded")}},x3dom.X3DDocument.prototype.onX3DNodeAdded=function(e,t){e.localName&&e.localName.toUpperCase()},x3dom.X3DDocument.prototype.onMutation=function(e){for(var t,i,o=0,s=e.length;o<s;o++)if("attributes"===(t=e[o]).type)null==t.oldValue&&!t.attributeName.startsWith("set_")||(i=t.target.getAttribute(t.attributeName),this.onAttributeChanged(t.target,t.attributeName,i));else if("childList"===t.type){if(t.removedNodes.length)for(var n=0,r=t.removedNodes.length;n<r;n++)this.onNodeRemoved(t.removedNodes[n],t.target);if(t.addedNodes.length)for(n=0,r=t.addedNodes.length;n<r;n++)this.onNodeAdded(t.addedNodes[n],t.target)}},x3dom.X3DDocument.prototype.onX3DMutation=function(e){for(var t=0,i=e.length;t<i;t++)if("childList"===e[t].type&&e[t].removedNodes.length)for(var o=0,s=e[t].removedNodes.length;o<s;o++)this.onX3DNodeRemoved(e[t].removedNodes[o],e[t].target)},x3dom.MatrixMixer=function(e,t){this.beginTime=e||0,this.endTime=t||1,this.isMixing=!1,this._beginMat=x3dom.fields.SFMatrix4f.identity(),this._beginInvMat=x3dom.fields.SFMatrix4f.identity(),this._beginLogMat=x3dom.fields.SFMatrix4f.identity(),this._endMat=x3dom.fields.SFMatrix4f.identity(),this._endLogMat=x3dom.fields.SFMatrix4f.identity(),this._beginRot=new x3dom.fields.Quaternion,this._endRot=new x3dom.fields.Quaternion,this._beginPos=new x3dom.fields.SFVec3f,this._endPos=new x3dom.fields.SFVec3f,this._result=x3dom.fields.SFMatrix4f.identity(),this._useQuaternion=!1,this._isVPtarget=!1},x3dom.MatrixMixer.prototype._calcFraction=function(e){e=(e-this.beginTime)/(this.endTime-this.beginTime);return(Math.sin(e*Math.PI-Math.PI/2)+1)/2},x3dom.MatrixMixer.prototype._isValid=function(){var e=this._beginMat.inverse().mult(this._endMat).getEulerAngles();return Math.abs(e[0])!=Math.PI&&Math.abs(e[1])!=Math.PI&&Math.abs(e[2])!=Math.PI},x3dom.MatrixMixer.prototype._prepareQuaternionAnimation=function(){this._beginRot.setValue(this._beginMat),this._endRot.setValue(this._endMat),this._beginPos=this._beginMat.e3(),this._endPos=this._endMat.e3(),this._useQuaternion=!0},x3dom.MatrixMixer.prototype.reset=function(){this.beginTime=0,this.endTime=0,this._useQuaternion=!1,this.isMixing=!1},x3dom.MatrixMixer.prototype.isActive=function(){return 0<this.beginTime},x3dom.MatrixMixer.prototype.setBeginMatrix=function(e){this._beginMat.setValues(e),this._beginInvMat=e.inverse(),this._beginLogMat=x3dom.fields.SFMatrix4f.zeroMatrix()},x3dom.MatrixMixer.prototype.getBeginMatrix=function(e){return this._beginMat},x3dom.MatrixMixer.prototype.setEndMatrix=function(e){this._endMat.setValues(e),this._isValid()||this._prepareQuaternionAnimation(),this._endLogMat=this._endMat.mult(this._beginInvMat).log(),this._logDiffMat=this._endLogMat.addScaled(this._beginLogMat,-1)},x3dom.MatrixMixer.prototype.getEndMatrix=function(e){return this._endMat},x3dom.MatrixMixer.prototype._mixQuaternion=function(e){var t=this._beginRot.slerp(this._endRot,e),e=this._beginPos.addScaled(this._endPos.subtract(this._beginPos),e);return this._result.setRotate(t),this._result.setTranslate(e),this._result.copy()},x3dom.MatrixMixer.prototype._mixMatrix=function(e){return this._logDiffMat.multiply(e).add(this._beginLogMat).exp().mult(this._beginMat)},x3dom.MatrixMixer.prototype.mix=function(e){if(e<=this.beginTime)return this._beginMat;if(e>=this.endTime)return this.reset(),this._endMat;this.isMixing=!0;e=this._calcFraction(e);return this._useQuaternion?this._mixQuaternion(e):this._mixMatrix(e)},x3dom.Mesh=function(e){this._parent=e,this._vol=new x3dom.fields.BoxVolume,this._invalidate=!0,this._numFaces=0,this._numCoords=0,this._primType="TRIANGLES",this._positions=[],this._normals=[],this._texCoords=[],this._texCoords2=[],this._colors=[],this._indices=[],this._tangents=[],this._binormals=[],this._positions[0]=[],this._normals[0]=[],this._texCoords[0]=[],this._texCoords2[0]=[],this._colors[0]=[],this._indices[0]=[],this._tangents[0]=[],this._binormals[0]=[]},x3dom.Mesh.prototype._dynamicFields={},x3dom.Mesh.prototype._numPosComponents=3,x3dom.Mesh.prototype._numTexComponents=2,x3dom.Mesh.prototype._numTex2Components=2,x3dom.Mesh.prototype._numColComponents=3,x3dom.Mesh.prototype._numNormComponents=3,x3dom.Mesh.prototype._numTangentComponents=3,x3dom.Mesh.prototype._numBinormalComponents=3,x3dom.Mesh.prototype._lit=!0,x3dom.Mesh.prototype._vol=null,x3dom.Mesh.prototype._invalidate=!0,x3dom.Mesh.prototype._numFaces=0,x3dom.Mesh.prototype._numCoords=0,x3dom.Mesh.prototype.getVolume=function(){if(1==this._invalidate&&!this._vol.isValid()){var e=this._positions[0],t=e.length;if(3<=t){var i=new x3dom.fields.SFVec3f(e[0],e[1],e[2]);this._vol.setBounds(i,i);for(var o=3;o<t;o+=3)this._vol.min.x>e[o]&&(this._vol.min.x=e[o]),this._vol.min.y>e[o+1]&&(this._vol.min.y=e[o+1]),this._vol.min.z>e[o+2]&&(this._vol.min.z=e[o+2]),this._vol.max.x<e[o]&&(this._vol.max.x=e[o]),this._vol.max.y<e[o+1]&&(this._vol.max.y=e[o+1]),this._vol.max.z<e[o+2]&&(this._vol.max.z=e[o+2]);this._invalidate=!1}}return this._vol},x3dom.Mesh.prototype.invalidate=function(){this._invalidate=!0,this._vol.invalidate()},x3dom.Mesh.prototype.isValid=function(){return this._vol.isValid()},x3dom.Mesh.prototype.getCenter=function(){return this.getVolume().getCenter()},x3dom.Mesh.prototype.getDiameter=function(){return this.getVolume().getDiameter()},x3dom.Mesh.prototype.doIntersect=function(e){var t=this.getVolume(),t=e.intersect(t.min,t.max);return t&&e.enter<e.dist&&(e.dist=e.enter,e.hitObject=this._parent,e.hitPoint=e.pos.add(e.dir.multiply(e.enter))),t},x3dom.Mesh.prototype.calcNormals=function(e,t){void 0===t&&(t=!0);var i,o,s,n,r,a,d,l=this._multiIndIndices&&this._multiIndIndices.length,h=l?this._multiIndIndices:this._indices[0],u=this._positions[0],f=[],c=[],_=u.length,m=null;for(g=3*(0<(g=void 0!==this._posSize&&this._posSize>_?this._posSize/3:_/3)-Math.floor(g)?Math.floor(g+1):g),i=0;i<g;++i)c[i]=[];for(g=h.length,i=0;i<g;i+=3)l?(n=3*i,a=3*(i+2),d=new x3dom.fields.SFVec3f(u[r=3*(i+1)],u[r+1],u[r+2]),o=new x3dom.fields.SFVec3f(u[n],u[n+1],u[n+2]).subtract(d),s=d.subtract(new x3dom.fields.SFVec3f(u[a],u[a+1],u[a+2]))):(n=3*h[i],r=3*h[i+1],a=3*h[i+2],d=new x3dom.fields.SFVec3f(u[r],u[r+1],u[r+2]),o=new x3dom.fields.SFVec3f(u[n],u[n+1],u[n+2]).subtract(d),s=d.subtract(new x3dom.fields.SFVec3f(u[a],u[a+1],u[a+2])),n=3*i,r=3*(i+1),a=3*(i+2)),m=o.cross(s).normalize(),t||(m=m.negate()),e<=x3dom.fields.Eps?(f[n]=f[r]=f[a]=m.x,f[n+1]=f[r+1]=f[a+1]=m.y,f[n+2]=f[r+2]=f[a+2]=m.z):(c[h[i]].push(m),c[h[i+1]].push(m),c[h[i+2]].push(m));if(e>x3dom.fields.Eps)for(i=0;i<_;i+=3){for(var p,x=i/3,g=(p=l?c[h[x]]:c[x]).length,m=new x3dom.fields.SFVec3f(0,0,0),v=0;v<g;++v)m=m.add(p[v]);m=m.normalize(),f[i]=m.x,f[i+1]=m.y,f[i+2]=m.z}this._normals[0]=f},x3dom.Mesh.prototype.splitMesh=function(e,t){var e=void 0===e?3:e,i=(void 0===t&&(t=!1),x3dom.Utils.maxIndexableCoords),i=Math.floor(i/e)*e;if(!(this._positions[0].length/3<=i)||t){var o=!!t&&this._multiIndIndices&&this._multiIndIndices.length,s=this._positions[0],n=this._normals[0],r=this._texCoords[0],a=this._colors[0],d=o?this._multiIndIndices:this._indices[0],l=this._tangents[0],h=this._binormals[0],u=0;do{this._positions[u]=[],this._normals[u]=[],this._texCoords[u]=[],this._colors[u]=[],this._indices[u]=[],this._tangents[u]=[],this._binormals[u]=[];var f=0<=d.length-(u+1)*i;if(this._indices[u]=f?d.slice(u*i,(u+1)*i):d.slice(u*i),o)for(_=0,m=this._indices[u].length;_<m;_++)this._indices[u][_]=_;else if(u)for(var c=u*i,_=0,m=this._indices[u].length;_<m;_++)this._indices[u][_]-=c}while(this._positions[u]=f?s.slice(u*i*3,3*(u+1)*i):s.slice(u*i*3),n.length&&(this._normals[u]=f?n.slice(u*i*3,3*(u+1)*i):n.slice(u*i*3)),r.length&&(this._texCoords[u]=f?r.slice(u*i*this._numTexComponents,this._numTexComponents*(u+1)*i):r.slice(u*i*this._numTexComponents)),a.length&&(this._colors[u]=f?a.slice(u*i*this._numColComponents,this._numColComponents*(u+1)*i):a.slice(u*i*this._numColComponents)),l.length&&(this._tangents[u]=f?l.slice(u*i*3,3*(u+1)*i):l.slice(u*i*3)),h.length&&(this._binormals[u]=f?h.slice(u*i*3,3*(u+1)*i):h.slice(u*i*3)),s.length>++u*i*3)}},x3dom.Mesh.prototype.calcTexCoords=function(e){if(this._texCoords[0]=[],"sphere-local"===e.toLowerCase())for(var t=0,i=0,o=this._normals[0].length;t<o;t+=3)this._texCoords[0][i++]=.5+this._normals[0][t]/2,this._texCoords[0][i++]=.5+this._normals[0][t+1]/2;if("coord"===e.toLowerCase())for(var s=0,n=0,r=this._positions[0].length;s<r;s+=3)this._texCoords[0][n++]=this._positions[0][s],this._texCoords[0][n++]=this._positions[0][s+1];else{var a=new x3dom.fields.SFVec3f(0,0,0),e=new x3dom.fields.SFVec3f(0,0,0),d=(this.getVolume().getBounds(a,e),e.subtract(a)),l=0,h=1,h=d.x>=d.y?d.x>=d.z?(l=0,d.y>=d.z?1:2):(l=2,0):d.y>=d.z?(l=1,d.x>=d.z?0:2):(l=2,1),u=1,f=0,c=0;switch(l){case 0:u=d.x,f=a.x;break;case 1:u=d.y,f=a.y;break;case 2:u=d.z,f=a.z}switch(h){case 0:d.x,c=a.x;break;case 1:d.y,c=a.y;break;case 2:d.z,c=a.z}for(r=this._positions[n=s=0].length;s<r;s+=3)this._texCoords[0][n++]=(this._positions[0][s+l]-f)/u,this._texCoords[0][n++]=(this._positions[0][s+h]-c)/u}},x3dom.docs={},x3dom.docs.specURLMap={CADGeometry:"CADGeometry.html",Core:"core.html",DIS:"dis.html",CubeMapTexturing:"env_texture.html",EnvironmentalEffects:"enveffects.html",EnvironmentalSensor:"envsensor.html",Followers:"followers.html",Geospatial:"geodata.html",Geometry2D:"geometry2D.html",Geometry3D:"geometry3D.html",Grouping:"group.html","H-Anim":"hanim.html",Interpolation:"interp.html",KeyDeviceSensor:"keyboard.html",Layering:"layering.html",Layout:"layout.html",Lighting:"lighting.html",Navigation:"navigation.html",Networking:"networking.html",NURBS:"nurbs.html",ParticleSystems:"particle_systems.html",Picking:"picking.html",PointingDeviceSensor:"pointingsensor.html",Rendering:"rendering.html",RigidBodyPhysics:"rigid_physics.html",Scripting:"scripting.html",Shaders:"shaders.html",Shape:"shape.html",Sound:"sound.html",Text:"text.html",Texturing3D:"texture3D.html",Texturing:"texturing.html",Time:"time.html",EventUtilities:"utils.html",VolumeRendering:"volume.html"},x3dom.docs.specBaseURL="https://www.web3d.org/documents/specifications/19775-1/V3.3/Part01/components/",x3dom.docs.getNodeTreeInfo=function(){function o(e,t){for(var i=0;i<t;i++)s+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";for(i in s+="<a href='"+x3dom.docs.specBaseURL+x3dom.docs.specURLMap[x3dom.nodeTypes[e]._compName]+"#"+e+"' style='color:black; text-decoration:none; font-weight:bold;'>"+e+"</a> &nbsp; <a href='"+x3dom.docs.specBaseURL+x3dom.docs.specURLMap[x3dom.nodeTypes[e]._compName]+"' style='color:black; text-decoration:none; font-style:italic;'>"+x3dom.nodeTypes[e]._compName+"</a><br/>",x3dom.nodeTypes[e].childTypes[e])o(x3dom.nodeTypes[e].childTypes[e][i],t+1)}var e,t,s="";for(e in x3dom.nodeTypes)for(void 0===(t=x3dom.nodeTypes[e]).childTypes&&(t.childTypes={});t.superClass;)void 0===t.superClass.childTypes[t.superClass._typeName]&&(t.superClass.childTypes[t.superClass._typeName]=[]),((e,t)=>{for(var i=0;i<e.length;i++)if(e[i]===t)return!0;return!1})(t.superClass.childTypes[t.superClass._typeName],t._typeName)||t.superClass.childTypes[t.superClass._typeName].push(t._typeName),t=t.superClass;return o("X3DNode",0),"<div class='x3dom-doc-nodes-tree'>"+s+"</div>"},x3dom.docs.getComponentInfo=function(){var e,t,i,o=[],s="";for(t in x3dom.components)o.push(t);for(i in o.sort(),o){for(var n in e=x3dom.components[t=o[i]],s=s+("<h2><a href='"+x3dom.docs.specBaseURL+x3dom.docs.specURLMap[t]+"' style='color:black; text-decoration:none; font-style:italic;'>"+t+"</a></h2>")+"<ul style='list-style-type:circle;'>",e){if(s+="<li><a href='"+x3dom.docs.specBaseURL+x3dom.docs.specURLMap[t]+"#"+n+"' style='color:black; text-decoration:none; font-weight:bold;'>"+n+"</a> <ul>",!n.startsWith("X3D")){try{var r,a=new x3dom.nodeTypes[n];for(r in s+="-- basic fields --",a._vf)s+="<li>"+r+": "+a._vf[r],s+="</li>"}catch(e){}try{for(var d in s+="-- node fields --",a._cf)s+="<li>"+d+": "+JSON.stringify(a._cf[d]),s+="</li>"}catch(e){}}s+="</ul> </li>"}s+="</ul>"}return s},x3dom.arc={},x3dom.arc.instance=null,x3dom.arc.Limits=function(e,t,i){this._min=e,this._max=t,this.getValue=function(e){return e=this._min+(this._max-this._min)*e,this._max>=e?this._min<=e?e:this._min:this._max}},x3dom.arc.ARF=function(e,t,i,o,s,n,r,a){this._name=e,this._stateValue=[.5,.5],this._limits=new x3dom.arc.Limits(t,i),this._factorGetterFunc=s,this._factorSetterFunc=n,this._setterFunc=a,this._getterFunc=r,this._dirFac=o,this.getFactor=function(){return this._factorGetterFunc()},this.update=function(e,t){t=this._stateValue[e]+t*this._dirFac;this._stateValue[e]=0<=t?t<=1?t:1:0,this._setterFunc(this._limits.getValue(this._stateValue[e]))},this.reset=function(){this._stateValue[0]=.5,this._stateValue[1]=.5}},x3dom.arc.AdaptiveRenderControl=defineClass(null,function(e){(x3dom.arc.instance=this)._scene=e,this._targetFrameRate=[],this._targetFrameRate[0]=this._scene._vf.minFrameRate,this._targetFrameRate[1]=this._scene._vf.maxFrameRate,this._currentState=0;var t=this._scene.getEnvironment();this._arfs=[],this._arfs.push(new x3dom.arc.ARF("smallFeatureCulling",0,10,-1,function(){return t._vf.smallFeatureFactor},function(e){t._vf.smallFeatureFactor=e},function(){return t._vf.smallFeatureThreshold},function(e){t._vf.smallFeatureThreshold=e})),this._arfs.push(new x3dom.arc.ARF("lowPriorityCulling",0,100,1,function(){return t._vf.lowPriorityFactor},function(e){t._vf.lowPriorityFactor=e},function(){return 100*t._vf.lowPriorityThreshold},function(e){t._vf.lowPriorityThreshold=e/100})),this._arfs.push(new x3dom.arc.ARF("tessellationDetailCulling",1,12,-1,function(){return t._vf.tessellationErrorFactor},function(e){t._vf.tessellationErrorFactor=e},function(){return t.tessellationErrorThreshold},function(e){t.tessellationErrorThreshold=e})),this._stepWidth=.1},{update:function(e,t){this._currentState=e;t-=this._targetFrameRate[e];this._stepWidth=10<Math.abs(t)?.1:.01;for(var i=0,o=[],s=this._arfs.length,n=0;n<s;++n)o[n]=this._arfs[n].getFactor(),0<o[n]&&(i+=o[n]);var r=t<0?-1:1;for(n=0;n<s;++n)0<o[n]&&(o[n]/=i,this._arfs[n].update(e,this._stepWidth*o[n]*r))},reset:function(){for(var e=0,t=this._arfs.length;e<t;++e)this._arfs[e].reset()}}),x3dom.RequestManager={},x3dom.RequestManager.requests=[],x3dom.RequestManager.maxParallelRequests=50,x3dom.RequestManager.failedRequests=0,x3dom.RequestManager.loadedRequests=0,x3dom.RequestManager.totalRequests=0,x3dom.RequestManager.activeRequests=[],x3dom.RequestManager.requestHeaders=[],x3dom.RequestManager.withCredentials=!1,x3dom.RequestManager.onSendRequest=function(e){},x3dom.RequestManager.onAbortAllRequests=function(e){},x3dom.RequestManager.addRequestHeader=function(e,t){this.requestHeaders.push({header:e,value:t})},x3dom.RequestManager._sendRequest=function(){var e;this.onSendRequest(this._getCounters()),this.activeRequests.length>this.maxParallelRequests||(e=this.requests.pop())&&(this.activeRequests.push(e),e.send(null),this._sendRequest())},x3dom.RequestManager._getCounters=function(){return{loaded:this.loadedRequests,active:this.activeRequests.length,failed:this.failedRequests,total:this.totalRequests}},x3dom.RequestManager.addRequest=function(e){if(e instanceof XMLHttpRequest){this.totalRequests++,e.withCredentials=this.withCredentials;for(var t=0;t<this.requestHeaders.length;t++){var i=this.requestHeaders[t].header,o=this.requestHeaders[t].value;e.setRequestHeader(i,o)}e.addEventListener("load",this._onLoadHandler.bind(this)),e.addEventListener("error",this._onErrorHandler.bind(this)),this.requests.push(e),this._sendRequest()}},x3dom.RequestManager.abortAllRequests=function(){for(var e=0;e<this.activeRequests.length;e++)this.activeRequests[e].abort();this.requests=[],this.activeRequests=[],this.failedRequests=0,this.loadedRequests=0,this.totalRequests=0,this.onAbortAllRequests(this._getCounters())},x3dom.RequestManager._removeActiveRequest=function(e){e=this.activeRequests.indexOf(e);return this.activeRequests.splice(e,1)},x3dom.RequestManager._onLoadHandler=function(e){this._removeActiveRequest(e.target),this.loadedRequests++,this._sendRequest()},x3dom.RequestManager._onErrorHandler=function(e){this._removeActiveRequest(e.target),this.failedRequests++,this._sendRequest()},x3dom.Properties=function(){this.properties={}},x3dom.Properties.prototype.setProperty=function(e,t){x3dom.debug.logInfo("Properties: Setting property '"+e+"' to value '"+t+"'"),this.properties[e]=t},x3dom.Properties.prototype.getProperty=function(e,t){return this.properties[e]||t},x3dom.Properties.prototype.merge=function(e){for(var t in e.properties)this.properties[t]=e.properties[t]},x3dom.Properties.prototype.toString=function(){var e,t="";for(e in this.properties)t+="Name: "+e+" Value: "+this.properties[e]+"\n";return t},x3dom.DoublyLinkedList=function(){this.length=0,this.first=null,this.last=null},x3dom.DoublyLinkedList.ListNode=function(e,t,i,o,s){this.point=e,this.point_index=t,this.normals=i,this.colors=o,this.texCoords=s,this.next=null,this.prev=null},x3dom.DoublyLinkedList.prototype.appendNode=function(e){null===this.first?(e.prev=e,this.first=e.next=e):(e.prev=this.last,e.next=this.first,this.first.prev=e,this.last.next=e),this.last=e,this.length++},x3dom.DoublyLinkedList.prototype.insertAfterNode=function(e,t){t.prev=e,t.next=e.next,e.next.prev=t,(e.next=t).prev==this.last&&(this.last=t),this.length++},x3dom.DoublyLinkedList.prototype.deleteNode=function(e){1<this.length?(e.prev.next=e.next,e.next.prev=e.prev,e==this.first&&(this.first=e.next),e==this.last&&(this.last=e.prev)):(this.first=null,this.last=null),e.prev=null,e.next=null,this.length--},x3dom.DoublyLinkedList.prototype.getNode=function(e){var t=null;if(e>this.length)return t;for(var i=0;i<this.length;i++)if(t=0==i?this.first:t.next,i==e)return t;return null},x3dom.DoublyLinkedList.prototype.invert=function(){for(var e=null,t=this.first,i=0;i<this.length;i++)e=t.prev,t.prev=t.next,t.next=e,t=t.prev;e=this.first,this.first=this.last,this.last=e},x3dom.EarClipping={getIndexes:function(e){for(var t,i,o=e.first.next,s=this.identifyPlane(o.prev.point,o.point,o.next.point),n=[],r=[],a=0;a<e.length;a++){switch(o=e.getNode(a),s){case"XY":t=o.point.x,i=o.point.y;break;case"XZ":t=o.point.z,i=o.point.x;break;default:t=o.point.y,i=o.point.z}n.push(i),n.push(t),r.push(o.point_index)}var d=x3dom.EarCut.triangulate(n,null,2);return d.map(function(e){return r[e]})},getMultiIndexes:function(e){for(var t,i,o=e.first.next,s=this.identifyPlane(o.prev.point,o.point,o.next.point),n={indices:[],point:[],normals:[],colors:[],texCoords:[]},r={indices:[],point:[],normals:[],colors:[],texCoords:[]},a=[],d=0;d<e.length;d++){switch(o=e.getNode(d),s){case"XY":t=o.point.x,i=o.point.y;break;case"XZ":t=o.point.z,i=o.point.x;break;default:t=o.point.y,i=o.point.z}a.push(i),a.push(t),r.indices.push(o.point_index),r.point.push(o.point),o.normals&&r.normals.push(o.normals),o.colors&&r.colors.push(o.colors),o.texCoords&&r.texCoords.push(o.texCoords)}var l=x3dom.EarCut.triangulate(a,null,2);return n.indices=l.map(function(e){return r.indices[e]}),n.point=l.map(function(e){return r.point[e]}),o.normals&&(n.normals=l.map(function(e){return r.normals[e]})),o.colors&&(n.colors=l.map(function(e){return r.colors[e]})),o.texCoords&&(n.texCoords=l.map(function(e){return r.texCoords[e]})),n},identifyPlane:function(e,t,i){var o=t.x-e.x,s=t.y-e.y,t=t.z-e.z,n=i.x-e.x,r=i.y-e.y,i=i.z-e.z,e=Math.abs(s*i-t*r),t=Math.abs(t*n-o*i),i=Math.abs(o*r-s*n),o=Math.max(e,t,i);return o==e?"YZ":o!=t&&o==i?"XY":"XZ"}},x3dom.EarCut={triangulate:function(e,t,i){var o=e,e=t,s=void 0;s=i||2;var n,r,a,d,l,t=e&&e.length,h=t?e[0]*s:o.length,i=((e,t,i)=>{for(var o=0,s=0,n=t-i;s<t;s+=i)o+=(e[n]-e[s])*(e[s+1]+e[n+1]),n=s;return 0<o})(o,h,s),u=p(o,0,h,s,!0,i),f=[];if(u){if(t&&(u=((e,t,i,o)=>{for(var s,n,r,a=[],d=0,l=t.length;d<l;d++)(s=p(e,t[d]*o,d<l-1?t[d+1]*o:e.length,o,!1))===s.next&&(s.steiner=!0),a.push((e=>{for(var t=e,i=e;t.x<i.x&&(i=t),(t=t.next)!==e;);return i})(s));for(a.sort(x),d=0;d<a.length;d++)(r=((e,t)=>{var i,o,s=t,n=e.x,r=e.y,a=-1/0;do{}while(r<=s.y&&r>=s.next.y&&(o=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y))<=n&&a<o&&(a=o,i=s.x<s.next.x?s:s.next),(s=s.next)!==t);if(!i)return null;for(var d,l=i,h=1/0,s=i.next;s!==l;)n>=s.x&&s.x>=i.x&&w(r<i.y?n:a,r,i.x,i.y,r<i.y?a:n,r,s.x,s.y)&&((d=Math.abs(r-s.y)/(n-s.x))<h||d===h&&s.x>i.x)&&N(s,e)&&(i=s,h=d),s=s.next;return i})(n=a[d],r=i))&&E(r=I(r,n),r.next),i=E(i,i.next);return i})(o,e,u,s)),o.length>80*s){for(var c=n=o[0],_=r=o[1],m=s;m<h;m+=s)(a=o[m])<c&&(c=a),(d=o[m+1])<_&&(_=d),n<a&&(n=a),r<d&&(r=d);l=Math.max(n-c,r-_)}M(u,f,s,c,_,l),!1===i&&f.reverse()}return f;function p(e,t,i,o,s,n){var r,a;if(s===n)for(r=t;r<i;r+=o)a=g(r,e[r],e[r+1],a);else for(r=i-o;t<=r;r-=o)a=g(r,e[r],e[r+1],a);return a}function E(e,t){if(!e)return e;t=t||e;var i,o=e;do{if(i=!1,o.steiner||!R(o,o.next)&&0!==A(o.prev,o,o.next))o=o.next;else{if(P(o),(o=t=o.prev)===o.next)return null;i=!0}}while(i||o!==t);return t}function M(e,t,i,o,s,n,r){if(e){if(!r&&n){var a=e;var d=o;var l=s;var h=n;for(var u=a;null===u.z&&(u.z=C(u.x,u.y,d,l,h)),u.prevZ=u.prev,u.nextZ=u.next,(u=u.next)!==a;);u.prevZ.nextZ=null,u.prevZ=null;var f,c,_,m,p,x,g,v,y=u,T=1;do{for(c=y,p=y=null,x=0;c;){for(x++,_=c,f=g=0;f<T&&(g++,_=_.nextZ);f++);for(v=T;0<g||0<v&&_;)0!==g&&(0===v||!_||c.z<=_.z)?(c=(m=c).nextZ,g--):(_=(m=_).nextZ,v--),p?p.nextZ=m:y=m,m.prevZ=p,p=m;c=_}}while(p.nextZ=null,T*=2,1<x)}for(var b,S,F=e;e.prev!==e.next;)if(b=e.prev,S=e.next,n?((e,t,i,o)=>{var s=e.prev,n=e,r=e.next;if(!(0<=A(s,n,r))){for(var a=(s.x<n.x?s.x<r.x?s:r:n.x<r.x?n:r).x,d=(s.y<n.y?s.y<r.y?s:r:n.y<r.y?n:r).y,l=(n.x<s.x?s.x>r.x?s:r:n.x>r.x?n:r).x,h=(n.y<s.y?s.y>r.y?s:r:n.y>r.y?n:r).y,u=C(a,d,t,i,o),f=C(l,h,t,i,o),c=e.nextZ;c&&c.z<=f;){if(c!==e.prev&&c!==e.next&&w(s.x,s.y,n.x,n.y,r.x,r.y,c.x,c.y)&&0<=A(c.prev,c,c.next))return;c=c.nextZ}for(c=e.prevZ;c&&c.z>=u;){if(c!==e.prev&&c!==e.next&&w(s.x,s.y,n.x,n.y,r.x,r.y,c.x,c.y)&&0<=A(c.prev,c,c.next))return;c=c.prevZ}return 1}})(e,o,s,n):(e=>{var t=e.prev,i=e,o=e.next;if(!(0<=A(t,i,o))){for(var s=e.next.next;s!==e.prev;){if(w(t.x,t.y,i.x,i.y,o.x,o.y,s.x,s.y)&&0<=A(s.prev,s,s.next))return;s=s.next}return 1}})(e))t.push(b.i/i),t.push(e.i/i),t.push(S.i/i),P(e),e=S.next,F=S.next;else if((e=S)===F){r?1===r?M(e=((e,t,i)=>{var o=e;do{var s=o.prev,n=o.next.next}while(D(s,o,o.next,n)&&N(s,n)&&N(n,s)&&(t.push(s.i/i),t.push(o.i/i),t.push(n.i/i),P(o),P(o.next),o=e=n),(o=o.next)!==e);return o})(e,t,i),t,i,o,s,n,2):2===r&&((e,t,i,o,s,n)=>{var r=e;do{for(var a,d=r.next.next;d!==r.prev;){if(r.i!==d.i&&((e,t)=>R(e,t)||e.next.i!==t.i&&e.prev.i!==t.i&&!((e,t)=>{var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&D(i,i.next,e,t))return 1}while((i=i.next)!==e)})(e,t)&&N(e,t)&&N(t,e)&&((e,t)=>{for(var i=e,o=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;i.y>n!=i.next.y>n&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(o=!o),(i=i.next)!==e;);return o})(e,t))(r,d))return a=I(r,d),r=E(r,r.next),a=E(a,a.next),M(r,t,i,o,s,n),M(a,t,i,o,s,n);d=d.next}}while((r=r.next)!==e)})(e,t,i,o,s,n):M(E(e),t,i,o,s,n,1);break}}}function x(e,t){return e.x-t.x}function C(e,t,i,o,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/s)|e<<8))|e<<4))|e<<2))|e<<1))|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-o)/s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function w(e,t,i,o,s,n,r,a){return 0<=(s-r)*(t-a)-(e-r)*(n-a)&&0<=(e-r)*(o-a)-(i-r)*(t-a)&&0<=(i-r)*(n-a)-(s-r)*(o-a)}function A(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function R(e,t){return e.x===t.x&&e.y===t.y}function D(e,t,i,o){return 0<A(e,t,i)!=0<A(e,t,o)&&0<A(i,o,e)!=0<A(i,o,t)}function N(e,t){return A(e.prev,e,e.next)<0?0<=A(e,t,e.next)&&0<=A(e,e.prev,t):A(e,t,e.prev)<0||A(e,e.next,t)<0}function I(e,t){var i=new v(e.i,e.x,e.y),o=new v(t.i,t.x,t.y),s=e.next,n=t.prev;return(e.next=t).prev=e,(i.next=s).prev=i,o.next=i,(n.next=i.prev=o).prev=n,o}function g(e,t,i,o){e=new v(e,t,i);return o?(e.next=o.next,(e.prev=o).next.prev=e,o.next=e):(e.prev=e).next=e,e}function P(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function v(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},x3dom.FieldInterpolator=function(e,t,i,o){this.beginTime=e||0,this.endTime=t||1,this.beginValue=i||0,this.endValue=o||0,this.isInterpolating=!1},x3dom.FieldInterpolator.prototype.isActive=function(){return 0<this.beginTime},x3dom.FieldInterpolator.prototype.calcFraction=function(e){e=(e-this.beginTime)/(this.endTime-this.beginTime);return(Math.sin(e*Math.PI-Math.PI/2)+1)/2},x3dom.FieldInterpolator.prototype.reset=function(){this.isInterpolating=!1,this.beginTime=0,this.endTime=1,this.beginValue=0,this.endValue=0},x3dom.FieldInterpolator.prototype.interpolate=function(e){var t;return e<this.beginTime?this.beginValue:e>=this.endTime?(t=this.endValue,this.reset(),t):(this.isInterpolating=!0,this.beginValue+(this.endValue-this.beginValue)*this.calcFraction(e))},x3dom.Utils={},x3dom.Utils.maxIndexableCoords=65535,x3dom.Utils.needLineWidth=!1,x3dom.Utils.measurements=[],window.performance=window.performance||{},performance.now=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()},x3dom.Utils.startMeasure=function(e){e=e.toUpperCase();x3dom.Utils.measurements[e]||(x3dom.Utils.measurements[e]=performance.now())},x3dom.Utils.stopMeasure=function(e){var t,e=e.toUpperCase();return x3dom.Utils.measurements[e]?(t=x3dom.Utils.measurements[e],delete x3dom.Utils.measurements[e],performance.now()-t):0},x3dom.Utils.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},x3dom.Utils.createTexture2D=function(t,i,s,e,o,n,r,a,d){a=a||!1;var l=t.createTexture(),h=new Uint8Array([0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255]),u=(t.bindTexture(t.TEXTURE_2D,l),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,t.UNSIGNED_BYTE,h),r&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),l.ready=!1,0);if(null!=s&&""!=s){var f=new Image;switch(o.toLowerCase()){case"anonymous":f.crossOrigin="anonymous";break;case"use-credentials":f.crossOrigin="use-credentials";break;case"none":break;default:x3dom.Utils.forbiddenBySOP(s)&&(f.crossOrigin="anonymous")}var c=function(){var o;d&&0===d.getOrigChannelCount()?((o=new XMLHttpRequest).open("GET",s),o.onloadstart=function(){o.responseType="arraybuffer"},o.onload=function(){var e=o.getResponseHeader("Content-Type"),t=new Uint8Array(o.response),i=x3dom.Utils.detectChannelCount(t,e);i&&d.setOrigChannelCount(i),f.src=x3dom.Utils.arrayBufferToObjectURL(t,e)},o.onerror=function(){x3dom.debug.logError("[Utils|createTexture2D] Can't http request: "+s),f.src=s},x3dom.RequestManager.addRequest(o)):f.src=s,i.incrementDownloads()};c(),f.onload=function(){l.originalWidth=f.width,l.originalHeight=f.height,n&&(f=x3dom.Utils.scaleImage(f)),1!=e&&1!=a||t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,l),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,f),r&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),1!=e&&1!=a||t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),l.width=f.width,l.height=f.height,l.ready=!0,i.decrementDownloads(),i.needRender=!0},f.onerror=function(e){x3dom.Utils.tryDDSLoading(l,t,i,s,r,a,d).then(function(){i.decrementDownloads(),i.needRender=!0},function(){x3dom.debug.logError("[Utils|createTexture2D] Can't load Image: "+s),i.decrementDownloads(),u++,d&&u<d._vf.url.length&&(s=d._nameSpace.getURL(d._vf.url[u]),c())})}}return l},x3dom.Utils.tryDDSLoading=function(r,a,e,t,i,o,d){return x3dom.DDSLoader.load(t).then(function(e){if(e&&(!e.isCompressed||x3dom.caps.COMPRESSED_TEXTURE)){for(var t in a.bindTexture(e.type,r),x3dom.Utils.isPowerOfTwo(e.width)||x3dom.Utils.isPowerOfTwo(e.height)?e.generateMipmaps&&a.texParameteri(e.type,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR):(a.texParameteri(e.type,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(e.type,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(e.type,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(e.type,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e.generateMipmaps=!1),e.data)for(var i=e.width,o=e.height,s=e.data[t],n=0;n<s.length;n++)0!=n&&(i=Math.max(.5*i,1),o=Math.max(.5*o,1)),e.format.internal<33776||33779<e.format.internal?a.texImage2D(+t,n,e.format.internal,i,o,0,e.format.format,e.format.type,s[n]):(a.compressedTexImage2D(+t,n,e.format.internal,i,o,0,s[n]),e.generateMipmaps=!1);e.generateMipmaps&&a.generateMipmap(e.type),a.bindTexture(e.type,null),r.width=e.width,r.height=e.height,r.ready=!0,r.textureCubeReady=!0,d&&e.channelCount&&d.setOrigChannelCount(e.channelCount)}})},x3dom.Utils.createTextureCube=function(s,n,e,t,i,r,a,o){var d=new Uint8Array([0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255]),l=s.createTexture(),h=t?[s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_Z,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_X]:[s.TEXTURE_CUBE_MAP_NEGATIVE_Z,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_X];l.ready=!1,l.pendingTextureLoads=-1,l.textureCubeReady=!1;for(var u=0,f=0,c=0;c<h.length;c++)s.bindTexture(s.TEXTURE_CUBE_MAP,l),s.texImage2D(h[c],0,s.RGBA,2,2,0,s.RGBA,s.UNSIGNED_BYTE,d),s.bindTexture(s.TEXTURE_CUBE_MAP,null);if(1==e.length)n.incrementDownloads(),x3dom.Utils.tryDDSLoading(l,s,n,e[0],a,o).then(function(){n.decrementDownloads(),n.needRender=!0},function(){x3dom.debug.logError("[Utils|createTexture2D] Can't load Image: "+e),n.decrementDownloads()});else if(6==e.length)for(c=0;c<h.length;c++){var _=h[c],m=new Image;switch(i.toLowerCase()){case"anonymous":m.crossOrigin="anonymous";break;case"use-credentials":m.crossOrigin="use-credentials";break;case"none":break;default:x3dom.Utils.forbiddenBySOP(e[c])&&(m.crossOrigin="anonymous")}l.pendingTextureLoads++,n.incrementDownloads(),m.onload=((e,t,i,o)=>function(){0==u&&0==f?(u=i.width,f=i.height):!r||u==i.width&&f==i.height||(x3dom.debug.logWarning("[Utils|createTextureCube] Rescaling CubeMap images, which are of different size!"),i=x3dom.Utils.rescaleImage(i,u,f)),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,o),s.bindTexture(s.TEXTURE_CUBE_MAP,e),s.texImage2D(t,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,i),s.bindTexture(s.TEXTURE_CUBE_MAP,null),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),e.pendingTextureLoads--,n.decrementDownloads(),e.pendingTextureLoads<0&&(e.width=u,e.height=f,e.textureCubeReady=!0,a&&(s.bindTexture(s.TEXTURE_CUBE_MAP,e),s.generateMipmap(s.TEXTURE_CUBE_MAP),s.bindTexture(s.TEXTURE_CUBE_MAP,null)),x3dom.debug.logInfo("[Utils|createTextureCube] Loading CubeMap finished..."),n.needRender=!0)})(l,_,m,t),m.onerror=function(){n.decrementDownloads(),x3dom.debug.logError("[Utils|createTextureCube] Can't load CubeMap!")},m.src=e[c]}return l},x3dom.Utils.detectChannelCount=function(e,t){switch(t){case"image/jpeg":return x3dom.Utils.detectChannelCountJPG(e);case"image/png":return x3dom.Utils.detectChannelCountPNG(e);case"image/gif":return x3dom.Utils.detectChannelCountGIF(e)}},x3dom.Utils.detectChannelCountJPG=function(e){if(255==e[0]&&216==e[1])for(var t=2,i=new DataView(e.buffer,e.byteOffset,e.byteLength);t+4<e.byteLength;)if(255==e[t]){var o=e[t+1];if(255!=e[t+=2]){var s=i.getUint16(t);if(t+s>e.byteLength)return;if(7<=s&&(192==o||194==o))return e[t+7];t+=s}}else t+=1},x3dom.Utils.detectChannelCountPNG=function(e){if(!(e.byteLength<29)&&137==e[0]&&80==e[1]&&78==e[2]&&71==e[3]&&13==e[4]&&10==e[5]&&26==e[6]&&10==e[7]&&73==e[12]&&72==e[13]&&68==e[14]&&82==e[15])return 0==e[25]?1:2==e[25]?3:4==e[25]?2:6==e[25]?4:void 0},x3dom.Utils.detectChannelCountGIF=function(e){if(71==e[0]&&73==e[1]&&70==e[2]&&56==e[3]&&(55==e[4]||57==e[4])&&97==e[5]&&1&e[10]){for(var t=224&e[10],i=13;i<t;i+=3)if(e[i]!=e[i+1]||e[i]!=e[i+2]||e[i+1]!=e[i+2])return 3;return 1}},x3dom.Utils.initFBO=function(e,t,i,o,s,n,r){var a=e.createTexture();a.width=t,a.height=i,e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,o,null),s&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null);var d,l=null;if(x3dom.caps.DRAW_BUFFERS&&void 0!==r)for(l=[a],d=1;d<r;d++)l[d]=e.createTexture(),l[d].width=t,l[d].height=i,e.bindTexture(e.TEXTURE_2D,l[d]),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,o,null),s&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null);var h=e.createFramebuffer(),u=null,f=null;if(n&&(null!==x3dom.caps.DEPTH_TEXTURE?(u=e.createTexture(),e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.DEPTH_COMPONENT,t,i,0,e.DEPTH_COMPONENT,e.UNSIGNED_SHORT,null),s&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),u.width=t,u.height=i):(f=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,f),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,i),e.bindRenderbuffer(e.RENDERBUFFER,null))),e.bindFramebuffer(e.FRAMEBUFFER,h),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),x3dom.caps.DRAW_BUFFERS&&void 0!==r)for(d=1;d<r;d++)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+d,e.TEXTURE_2D,l[d],0);n&&null!==x3dom.caps.DEPTH_TEXTURE?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,u,0):e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,f);n=e.checkFramebufferStatus(e.FRAMEBUFFER);return n!=e.FRAMEBUFFER_COMPLETE&&x3dom.debug.logWarning("[Utils|InitFBO] FBO-Status: "+n),e.bindFramebuffer(e.FRAMEBUFFER,null),{fbo:h,dtex:u,rbo:f,tex:a,texTargets:l,width:t,height:i,type:o,mipMap:s}},x3dom.Utils.getFileName=function(e){return-1<e.lastIndexOf("/")?e.substr(e.lastIndexOf("/")+1):-1<e.lastIndexOf("\\")?e.substr(e.lastIndexOf("\\")+1):e},x3dom.Utils.isWebGL2Enabled=function(){var e=document.createElement("canvas");return!(!e.getContext("webgl2")&&!e.getContext("experimental-webgl2"))},x3dom.Utils.findTextureByName=function(e,t){for(var i=0;i<e.length;++i)if(t==e[i].samplerName)return e[i];return!1},x3dom.Utils.rescaleImage=function(e,t,i){var o=document.createElement("canvas");return o.width=t,o.height=i,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,o.width,o.height),o},x3dom.Utils.scaleImage=function(e){var t;return x3dom.Utils.isPowerOfTwo(e.width)&&x3dom.Utils.isPowerOfTwo(e.height)||((t=document.createElement("canvas")).width=x3dom.Utils.nextHighestPowerOfTwo(e.width),t.height=x3dom.Utils.nextHighestPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t),e},x3dom.Utils.isPowerOfTwo=function(e){return 0==(e&e-1)},x3dom.Utils.nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},x3dom.Utils.nextBestPowerOfTwo=function(e){e=Math.log(e)/.693147180559945;return Math.pow(2,Math.round(e))},x3dom.Utils.getDataTypeSize=function(e){switch(e){case"Int8":case"Uint8":return 1;case"Int16":case"Uint16":return 2;case"Int32":case"Uint32":case"Float32":return 4;default:return 8}},x3dom.Utils.getOffsetMultiplier=function(e,t){switch(e){case t.UNSIGNED_SHORT:return 1;case t.UNSIGNED_INT:return 2;case t.UNSIGNED_BYTE:return.5;default:return 1}},x3dom.Utils.getByteAwareOffset=function(e,t,i){switch(t){case i.UNSIGNED_SHORT:return 2*e;case i.UNSIGNED_INT:return 4*e;case i.UNSIGNED_BYTE:return e;default:return 2*e}},x3dom.Utils.getVertexAttribType=function(e,t){var i=t.NONE;switch(e){case"Int8":i=t.BYTE;break;case"Uint8":i=t.UNSIGNED_BYTE;break;case"Int16":i=t.SHORT;break;case"Uint16":i=t.UNSIGNED_SHORT;break;case"Int32":i=t.INT;break;case"Uint32":i=t.UNSIGNED_INT;break;case"Float32":i=t.FLOAT;break;default:x3dom.debug.logError("Can't find this.gl data type for "+e+", getting FLOAT..."),i=t.FLOAT}return i},x3dom.Utils.getArrayBufferView=function(e,t){var i=null;switch(e){case"Int8":i=new Int8Array(t);break;case"Uint8":i=new Uint8Array(t);break;case"Int16":i=new Int16Array(t);break;case"Uint16":i=new Uint16Array(t);break;case"Int32":i=new Int32Array(t);break;case"Uint32":i=new Uint32Array(t);break;case"Float32":i=new Float32Array(t);break;case"Float64":i=new Float64Array(t);break;default:x3dom.debug.logError("Can't create typed array view of type "+e+", trying Float32..."),i=new Float32Array(t)}return i},x3dom.Utils.isUnsignedType=function(e){return"Uint8"==e||"Uint16"==e||"Uint32"==e},x3dom.Utils.checkDirtyLighting=function(e){return e.getLights().length+e._scene.getNavigationInfo()._vf.headlight+(0<e._scene.getFog()._vf.visibilityRange)},x3dom.Utils.checkDirtyPhysicalEnvironmentLight=function(e,t){return!!t.PHYSICALENVLIGHT!=e.hasPhysicalEnvironmentLight()},x3dom.Utils.checkDirtyEnvironment=function(e,t){e=e._scene.getEnvironment();return t.GAMMACORRECTION!=e._vf.gammaCorrectionDefault},x3dom.Utils.minFilterDic=function(e,t){switch(t.toUpperCase()){case"NEAREST":return e.NEAREST;case"LINEAR":return e.LINEAR;case"NEAREST_MIPMAP_NEAREST":return e.NEAREST_MIPMAP_NEAREST;case"NEAREST_MIPMAP_LINEAR":return e.NEAREST_MIPMAP_LINEAR;case"LINEAR_MIPMAP_NEAREST":return e.LINEAR_MIPMAP_NEAREST;case"LINEAR_MIPMAP_LINEAR":return e.LINEAR_MIPMAP_LINEAR;case"AVG_PIXEL":return e.LINEAR;case"AVG_PIXEL_AVG_MIPMAP":return e.LINEAR_MIPMAP_LINEAR;case"AVG_PIXEL_NEAREST_MIPMAP":return e.LINEAR_MIPMAP_NEAREST;case"DEFAULT":return e.LINEAR_MIPMAP_LINEAR;case"FASTEST":case"NEAREST_PIXEL":return e.NEAREST;case"NEAREST_PIXEL_AVG_MIPMAP":return e.NEAREST_MIPMAP_LINEAR;case"NEAREST_PIXEL_NEAREST_MIPMAP":return e.NEAREST_MIPMAP_NEAREST;case"NICEST":return e.LINEAR_MIPMAP_LINEAR;default:return e.LINEAR}},x3dom.Utils.minFilterDicX3D=function(e){switch(e){case 9728:return"NEAREST";case 9729:return"LINEAR";case 9984:return"NEAREST_MIPMAP_NEAREST";case 9985:return"LINEAR_MIPMAP_NEAREST";case 9986:return"NEAREST_MIPMAP_LINEAR";default:return"LINEAR_MIPMAP_LINEAR"}},x3dom.Utils.magFilterDic=function(e,t){switch(t.toUpperCase()){case"NEAREST":return e.NEAREST;case"LINEAR":case"AVG_PIXEL":case"DEFAULT":return e.LINEAR;case"FASTEST":case"NEAREST_PIXEL":return e.NEAREST;default:return e.LINEAR}},x3dom.Utils.magFilterDicX3D=function(e){return 9728!==e?"LINEAR":"NEAREST"},x3dom.Utils.boundaryModesDicX3D=function(e){switch(e){case 10497:return"REPEAT";case 33071:return"CLAMP_TO_EDGE";case 33648:return"MIRRORED_REPEAT";default:return"REPEAT"}},x3dom.Utils.boundaryModesDic=function(e,t){switch(t.toUpperCase()){case"CLAMP":case"CLAMP_TO_EDGE":case"CLAMP_TO_BOUNDARY":return e.CLAMP_TO_EDGE;case"MIRRORED_REPEAT":return e.MIRRORED_REPEAT;default:return e.REPEAT}},x3dom.Utils.primTypeDic=function(e,t){switch(t.toUpperCase()){case"POINTS":return e.POINTS;case"LINES":return e.LINES;case"LINELOOP":return e.LINE_LOOP;case"LINESTRIP":return e.LINE_STRIP;case"TRIANGLES":return e.TRIANGLES;case"TRIANGLESTRIP":return e.TRIANGLE_STRIP;case"TRIANGLEFAN":return e.TRIANGLE_FAN;default:return e.TRIANGLES}},x3dom.Utils.depthFunc=function(e,t){switch(t.toUpperCase()){case"NEVER":return e.NEVER;case"ALWAYS":return e.ALWAYS;case"LESS":return e.LESS;case"EQUAL":return e.EQUAL;case"LEQUAL":return e.LEQUAL;case"GREATER":return e.GREATER;case"GEQUAL":return e.GEQUAL;case"NOTEQUAL":return e.NOTEQUAL;default:return e.LEQUAL}},x3dom.Utils.blendFunc=function(e,t){switch(t.toLowerCase()){case"zero":return e.ZERO;case"one":return e.ONE;case"dst_color":return e.DST_COLOR;case"dst_alpha":return e.DST_ALPHA;case"src_color":return e.SRC_COLOR;case"src_alpha":return e.SRC_ALPHA;case"one_minus_dst_color":return e.ONE_MINUS_DST_COLOR;case"one_minus_dst_alpha":return e.ONE_MINUS_DST_ALPHA;case"one_minus_src_color":return e.ONE_MINUS_SRC_COLOR;case"one_minus_src_alpha":return e.ONE_MINUS_SRC_ALPHA;case"src_alpha_saturate":return e.SRC_ALPHA_SATURATE;case"constant_color":return e.CONSTANT_COLOR;case"constant_alpha":return e.CONSTANT_ALPHA;case"one_minus_constant_color":return e.ONE_MINUS_CONSTANT_COLOR;case"one_minus_constant_alpha":return e.ONE_MINUS_CONSTANT_ALPHA;default:return 0}},x3dom.Utils.blendEquation=function(e,t){switch(t.toLowerCase()){case"func_add":return e.FUNC_ADD;case"func_subtract":return e.FUNC_SUBTRACT;case"func_reverse_subtract":return e.FUNC_REVERSE_SUBTRACT;default:return 0}},x3dom.Utils.generateProperties=function(e,t){var i={},o=t._cf.geometry.node,s=t._cf.appearance.node,n=s?s._cf.texture.node:null,r=s?s._cf.material.node:null,a=e._scene.getEnvironment();return s&&s._shader&&x3dom.isa(s._shader,x3dom.nodeTypes.ComposedShader)?i.CSHADER=s._shader._id:o&&(i.CSHADER=-1,i.APPMAT=s&&(r||i.CSSHADER)?1:0,i.SOLID=t.isSolid()?1:0,i.TEXT=x3dom.isa(o,x3dom.nodeTypes.Text)?1:0,i.POPGEOMETRY=x3dom.isa(o,x3dom.nodeTypes.PopGeometry)?1:0,i.BUFFERGEOMETRY=x3dom.isa(o,x3dom.nodeTypes.BufferGeometry)?1:0,i.BINARYGEOMETRY=x3dom.isa(o,x3dom.nodeTypes.BinaryGeometry)?1:0,i.POINTLINE2D=o.needLighting()?0:1,i.VERTEXID=i.BINARYGEOMETRY&&o._vf.idsPerVertex?1:0,i.IS_PARTICLE=x3dom.isa(o,x3dom.nodeTypes.ParticleSet)?1:0,i.POINTPROPERTIES=s&&s._cf.pointProperties.node?1:0,i.TANGENTDATA=0<o._mesh._tangents[0].length&&0<o._mesh._binormals[0].length?1:0,i.PBR_MATERIAL=i.APPMAT&&x3dom.isa(r,x3dom.nodeTypes.PhysicalMaterial)?1:0,i.TWOSIDEDMAT=i.APPMAT&&x3dom.isa(r,x3dom.nodeTypes.TwoSidedMaterial)?1:0,i.SEPARATEBACKMAT=i.TWOSIDEDMAT&&r._vf.separateBackColor?1:0,i.SHADOW=e.getLightsShadow()?1:0,i.FOG=0<e._scene.getFog()._vf.visibilityRange?1:0,i.CSSHADER=s&&s._shader&&x3dom.isa(s._shader,x3dom.nodeTypes.CommonSurfaceShader)?1:0,i.LIGHTS=!i.POINTLINE2D&&s&&t.isLit()&&(r||i.CSSHADER)?e.getLights().length+e._scene.getNavigationInfo()._vf.headlight:0,i.TEXTURED=n||i.TEXT||i.CSSHADER&&s._shader.needTexcoords()||i.PBR_MATERIAL&&r.hasTextures()?1:0,i.CUBEMAP=n&&x3dom.isa(n,x3dom.nodeTypes.X3DEnvironmentTextureNode)||i.CSSHADER&&s._shader.getEnvironmentMap()?1:0,i.PIXELTEX=n&&x3dom.isa(n,x3dom.nodeTypes.PixelTexture)?1:0,i.TEXTRAFO=s&&s._cf.textureTransform.node?1:0,i.DIFFUSEMAP=n&&!x3dom.isa(n,x3dom.nodeTypes.X3DEnvironmentTextureNode)||i.CSSHADER&&s._shader.getDiffuseMap()||i.PBR_MATERIAL&&r._cf.baseColorTexture.node?1:0,i.NORMALMAP=i.CSSHADER&&s._shader.getNormalMap()||i.PBR_MATERIAL&&r._cf.normalTexture.node?1:0,i.SPECMAP=i.CSSHADER&&s._shader.getSpecularMap()?1:0,i.SHINMAP=i.CSSHADER&&s._shader.getShininessMap()?1:0,i.EMISSIVEMAP=i.PBR_MATERIAL&&r._cf.emissiveTexture.node?1:0,i.OCCLUSIONMAP=i.PBR_MATERIAL&&r._cf.occlusionTexture.node?1:0,i.DISPLACEMENTMAP=i.CSSHADER&&s._shader.getDisplacementMap()?1:0,i.DIFFPLACEMENTMAP=i.CSSHADER&&s._shader.getDiffuseDisplacementMap()?1:0,i.ALPHAMODE=i.PBR_MATERIAL?r._vf.alphaMode:"BLEND",i.ISROUGHNESSMETALLIC=i.PBR_MATERIAL&&"roughnessMetallic"==r._vf.model?1:0,i.ROUGHNESSMETALLICMAP=i.PBR_MATERIAL&&r._cf.roughnessMetallicTexture.node?1:0,i.SPECULARGLOSSINESSMAP=i.PBR_MATERIAL&&r._cf.specularGlossinessTexture.node?1:0,i.OCCLUSIONROUGHNESSMETALLICMAP=i.PBR_MATERIAL&&r._cf.occlusionRoughnessMetallicTexture.node?1:0,i.PHYSICALENVLIGHT=e.hasPhysicalEnvironmentLight()?1:0,i.NORMALSPACE=i.NORMALMAP&&i.CSSHADER?s._shader._vf.normalSpace.toUpperCase():i.NORMALMAP&&i.PBR_MATERIAL?r._vf.normalSpace.toUpperCase():"TANGENT",i.BLENDING=i.TEXT||i.CUBEMAP||i.CSSHADER||i.PBR_MATERIAL||n&&n._blending?1:0,i.REQUIREBBOX=void 0!==o._vf.coordType&&"Float32"!=o._vf.coordType?1:0,i.REQUIREBBOXNOR=void 0!==o._vf.normalType&&"Float32"!=o._vf.normalType?1:0,i.REQUIREBBOXCOL=void 0!==o._vf.colorType&&"Float32"!=o._vf.colorType?1:0,i.REQUIREBBOXTEX=void 0!==o._vf.texCoordType&&"Float32"!=o._vf.texCoordType?1:0,i.COLCOMPONENTS=o._mesh._numColComponents,i.NORCOMPONENTS=o._mesh._numNormComponents,i.POSCOMPONENTS=o._mesh._numPosComponents,i.SPHEREMAPPING=void 0!==o._cf.texCoord&&null!==o._cf.texCoord.node&&o._cf.texCoord.node._vf.mode&&"sphere"==o._cf.texCoord.node._vf.mode.toLowerCase()?1:0,i.VERTEXCOLOR=0<o._mesh._colors[0].length||i.POPGEOMETRY&&o.hasColor()||i.BUFFERGEOMETRY&&o.hasColor()||void 0!==o._vf.color&&0<o._vf.color.length?1:0,i.CLIPPLANES=t._clipPlanes.length,i.ALPHATHRESHOLD=s?s._vf.alphaClipThreshold.toFixed(2):.1,i.MULTITEXCOORD=i.BUFFERGEOMETRY&&o.hasMultiTexCoord()?1:0,i.DIFFUSEMAPCHANNEL=i.PBR_MATERIAL&&i.DIFFUSEMAP&&1===r._cf.baseColorTexture.node._vf.channel?1:0,i.NORMALMAPCHANNEL=i.PBR_MATERIAL&&i.NORMALMAP&&1===r._cf.normalTexture.node._vf.channel?1:0,i.EMISSIVEMAPCHANNEL=i.PBR_MATERIAL&&i.EMISSIVEMAP&&1===r._cf.emissiveTexture.node._vf.channel?1:0,i.OCCLUSIONMAPCHANNEL=i.PBR_MATERIAL&&i.OCCLUSIONMAP&&1===r._cf.occlusionTexture.node._vf.channel?1:0,i.ROUGHNESSMETALLICMAPCHANNEL=i.PBR_MATERIAL&&i.ROUGHNESSMETALLICMAP&&1===r._cf.roughnessMetallicTexture.node._vf.channel?1:0,i.OCCLUSIONROUGHNESSMETALLICMAPCHANNEL=i.PBR_MATERIAL&&i.OCCLUSIONROUGHNESSMETALLICMAP&&1===r._cf.occlusionRoughnessMetallicTexture.node._vf.channel?1:0,i.SPECULARGLOSSINESSMAPCHANNEL=i.PBR_MATERIAL&&i.SPECULARGLOSSINESSMAP&&1===r._cf.specularGlossinessTexture.node._vf.channel?1:0,i.ALPHAMASK=i.PBR_MATERIAL&&"MASK"==r._vf.alphaMode?1:0,i.UNLIT=i.PBR_MATERIAL&&r._vf.unlit?1:0,i.GAMMACORRECTION=a._vf.gammaCorrectionDefault,i.KHR_MATERIAL_COMMONS=0),i.toIdentifier=function(){delete this.id;var e,t="";for(e in this)this[e]!=this.toIdentifier&&this[e]!=this.toString&&(t+=this[e]);return this.id=t},i.toString=function(){var e,t="";for(e in this)this[e]!=this.toIdentifier&&this[e]!=this.toString&&(t+=e+": "+this[e]+", ");return t},i.toIdentifier(),i},x3dom.Utils.lerp=function(e,t,i){return e+(t-e)*(1<(i=i<0?0:i)?1:i)},x3dom.Utils.wrapProgram=function(i,e,t){for(var o,s={shaderID:t,program:e,bind:function(){i.useProgram(e)}},n=null,r=null,a=i.getProgramParameter(e,i.ACTIVE_UNIFORMS),d=0;d<a;++d){try{r=i.getActiveUniform(e,d)}catch(i){if(!r)continue}switch((o=i.getError())&&x3dom.debug.logError("GL-Error (on searching uniforms): name="+r.name+" type="+r.type+" size="+r.size+" Err="+o),n=i.getUniformLocation(e,r.name),r.type){case i.SAMPLER_2D:case i.SAMPLER_CUBE:case i.BOOL:s.__defineSetter__(r.name,(t=>function(e){i.uniform1i(t,e)})(n));break;case i.FLOAT:-1!=r.name.indexOf("[0]")?s.__defineSetter__(r.name.substring(0,r.name.length-3),(t=>function(e){i.uniform1fv(t,new Float32Array(e))})(n)):s.__defineSetter__(r.name,(t=>function(e){i.uniform1f(t,e)})(n));break;case i.FLOAT_VEC2:s.__defineSetter__(r.name,(t=>function(e){i.uniform2f(t,e[0],e[1])})(n));break;case i.FLOAT_VEC3:-1!=r.name.indexOf("[0]")?s.__defineSetter__(r.name.substring(0,r.name.length-3),(t=>function(e){i.uniform3fv(t,new Float32Array(e))})(n)):s.__defineSetter__(r.name,(t=>function(e){i.uniform3f(t,e[0],e[1],e[2])})(n));break;case i.FLOAT_VEC4:s.__defineSetter__(r.name,(t=>function(e){i.uniform4f(t,e[0],e[1],e[2],e[3])})(n));break;case i.FLOAT_MAT2:s.__defineSetter__(r.name,(t=>function(e){i.uniformMatrix2fv(t,!1,new Float32Array(e))})(n));break;case i.FLOAT_MAT3:s.__defineSetter__(r.name,(t=>function(e){i.uniformMatrix3fv(t,!1,new Float32Array(e))})(n));break;case i.FLOAT_MAT4:s.__defineSetter__(r.name,(t=>function(e){i.uniformMatrix4fv(t,!1,new Float32Array(e))})(n));break;case i.INT:s.__defineSetter__(r.name,(t=>function(e){i.uniform1i(t,e)})(n));break;default:x3dom.debug.logWarning("GLSL program variable "+r.name+" has unknown type "+r.type)}}var l=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(d=0;d<l;++d){try{r=i.getActiveAttrib(e,d)}catch(i){if(!r)continue}(o=i.getError())&&x3dom.debug.logError("GL-Error (on searching attributes): name="+r.name+" type="+r.type+" size="+r.size+" Err="+o),n=i.getAttribLocation(e,r.name),s[r.name]=n}return s},x3dom.Utils.arrayBufferToJSON=function(e,t,i){for(var o,s,n,r="",a=i=null!=i?i:e.length,d=t=null!=t?t:0;d<a;)switch((o=e[d++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(o);break;case 12:case 13:s=e[d++],r+=String.fromCharCode((31&o)<<6|63&s);break;case 14:s=e[d++],n=e[d++],r+=String.fromCharCode((15&o)<<12|(63&s)<<6|(63&n)<<0)}return JSON.parse(r)},x3dom.Utils.arrayBufferToObjectURL=function(e,t){return URL.createObjectURL(new Blob([new Uint8Array(e)],{type:t}))},x3dom.Utils.dataURIToObjectURL=function(e){if(-1==e.indexOf("data:"))return e;for(var e=e.split(","),t=e[0].split(":")[1].split(";")[0],e=e[1],i=window.atob(e),o=i.length,s=new Uint8Array(o),n=0;n<o;n++)s[n]=i.charCodeAt(n);return URL.createObjectURL(new Blob([s],{type:t}))},x3dom.Utils.arrayBufferToDataURL=function(e,t){for(var i="",o=new Uint8Array(e),s=0;s<o.byteLength;s++)i+=String.fromCharCode(o[s]);return"data:"+t+";base64,"+window.btoa(i)},x3dom.Utils.forbiddenBySOP=function(e){var t,i,o,e=(e=e.toLowerCase()).split("//"),s=""===document.location.port?"80":document.location.port;return 2===e.length&&(t=e[0],o=(e=(1===(e=e[1].split("/")[0].split("?")[0].split("#")[0].split("@")).length?e[0]:e[1]).split(":"))[0],i=e[1]),i=i||s,o=o||document.location.host,t=t||document.location.protocol,!(i===s&&o===document.location.host&&t===document.location.protocol)},x3dom.States=function(n){var e=this,t=(this.active=!1,this.viewer=document.createElement("div"),this.viewer.id="x3dom-state-viewer",document.createElement("div")),i=(t.className="x3dom-states-head",t.appendChild(document.createTextNode("x3dom")),document.createElement("span"));i.className="x3dom-states-head2",i.appendChild(document.createTextNode("stats")),t.appendChild(i),this.renderMode=document.createElement("div"),this.renderMode.className="x3dom-states-rendermode-hardware",this.measureList=document.createElement("ul"),this.measureList.className="x3dom-states-list",this.infoList=document.createElement("ul"),this.infoList.className="x3dom-states-list",this.requestList=document.createElement("ul"),this.requestList.className="x3dom-states-list",this.viewer.appendChild(this.renderMode),this.viewer.appendChild(this.measureList),this.viewer.appendChild(this.infoList),this.viewer.appendChild(this.requestList),this.disableContextMenu=function(e){return e.preventDefault(),e.stopPropagation(),e.returnValue=!1},this.thousandSeperator=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},this.toFixed=function(e){return e.toFixed(2)},this.addItem=function(e,t,i){var o=document.createElement("li"),s=(o.className="x3dom-states-item",document.createElement("div")),t=(s.className="x3dom-states-item-title",s.appendChild(document.createTextNode(t)),document.createElement("div"));t.className="x3dom-states-item-value",t.appendChild(document.createTextNode(i)),o.appendChild(s),o.appendChild(t),e.appendChild(o)},this.update=function(){if(n.runtime||void 0===this.updateMethodID){var e,t,i=n.runtime.states.infos,o=n.runtime.states.measurements,s=x3dom.caps.RENDERMODE;for(e in"HARDWARE"==s?(this.renderMode.innerHTML="Hardware-Rendering",this.renderMode.className="x3dom-states-rendermode-hardware"):"SOFTWARE"==s&&(this.renderMode.innerHTML="Software-Rendering",this.renderMode.className="x3dom-states-rendermode-software"),this.measureList.innerHTML="",o)o.hasOwnProperty(e)&&this.addItem(this.measureList,e,this.toFixed(o[e]));for(t in this.infoList.innerHTML="",i)i.hasOwnProperty(t)&&this.addItem(this.infoList,t,this.thousandSeperator(i[t]));this.requestList.innerHTML="",this.addItem(this.requestList,"#ACTIVE",x3dom.RequestManager.activeRequests.length),this.addItem(this.requestList,"#TOTAL",x3dom.RequestManager.totalRequests),this.addItem(this.requestList,"#LOADED",x3dom.RequestManager.loadedRequests),this.addItem(this.requestList,"#FAILED",x3dom.RequestManager.failedRequests)}else clearInterval(this.updateMethodID)},this.updateMethodID=window.setInterval(function(){e.update()},1e3),this.viewer.addEventListener("contextmenu",e.disableContextMenu)},x3dom.States.prototype.display=function(e){this.active=void 0!==e?e:!this.active,this.viewer.style.display=this.active?"block":"none"},x3dom.StateManager=function(e){this.gl=e,this.states=[],this.initStates()},x3dom.StateManager.prototype.initStates=function(){this.states.shaderID=null,this.states.colorMask={red:null,green:null,blue:null,alpha:null},this.states.depthMask=null,this.states.stencilMask=null,this.states.cullFace=null,this.states.frontFace=null,this.states.lineWidth=null,this.states.blendColor={red:null,green:null,blue:null,alpha:null},this.states.blendEquation=null,this.states.blendEquationSeparate={modeRGB:null,modeAlpha:null},this.states.blendFunc={sfactor:null,dfactor:null},this.states.blendFuncSeparate={srcRGB:null,dstRGB:null,srcAlpha:null,dstAlpha:null},this.states.depthFunc=null,this.states.viewport={x:null,y:null,width:null,height:null},this.states.depthRange={zNear:null,zFar:null}},x3dom.StateManager.prototype.useProgram=function(e){return this.states.shaderID!=e.shaderID&&(this.gl.useProgram(e.program),this.states.shaderID=e.shaderID,!0)},x3dom.StateManager.prototype.unsetProgram=function(){this.states.shaderID=null},x3dom.StateManager.prototype.enable=function(e){!0!==this.states[e]&&(this.gl.enable(e),this.states[e]=!0)},x3dom.StateManager.prototype.disable=function(e){!1!==this.states[e]&&(this.gl.disable(e),this.states[e]=!1)},x3dom.StateManager.prototype.colorMask=function(e,t,i,o){this.states.colorMask.red==e&&this.states.colorMask.green==t&&this.states.colorMask.blue==i&&this.states.colorMask.alpha==o||(this.gl.colorMask(e,t,i,o),this.states.colorMask.red=e,this.states.colorMask.green=t,this.states.colorMask.blue=i,this.states.colorMask.alpha=o)},x3dom.StateManager.prototype.depthMask=function(e){this.states.depthMask!=e&&(this.gl.depthMask(e),this.states.depthMask=e)},x3dom.StateManager.prototype.stencilMask=function(e){this.states.stencilMask!=e&&(this.gl.stencilMask(e),this.states.stencilMask=e)},x3dom.StateManager.prototype.cullFace=function(e){this.states.cullFace!=e&&(this.gl.cullFace(e),this.states.cullFace=e)},x3dom.StateManager.prototype.frontFace=function(e){this.states.frontFace!=e&&(this.gl.frontFace(e),this.states.frontFace=e)},x3dom.StateManager.prototype.lineWidth=function(e){this.states.lineWidth!=(e=e<=1?1:e)&&(this.gl.lineWidth(e),this.states.lineWidth=e)},x3dom.StateManager.prototype.blendColor=function(e,t,i,o){this.states.blendColor.red==e&&this.states.blendColor.green==t&&this.states.blendColor.blue==i&&this.states.blendColor.alpha==o||(this.gl.blendColor(e,t,i,o),this.states.blendColor.red=e,this.states.blendColor.green=t,this.states.blendColor.blue=i,this.states.blendColor.alpha=o)},x3dom.StateManager.prototype.blendEquation=function(e){e&&this.states.blendEquation!=e&&(this.gl.blendEquation(e),this.states.blendEquation=e)},x3dom.StateManager.prototype.blendEquationSeparate=function(e,t){this.states.blendEquationSeparate.modeRGB==e&&this.states.blendEquationSeparate.modeAlpha==t||(this.gl.blendEquationSeparate(e,t),this.states.blendEquationSeparate.modeRGB=e,this.states.blendEquationSeparate.modeAlpha=t)},x3dom.StateManager.prototype.blendFunc=function(e,t){this.states.blendFunc.sfactor==e&&this.states.blendFunc.dfactor==t||(this.gl.blendFunc(e,t),this.states.blendFunc.sfactor=e,this.states.blendFunc.dfactor=t)},x3dom.StateManager.prototype.blendFuncSeparate=function(e,t,i,o){this.states.blendFuncSeparate.srcRGB==e&&this.states.blendFuncSeparate.dstRGB==t&&this.states.blendFuncSeparate.srcAlpha==i&&this.states.blendFuncSeparate.dstAlpha==o||(this.gl.blendFuncSeparate(e,t,i,o),this.states.blendFuncSeparate.srcRGB=e,this.states.blendFuncSeparate.dstRGB=t,this.states.blendFuncSeparate.srcAlpha=i,this.states.blendFuncSeparate.dstAlpha=o)},x3dom.StateManager.prototype.depthFunc=function(e){this.states.depthFunc!=e&&(this.gl.depthFunc(e),this.states.depthFunc=e)},x3dom.StateManager.prototype.depthRange=function(e,t){e<0||t<0||t<e||(t=1<t?1:t,this.states.depthRange.zNear==(e=1<e?1:e)&&this.states.depthRange.zFar==t)||(this.gl.depthRange(e,t),this.states.depthRange.zNear=e,this.states.depthRange.zFar=t)},x3dom.StateManager.prototype.viewport=function(e,t,i,o){this.states.viewport.x==e&&this.states.viewport.y==t&&this.states.viewport.width==i&&this.states.viewport.height==o||(this.gl.viewport(e,t,i,o),this.states.viewport.x=e,this.states.viewport.y=t,this.states.viewport.width=i,this.states.viewport.height=o)},x3dom.StateManager.prototype.bindFramebuffer=function(e,t){this.gl.bindFramebuffer(e,t),this.initStates()},x3dom.BinaryContainerLoader={outOfMemory:!1,checkError:function(e){var t=e.getError();t&&(t==e.OUT_OF_MEMORY?(this.outOfMemory=!0,x3dom.debug.logError("GL-Error "+t+" on loading binary container (out of memory)."),console.error("WebGL: OUT_OF_MEMORY")):x3dom.debug.logError("GL-Error "+t+" on loading binary container."))}},x3dom.BinaryContainerLoader.setupBinGeo=function(v,y,T,b,S){var a,F,E,d,n,s,l,i,r,o,h,u;this.outOfMemory||(a=(new Date).getTime(),F=this,E=v._cf.geometry.node,v._webgl.binaryGeometry=-1,v._webgl.internalDownloadCount=(0<E._vf.index.length?1:0)+(E._hasStrideOffset&&0<E._vf.coord.length?1:0)+(!E._hasStrideOffset&&0<E._vf.coord.length?1:0)+(!E._hasStrideOffset&&0<E._vf.normal.length?1:0)+(!E._hasStrideOffset&&0<E._vf.texCoord.length?1:0)+(!E._hasStrideOffset&&0<E._vf.color.length?1:0),d=0==E._vf.normalPerVertex||0<E._vf.index.length&&("Int32"==E._vf.indexType||"Uint32"==E._vf.indexType&&!x3dom.caps.INDEX_UINT),v._webgl.makeSeparateTris={index:null,coord:null,normal:null,texCoord:null,color:null,pushBuffer:function(e,t){this[e]=t,0==--v._webgl.internalDownloadCount&&(this.coord&&this.createMesh(),v._nameSpace.doc.needRender=!0),0==--v._nameSpace.doc.downloadCount&&(v._nameSpace.doc.needRender=!0)},createMesh:function(){var e=E;if(e._hasStrideOffset)x3dom.debug.logError(e._vf.indexType+" index type and per-face normals not supported for interleaved arrays.");else{for(var t=0;t<v._webgl.primType.length;t++)if(v._webgl.primType[t]==T.TRIANGLE_STRIP)return void x3dom.debug.logError("makeSeparateTris: triangle strips not yet supported for per-face normals.");var i,o,s=e._vf.coordType,n=(v._webgl.coordType=x3dom.Utils.getVertexAttribType(s,T),o=v._webgl.coordType!=T.FLOAT?(4==e._mesh._numPosComponents&&x3dom.Utils.isUnsignedType(e._vf.coordType)?x3dom.fields.SFVec3f.copy(e.getMin()):x3dom.fields.SFVec3f.copy(e._vf.position),i=x3dom.fields.SFVec3f.copy(e._vf.size),e.getPrecisionMax("coordType")):(new x3dom.fields.SFVec3f(0,0,0),i=new x3dom.fields.SFVec3f(1,1,1),1),v._coordStrideOffset[0]/x3dom.Utils.getDataTypeSize(e._vf.coordType)),r=(x3dom.debug.logWarning("makeSeparateTris.createMesh called with coord length "+(n=0==n?3:n)),this.color&&n!=v._colorStrideOffset[0]/x3dom.Utils.getDataTypeSize(e._vf.colorType)&&(this.color=null,x3dom.debug.logWarning("Color format not supported.")),this.texCoord?v._texCoordStrideOffset[0]/x3dom.Utils.getDataTypeSize(e._vf.texCoordType):0);e._vf.normalType="Float32",v._webgl.normalType=T.FLOAT,e._mesh._numNormComponents=3,v._normalStrideOffset=[0,0];for(var a,d=[],l=[],h=[],u=[],f=this.index?this.index.length-2:this.coord.length/3-2,c=0;c<f;c+=3){var _=n*(this.index?this.index[c]:c),m=new x3dom.fields.SFVec3f(i.x*this.coord[_]/o,i.y*this.coord[_+1]/o,i.z*this.coord[_+2]/o),p=(d.push(this.coord[_]),d.push(this.coord[_+1]),d.push(this.coord[_+2]),3<n&&d.push(this.coord[_+3]),this.color&&(u.push(this.color[_]),u.push(this.color[_+1]),u.push(this.color[_+2]),3<n)&&u.push(this.color[_+3]),this.texCoord&&(a=r*(this.index?this.index[c]:c),h.push(this.texCoord[a]),h.push(this.texCoord[a+1]),3<r)&&(h.push(this.texCoord[a+2]),h.push(this.texCoord[a+3])),_=n*(this.index?this.index[c+1]:c+1),new x3dom.fields.SFVec3f(i.x*this.coord[_]/o,i.y*this.coord[_+1]/o,i.z*this.coord[_+2]/o)),x=(d.push(this.coord[_]),d.push(this.coord[_+1]),d.push(this.coord[_+2]),3<n&&d.push(this.coord[_+3]),this.color&&(u.push(this.color[_]),u.push(this.color[_+1]),u.push(this.color[_+2]),3<n)&&u.push(this.color[_+3]),this.texCoord&&(a=r*(this.index?this.index[c+1]:c+1),h.push(this.texCoord[a]),h.push(this.texCoord[a+1]),3<r)&&(h.push(this.texCoord[a+2]),h.push(this.texCoord[a+3])),_=n*(this.index?this.index[c+2]:c+2),new x3dom.fields.SFVec3f(i.x*this.coord[_]/o,i.y*this.coord[_+1]/o,i.z*this.coord[_+2]/o)),m=(d.push(this.coord[_]),d.push(this.coord[_+1]),d.push(this.coord[_+2]),3<n&&d.push(this.coord[_+3]),this.color&&(u.push(this.color[_]),u.push(this.color[_+1]),u.push(this.color[_+2]),3<n)&&u.push(this.color[_+3]),this.texCoord&&(a=r*(this.index?this.index[c+2]:c+2),h.push(this.texCoord[a]),h.push(this.texCoord[a+1]),3<r)&&(h.push(this.texCoord[a+2]),h.push(this.texCoord[a+3])),m.subtract(p)),p=p.subtract(x),g=m.cross(p).normalize();for(_=0;_<3;_++)l.push(g.x),l.push(g.y),l.push(g.z)}s=T.createBuffer();v._webgl.buffers[x3dom.BUFFER_IDX.POSITION]=s,T.bindBuffer(T.ARRAY_BUFFER,s),T.bufferData(T.ARRAY_BUFFER,x3dom.Utils.getArrayBufferView(e._vf.coordType,d),T.STATIC_DRAW),T.vertexAttribPointer(y.position,e._mesh._numPosComponents,v._webgl.coordType,!1,v._coordStrideOffset[0],v._coordStrideOffset[1]),T.enableVertexAttribArray(y.position),s=T.createBuffer(),v._webgl.buffers[x3dom.BUFFER_IDX.NORMAL]=s,T.bindBuffer(T.ARRAY_BUFFER,s),T.bufferData(T.ARRAY_BUFFER,new Float32Array(l),T.STATIC_DRAW),T.vertexAttribPointer(y.normal,e._mesh._numNormComponents,v._webgl.normalType,!1,v._normalStrideOffset[0],v._normalStrideOffset[1]),T.enableVertexAttribArray(y.normal),this.texCoord&&(s=T.createBuffer(),v._webgl.buffers[x3dom.BUFFER_IDX.TEXCOORD]=s,T.bindBuffer(T.ARRAY_BUFFER,s),T.bufferData(T.ARRAY_BUFFER,x3dom.Utils.getArrayBufferView(e._vf.texCoordType,h),T.STATIC_DRAW),T.vertexAttribPointer(y.texcoord,e._mesh._numTexComponents,v._webgl.texCoordType,!1,v._texCoordStrideOffset[0],v._texCoordStrideOffset[1]),T.enableVertexAttribArray(y.texcoord)),this.color&&(s=T.createBuffer(),v._webgl.buffers[x3dom.BUFFER_IDX.COLOR]=s,T.bindBuffer(T.ARRAY_BUFFER,s),T.bufferData(T.ARRAY_BUFFER,x3dom.Utils.getArrayBufferView(e._vf.colorType,u),T.STATIC_DRAW),T.vertexAttribPointer(y.color,e._mesh._numColComponents,v._webgl.colorType,!1,v._colorStrideOffset[0],v._colorStrideOffset[1]),T.enableVertexAttribArray(y.color)),e._vf.vertexCount=[],e._vf.vertexCount[0]=d.length/n,e._mesh._numCoords=e._vf.vertexCount[0],e._mesh._numFaces=e._vf.vertexCount[0]/3,v._webgl.primType=[],v._webgl.primType[0]=T.TRIANGLES,this.index=u=h=l=d=null,this.coord=null,this.normal=null,this.texCoord=null,this.color=null,F.checkError(T),delete v._webgl.shader,v._webgl.shader=S.cache.getDynamicShader(T,b,v)}}},0<E._vf.index.length&&(v._webgl.binaryGeometry=1,(n=new XMLHttpRequest).open("GET",v._nameSpace.getURL(E._vf.index),!0),n.responseType="arraybuffer",v._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(n),n.onload=function(){if(v._nameSpace.doc.decrementDownloads(),--v._webgl.internalDownloadCount,200==n.status){if(v._webgl)if(E._vf.compressed)x3dom.debug.logError("x3dom 1.8.2+ do not support compressed BinaryGeometries anymore");else{var e=n.response,t=E,i=t._vf.indexType,e=x3dom.Utils.getArrayBufferView(i,e);if(d)v._webgl.makeSeparateTris.pushBuffer("index",e);else{var o=T.createBuffer();x3dom.caps.INDEX_UINT&&"Uint32"==i?v._webgl.indexType=T.UNSIGNED_INT:v._webgl.indexType=T.UNSIGNED_SHORT,T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,o),T.bufferData(T.ELEMENT_ARRAY_BUFFER,e,T.STATIC_DRAW),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,null),0==t._vf.vertexCount[0]&&(t._vf.vertexCount[0]=e.length);for(var s=t._mesh._numFaces=0;s<t._vf.vertexCount.length;s++)v._webgl.primType[s]==T.TRIANGLE_STRIP?t._mesh._numFaces+=t._vf.vertexCount[s]-2:t._mesh._numFaces+=t._vf.vertexCount[s]/3;0==v._webgl.internalDownloadCount&&(v._nameSpace.doc.needRender=!0),F.checkError(T);i=(new Date).getTime()-a;x3dom.debug.logInfo("XHR0/ index load time: "+i+" ms"),v._webgl.buffers[x3dom.BUFFER_IDX.INDEX]=o}}}else x3dom.debug.logError("XHR1/ index load failed with status: "+n.status)}),E._hasStrideOffset&&0<E._vf.coord.length&&((s=new XMLHttpRequest).open("GET",v._nameSpace.getURL(E._vf.coord),!0),s.responseType="arraybuffer",v._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(s),s.onload=function(){if(v._nameSpace.doc.decrementDownloads(),--v._webgl.internalDownloadCount,200==s.status){if(v._webgl)if(E._vf.compressed)x3dom.debug.logError("x3dom 1.8.2+ do not support compressed BinaryGeometries anymore");else{var e=s.response,t=E,i=t._vf.coordType,e=(v._webgl.coordType=x3dom.Utils.getVertexAttribType(i,T),v._webgl.normalType=v._webgl.coordType,v._webgl.texCoordType=v._webgl.coordType,v._webgl.colorType=v._webgl.coordType,x3dom.Utils.getArrayBufferView(i,e)),i=v._coordStrideOffset[0]/x3dom.Utils.getDataTypeSize(i);if(i&&(t._mesh._numCoords=e.length/i),0==t._vf.index.length)for(var o=0;o<t._vf.vertexCount.length;o++)v._webgl.primType[o]==T.TRIANGLE_STRIP?t._mesh._numFaces+=t._vf.vertexCount[o]-2:t._mesh._numFaces+=t._vf.vertexCount[o]/3;i=T.createBuffer(),e=(T.bindBuffer(T.ARRAY_BUFFER,i),T.bufferData(T.ARRAY_BUFFER,e,T.STATIC_DRAW),T.vertexAttribPointer(y.position,t._mesh._numPosComponents,v._webgl.coordType,!1,v._coordStrideOffset[0],v._coordStrideOffset[1]),T.enableVertexAttribArray(y.position),0<t._vf.normal.length&&(v._webgl.buffers[x3dom.BUFFER_IDX.NORMAL]=i,T.bindBuffer(T.ARRAY_BUFFER,i),T.bufferData(T.ARRAY_BUFFER,e,T.STATIC_DRAW),T.vertexAttribPointer(y.normal,t._mesh._numNormComponents,v._webgl.normalType,!1,v._normalStrideOffset[0],v._normalStrideOffset[1]),T.enableVertexAttribArray(y.normal)),0<t._vf.texCoord.length&&(v._webgl.buffers[x3dom.BUFFER_IDX.TEXCOORD]=i,T.bindBuffer(T.ARRAY_BUFFER,i),T.bufferData(T.ARRAY_BUFFER,e,T.STATIC_DRAW),T.vertexAttribPointer(y.texcoord,t._mesh._numTexComponents,v._webgl.texCoordType,!1,v._texCoordStrideOffset[0],v._texCoordStrideOffset[1]),T.enableVertexAttribArray(y.texcoord)),0<t._vf.color.length&&(v._webgl.buffers[x3dom.BUFFER_IDX.COLOR]=i,T.bindBuffer(T.ARRAY_BUFFER,i),T.bufferData(T.ARRAY_BUFFER,e,T.STATIC_DRAW),T.vertexAttribPointer(y.color,t._mesh._numColComponents,v._webgl.colorType,!1,v._colorStrideOffset[0],v._colorStrideOffset[1]),T.enableVertexAttribArray(y.color)),0==v._webgl.internalDownloadCount&&(v._nameSpace.doc.needRender=!0),F.checkError(T),(new Date).getTime()-a);x3dom.debug.logInfo("XHR/ interleaved array load time: "+e+" ms"),v._webgl.buffers[x3dom.BUFFER_IDX.POSITION]=i}}else x3dom.debug.logError("XHR1/ interleaved array load failed with status: "+s.status)}),!E._hasStrideOffset&&0<E._vf.coord.length&&((l=new XMLHttpRequest).open("GET",v._nameSpace.getURL(E._vf.coord),!0),l.responseType="arraybuffer",v._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(l),l.onload=function(){if(v._nameSpace.doc.decrementDownloads(),--v._webgl.internalDownloadCount,200==l.status){if(v._webgl)if(E._vf.compressed)x3dom.debug.logError("x3dom 1.8.2+ do not support compressed BinaryGeometries anymore");else{var e=l.response,t=E,i=0,o=t._vf.coordType,s=(v._webgl.coordType=x3dom.Utils.getVertexAttribType(o,T),x3dom.Utils.getArrayBufferView(o,e));if(d)v._webgl.makeSeparateTris.pushBuffer("coord",s);else{T.bindAttribLocation(y.program,0,"position");e=T.createBuffer();if(T.bindBuffer(T.ARRAY_BUFFER,e),T.bufferData(T.ARRAY_BUFFER,s,T.STATIC_DRAW),T.bindBuffer(T.ARRAY_BUFFER,null),t._mesh._numCoords=s.length/t._mesh._numPosComponents,0==t._vf.index.length)for(i=0;i<t._vf.vertexCount.length;i++)v._webgl.primType[i]==T.TRIANGLE_STRIP?t._mesh._numFaces+=t._vf.vertexCount[i]-2:t._mesh._numFaces+=t._vf.vertexCount[i]/3;if("Float32"==o&&(v._vf.bboxSize.x<0||v._vf.bboxSize.y<0||v._vf.bboxSize.z<0)){for(var n=new x3dom.fields.SFVec3f(s[0],s[1],s[2]),r=new x3dom.fields.SFVec3f(s[0],s[1],s[2]),i=3;i<s.length;i+=3)n.x>s[i+0]&&(n.x=s[i+0]),n.y>s[i+1]&&(n.y=s[i+1]),n.z>s[i+2]&&(n.z=s[i+2]),r.x<s[i+0]&&(r.x=s[i+0]),r.y<s[i+1]&&(r.y=s[i+1]),r.z<s[i+2]&&(r.z=s[i+2]);v._vf.bboxCenter.setValues(n.add(r).multiply(.5)),v._vf.bboxSize.setValues(r.subtract(n))}s=null,0==v._webgl.internalDownloadCount&&(v._nameSpace.doc.needRender=!0),F.checkError(T);o=(new Date).getTime()-a;x3dom.debug.logInfo("XHR1/ coord load time: "+o+" ms"),v._webgl.buffers[x3dom.BUFFER_IDX.POSITION]=e}}}else x3dom.debug.logError("XHR1/ coord load failed with status: "+l.status)}),!E._hasStrideOffset&&0<E._vf.normal.length&&((i=new XMLHttpRequest).open("GET",v._nameSpace.getURL(E._vf.normal),!0),i.responseType="arraybuffer",v._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(i),i.onload=function(){var e,t;v._nameSpace.doc.decrementDownloads(),--v._webgl.internalDownloadCount,200==i.status?v._webgl&&(E._vf.compressed?x3dom.debug.logError("x3dom 1.8.2+ do not support compressed BinaryGeometries anymore"):(e=i.response,t=E._vf.normalType,v._webgl.normalType=x3dom.Utils.getVertexAttribType(t,T),t=x3dom.Utils.getArrayBufferView(t,e),d?v._webgl.makeSeparateTris.pushBuffer("normal",t):(e=T.createBuffer(),T.bindBuffer(T.ARRAY_BUFFER,e),T.bufferData(T.ARRAY_BUFFER,t,T.STATIC_DRAW),T.bindBuffer(T.ARRAY_BUFFER,null),t=null,0==v._webgl.internalDownloadCount&&(v._nameSpace.doc.needRender=!0),F.checkError(T),t=(new Date).getTime()-a,x3dom.debug.logInfo("XHR2/ normal load time: "+t+" ms"),v._webgl.buffers[x3dom.BUFFER_IDX.NORMAL]=e))):x3dom.debug.logError("XHR2/ normal load failed with status: "+i.status)}),!E._hasStrideOffset&&0<E._vf.texCoord.length&&((r=new XMLHttpRequest).open("GET",v._nameSpace.getURL(E._vf.texCoord),!0),r.responseType="arraybuffer",v._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(r),r.onload=function(){if(v._nameSpace.doc.decrementDownloads(),--v._webgl.internalDownloadCount,200==r.status){if(v._webgl)if(E._vf.compressed)x3dom.debug.logError("x3dom 1.8.2+ do not support compressed BinaryGeometries anymore");else{var e=r.response,t=E._vf.texCoordType,i=(v._webgl.texCoordType=x3dom.Utils.getVertexAttribType(t,T),x3dom.Utils.getArrayBufferView(t,e));if(d)v._webgl.makeSeparateTris.pushBuffer("texCoord",i);else{if(E._vf.idsPerVertex){for(var t=T.createBuffer(),o=(T.bindBuffer(T.ARRAY_BUFFER,t),x3dom.Utils.getArrayBufferView("Float32",i.length/2)),s=0,n=0;s<i.length;s+=2,n++)o[n]=65536*i[s+1]+i[s];T.bufferData(T.ARRAY_BUFFER,o,T.STATIC_DRAW),T.bindBuffer(T.ARRAY_BUFFER,null),v._webgl.buffers[x3dom.BUFFER_IDX.ID]=t}else{e=T.createBuffer();T.bindBuffer(T.ARRAY_BUFFER,e),T.bufferData(T.ARRAY_BUFFER,i,T.STATIC_DRAW),T.bindBuffer(T.ARRAY_BUFFER,null),v._webgl.buffers[x3dom.BUFFER_IDX.TEXCOORD]=e}i=null,0==v._webgl.internalDownloadCount&&(v._nameSpace.doc.needRender=!0),F.checkError(T);t=(new Date).getTime()-a;x3dom.debug.logInfo("XHR3/ texCoord load time: "+t+" ms")}}}else x3dom.debug.logError("XHR3/ texcoord load failed with status: "+r.status)}),!E._hasStrideOffset&&0<E._vf.color.length&&((o=new XMLHttpRequest).open("GET",v._nameSpace.getURL(E._vf.color),!0),o.responseType="arraybuffer",v._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(o),o.onload=function(){var e,t;v._nameSpace.doc.decrementDownloads(),--v._webgl.internalDownloadCount,200==o.status?v._webgl&&(E._vf.compressed?x3dom.debug.logError("x3dom 1.8.2+ do not support compressed BinaryGeometries anymore"):(e=o.response,t=E._vf.colorType,v._webgl.colorType=x3dom.Utils.getVertexAttribType(t,T),t=x3dom.Utils.getArrayBufferView(t,e),d?v._webgl.makeSeparateTris.pushBuffer("color",t):(e=T.createBuffer(),T.bindBuffer(T.ARRAY_BUFFER,e),T.bufferData(T.ARRAY_BUFFER,t,T.STATIC_DRAW),T.bindBuffer(T.ARRAY_BUFFER,null),t=null,0==v._webgl.internalDownloadCount&&(v._nameSpace.doc.needRender=!0),F.checkError(T),t=(new Date).getTime()-a,x3dom.debug.logInfo("XHR4/ color load time: "+t+" ms"),v._webgl.buffers[x3dom.BUFFER_IDX.COLOR]=e))):x3dom.debug.logError("XHR4/ color load failed with status: "+o.status)}),!E._hasStrideOffset&&0<E._vf.tangent.length&&((h=new XMLHttpRequest).open("GET",v._nameSpace.getURL(E._vf.normal),!0),h.responseType="arraybuffer",v._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(h),h.onload=function(){var e,t;v._nameSpace.doc.decrementDownloads(),--v._webgl.internalDownloadCount,200==h.status?v._webgl&&(E._vf.compressed?x3dom.debug.logError("x3dom 1.8.2+ do not support compressed BinaryGeometries anymore"):(e=h.response,t=E._vf.tangentType,v._webgl.tangentType=x3dom.Utils.getVertexAttribType(t,T),t=x3dom.Utils.getArrayBufferView(t,e),d?v._webgl.makeSeparateTris.pushBuffer("tangent",t):(e=T.createBuffer(),T.bindBuffer(T.ARRAY_BUFFER,e),T.bufferData(T.ARRAY_BUFFER,t,T.STATIC_DRAW),T.bindBuffer(T.ARRAY_BUFFER,null),t=null,0==v._webgl.internalDownloadCount&&(v._nameSpace.doc.needRender=!0),F.checkError(T),t=(new Date).getTime()-a,x3dom.debug.logInfo("XHR5/ normal load time: "+t+" ms"),v._webgl.buffers[x3dom.BUFFER_IDX.TANGENT]=e))):x3dom.debug.logError("XHR2/ normal load failed with status: "+h.status)}),!E._hasStrideOffset&&0<E._vf.binormal.length&&((u=new XMLHttpRequest).open("GET",v._nameSpace.getURL(E._vf.normal),!0),u.responseType="arraybuffer",v._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(u),u.onload=function(){var e,t;v._nameSpace.doc.decrementDownloads(),--v._webgl.internalDownloadCount,200==u.status?v._webgl&&(E._vf.compressed?x3dom.debug.logError("x3dom 1.8.2+ do not support compressed BinaryGeometries anymore"):(e=u.response,t=E._vf.binormalType,v._webgl.binormalType=x3dom.Utils.getVertexAttribType(t,T),t=x3dom.Utils.getArrayBufferView(t,e),d?v._webgl.makeSeparateTris.pushBuffer("binormal",t):(e=T.createBuffer(),T.bindBuffer(T.ARRAY_BUFFER,e),T.bufferData(T.ARRAY_BUFFER,t,T.STATIC_DRAW),T.bindBuffer(T.ARRAY_BUFFER,null),t=null,0==v._webgl.internalDownloadCount&&(v._nameSpace.doc.needRender=!0),F.checkError(T),t=(new Date).getTime()-a,x3dom.debug.logInfo("XHR6/ normal load time: "+t+" ms"),v._webgl.buffers[x3dom.BUFFER_IDX.BITANGENT]=e))):x3dom.debug.logError("XHR6/ normal load failed with status: "+u.status)}))},x3dom.BinaryContainerLoader.setupPopGeo=function(l,e,h,t,i){if(!this.outOfMemory){var u=l._cf.geometry.node;if(u.hasIndex()){l._webgl.popGeometry=1,l._webgl.buffers[x3dom.BUFFER_IDX.INDEX]=h.createBuffer(),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l._webgl.buffers[x3dom.BUFFER_IDX.INDEX]),h.bufferData(h.ELEMENT_ARRAY_BUFFER,2*u.getTotalNumberOfIndices(),h.STATIC_DRAW),l._webgl.buffers[x3dom.BUFFER_IDX.ID]=h.createBuffer();for(var o=new Float32Array(u._vf.vertexBufferSize),s=0;s<o.length;++s)o[s]=s;h.bindBuffer(h.ARRAY_BUFFER,l._webgl.buffers[x3dom.BUFFER_IDX.ID]),h.bufferData(h.ARRAY_BUFFER,o,h.STATIC_DRAW)}else l._webgl.popGeometry=-1;l._webgl.buffers[x3dom.BUFFER_IDX.POSITION]=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,l._webgl.buffers[x3dom.BUFFER_IDX.POSITION]),h.bufferData(h.ARRAY_BUFFER,u._vf.attributeStride*u._vf.vertexBufferSize,h.STATIC_DRAW);var n=u._vf.coordType;l._webgl.coordType=x3dom.Utils.getVertexAttribType(n,h),l._coordStrideOffset[0]=u.getAttributeStride(),l._coordStrideOffset[1]=u.getPositionOffset(),h.vertexAttribPointer(e.position,l._cf.geometry.node._mesh._numPosComponents,l._webgl.coordType,!1,l._coordStrideOffset[0],l._coordStrideOffset[1]),h.enableVertexAttribArray(e.position),u.hasNormal()&&(n=u._vf.normalType,l._webgl.normalType=x3dom.Utils.getVertexAttribType(n,h),l._normalStrideOffset[0]=u.getAttributeStride(),l._normalStrideOffset[1]=u.getNormalOffset(),l._webgl.buffers[x3dom.BUFFER_IDX.NORMAL]=l._webgl.buffers[x3dom.BUFFER_IDX.POSITION],h.vertexAttribPointer(e.normal,l._cf.geometry.node._mesh._numNormComponents,l._webgl.normalType,!1,l._normalStrideOffset[0],l._normalStrideOffset[1]),h.enableVertexAttribArray(e.normal)),u.hasTexCoord()&&(n=u._vf.texCoordType,l._webgl.texCoordType=x3dom.Utils.getVertexAttribType(n,h),l._webgl.buffers[x3dom.BUFFER_IDX.TEXCOORD]=l._webgl.buffers[x3dom.BUFFER_IDX.POSITION],l._texCoordStrideOffset[0]=u.getAttributeStride(),l._texCoordStrideOffset[1]=u.getTexCoordOffset(),h.vertexAttribPointer(e.texcoord,l._cf.geometry.node._mesh._numTexComponents,l._webgl.texCoordType,!1,l._texCoordStrideOffset[0],l._texCoordStrideOffset[1]),h.enableVertexAttribArray(e.texcoord)),u.hasColor()&&(n=u._vf.colorType,l._webgl.colorType=x3dom.Utils.getVertexAttribType(n,h),l._webgl.buffers[x3dom.BUFFER_IDX.COLOR]=l._webgl.buffers[x3dom.BUFFER_IDX.POSITION],l._colorStrideOffset[0]=u.getAttributeStride(),l._colorStrideOffset[1]=u.getColorOffset(),h.vertexAttribPointer(e.color,l._cf.geometry.node._mesh._numColComponents,l._webgl.colorType,!1,l._colorStrideOffset[0],l._colorStrideOffset[1]),h.enableVertexAttribArray(e.color)),l._webgl.currentNumIndices=0,l._webgl.currentNumVertices=0,l._webgl.numVerticesAtLevel=[],l._webgl.levelsAvailable=0,this.checkError(h),l._webgl.levelLoaded=[];for(var r=0;r<u.getNumLevels();++r)l._webgl.levelLoaded.push(!1);var a=u.getDataURLs();l._webgl.downloadStartTimer=(new Date).getTime();for(var d=0;d<a.length;++d){l._nameSpace.doc.incrementDownloads();var f=new XMLHttpRequest;f.responseType="arraybuffer",f.open("GET",a[d]),f.onload=function(e,t){l._nameSpace.doc.decrementDownloads();var e=e.response,i=t;if(l._webgl.levelLoaded[i]=!0,l._webgl.numVerticesAtLevel[i]=0,e){var t=0,o=!1;if(u.hasIndex()&&0<(t=2*u.getNumIndicesByLevel(i))){var o=!0,s=new Uint8Array(e,0,t);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l._webgl.buffers[x3dom.BUFFER_IDX.INDEX]);for(var n=0,r=0;r<i;++r)n+=u.getNumIndicesByLevel(r);h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,2*n,s)}s=e.byteLength-t;0<s&&(o=!0,e=new Uint8Array(e,t,s),h.bindBuffer(h.ARRAY_BUFFER,l._webgl.buffers[x3dom.BUFFER_IDX.POSITION]),u.hasIndex()?h.bufferSubData(h.ARRAY_BUFFER,u.getVertexDataBufferOffset(i)*u.getAttributeStride(),e):h.bufferSubData(h.ARRAY_BUFFER,l._webgl.currentNumVertices*u.getAttributeStride(),e),l._webgl.numVerticesAtLevel[i]=s/u.getAttributeStride(),l._webgl.currentNumVertices+=l._webgl.numVerticesAtLevel[i]);for(var a=0,d=l._webgl.levelsAvailable;d<u.getNumLevels()&&!1!==l._webgl.levelLoaded[d];++d)a+=u.getNumIndicesByLevel(d),++l._webgl.levelsAvailable;l._webgl.currentNumIndices=a,u._mesh._numCoords=l._webgl.currentNumVertices,u._mesh._numFaces=(u.hasIndex()?l._webgl.currentNumIndices:l._webgl.currentNumVertices)/3,u.adaptVertexCount(u.hasIndex()?3*u._mesh._numFaces:u._mesh._numCoords),o&&(l._nameSpace.doc.needRender=!0)}}.bind(this,f,d),x3dom.RequestManager.addRequest(f)}}},x3dom.BinaryContainerLoader.bufferGeoCache={},x3dom.BinaryContainerLoader.draco={DecoderModule:null,Decoder:null},x3dom.BinaryContainerLoader.setupBufferGeo=function(U,e,X,t,i){var s,k,G=U._cf.geometry.node,z=null,H=null,j=!0,W=(U._webgl.bufferGeometry=G._indexed?1:-1,G._vf.draco);G._mesh._numCoords=G._vf.vertexCount[0],G._mesh._numFaces=G._vf.vertexCount[0]/3;function Y(e,t){var e=e._vf.dracoId,e=K.GetAttributeByUniqueId(Z,e),i=G._cf.accessors.nodes.find(function(e){return e._vf.view==t})._vf.componentType,o=x3dom.BinaryContainerLoader.getArrayBufferFromType(i).BYTES_PER_ELEMENT,s=Z.num_points()*e.num_components(),o=s*o,n=Q._malloc(o),e=(K.GetAttributeDataArrayForAllPoints(Z,e,e.data_type(),o,n),x3dom.BinaryContainerLoader.getArrayBufferFromType(i,Q.HEAPF32.buffer,n,s).slice());return Q._free(n),e}function q(){var e=3*Z.num_faces(),t=4*e,i=Q._malloc(t),t=(K.GetTrianglesUInt32Array(Z,t,i),new Uint32Array(Q.HEAPU32.buffer,i,e).slice());Q._free(i);i=(e=G._cf.accessors.nodes.find(function(e){return"INDEX"==e._vf.bufferType}))?e._vf.componentType:X.UNSIGNED_SHORT;return x3dom.BinaryContainerLoader.getArrayBufferFromType(i,t)}var Q,K,Z;""!=G._vf.buffer&&(s=U._nameSpace.getURL(G._vf.buffer),k=s,W&&(k+=" "+G._cf.views.nodes[0]._vf.byteOffset),null==x3dom.BinaryContainerLoader.bufferGeoCache[k]&&(U._nameSpace.doc.incrementDownloads(),x3dom.BinaryContainerLoader.bufferGeoCache[k]={},x3dom.BinaryContainerLoader.bufferGeoCache[k].buffers=[],x3dom.BinaryContainerLoader.bufferGeoCache[k].shapes=[],x3dom.BinaryContainerLoader.bufferGeoCache[k].decrementDownload=!0,x3dom.BinaryContainerLoader.bufferGeoCache[k].promise=new Promise(function(t,i){var o=new XMLHttpRequest;o.open("GET",s),o.responseType="arraybuffer",o.onload=function(e){200!=o.status?i():t(o.response)},o.onerror=function(e){i()},x3dom.RequestManager.addRequest(o)})),x3dom.BinaryContainerLoader.bufferGeoCache[k].promise.then(function(t){return W?x3dom.BinaryContainerLoader.draco.DecoderModule?(Q=x3dom.BinaryContainerLoader.draco.DecoderModule,K=x3dom.BinaryContainerLoader.draco.Decoder,t):x3dom.DracoDecoderModule({wasmBinary:x3dom.DracoDecoderWASM.arrayBuffer}).then(function(e){return K=new(Q=e).Decoder,x3dom.BinaryContainerLoader.draco.DecoderModule=e,x3dom.BinaryContainerLoader.draco.Decoder=K,t}):t}).then(function(e){if(null!=U._webgl){W&&(i=G._cf.views.nodes[0],i=new Int8Array(e).slice(i._vf.byteOffset,i._vf.byteOffset+i._vf.byteLength),(S=K.GetEncodedGeometryType(i))==Q.TRIANGULAR_MESH&&(Z=new Q.Mesh,K.DecodeArrayToMesh(i,i.length,Z)),S==Q.POINT_CLOUD)&&(Z=new Q.PointCloud,K.DecodeArrayToPointCloud(i,i.length,Z));for(var t,i,o,s,n,L=e,r=G._cf.views.nodes,a=0;a<r.length;a++){var d,l,h=r[a],u=W?h._vf.dracoId:h._vf.idx,f=h._vf.byteOffset,c=h._vf.byteLength;null!=x3dom.BinaryContainerLoader.bufferGeoCache[k].buffers[u]&&X.isBuffer(x3dom.BinaryContainerLoader.bufferGeoCache[k].buffers[u])||(n=L,f=f,c=c,d=h,l=a,d=W?34963==d._vf.target?q():Y(d,l):new Uint8Array(n,f,c),l=X.createBuffer(),X.bindBuffer(h._vf.target,l),X.bufferData(h._vf.target,d,X.STATIC_DRAW),X.bindBuffer(h._vf.target,null),x3dom.BinaryContainerLoader.bufferGeoCache[k].buffers[u]=l)}for(var O=G._cf.accessors.nodes,_=0;_<O.length;_++){var m=O[_],p=m._vf.byteOffset,x=m._vf.byteStride,g=m._vf.bufferType,v=m._vf.components,y=m._vf.componentType,T=m._vf.normalized,b=m._vf.view;switch(g){case"INDEX":z=m,U._webgl.indexType=y,U._indexOffset=p;break;case"POSITION":H=m,U._coordStrideOffset=[x,p],U._webgl.coordType=y,U._webgl.coordNormalized=T,G._mesh._numPosComponents=v;break;case"NORMAL":j=!1,U._normalStrideOffset=[x,p],U._webgl.normalType=y,U._webgl.normalNormalized=T,G._mesh._numNormComponents=v;break;case"TEXCOORD_0":case"TEXCOORD":U._texCoordStrideOffset=[x,p],U._webgl.texCoordType=y,U._webgl.texCoordNormalized=T,G._mesh._numTexComponents=v;break;case"TEXCOORD_1":U._texCoord2StrideOffset=[x,p],U._webgl.texCoord2Type=y,U._webgl.texCoord2Normalized=T,G._mesh._numTex2Components=v;break;case"COLOR":case"COLOR_0":U._colorStrideOffset=[x,p],U._webgl.colorType=y,U._webgl.colorNormalized=T,G._mesh._numColComponents=v;break;case"TANGENT":U._tangentStrideOffset=[x,p],U._webgl.tangentType=y,U._webgl.tangentNormalized=T,G._mesh._numTangentComponents=v;break;case"BITANGENT":U._binormalStrideOffset=[x,p],U._webgl.binormalType=y,U._webgl.binormalNormalized=T,G._mesh._numBinormalComponents=v}g=x3dom.BUFFER_IDX[m._vf.bufferType],b=G._cf.views.nodes[b],b=W?b._vf.dracoId:b._vf.idx;U._webgl.buffers[g]=x3dom.BinaryContainerLoader.bufferGeoCache[k].buffers[b]}var S=e;if(0!=j){i=S,H&&(s=G._cf.views.nodes[H._vf.view],s=W?Y(s,H._vf.view):(s=H._vf.byteOffset+s._vf.byteOffset,o=H._vf.count*H._vf.components,x3dom.BinaryContainerLoader.getArrayBufferFromType(H._vf.componentType,i,s,o)));var F=s,E=(i=S,W?q():(z&&(t=G._cf.views.nodes[z._vf.view],t=z._vf.byteOffset+t._vf.byteOffset,o=z._vf.count*z._vf.components,t=x3dom.BinaryContainerLoader.getArrayBufferFromType(z._vf.componentType,i,t,o)),t)),M=new Float32Array(3*H._vf.count),C=new x3dom.fields.SFVec3f,w=new x3dom.fields.SFVec3f,A=new x3dom.fields.SFVec3f,R=new x3dom.fields.SFVec3f,D=new x3dom.fields.SFVec3f;if(E)for(var N,I,P,V=0;V<E.length;V+=3)N=3*E[V],I=3*E[V+1],P=3*E[V+2],C.set(F[N],F[1+N],F[2+N]),w.set(F[I],F[1+I],F[2+I]),A.set(F[P],F[1+P],F[2+P]),R=R.subtractVectors(C,w),D=(D=(D=D.subtractVectors(A,w)).cross(R)).normalize(),M[N]=M[I]=M[P]=D.x,M[1+N]=M[1+I]=M[1+P]=D.y,M[2+N]=M[2+I]=M[2+P]=D.z;else if(F)for(V=0;V<F.length;V+=9)C.set(F[V],F[V+1],F[V+2]),w.set(F[V+3],F[V+4],F[V+5]),A.set(F[V+6],F[V+7],F[V+8]),R=R.subtractVectors(C,w),D=(D=(D=D.subtractVectors(A,w)).cross(R)).normalize(),M[V]=M[V+3]=M[V+6]=D.x,M[V+1]=M[V+4]=M[V+7]=D.y,M[V+2]=M[V+5]=M[V+8]=D.z;s=X.createBuffer();X.bindBuffer(34962,s),X.bufferData(34962,M,X.STATIC_DRAW),X.bindBuffer(34962,null),U._webgl.buffers[x3dom.BUFFER_IDX.NORMAL]=s,U._normalStrideOffset=[12,0],U._webgl.normalType=5126,G._mesh._numNormComponents=3}(e=x3dom.BinaryContainerLoader.bufferGeoCache[k]).shapes.push(U),U._webgl._bufferGeoCache=e,B=U._cleanupGLObjects,U._cleanupGLObjects=function(e,t){var i,o=this._webgl._bufferGeoCache;for(i in o.buffers)delete o.buffers[i];var s=o.shapes.indexOf(this);-1<s&&o.shapes.splice(s,1),0<o.shapes.length||B.call(this,e,t)},W&&Q.destroy(Z),x3dom.BinaryContainerLoader.bufferGeoCache[k].decrementDownload&&(x3dom.BinaryContainerLoader.bufferGeoCache[k].decrementDownload=!1,U._nameSpace.doc.decrementDownloads(),U._nameSpace.doc.needRender=!0)}else x3dom.BinaryContainerLoader.bufferGeoCache[k]=void 0;var B}).catch(function(){x3dom.BinaryContainerLoader.bufferGeoCache[k].decrementDownload&&(x3dom.BinaryContainerLoader.bufferGeoCache[k].decrementDownload=!1,U._nameSpace.doc.decrementDownloads())}))},x3dom.BinaryContainerLoader.setupBufferInterpolator=function(m){var p=m._nameSpace.getURL(m._vf.buffer);null==x3dom.BinaryContainerLoader.bufferGeoCache[p]&&(m._nameSpace.doc.incrementDownloads(),x3dom.BinaryContainerLoader.bufferGeoCache[p]={},x3dom.BinaryContainerLoader.bufferGeoCache[p].buffers=[],x3dom.BinaryContainerLoader.bufferGeoCache[p].decrementDownload=!0,x3dom.BinaryContainerLoader.bufferGeoCache[p].promise=new Promise(function(t,i){var o=new XMLHttpRequest;o.open("GET",p),o.responseType="arraybuffer",o.onload=function(e){200!=o.status?i():t(o.response)},o.onerror=function(e){i()},x3dom.RequestManager.addRequest(o)})),x3dom.BinaryContainerLoader.bufferGeoCache[p].promise.then(function(e){if(null!=m){for(var t,i,o,s,n,r,a,d=e,l=m._cf.accessors.nodes,h=0;h<l.length;h++){var u=l[h];switch(u._vf.bufferType){case"SAMPLER_INPUT":t=((e,t,i)=>{for(var o=e._cf.views.nodes[t._vf.view],o=t._vf.byteOffset+o._vf.byteOffset,s=t._vf.count*t._vf.components,t=t._vf.componentType,n=x3dom.BinaryContainerLoader.getArrayBufferFromType(t,i,o,s),r=0,a=n.length;r<a;r++)n[r]=n[r]/e._vf.duration;return new x3dom.fields.MFFloat(n)})(m,u,d),m._vf.key=t;break;case"SAMPLER_OUTPUT":s=u,n=d,a=r=void 0,r=(o=m)._cf.views.nodes[s._vf.view],r=s._vf.byteOffset+r._vf.byteOffset,a=s._vf.count*s._vf.components,s=s._vf.componentType,n=x3dom.BinaryContainerLoader.getArrayBufferFromType(s,d,r,a),i=o.keyValueFromAccessor(n,s)}}if("STEP"===m._vf.interpolation){for(var f=t.copy(),c=i.copy(),_=(h=1,t.length);h<_;h++)f.splice(2*h,0,t[h]);for(h=0,_=i.length;h<_;h++)c.splice(2*h+1,0,i[h]);t=f,i=c}m._vf.keyValue=i,x3dom.BinaryContainerLoader.bufferGeoCache[p].decrementDownload&&(x3dom.BinaryContainerLoader.bufferGeoCache[p].decrementDownload=!1,m._nameSpace.doc.decrementDownloads(),m._nameSpace.doc.needRender=!0)}else x3dom.BinaryContainerLoader.bufferGeoCache[p]=void 0}).catch(function(){x3dom.BinaryContainerLoader.bufferGeoCache[p].decrementDownload&&(x3dom.BinaryContainerLoader.bufferGeoCache[p].decrementDownload=!1,m._nameSpace.doc.decrementDownloads())})},x3dom.BinaryContainerLoader.getArrayBufferFromType=function(e,t,i,o){switch(e){case 5120:return new Int8Array(t,i,o);case 5121:return new Uint8Array(t,i,o);case 5122:return new Int16Array(t,i,o);case 5123:return new Uint16Array(t,i,o);case 5125:return new Uint32Array(t,i,o);case 5126:return new Float32Array(t,i,o)}},x3dom.DrawableCollection=function(e){this.collection=[],this.viewMatrix=e.viewMatrix,this.projMatrix=e.projMatrix,this.sceneMatrix=e.sceneMatrix,this.viewarea=e.viewArea;var t=this.viewarea._scene,i=t.getEnvironment(),t=t.getViewpoint();this.near=t.getNear(),this.pixelHeightAtDistOne=t.getImgPlaneHeightAtDistOne()/this.viewarea._height,this.context=e.context,this.gl=e.gl,this.viewFrustum=this.viewarea.getViewfrustum(this.sceneMatrix),this.worldVol=new x3dom.fields.BoxVolume,this.frustumCulling=e.frustumCulling&&null!=this.viewFrustum,this.smallFeatureThreshold=e.smallFeatureThreshold,this.sortOpaque=0<this.smallFeatureThreshold&&i._lowPriorityThreshold<1,this.sortTrans=e.sortTrans,this.prioLevels=10,this.maxTreshold=100,this.sortBySortKey=!1,this.sortByPriority=!1,this.numberOfNodes=0,this.length=0},x3dom.DrawableCollection.prototype.cull=function(e,t,i,o){var s=t.boundedNode;if(!s||!s.renderFlag())return-1;var n=s.getVolume();if(this.frustumCulling&&t.needCulling){if(i&&!t.worldVolume.isValid()?(t.worldVolume.transformFrom(e,n),r=t.worldVolume):o<63&&(this.worldVol.transformFrom(e,n),r=this.worldVol),-1==(o=o<63?this.viewFrustum.intersect(r,o):o))return-1}else o=63;if(t.coverage=-1,0<this.smallFeatureThreshold||s.forceUpdateCoverage()){var i=this.viewMatrix.mult(e),r=(t.center=i.multMatrixPnt(n.getCenter()),i.multMatrixVec(n.getRadialVec()).length()),s=Math.max(-t.center.z-r,this.near)*this.pixelHeightAtDistOne;if(t.coverage=2*r/s,0<this.smallFeatureThreshold&&t.coverage<this.smallFeatureThreshold&&t.needCulling)return-1}return this.numberOfNodes++,o},x3dom.DrawableCollection.prototype.addShape=function(e,t,i){var o={},s=(o.shape=e,o.transform=t,o.localTransform=i.localMatrix,o.localVolume=i.volume,o.worldVolume=x3dom.fields.BoxVolume.copy(i.worldVolume),o.priority=Math.max(0,i.coverage),o.shaderID=e.getShaderProperties(this.viewarea).id,e._cf.appearance.node);o.sortType=s?s._vf.sortType.toLowerCase():"opaque",o.sortKey=s?s._vf.sortKey:0,"transparent"==o.sortType&&(0<this.smallFeatureThreshold?o.zPos=i.center.z:(s=t.multMatrixPnt(e.getCenter()),s=this.viewMatrix.multMatrixPnt(s),o.zPos=s.z)),this.sortBySortKey||0==o.sortKey||(this.sortBySortKey=!0),void 0===this.collection[o.sortType]&&(this.collection[o.sortType]=[]),this.collection[o.sortType].push(o),this.length++,this.context&&this.gl&&this.context.setupShape(this.gl,o,this.viewarea)},x3dom.DrawableCollection.prototype.addDrawable=function(e){e.shaderID=e.shape.getShaderProperties(this.viewarea).id;var t=e.shape._cf.appearance.node;e.sortType=t?t._vf.sortType.toLowerCase():"opaque",e.sortKey=t?t._vf.sortKey:0,"transparent"==e.sortType&&(t=e.transform.multMatrixPnt(e.shape.getCenter()),t=this.viewMatrix.multMatrixPnt(t),e.zPos=t.z),this.sortBySortKey||0==e.sortKey||(this.sortBySortKey=!0),void 0===this.collection[e.sortType]&&(this.collection[e.sortType]=[]),this.collection[e.sortType].push(e),this.length++,this.context&&this.gl&&this.context.setupShape(this.gl,e,this.viewarea)},x3dom.DrawableCollection.prototype.calculatePriority=function(e){var e=Math.max(0,e.coverage),t=this.prioLevels-1;return Math.min(Math.round(e/(this.maxTreshold/t)),t)},x3dom.DrawableCollection.prototype.concat=function(){var e=void 0!==this.collection.opaque?this.collection.opaque:[],t=void 0!==this.collection.transparent?this.collection.transparent:[];this.collection=e.concat(t)},x3dom.DrawableCollection.prototype.get=function(e){return this.collection[e]},x3dom.DrawableCollection.prototype.sort=function(){var e=[],t=[],i=this;void 0!==this.collection.opaque&&(this.sortOpaque&&this.collection.opaque.sort(function(e,t){return e.sortKey!=t.sortKey&&i.sortBySortKey?e.sortKey-t.sortKey:t.priority-e.priority}),e=this.collection.opaque),void 0!==this.collection.transparent&&(this.sortTrans&&this.collection.transparent.sort(function(e,t){return e.sortKey!=t.sortKey&&i.sortBySortKey?e.sortKey-t.sortKey:e.priority!=t.priority&&i.sortByPriority?t.priority-e.priority:e.zPos-t.zPos}),t=this.collection.transparent),this.collection=e.concat(t)},x3dom.DrawableCollection.prototype.forEach=function(e,t){var i,o,s,n;for(t=void 0!==t?Math.min(t,this.prioLevels):this.prioLevels,i=0;i<this.collection.opaque.length;++i)if(void 0!==this.collection.opaque[i])for(o=this.collection.opaque[i].length;0<o;--o)if(void 0!==this.collection.opaque[i][o])for(s in this.collection.opaque[i][o])for(n=0;n<this.collection.opaque[i][o][s].length;++n)e(this.collection.opaque[i][o][s][n]);for(i=0;i<this.collection.transparent.length;++i)if(void 0!==this.collection.transparent[i])for(o=this.collection.transparent[i].length;0<o;--o)if(void 0!==this.collection.transparent[i][o])for(var r in this.collection.transparent[i][o])for(this.collection.transparent[i][o][r].sort(function(e,t){return e.zPos-t.zPos}),n=0;n<this.collection.transparent[i][o][r].length;++n)e(this.collection.transparent[i][o][r][n])},x3dom.Moveable=function(e,t,i,o,s){this._x3domRoot=e,this._runtime=e.runtime,this._callback=i,this._gridSize=o||0,this._moveable=t,this._drag=!1,this._w=0,this._h=0,this._uPlane=null,this._vPlane=null,this._pPlane=null,this._isect=null,this._translationOffset=null,this._rotationOffset=null,this._scaleOffset=null,this._lastX=0,this._lastY=0,this._buttonState=0,this._mode=s&&s.length?s.toLowerCase():"translation",this._firstRay=null,this._matrixTrafo=null,this._navType="examine",this.attachHandlers()},x3dom.Moveable.prototype.setGridSize=function(e){this._gridSize=e},x3dom.Moveable.prototype.setMode=function(e){this._mode=e.toLowerCase()},x3dom.Moveable.prototype.attachHandlers=function(){(this._moveable._iMove=this)._x3domRoot._iMove||(this._x3domRoot._iMove=[]),this._x3domRoot._iMove.push(this),this._moveable.addEventListener("mousedown",this.start,!1),this._moveable.addEventListener("mouseover",this.over,!1),this._moveable.addEventListener("mouseout",this.out,!1),1==this._x3domRoot._iMove.length&&(this._x3domRoot.addEventListener("mouseup",this.stop,!1),this._x3domRoot.addEventListener("mouseout",this.stop,!1),this._x3domRoot.addEventListener("mousemove",this.move,!0),this._runtime.canvas.disableTouch||(this._x3domRoot.addEventListener("MozTouchDown",this.touchStartHandlerMoz,!1),this._x3domRoot.addEventListener("MozTouchMove",this.touchMoveHandlerMoz,!0),this._x3domRoot.addEventListener("MozTouchUp",this.touchEndHandlerMoz,!1),this._x3domRoot.addEventListener("touchstart",this.touchStartHandler,!1),this._x3domRoot.addEventListener("touchmove",this.touchMoveHandler,!0),this._x3domRoot.addEventListener("touchend",this.touchEndHandler,!1)))},x3dom.Moveable.prototype.detachHandlers=function(){var e=this._x3domRoot._iMove;if(e)for(var t=0,i=e.length;t<i;t++)if(e[t]==this){e.splice(t,1);break}this._moveable.removeEventListener("mousedown",this.start,!1),this._moveable.removeEventListener("mouseover",this.over,!1),this._moveable.removeEventListener("mouseout",this.out,!1),0==e.length&&(this._x3domRoot.removeEventListener("mouseup",this.stop,!1),this._x3domRoot.removeEventListener("mouseout",this.stop,!1),this._x3domRoot.removeEventListener("mousemove",this.move,!0),this._runtime.canvas.disableTouch||(this._x3domRoot.removeEventListener("MozTouchDown",this.touchStartHandlerMoz,!1),this._x3domRoot.removeEventListener("MozTouchMove",this.touchMoveHandlerMoz,!0),this._x3domRoot.removeEventListener("MozTouchUp",this.touchEndHandlerMoz,!1),this._x3domRoot.removeEventListener("touchstart",this.touchStartHandler,!1),this._x3domRoot.removeEventListener("touchmove",this.touchMoveHandler,!0),this._x3domRoot.removeEventListener("touchend",this.touchEndHandler,!1))),this._moveable._iMove&&delete this._moveable._iMove},x3dom.Moveable.prototype.calcViewPlane=function(e){this._w=this._runtime.getWidth(),this._h=this._runtime.getHeight();var t=this._runtime.getViewingRay(0,this._h-1),i=t.pos.add(t.dir),o=(t=this._runtime.getViewingRay(this._w-1,this._h-1)).pos.add(t.dir),t=(t=this._runtime.getViewingRay(0,0)).pos.add(t.dir);this._uPlane=o.subtract(i).normalize(),this._vPlane=t.subtract(i).normalize(),this._pPlane=0===arguments.length?i:x3dom.fields.SFVec3f.copy(e)},x3dom.Moveable.prototype.det=function(e){return e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[2][1]*e[1][0]-e[2][0]*e[1][1]*e[0][2]-e[0][0]*e[2][1]*e[1][2]-e[1][0]*e[0][1]*e[2][2]},x3dom.Moveable.prototype.translateXY=function(e){for(var t=null,i=[],o=[],s=0;s<3;s++)i[s]=[],o[s]=[],i[s][0]=this._uPlane.at(s),o[s][0]=i[s][0],i[s][1]=this._vPlane.at(s),o[s][1]=i[s][1],i[s][2]=e.pos.subtract(this._pPlane).at(s),o[s][2]=-e.dir.at(s);var n=this.det(o);return 0!==n&&(n=this.det(i)/n,t=e.pos.addScaled(e.dir,n)),t=t?(t=this._isect?t.subtract(this._isect):t).add(this._translationOffset):t},x3dom.Moveable.prototype.translateZ=function(e,t){var i=this._runtime.getSceneBBox(),t=(t<this._lastY?1:-1)*i.max.subtract(i.min).length()/100;return this._translationOffset=this._translationOffset.addScaled(e.dir,t),this._translationOffset},x3dom.Moveable.prototype.rotate=function(e,t){var i=2*Math.PI,t=(t-this._lastY)*i/this._w,e=(e-this._lastX)*i/this._h,i=x3dom.fields.Quaternion.axisAngle(this._uPlane,t).toMatrix(),t=(this._rotationOffset=i.mult(this._rotationOffset),i=x3dom.fields.Quaternion.axisAngle(this._vPlane,e).toMatrix(),this._rotationOffset=i.mult(this._rotationOffset),this._rotationOffset.mult(x3dom.fields.SFMatrix4f.scale(this._scaleOffset))),e=new x3dom.fields.Quaternion(0,0,1,0);return e.setValue(t),e},x3dom.Moveable.prototype.over=function(e){this._iMove._runtime.getCanvas().style.cursor="crosshair"},x3dom.Moveable.prototype.out=function(e){var t=this._iMove;t._drag||(t._runtime.getCanvas().style.cursor="pointer")},x3dom.Moveable.prototype.start=function(e){var t,i,o,s,n=this._iMove;switch(n._mode){case"translation":n._buttonState=4==e.button?1:3&e.button;break;case"rotation":n._buttonState=4;break;default:n._buttonState=e.button}!n._drag&&n._buttonState&&(n._lastX=e.layerX,n._lastY=e.layerY,n._drag=!0,n._navType=n._runtime.navigationType(),n._runtime.noNav(),n._isect=new x3dom.fields.SFVec3f(e.worldX,e.worldY,e.worldZ),n.calcViewPlane(n._isect),n._firstRay=n._runtime.getViewingRay(e.layerX,e.layerY),i=n._moveable.getAttribute("translation"),n._matrixTrafo=null,i?(n._translationOffset=x3dom.fields.SFVec3f.parse(i),t=(t=n._moveable.getAttribute("rotation"))?x3dom.fields.Quaternion.parseAxisAngle(t):new x3dom.fields.Quaternion(0,0,1,0),n._rotationOffset=t.toMatrix(),t=n._moveable.getAttribute("scale"),n._scaleOffset=t?x3dom.fields.SFVec3f.parse(t):new x3dom.fields.SFVec3f(1,1,1)):(i=n._moveable.getAttribute("matrix"))?(n._matrixTrafo=x3dom.fields.SFMatrix4f.parse(i).transpose(),t=new x3dom.fields.SFVec3f(0,0,0),i=new x3dom.fields.SFVec3f(1,1,1),o=new x3dom.fields.Quaternion(0,0,1,0),s=new x3dom.fields.Quaternion(0,0,1,0),n._matrixTrafo.getTransform(t,o,i,s),n._translationOffset=t,n._rotationOffset=o.toMatrix(),n._scaleOffset=i):(n._translationOffset=new x3dom.fields.SFVec3f(0,0,0),n._rotationOffset=new x3dom.fields.SFMatrix4f,n._scaleOffset=new x3dom.fields.SFVec3f(1,1,1)),n._runtime.getCanvas().style.cursor="crosshair")},x3dom.Moveable.prototype.move=function(e){for(var t=0,i=this._iMove.length;t<i;t++){var o,s,n,r,a,d=this._iMove[t];d._drag&&(o=d._runtime.mousePosition(e),s=d._runtime.getViewingRay(o[0],o[1]),a=null,(a=2==d._buttonState?d.translateZ(d._firstRay,o[1]):1==d._buttonState?d.translateXY(s):d.rotate(o[0],o[1]))&&(0<d._gridSize&&4!=d._buttonState&&(s=d._gridSize*Math.round(a.x/d._gridSize),n=d._gridSize*Math.round(a.y/d._gridSize),r=d._gridSize*Math.round(a.z/d._gridSize),a=new x3dom.fields.SFVec3f(s,n,r)),d._matrixTrafo?(4==d._buttonState?d._matrixTrafo.setRotate(a):d._matrixTrafo.setTranslate(a),d._moveable.setAttribute("matrix",d._matrixTrafo.toGL().toString())):4==d._buttonState?d._moveable.setAttribute("rotation",a.toAxisAngle().toString()):d._moveable.setAttribute("translation",a.toString()),d._callback)&&d._callback(d._moveable,a),d._lastX=o[0],d._lastY=o[1])}},x3dom.Moveable.prototype.stop=function(e){for(var t=0,i=this._iMove.length;t<i;t++){var o=this._iMove[t];o._drag&&(o._lastX=e.layerX,o._lastY=e.layerY,o._isect=null,o._drag=!1,o._runtime.canvas.doc._scene.getNavigationInfo().setType(o._navType),o._runtime.getCanvas().style.cursor="pointer")}},x3dom.Moveable.prototype.touchStartHandler=function(e){e.preventDefault()},x3dom.Moveable.prototype.touchStartHandlerMoz=function(e){e.preventDefault()},x3dom.Moveable.prototype.touchMoveHandler=function(e){e.preventDefault()},x3dom.Moveable.prototype.touchMoveHandlerMoz=function(e){e.preventDefault()},x3dom.Moveable.prototype.touchEndHandler=function(e){var t;this._iMove.length&&(t=this._iMove[0]).stop.apply(t._x3domRoot,[e]),e.preventDefault()},x3dom.Moveable.prototype.touchEndHandlerMoz=function(e){var t;this._iMove.length&&(t=this._iMove[0]).stop.apply(t._x3domRoot,[e]),e.preventDefault()},(()=>{function l(e){return"function"==typeof e}function t(){var e=setTimeout;return function(){return e(i,1)}}function i(){for(var e=0;e<n;e+=2)(0,M[e])(M[e+1]),M[e]=void 0,M[e+1]=void 0;n=0}function a(e,t){var i,o=this,s=new this.constructor(r),n=(void 0===s[C]&&g(s),o._state);return n?(i=arguments[n-1],b(function(){return x(n,s,i,o._result)})):m(o,s,e,t),s}function d(e){var t;return e&&"object"==typeof e&&e.constructor===this?e:(f(t=new this(r),e),t)}function r(){}function h(e){try{return e.then}catch(e){return D.error=e,D}}function u(e,t,i){var s,n,o,r;t.constructor===e.constructor&&i===a&&t.constructor.resolve===d?(o=e,(r=t)._state===A?c(o,r._result):r._state===R?_(o,r._result):m(r,void 0,function(e){return f(o,e)},function(e){return _(o,e)})):i===D?(_(e,D.error),D.error=null):void 0!==i&&l(i)?(s=t,n=i,b(function(i){var o=!1,e=((e,t)=>{try{e.call(t,function(e){o||(o=!0,s!==e?f(i,e):c(i,e))},function(e){o||(o=!0,_(i,e))})}catch(e){return e}})(n,s,i._label);!o&&e&&(o=!0,_(i,e))},e)):c(e,t)}function f(e,t){var i;e===t?_(e,new TypeError("You cannot resolve a promise with itself")):(i=typeof t,null===t||"object"!=i&&"function"!=i?c(e,t):u(e,t,h(t)))}function L(e){e._onerror&&e._onerror(e._result),p(e)}function c(e,t){e._state===w&&(e._result=t,e._state=A,0!==e._subscribers.length)&&b(p,e)}function _(e,t){e._state===w&&(e._state=R,e._result=t,b(L,e))}function m(e,t,i,o){var s=e._subscribers,n=s.length;e._onerror=null,s[n]=t,s[n+A]=i,s[n+R]=o,0===n&&e._state&&b(p,e)}function p(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var o,s=void 0,n=e._result,r=0;r<t.length;r+=3)o=t[r],s=t[r+i],o?x(i,o,s,n):s(n);e._subscribers.length=0}}function x(e,t,i,o){var s=l(i),n=void 0,r=void 0,a=void 0,d=void 0;if(s){if((n=((e,t)=>{try{return e(t)}catch(e){return D.error=e,D}})(i,o))===D?(d=!0,r=n.error,n.error=null):a=!0,t===n)return void _(t,new TypeError("A promises callback cannot return that same promise."))}else n=o,a=!0;t._state===w&&(s&&a?f(t,n):d?_(t,r):e===A?c(t,n):e===R&&_(t,n))}function g(e){e[C]=N++,e._state=void 0,e._result=void 0,e._subscribers=[]}var e,o,s,v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,y=void 0,T=void 0,b=function(e,t){M[n]=e,M[n+1]=t,2===(n+=2)&&(T?T(i):B())},S=void 0!==window?window:void 0,F=(F=S||{}).MutationObserver||F.WebKitMutationObserver,E="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),O="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,M=new Array(1e3),B=void 0,B=E?function(){return process.nextTick(i)}:F?(o=0,E=new F(i),s=document.createTextNode(""),E.observe(s,{characterData:!0}),function(){s.data=o=++o%2}):O?((e=new MessageChannel).port1.onmessage=i,function(){return e.port2.postMessage(0)}):(void 0===S&&"function"==typeof require?()=>{try{var e=Function("return this")().require("vertx");return void 0!==(y=e.runOnLoop||e.runOnContext)?function(){y(i)}:t()}catch(e){return t()}}:t)(),C=Math.random().toString(36).substring(2),w=void 0,A=1,R=2,D={error:null},N=0,U=(V.prototype._enumerate=function(e){for(var t=0;this._state===w&&t<e.length;t++)this._eachEntry(e[t],t)},V.prototype._eachEntry=function(t,e){var i,o,s=this._instanceConstructor,n=s.resolve;n===d?(i=h(t))===a&&t._state!==w?this._settledAt(t._state,e,t._result):"function"!=typeof i?(this._remaining--,this._result[e]=t):s===I?(u(o=new s(r),t,i),this._willSettleAt(o,e)):this._willSettleAt(new s(function(e){return e(t)}),e):this._willSettleAt(n(t),e)},V.prototype._settledAt=function(e,t,i){var o=this.promise;o._state===w&&(this._remaining--,e===R?_(o,i):this._result[t]=i),0===this._remaining&&c(o,this._result)},V.prototype._willSettleAt=function(e,t){var i=this;m(e,void 0,function(e){return i._settledAt(A,t,e)},function(e){return i._settledAt(R,t,e)})},V),I=(P.prototype.catch=function(e){return this.then(null,e)},P.prototype.finally=function(t){var i=this.constructor;return this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})})},P);function P(e){if(this[C]=N++,this._result=this._state=void 0,this._subscribers=[],r!==e){if("function"!=typeof e)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof P))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var t=this,i=e;try{i(function(e){f(t,e)},function(e){_(t,e)})}catch(i){_(t,i)}}}function V(e,t){this._instanceConstructor=e,this.promise=new e(r),this.promise[C]||g(this.promise),v(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0!==this.length&&(this.length=this.length||0,this._enumerate(t),0!==this._remaining)||c(this.promise,this._result)):_(this.promise,new Error("Array Methods must be provided an Array"))}I.prototype.then=a,I.all=function(e){return new U(this,e).promise},I.race=function(s){var n=this;return new n(v(s)?function(e,t){for(var i=s.length,o=0;o<i;o++)n.resolve(s[o]).then(e,t)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},I.resolve=d,I.reject=function(e){var t=new this(r);return _(t,e),t},I._setScheduler=function(e){T=e},I._setAsap=function(e){b=e},I._asap=b,I.polyfill=function(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=I},(I.Promise=I).polyfill()})(),x3dom.glTF2Loader=function(e){this._nameSpace=e,this._definitions={},this._supportedExtensions=["KHR_materials_pbrSpecularGlossiness","KHR_materials_unlit","KHR_texture_transform"],x3dom.DracoDecoderModule&&this._supportedExtensions.push("KHR_draco_mesh_compression")},x3dom.glTF2Loader.prototype.load=function(e,t){this._gltf=this._getGLTF(e,t);var i=this._generateX3DScene(),e=this._gltf.scene||0,o=this._gltf.scenes[e];if(this._generateX3DWorldInfo(o,i),this._unsupportedExtensionsRequired())x3dom.debug.logWarning("Cannot render glTF."),x3dom.debug.logWarning("Some required extension of "+this._gltf.extensionsRequired+" not supported.");else{for(var s=0;s<o.nodes.length;s++){var n=this._gltf.nodes[o.nodes[s]];this._traverseNodes(n,i,o.nodes[s])}if(this._gltf.animations)for(s=0;s<this._gltf.animations.length;s++){var r=this._gltf.animations[s];this._generateX3DAnimationNodes(i,r,"glTF_ANIMATION_"+s)}}return i},x3dom.glTF2Loader.prototype._unsupportedExtensionsRequired=function(){return!!this._gltf.extensionsRequired&&this._gltf.extensionsRequired.some(function(e){return this._supportedExtensions.indexOf(e)<0},this)},x3dom.glTF2Loader.prototype._generateX3DWorldInfo=function(e,t){if(this._gltf.asset){for(var i,o=this._gltf.asset,s=["copyright","generator","version","minversion"],n=document.createElement("worldinfo"),r=new x3dom.fields.MFString,a=0;a<s.length;a++)o[i=s[a]]&&r.push('"'+s[a]+":"+o[i]+'"');n.setAttribute("info",r.toString()),o.extras&&o.extras.title&&n.setAttribute("title",o.extras.title);var d=document.createElement("MetadataSet");d.setAttribute("name","global"),d.setAttribute("containerfield","metadata"),this._generateX3DMetadata(o,d,"asset_extras","value"),this._generateX3DMetadata(e,d,"scene_extras","value"),d.hasChildNodes()&&n.appendChild(d),t.appendChild(n)}},x3dom.glTF2Loader.prototype._generateX3DMetadata=function(e,t,i,o){function s(e,t,i,o){e=document.createElement(e);return e.setAttribute("name",t),e.setAttribute("value",i),e.setAttribute("containerfield",o),e}e.extras&&(i=function a(e,t,i){var o=typeof t;return"string"==o||null===t||"undefined"==o?s("MetadataString",e,JSON.stringify(t),i):"number"==o?s("MetadataFloat",e,t,i):"boolean"==o?s("MetadataBoolean",e,t,i):"object"==o?((e,t,i)=>{var o=document.createElement("MetadataSet");o.setAttribute("name",e),o.setAttribute("containerfield",i);var s,n,r=Object.keys(t);for(n=0;n<r.length;n++)s=r[n],o.appendChild(a(s,t[s],"value"));return o})(e,t,i):s("MetadataString",e,t,i)}(i=i||"extras",e.extras,o=o||"metadata"),t.appendChild(i))},x3dom.glTF2Loader.prototype._traverseNodes=function(e,t,i){var o=this._generateX3DNode(e,i);if(t.appendChild(o),e.children)for(var s=0;s<e.children.length;s++){var n=this._gltf.nodes[e.children[s]];this._traverseNodes(n,o,e.children[s])}},x3dom.glTF2Loader.prototype._generateX3DNode=function(e,t){var i;if(e.name=e.name||t,i=null!=e.matrix?this._generateX3DMatrixTransform(e):(null==e.translation&&null==e.rotation&&e.scale,this._generateX3DTransform(e)),this._generateX3DMetadata(e,i),null!=e.mesh)for(var o=this._gltf.meshes[e.mesh],s=0;s<o.primitives.length;s++)i.appendChild(this._generateX3DShape(o.primitives[s]));return null!=e.model&&null!=(t=this._gltf.models[e.model]).uri&&i.appendChild(this._generateX3DInline(t)),null!=e.camera&&i.appendChild(this._generateX3DViewpoint(e)),i},x3dom.glTF2Loader.prototype._generateX3DScene=function(){return document.createElement("scene")},x3dom.glTF2Loader.prototype._generateX3DTransform=function(e){var t=document.createElement("transform");return null!=e.translation&&t.setAttribute("translation",e.translation.join(" ")),null!=e.rotation&&t.setAttribute("rotation",this._toAxisAngle(e.rotation).join(" ")),null!=e.scale&&t.setAttribute("scale",e.scale.join(" ")),null!=e.name&&t.setAttribute("DEF","glTF_NODE_"+e.name),t},x3dom.glTF2Loader.prototype._generateX3DMatrixTransform=function(e){var t=document.createElement("matrixtransform");return null!=e.matrix&&t.setAttribute("matrix",e.matrix.join(" ")),null!=e.name&&t.setAttribute("DEF","glTF_NODE_"+e.name),t},x3dom.glTF2Loader.prototype._generateX3DGroup=function(e){return document.createElement("group")},x3dom.glTF2Loader.prototype._generateX3DInline=function(e){var t=document.createElement("inline");return t.setAttribute("url",e.uri),null!=e.mimeType&&t.setAttribute("contentType",e.mimeType),t},x3dom.glTF2Loader.prototype._generateX3DViewpoint=function(e){var t=this._gltf.cameras[e.camera],e="glTF_CAMERA_"+e.camera;return"orthographic"!==t.type?this._generateX3DPerspectiveViewpoint(e,t.perspective):this._generateX3DOrthoViewpoint(e,t.orthographic)},x3dom.glTF2Loader.prototype._generateX3DPerspectiveViewpoint=function(e,t){var i=document.createElement("viewpoint"),o=(this._generateX3DMetadata(t,i),t.yfov||.785398),s=t.znear||-1,t=t.zfar||-1;return 1e5<t/s&&(t=s=-1),i.setAttribute("DEF",e),i.setAttribute("fieldOfView",o),i.setAttribute("zNear",s),i.setAttribute("zFar",t),i.setAttribute("position","0 0 0"),i},x3dom.glTF2Loader.prototype._generateX3DOrthoViewpoint=function(e,t){var i=document.createElement("orthoviewpoint"),o=(this._generateX3DMetadata(t,i),t.xmag||1),s=t.ymag||1,n=t.znear||-1,t=t.zfar||-1,o=[-o,-s,o,s];return i.setAttribute("DEF",e),i.setAttribute("fieldOfView",o),i.setAttribute("zNear",n),i.setAttribute("zFar",t),i.setAttribute("position","0 0 0"),i},x3dom.glTF2Loader.prototype._generateX3DShape=function(e){var t=document.createElement("shape"),i=(this._generateX3DMetadata(e,t),null!=e.material?this._gltf.materials[e.material]:{name:"DEFAULT"}),i=(null==i.name&&(i.name=e.material),t.appendChild(this._generateX3DAppearance(i)),null);return(i=e.extensions&&e.extensions.KHR_draco_mesh_compression?e.extensions.KHR_draco_mesh_compression:i)&&!x3dom.DracoDecoderModule||t.appendChild(this._generateX3DBufferGeometry(e,i)),t},x3dom.glTF2Loader.prototype._generateX3DAppearance=function(e){var t=document.createElement("appearance");return this._generateX3DMetadata(e,t),"BLEND"===e.alphaMode?t.setAttribute("sortType","transparent"):t.setAttribute("sortType","opaque"),t.setAttribute("alphaClipThreshold",0),t.appendChild(this._generateX3DPhysicalMaterial(e)),this._textureTransform&&(t.appendChild(this._textureTransform),this._textureTransform=void 0),t},x3dom.glTF2Loader.prototype._generateX3DPhysicalMaterial=function(e){var t,i,o,s,n,r,a,d,l,h,u,f,c=document.createElement("physicalmaterial");return this._USEorDEF(c,"glTF_MATERIAL_"+e.name)||(h=[1,1,1,1],o=e.emissiveFactor||[0,0,0],f=u=1,s=e.alphaMode||"OPAQUE",n=e.alphaCutoff||.5,r=!0,d=a=void 0,l=0,e.pbrMetallicRoughness?(d=e.pbrMetallicRoughness,a="roughnessMetallic"):e.extensions&&e.extensions.KHR_materials_pbrSpecularGlossiness&&(d=e.extensions.KHR_materials_pbrSpecularGlossiness,a="specularGlossiness"),"roughnessMetallic"==a?(h=d.baseColorFactor||[1,1,1,1],u=null!=d.metallicFactor?d.metallicFactor:1,f=null!=d.roughnessFactor?d.roughnessFactor:1,d.baseColorTexture&&(l=d.baseColorTexture.texCoord?1:0,t=this._gltf.textures[d.baseColorTexture.index],i=d.baseColorTexture.extensions&&d.baseColorTexture.extensions.KHR_texture_transform?d.baseColorTexture.extensions.KHR_texture_transform:void 0,c.appendChild(this._generateX3DImageTexture(t,"baseColorTexture",l,i))),d.metallicRoughnessTexture&&(l=d.metallicRoughnessTexture.texCoord?1:0,t=this._gltf.textures[d.metallicRoughnessTexture.index],i=d.metallicRoughnessTexture.extensions&&d.metallicRoughnessTexture.extensions.KHR_texture_transform?d.metallicRoughnessTexture.extensions.KHR_texture_transform:void 0,e.occlusionTexture&&e.occlusionTexture.index==d.metallicRoughnessTexture.index?(r=!1,c.appendChild(this._generateX3DImageTexture(t,"occlusionRoughnessMetallicTexture",l,i))):c.appendChild(this._generateX3DImageTexture(t,"roughnessMetallicTexture",l,i))),c.setAttribute("baseColorFactor",h.join(" ")),c.setAttribute("metallicFactor",u),c.setAttribute("roughnessFactor",f)):"specularGlossiness"==a&&(h=d.diffuseFactor||[1,1,1,1],u=d.specularFactor||[1,1,1],f=null!=d.glossinessFactor?d.glossinessFactor:1,d.diffuseTexture&&(l=d.diffuseTexture.texCoord?1:0,t=this._gltf.textures[d.diffuseTexture.index],i=d.diffuseTexture.extensions&&d.diffuseTexture.extensions.KHR_texture_transform?d.diffuseTexture.extensions.KHR_texture_transform:void 0,c.appendChild(this._generateX3DImageTexture(t,"baseColorTexture",l,i))),d.specularGlossinessTexture&&(l=d.specularGlossinessTexture.texCoord?1:0,t=this._gltf.textures[d.specularGlossinessTexture.index],i=d.specularGlossinessTexture.extensions&&d.specularGlossinessTexture.extensions.KHR_texture_transform?d.specularGlossinessTexture.extensions.KHR_texture_transform:void 0,c.appendChild(this._generateX3DImageTexture(t,"specularGlossinessTexture",l,i))),c.setAttribute("diffuseFactor",h.join(" ")),c.setAttribute("specularFactor",u.join(" ")),c.setAttribute("glossinessFactor",f)),e.normalTexture&&(l=e.normalTexture.texCoord?1:0,t=this._gltf.textures[e.normalTexture.index],i=e.normalTexture.extensions&&e.normalTexture.extensions.KHR_texture_transform?e.normalTexture.extensions.KHR_texture_transform:void 0,c.appendChild(this._generateX3DImageTexture(t,"normalTexture",l,i))),e.emissiveTexture&&(l=e.emissiveTexture.texCoord?1:0,t=this._gltf.textures[e.emissiveTexture.index],i=e.emissiveTexture.extensions&&e.emissiveTexture.extensions.KHR_texture_transform?e.emissiveTexture.extensions.KHR_texture_transform:void 0,c.appendChild(this._generateX3DImageTexture(t,"emissiveTexture",l,i))),e.occlusionTexture&&r&&(l=e.occlusionTexture.texCoord?1:0,t=this._gltf.textures[e.occlusionTexture.index],i=e.occlusionTexture.extensions&&e.occlusionTexture.extensions.KHR_texture_transform?e.occlusionTexture.extensions.KHR_texture_transform:void 0,c.appendChild(this._generateX3DImageTexture(t,"occlusionTexture",l,i))),e.extensions&&e.extensions.KHR_materials_unlit&&c.setAttribute("unlit",!0),c.setAttribute("emissiveFactor",o.join(" ")),c.setAttribute("alphaMode",s),c.setAttribute("alphaCutoff",n),c.setAttribute("model",a)),c},x3dom.glTF2Loader.prototype._generateX3DImageTexture=function(e,t,i,o){var s=this._gltf.images[e.source],n=document.createElement("imagetexture");return this._generateX3DMetadata(e,n),n.setAttribute("origChannelCount","2"),n.setAttribute("flipY","true"),t&&n.setAttribute("containerField",t),null!=s.uri&&n.setAttribute("url",x3dom.Utils.dataURIToObjectURL(s.uri)),null!=e.sampler&&(t=this._gltf.samplers[e.sampler],n.appendChild(this._createX3DTextureProperties(t))),i&&n.setAttribute("channel","1"),o&&(this._textureTransform=this._createX3DTextureTransform(n,o)),n},x3dom.glTF2Loader.prototype._createX3DTextureProperties=function(e){var t=document.createElement("textureproperties");return t.setAttribute("boundaryModeS",x3dom.Utils.boundaryModesDicX3D(e.wrapS)),t.setAttribute("boundaryModeT",x3dom.Utils.boundaryModesDicX3D(e.wrapT)),t.setAttribute("magnificationFilter",x3dom.Utils.magFilterDicX3D(e.magFilter)),t.setAttribute("minificationFilter",x3dom.Utils.minFilterDicX3D(e.minFilter)),(null==e.minFilter||9984<=e.minFilter&&e.minFilter<=9987)&&t.setAttribute("generateMipMaps","true"),t},x3dom.glTF2Loader.prototype._createX3DTextureTransform=function(e,t){var i=document.createElement("matrixtexturetransform"),o=t.offset||[0,0],s=t.rotation||0,n=t.scale||[1,1],r=new x3dom.fields.SFVec3f(-0,-0,0),a=new x3dom.fields.SFVec3f(0,0,0),o=new x3dom.fields.SFVec3f(o[0],o[1],0),n=new x3dom.fields.SFVec3f(n[0],n[1],0),a=x3dom.fields.SFMatrix4f.translation(a.add(o)).mult(x3dom.fields.SFMatrix4f.rotationZ(-1*s)).mult(x3dom.fields.SFMatrix4f.scale(n)).mult(x3dom.fields.SFMatrix4f.translation(r));return i.setAttribute("matrix",a.toString()),t.texCoord&&e.setAttribute("channel",texCoord),i},x3dom.glTF2Loader.prototype._generateX3DBufferGeometry=function(e,t){var i,o,s,n,r=[],a=document.createElement("buffergeometry"),d=this._getCenterAndSize(e),l=t?x3dom.Utils.dataURIToObjectURL(this._gltf.buffers[this._gltf.bufferViews[t.bufferView].buffer].uri):this._bufferURI(e);for(n in a.setAttribute("buffer",l),a.setAttribute("position",d.center.join(" ")),a.setAttribute("size",d.size.join(" ")),a.setAttribute("vertexCount",this._getVertexCount(e)),a.setAttribute("primType",this._primitiveType(e.mode)),a.setAttribute("draco",null!==t),null!=e.material&&this._gltf.materials[e.material].doubleSided&&a.setAttribute("solid","false"),null!=e.indices&&(s=this._gltf.accessors[e.indices],t?((i=Object.assign({},this._gltf.bufferViews[t.bufferView])).idx=t.bufferView,i.target=34963,o=r.push(i)-1):((i=Object.assign({},this._gltf.bufferViews[s.bufferView])).idx=s.bufferView,i.target=34963,o=r.indexOf(i),null!=i.target&&-1==o&&(o=r.push(i)-1)),a.appendChild(this._generateX3DBufferAccessor("INDEX",s,o))),(t||e).attributes)s=this._gltf.accessors[e.attributes[n]],t?((i=Object.assign({},this._gltf.bufferViews[t.bufferView])).target=34962,i.idx=t.bufferView,i.dracoUniqueId=t.attributes[n],o=r.push(i)-1):((i=Object.assign({},this._gltf.bufferViews[s.bufferView])).target=34962,i.idx=s.bufferView,o=r.indexOf(i),null!=i.target&&-1==o&&(o=r.push(i)-1)),a.appendChild(this._generateX3DBufferAccessor(n,s,o));for(var h=0;h<r.length;h++)a.appendChild(this._generateX3DBufferView(r[h]));return a},x3dom.glTF2Loader.prototype._generateX3DBufferView=function(e){var t=document.createElement("bufferview");return t.setAttribute("target",e.target),t.setAttribute("byteOffset",e.byteOffset||0),t.setAttribute("byteLength",e.byteLength),t.setAttribute("idx",e.idx),t.setAttribute("dracoId",void 0!==e.dracoUniqueId?e.dracoUniqueId:-1),t},x3dom.glTF2Loader.prototype._generateX3DBufferAccessor=function(e,t,i){var o=this._componentsOf(t.type),s="bufferView"in t?this._gltf.bufferViews[t.bufferView]:{},s="byteStride"in s?s.byteStride:0,n="byteOffset"in t?t.byteOffset:0,r=document.createElement("bufferaccessor");return r.setAttribute("bufferType",e.replace("_0","")),r.setAttribute("view",i),r.setAttribute("byteOffset",n),r.setAttribute("byteStride",s),r.setAttribute("normalized",t.normalized||!1),r.setAttribute("components",o),r.setAttribute("componentType",t.componentType),r.setAttribute("count",t.count),r},x3dom.glTF2Loader.prototype._generateX3DAnimationNodes=function(e,t,i){var o=this._animationDuration(t),s=i+"_TIMESENSOR";e.appendChild(this._generateX3DTimeSensor(s,o));for(var n=0;n<t.channels.length;n++){var r=t.channels[n],a=r.target.path,d=r.target.node,r=t.samplers[r.sampler],d="glTF_NODE_"+this._gltf.nodes[d].name,l=i+"_INTERPOLATOR_"+n;e.appendChild(this._generateX3DInterpolator(l,a,r,o)),e.appendChild(this._createX3DRoute("fraction_changed",s,"set_fraction",l)),e.appendChild(this._createX3DRoute("value_changed",l,"set_"+a,d))}},x3dom.glTF2Loader.prototype._generateX3DTimeSensor=function(e,t){var i=document.createElement("TimeSensor");return i.setAttribute("loop","true"),i.setAttribute("cycleInterval",t),i.setAttribute("DEF",e),i},x3dom.glTF2Loader.prototype._generateX3DInterpolator=function(e,t,i,o){var s,n=i.interpolation||"LINEAR",r=this._gltf.accessors[i.input],a=this._gltf.accessors[i.output],d=this._gltf.bufferViews[r.bufferView],l=this._gltf.bufferViews[a.bufferView];switch(t){case"scale":case"translation":s=document.createElement("PositionInterpolator");break;case"rotation":s=document.createElement("OrientationInterpolator");break;case"weights":s=document.createElement("ScalarInterpolator")}return s.setAttribute("DEF",e),s.setAttribute("buffer",this._bufferURI(i)),s.setAttribute("interpolation",n),s.setAttribute("duration",o),s.appendChild(this._generateX3DBufferAccessor("SAMPLER_INPUT",r,0)),s.appendChild(this._generateX3DBufferAccessor("SAMPLER_OUTPUT",a,1)),s.appendChild(this._generateX3DBufferView(d)),s.appendChild(this._generateX3DBufferView(l)),s},x3dom.glTF2Loader.prototype._createX3DRoute=function(e,t,i,o){var s=document.createElement("ROUTE");return s.setAttribute("fromField",e),s.setAttribute("fromNode",t),s.setAttribute("toField",i),s.setAttribute("toNode",o),s},x3dom.glTF2Loader.prototype._getCenterAndSize=function(e){var t=[1,1,1],i=[0,0,0];return null!=e.attributes.POSITION&&(e=this._gltf.accessors[e.attributes.POSITION],t[0]=e.max[0]-e.min[0],t[1]=e.max[1]-e.min[1],t[2]=e.max[2]-e.min[2],i[0]=e.min[0]+.5*t[0],i[1]=e.min[1]+.5*t[1],i[2]=e.min[2]+.5*t[2]),{center:i,size:t}},x3dom.glTF2Loader.prototype._getVertexCount=function(e){var t=0;return null!=e.indices?t=this._gltf.accessors[e.indices].count:null!=e.attributes.POSITION&&(t=this._gltf.accessors[e.attributes.POSITION].count),t},x3dom.glTF2Loader.prototype._sizeInBytes=function(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5125:case 5126:return 4}},x3dom.glTF2Loader.prototype._componentsOf=function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}},x3dom.glTF2Loader.prototype._bufferURI=function(e){var t,i="";return null!=e.attributes&&null!=e.attributes.POSITION?t=e.attributes.POSITION:e.input&&(t=e.input),null!=t&&(e=this._gltf.accessors[t],t=this._gltf.bufferViews[e.bufferView],e=this._gltf.buffers[t.buffer],i=x3dom.Utils.dataURIToObjectURL(e.uri)),i},x3dom.glTF2Loader.prototype._USEorDEF=function(e,t){return null!=this._definitions[t]?(e.setAttribute("USE",t),!0):(e.setAttribute("DEF",t),this._definitions[t]=t,!1)},x3dom.glTF2Loader.prototype._primitiveType=function(e){switch(e){case 0:return"POINTS";case 1:return"LINES";case 2:return"LINE_LOOP";case 3:return"LINE_STRIP";case 4:return"TRIANGLES";case 5:return"TRIANGLE_STRIP";case 6:return"TRIANGLE_FAN";default:return"TRIANGLES"}},x3dom.glTF2Loader.prototype._isDefaultSampler=function(e){return 10497==e.wrapS&&10497==e.wrapT&&9729==e.magFilter&&9729==e.minFilter},x3dom.glTF2Loader.prototype._toAxisAngle=function(e){var t=[],e=(e=new x3dom.fields.Quaternion(e[0],e[1],e[2],e[3])).toAxisAngle();return t[0]=e[0].x,t[1]=e[0].y,t[2]=e[0].z,t[3]=e[1],t},x3dom.glTF2Loader.prototype._getGLTF=function(e,t){if(!t)return"string"==typeof e?JSON.parse(e):e;var t=0,i=new Uint32Array(e,0,3);if(1179937895==i[0]||2==i[1]){t+=12;i=new Uint32Array(e,12,2);if(1313821514==i[1]){t+=8;var o=new Uint8Array(e,20,i[0]),i=(t+=i[0],new Uint32Array(e,t,2));if(5130562==i[1])return t+=8,i=new Uint8Array(e,t,i[0]),(o=x3dom.Utils.arrayBufferToJSON(o)).buffers[0].uri=x3dom.Utils.arrayBufferToObjectURL(i,"application/octet-stream"),this._convertBinaryImages(o,e,t),o}}},x3dom.glTF2Loader.prototype._convertBinaryImages=function(e,t,i){if(null!=e.images)for(var o=0;o<e.images.length;o++){var s,n=e.images[o];null!=n.bufferView&&((s=e.bufferViews[n.bufferView]).byteOffset=s.byteOffset||0,s=new Uint8Array(t,i+s.byteOffset,s.byteLength),n.uri=x3dom.Utils.arrayBufferToObjectURL(s,n.mimeType))}},x3dom.glTF2Loader.prototype._animationDuration=function(e){for(var t=-1,i=0;i<e.channels.length;i++)var o=e.channels[i],o=e.samplers[o.sampler],o=this._gltf.accessors[o.input],t=Math.max(o.max[0],t);return t},x3dom.DDSLoader={},x3dom.DDSLoader.load=function(e){return new Promise(function(t,i){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){var e=x3dom.DDSLoader._read(o.response);(e?t:i)(e)},o.onerror=function(){i()},x3dom.RequestManager.addRequest(o)})},x3dom.DDSLoader._read=function(e){if(!(void 0===e||e.byteLength<148)){var t={isCompressed:!1,isVolume:!1,isCubeMap:!1,targets:[],data:[]},i=new Uint32Array(e,0,32);if(t.header=x3dom.DDSLoader._readHeader(i),i=new Uint32Array(e,128,5),t.header10=x3dom.DDSLoader._readHeader10(t,i),542327876==t.header.dwMagic&&124==t.header.dwSize&&x3dom.DDSLoader._readFormat(t))return x3dom.DDSLoader._readMipmapCount(t),x3dom.DDSLoader._readType(t),this._readData(t,e),t}},x3dom.DDSLoader._readHeader=function(e){return{dwMagic:e[0],dwSize:e[1],dwFlags:x3dom.DDSLoader._readDDSFlags(e[2]),dwHeight:e[3],dwWidth:e[4],dwPitchOrLinearSize:e[5],dwDepth:e[6],dwMipMapCount:e[7],dwReserved1:"UNUSED",ddspf:{dwSize:e[19],dwFlags:x3dom.DDSLoader._readPFFlags(e[20]),dwFourCC:x3dom.DDSLoader.int32ToFourCC(e[21]),dwRGBBitCount:e[22],dwRBitMask:e[23],dwGBitMask:e[24],dwBBitMask:e[25],dwABitMask:e[26]},dwCaps:x3dom.DDSLoader._readCapsFlags(e[27]),dwCaps2:x3dom.DDSLoader._readCaps2Flags(e[28]),dwCaps3:"UNUSED",dwCaps4:"UNUSED",dwReserved2:"UNUSED"}},x3dom.DDSLoader._readHeader10=function(e,t){return"DX10"!=e.header.ddspf.dwFourCC?null:{dxgiFormat:t[0],resourceDimension:x3dom.DDSLoader._readResourceDimension(t[1]),miscFlags:x3dom.DDSLoader._readMiscFlags(t[2]),arraySize:t[3],miscFlags2:x3dom.DDSLoader._readMiscFlags2(t[4])}},x3dom.DDSLoader._readMipmapCount=function(e){e.numberOfMipmaps=e.header.dwFlags.DDSD_MIPMAPCOUNT?e.header.dwMipMapCount:1},x3dom.DDSLoader._readType=function(e){e.header.dwFlags.DDSD_DEPTH&&e.header.dwCaps2.DDSCAPS2_VOLUME?(e.type=32879,e.numberOfImages=e.header.dwCaps.DDSD_DEPTH):(e.header.dwCaps2.DDSCAPS2_CUBEMAP?(e.type=34067,e.header.dwCaps2.DDSCAPS2_CUBEMAP_POSITIVEX&&e.targets.push(34069),e.header.dwCaps2.DDSCAPS2_CUBEMAP_NEGATIVEX&&e.targets.push(34070),e.header.dwCaps2.DDSCAPS2_CUBEMAP_POSITIVEY&&e.targets.push(34071),e.header.dwCaps2.DDSCAPS2_CUBEMAP_NEGATIVEY&&e.targets.push(34072),e.header.dwCaps2.DDSCAPS2_CUBEMAP_POSITIVEZ&&e.targets.push(34073),e.header.dwCaps2.DDSCAPS2_CUBEMAP_NEGATIVEZ&&e.targets.push(34074)):(e.type=3553,e.targets.push(3553)),e.numberOfImages=e.targets.length)},x3dom.DDSLoader._readDDSFlags=function(e){return{DDSD_CAPS:!!(1&e),DDSD_HEIGHT:!!(2&e),DDSD_WIDTH:!!(4&e),DDSD_PITCH:!!(8&e),DDSD_PIXELFORMAT:!!(4096&e),DDSD_MIPMAPCOUNT:!!(131072&e),DDSD_LINEARSIZE:!!(524288&e),DDSD_DEPTH:!!(8388608&e)}},x3dom.DDSLoader._readPFFlags=function(e){return{DDPF_ALPHAPIXELS:!!(1&e),DDPF_ALPHA:!!(2&e),DDPF_FOURCC:!!(4&e),DDPF_RGB:!!(64&e),DDPF_YUV:!!(512&e),DDPF_LUMINANCE:!!(131072&e)}},x3dom.DDSLoader._readCapsFlags=function(e){return{DDSCAPS_COMPLEX:!!(8&e),DDSCAPS_MIPMAP:!!(4194304&e),DDSCAPS_TEXTURE:!!(4096&e)}},x3dom.DDSLoader._readCaps2Flags=function(e){return{DDSCAPS2_CUBEMAP:!!(512&e),DDSCAPS2_CUBEMAP_POSITIVEX:!!(1024&e),DDSCAPS2_CUBEMAP_NEGATIVEX:!!(2048&e),DDSCAPS2_CUBEMAP_POSITIVEY:!!(4096&e),DDSCAPS2_CUBEMAP_NEGATIVEY:!!(8192&e),DDSCAPS2_CUBEMAP_POSITIVEZ:!!(16384&e),DDSCAPS2_CUBEMAP_NEGATIVEZ:!!(32768&e),DDSCAPS2_VOLUME:!!(131072&e)}},x3dom.DDSLoader._readResourceDimension=function(e){switch(e){case 0:return"D3D10_RESOURCE_DIMENSION_UNKNOWN";case 1:return"D3D10_RESOURCE_DIMENSION_BUFFER";case 2:return"D3D10_RESOURCE_DIMENSION_TEXTURE1D";case 3:return"D3D10_RESOURCE_DIMENSION_TEXTURE2D";case 4:return"D3D10_RESOURCE_DIMENSION_TEXTURE3D"}},x3dom.DDSLoader._readMiscFlags=function(e){return{D3D11_RESOURCE_MISC_GENERATE_MIPS:!!(1&e),D3D11_RESOURCE_MISC_SHARED:!!(2&e),D3D11_RESOURCE_MISC_TEXTURECUBE:!!(4&e),D3D11_RESOURCE_MISC_DRAWINDIRECT_ARGS:!!(16&e),D3D11_RESOURCE_MISC_BUFFER_ALLOW_RAW_VIEWS:!!(32&e),D3D11_RESOURCE_MISC_BUFFER_STRUCTURED:!!(64&e),D3D11_RESOURCE_MISC_RESOURCE_CLAMP:!!(128&e),D3D11_RESOURCE_MISC_SHARED_KEYEDMUTEX:!!(256&e),D3D11_RESOURCE_MISC_GDI_COMPATIBLE:!!(512&e),D3D11_RESOURCE_MISC_SHARED_NTHANDLE:!!(2048&e),D3D11_RESOURCE_MISC_RESTRICTED_CONTENT:!!(4096&e),D3D11_RESOURCE_MISC_RESTRICT_SHARED_RESOURCE:!!(8192&e),D3D11_RESOURCE_MISC_RESTRICT_SHARED_RESOURCE_DRIVER:!!(16384&e),D3D11_RESOURCE_MISC_GUARDED:!!(32768&e),D3D11_RESOURCE_MISC_TILE_POOL:!!(131072&e),D3D11_RESOURCE_MISC_TILED:!!(262144&e),D3D11_RESOURCE_MISC_HW_PROTECTED:!!(524288&e)}},x3dom.DDSLoader._readMiscFlags2=function(e){var t={};switch(e){case 0:case 1:case 2:case 3:case 4:t.alphaMode="DDS_ALPHA_MODE_UNKNOWN"}return t},x3dom.DDSLoader._readData=function(e,t,i,o){var s,n,r,a=e.header10?148:128;e.width=e.header.dwWidth,e.height=e.header.dwHeight,e.generateMipmaps=e.numberOfMipmaps<=1&&!e.isCompressed;for(var d=0;d<e.numberOfImages;d++){n=e.header.dwWidth,r=e.header.dwHeight,e.data[e.targets[d]]=[];for(var l=0;l<e.numberOfMipmaps;l++)0!=l&&(n=Math.max(.5*n,1),r=Math.max(.5*r,1)),s=e.isCompressed?this._readCompressedData(t,n,r,a,e.blockSize):this._readUncompressedData(t,n,r,a,e.format),a+=(e.data[e.targets[d]][l]=s).length*s.BYTES_PER_ELEMENT*e.format.bytesPerElementFactor}return e.format.overwriteType&&(e.format.type=e.format.overwriteType),e.format.overwriteInternalType&&(e.format.internal=e.format.overwriteInternalType),e},x3dom.DDSLoader._readCompressedData=function(e,t,i,o,s){t=Math.max(1,parseInt((t+3)/4))*Math.max(1,parseInt((i+3)/4))*s;return new Uint8Array(e.slice(o,o+t))},x3dom.DDSLoader._readUncompressedData=function(e,t,i,o,s,n){if(s.bytesPerElementFactor=1,6406==s.internal)return new Uint8Array(e.slice(o,o+t*i));if(6409==s.internal)return new Uint8Array(e.slice(o,o+t*i));if(6410==s.internal)return new Uint8Array(e.slice(o,o+t*i*2));if(6407==s.internal)return x3dom.DDSLoader.R8G8B8_To_B8G8R8(new Uint8Array(e.slice(o,o+t*i*3)));if(36194==s.internal)return new Uint16Array(e.slice(o,o+t*i*2));if(6408==s.internal&&36193!=s.type&&5126!=s.type)return x3dom.DDSLoader.A8R8G8B8_To_A8B8G8R8(new Uint8Array(e.slice(o,o+t*i*4)));if(32854==s.internal)return x3dom.DDSLoader.A4R4G4B4_To_A4B4G4R4(new Uint16Array(e.slice(o,o+t*i*2)));if(32855==s.internal)return x3dom.DDSLoader.A1R5G5B5_To_A1B5G5R5(new Uint16Array(e.slice(o,o+t*i*2)));if(34842==s.internal||36193==s.type)return x3dom.caps.HFP_TEXTURES||2==x3dom.caps.WEBGL_VERSION?new Uint16Array(e.slice(o,o+t*i*4*2)):x3dom.caps.FP_TEXTURES?(s.overwriteType=5126,s.overwriteInternalType=2==x3dom.caps.WEBGL_VERSION?34836:6408,s.bytesPerElementFactor=.5,x3dom.DDSLoader.UI16_To_F32(new Uint16Array(e.slice(o,o+t*i*4*2)))):(s.overwriteType=5121,s.overwriteInternalType=6408,s.bytesPerElementFactor=2,x3dom.DDSLoader.UI16_To_UI8(new Uint16Array(e.slice(o,o+t*i*4*2))));if(34836==s.internal||5126==s.type){if(x3dom.caps.FP_TEXTURES||2==x3dom.caps.WEBGL_VERSION)return new Float32Array(e.slice(o,o+t*i*4*4))}else if(35898==s.internal)return new Uint8Array(e.slice(o,o+t*i*3))},x3dom.DDSLoader._readFormat=function(e){var t=e.header.ddspf;if(t.dwFlags.DDPF_FOURCC)if("DXT1"==t.dwFourCC)e.channelCount=3,e.blockSize=8,e.isCompressed=!0,e.format={internal:33776,format:6407,type:5121};else if("DXT3"==t.dwFourCC)e.channelCount=3,e.blockSize=16,e.isCompressed=!0,e.format={internal:33778,format:6408,type:5121};else if("DXT5"==t.dwFourCC)e.channelCount=4,e.blockSize=16,e.isCompressed=!0,e.format={internal:33779,format:6408,type:5121};else if("t"==t.dwFourCC)e.channelCount=4,2==x3dom.caps.WEBGL_VERSION?e.format={internal:34836,format:6408,type:5126}:e.format={internal:6408,format:6408,type:5126};else{if("q"!=t.dwFourCC&&"$"!=t.dwFourCC)return!1;e.channelCount=4,2==x3dom.caps.WEBGL_VERSION?e.format={internal:34842,format:6408,type:5131}:e.format={internal:6408,format:6408,type:36193}}else if(t.dwFlags.DDPF_RGB&&!t.dwFlags.DDPF_ALPHAPIXELS)if(e.channelCount=3,24==t.dwRGBBitCount&&16711680==t.dwRBitMask&&65280==t.dwGBitMask&&255==t.dwBBitMask)e.format={internal:6407,format:6407,type:5121};else{if(16!=t.dwRGBBitCount||63488!=t.dwRBitMask||2016!=t.dwGBitMask||31!=t.dwBBitMask)return!1;e.format={internal:36194,format:6407,type:33635}}else if(t.dwFlags.DDPF_RGB&&t.dwFlags.DDPF_ALPHAPIXELS)if(e.channelCount=4,32==t.dwRGBBitCount&&16711680==t.dwRBitMask&&65280==t.dwGBitMask&&255==t.dwBBitMask&&4278190080==t.dwABitMask)e.format={internal:6408,format:6408,type:5121};else if(16==t.dwRGBBitCount&&3840==t.dwRBitMask&&240==t.dwGBitMask&&15==t.dwBBitMask&&61440==t.dwABitMask)e.format={internal:32854,format:6408,type:32819};else{if(16!=t.dwRGBBitCount||31744!=t.dwRBitMask||992!=t.dwGBitMask||31!=t.dwBBitMask||32768!=t.dwABitMask)return!1;e.format={internal:32855,format:6408,type:32820}}else if(t.dwFlags.DDPF_LUMINANCE&&!t.dwFlags.DDPF_ALPHAPIXELS){if(8!=t.dwRGBBitCount||255!=t.dwRBitMask)return!1;e.format={internal:6409,format:6409,type:5121},e.channelCount=1}else if(t.dwFlags.DDPF_LUMINANCE&&t.dwFlags.DDPF_ALPHAPIXELS){if(16!=t.dwRGBBitCount||255!=t.dwRBitMask||65280!=t.dwABitMask)return!1;e.format={internal:6410,format:6410,type:5121},e.channelCount=2}else{if(!t.dwFlags.DDPF_ALPHA)return!1;if(8!=t.dwRGBBitCount||255!=t.dwABitMask)return!1;e.format={internal:6406,format:6406,type:5121},e.channelCount=1}return!0},x3dom.DDSLoader.int32ToFourCC=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255).replace(/[\x00]/g,"")},x3dom.DDSLoader.R8G8B8_To_B8G8R8=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i+=3)t[i]=e[i+1],t[i+1]=e[i+0],t[i+2]=e[i+2];return t},x3dom.DDSLoader.A8R8G8B8_To_A8B8G8R8=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i+=4)t[i]=e[i+2],t[i+1]=e[i+1],t[i+2]=e[i+0],t[i+3]=e[i+3];return t},x3dom.DDSLoader.UI16_To_UI8=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i+=4)t[i]=255*x3dom.DDSLoader.UI16_To_UI8_2(e[i]),t[i+1]=255*x3dom.DDSLoader.UI16_To_UI8_2(e[i+1]),t[i+2]=255*x3dom.DDSLoader.UI16_To_UI8_2(e[i+2]),t[i+3]=255*x3dom.DDSLoader.UI16_To_UI8_2(e[i+3]);return t},x3dom.DDSLoader.UI16_To_F32=function(e){for(var t=new Float32Array(e.length),i=0;i<e.length;i+=4)t[i]=x3dom.DDSLoader.UI16_To_F16(e[i]),t[i+1]=x3dom.DDSLoader.UI16_To_F16(e[i+1]),t[i+2]=x3dom.DDSLoader.UI16_To_F16(e[i+2]),t[i+3]=x3dom.DDSLoader.UI16_To_F16(e[i+3]);return t},x3dom.DDSLoader.UI16_To_F16=function(e){var t=e>>15&1,i=e>>10&1023,e=e&Math.pow(2,10)-1;return 0!=i?Math.pow(-1,t)*(1+e/Math.pow(2,10))*Math.pow(2,i-15):0==e?0:Math.pow(-1,t)*e/Math.pow(2,10)*Math.pow(2,-14)},x3dom.DDSLoader.UI16_To_UI8_2=function(e){e=x3dom.DDSLoader.UI16_To_F16(e);return e/(e+1)},x3dom.DDSLoader.A4R4G4B4_To_A4B4G4R4=function(e){for(var t=new Uint16Array(e.length),i=0;i<e.length;i++)t[i]=(e[i]>>8&15)<<12&(e[i]>>4&15)<<8&(15&e[i])<<4&(e[i]>>12&15);return t},x3dom.DDSLoader.A1R5G5B5_To_A1B5G5R5=function(e){for(var t=new Uint16Array(e.length),i=0;i<e.length;i++)t[i]=(e[i]>>10&31)<<11&(e[i]>>5&95)<<6&(95&e[i])<<1&(e[i]>>15&1);return t},x3dom.VRControllerManager=function(e){this.leftInline=void 0,this.leftTransform=void 0,this.rightInline=void 0,this.rightTransform=void 0,this.wasPresenting=!1,this.modelsAdded=!1,this._doc=e,this._controllers={"htc-vive":{left:"https://x3dom.org/download/assets/vr/vive.glb",right:"https://x3dom.org/download/assets/vr/vive.glb",scaleFactor:new x3dom.fields.SFVec3f(40,40,40),offset:new x3dom.fields.SFVec3f,axesScale:[1,1]},"oculus-touch":{left:"https://x3dom.org/download/assets/vr/oculus-touch-left.glb",right:"https://x3dom.org/download/assets/vr/oculus-touch-right.glb",scaleFactor:new x3dom.fields.SFVec3f(39.5,39.5,39.5),offset:new x3dom.fields.SFVec3f,axesScale:[1,1]},"oculus-go":{left:"https://x3dom.org/download/assets/vr/oculus-go.glb",right:"https://x3dom.org/download/assets/vr/oculus-go.glb",scaleFactor:new x3dom.fields.SFVec3f(1,1,1),offset:new x3dom.fields.SFVec3f(.2,-.3,-.3),axesScale:[-1,1]}},this._addInlines()},x3dom.VRControllerManager.prototype._addInlines=function(){var e=document.querySelector("scene")||document.querySelector("Scene");e&&(this.leftTransform=document.createElement("matrixtransform"),this.leftInline=document.createElement("inline"),this.rightTransform=document.createElement("matrixtransform"),this.rightInline=document.createElement("inline"),this.leftInline.setAttribute("render","false"),this.rightInline.setAttribute("render","false"),this.leftTransform.appendChild(this.leftInline),this.rightTransform.appendChild(this.rightInline),e.appendChild(this.leftTransform),e.appendChild(this.rightTransform))},x3dom.VRControllerManager.prototype._addControllerModels=function(e){var t;this.modelsAdded||(e.left&&(t=this._getControllerModelURL(e.left.type,"left"),this.leftInline.setAttribute("url",t)),e.right&&(t=this._getControllerModelURL(e.right.type,"right"),this.rightInline.setAttribute("url",t)),this.modelsAdded=!0)},x3dom.VRControllerManager.prototype._getControllerAxesScale=function(e){return void 0===this._controllers[e]?[1,1]:this._controllers[e].axesScale},x3dom.VRControllerManager.prototype._getControllerDirection=function(e){return(e.orientation?x3dom.fields.Quaternion.fromArray(e.orientation):new x3dom.fields.Quaternion).toMatrix().e2()},x3dom.VRControllerManager.prototype._getControllerModelURL=function(e,t){return void 0===this._controllers[e]?"":this._controllers[e][t]},x3dom.VRControllerManager.prototype._getControllerOffset=function(e){return void 0===this._controllers[e]?[0,0,0]:this._controllers[e].offset},x3dom.VRControllerManager.prototype._getControllerScaleFactor=function(e){return void 0===this._controllers[e]?[1,1,1]:this._controllers[e].scaleFactor},x3dom.VRControllerManager.prototype.fit=function(e){var t=e._scene._lastMin,t=e._scene._lastMax.subtract(t).multiply(.5).length(),i=e.vrLeftViewMatrix.e2(),o=Math.min(e._width/e._height,1),t=t/Math.tan(.5*Math.PI/2)/o;e._movement=i.multiply(-.001*t)},x3dom.VRControllerManager.prototype.update=function(e,t){t?(this.wasPresenting||(this.leftInline.setAttribute("render","true"),this.rightInline.setAttribute("render","true"),this.fit(e),this.wasPresenting=!0),this._addControllerModels(t.controllers),this._updateMatrices(e,t.controllers),this._updateControllerModels(e,t.controllers)):this.wasPresenting&&(this.leftInline.setAttribute("render","false"),this.rightInline.setAttribute("render","false"),this.wasPresenting=!1)},x3dom.VRControllerManager.prototype._updateMatrices=function(o,s){var e=new x3dom.fields.SFMatrix4f,t=new x3dom.fields.SFMatrix4f,i=[0,0];if(s.left){var n=this._getControllerAxesScale(s.left.type);if(i[0]+=s.left.gamepad.axes[0]*n[0],i[1]+=s.left.gamepad.axes[1]*n[1],s.left.gamepad.buttons[0].pressed){let e=s.left.pose,t=this._getControllerDirection(e),i=this._getViewAreaZoom(o);o._movement=o._movement.add(t.multiply(i))}}if(s.right&&(n=this._getControllerAxesScale(s.right.type),i[0]+=s.right.gamepad.axes[0]*n[0],i[1]+=s.right.gamepad.axes[1]*n[1],s.right.gamepad.buttons[0].pressed)){let e=s.right.pose,t=this._getControllerDirection(e),i=this._getViewAreaZoom(o);o._movement=o._movement.add(t.multiply(i))}var n=5*i[0],s=5*i[1],i=o.vrLeftViewMatrix.e2(),r=o.vrLeftViewMatrix.e0(),a=(a=o._scene._lastMax.subtract(o._scene._lastMin).length())<x3dom.fields.Eps?1:a,i=new x3dom.fields.SFVec3f(-i.x,-i.y,i.z).multiply(a*(s/o._height)),r=new x3dom.fields.SFVec3f(-r.x,-r.y,r.z).multiply(a*(n/o._width));o._movement=o._movement.add(r).add(i),e=x3dom.fields.SFMatrix4f.translation(o._movement),o.vrLeftViewMatrix=o.vrLeftViewMatrix.mult(e).mult(t),o.vrRightViewMatrix=o.vrRightViewMatrix.mult(e).mult(t)},x3dom.VRControllerManager.prototype._updateControllerModels=function(e,t){var i,o,s,n,r,a;t.left&&(i=t.left.pose,o=this._getControllerOffset(t.left.type),s=i.orientation?x3dom.fields.Quaternion.fromArray(i.orientation):new x3dom.fields.Quaternion,r=i.position?x3dom.fields.SFVec3f.fromArray(i.position):o,n=this._getControllerScaleFactor(t.left.type),r=r.subtract(e._movement),a=x3dom.fields.SFMatrix4f.fromRotationTranslationScale(s,r,n),this.leftTransform.setAttribute("matrix",a.toString())),t.right&&(i=t.right.pose,o=this._getControllerOffset(t.right.type),s=i.orientation?x3dom.fields.Quaternion.fromArray(i.orientation):new x3dom.fields.Quaternion,r=i.position?x3dom.fields.SFVec3f.fromArray(i.position):o,n=this._getControllerScaleFactor(t.right.type),r=r.subtract(e._movement),a=x3dom.fields.SFMatrix4f.fromRotationTranslationScale(s,r,n),this.rightTransform.setAttribute("matrix",a.toString()))},x3dom.VRControllerManager.prototype._getViewAreaZoom=function(e){var t=e._scene.getNavigationInfo(),i=e._scene.getViewpoint(),o=e._scene._lastMax.subtract(e._scene._lastMin).length();return((o=Math.min(o,i.getFar()))<x3dom.fields.Eps?1:o)*t._vf.speed*(60/this._doc._x3dElem.runtime.getFPS())/e._height},x3dom.JSONParser=function(e){this.x3djsonNS="http://www.web3d.org/specifications/x3d-namespace"},x3dom.JSONParser.prototype.constructor=x3dom.JSONParser,x3dom.JSONParser.prototype.parseJavaScript=function(e){var t=this.CreateElement("X3D");return this.ConvertToX3DOM(e,"",t),t},x3dom.JSONParser.prototype.elementSetAttribute=function(e,t,i){"SON schema"!==t&&"ncoding"!==t&&"function"==typeof e.setAttribute&&e.setAttribute(t,i)},x3dom.JSONParser.prototype.ConvertChildren=function(e,t,i){for(var o in t)"object"==typeof t[o]&&(isNaN(parseInt(o))?this.ConvertObject(o,t,i,e.substr(1)):this.ConvertToX3DOM(t[o],o,i,e.substr(1)))},x3dom.JSONParser.prototype.CreateElement=function(e,t){var i=null;return void 0===this.x3djsonNS?i=document.createElement(e):null==(i=document.createElementNS(this.x3djsonNS,e))&&(console.error("Trouble creating element for",e),i=document.createElement(e)),void 0!==t&&this.elementSetAttribute(i,"containerField",t),i},x3dom.JSONParser.prototype.CDATACreateFunction=function(e,t,i){for(var o=i.trim().replace(/\\"/g,'\\"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");(o=(i=o).replace(/'([^'\r\n]*)\n([^']*)'/g,"'$1\\n$2'"))!=i;);var s="<script> <![CDATA[ "+o+" ]]> <\/script>",s=(new DOMParser).parseFromString(s,"application/xml").children[0].childNodes[1];t.appendChild(s)},x3dom.JSONParser.prototype.ConvertObject=function(e,t,i,o){var s;if(null!==t&&"object"==typeof t[e])if(e.startsWith("@"))this.ConvertToX3DOM(t[e],e,i);else if(e.startsWith("-"))this.ConvertChildren(e,t[e],i);else if("#comment"===e)for(var n in t[e])s=document.createComment(this.CommentStringToXML(t[e][n])),i.appendChild(s);else if("#sourceText"===e||"#sourceCode"===e)this.CDATACreateFunction(document,i,t[e].join("\r\n")+"\r\n");else if("connect"===e||"fieldValue"===e||"field"===e||"meta"===e||"component"===e)for(var r in t[e])"object"==typeof t[e][r]&&(s=this.CreateElement(e,o),this.ConvertToX3DOM(t[e][r],r,s),i.appendChild(s),i.appendChild(document.createTextNode("\n")));else s=this.CreateElement(e,o),this.ConvertToX3DOM(t[e],e,s),i.appendChild(s),i.appendChild(document.createTextNode("\n"))},x3dom.JSONParser.prototype.CommentStringToXML=function(e){return e.replace(/\\\\/g,"\\")},x3dom.JSONParser.prototype.SFStringToXML=function(e){return(e=e.replace(/\\/g,"\\\\")).replace(/"/g,'\\"')},x3dom.JSONParser.prototype.JSONStringToXML=function(e){return(e=e.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")},x3dom.JSONParser.prototype.ConvertToX3DOM=function(e,t,i,o){var s,n,r=[],a=!1,d=!1;for(s in e)if(a=!isNaN(parseInt(s)))"number"==typeof e[s]?r.push(e[s]):"string"==typeof e[s]?(r.push(e[s]),d=!0):"boolean"==typeof e[s]?r.push(e[s]):"object"==typeof e[s]?this.ConvertToX3DOM(e[s],s,i):void 0!==e[s]&&console.error("Unknown type found in array "+typeof e[s]);else if("object"==typeof e[s])if("X3D"===s)this.ConvertToX3DOM(e[s],s,i);else if("-skin"===s||"-skeleton"===s||"-value"===s){var l,h=e[s][0];for(l in h)h[l]["@containerField"]=s.substr(1),console.log(h[l]),this.ConvertObject(s,e,i,h[l]["@containerField"])}else 0===s.indexOf("HAnim")&&"HAnimHumanoid"!==s&&void 0!==e[s]["@USE"]?(e[s]["@containerField"]=s.substr(5).toLowerCase()+"s",this.ConvertObject(s,e,i,e[s]["@containerField"])):this.ConvertObject(s,e,i);else"number"==typeof e[s]?this.elementSetAttribute(i,s.substr(1),e[s]):"string"==typeof e[s]?"#comment"!==s?this.elementSetAttribute(i,s.substr(1),this.JSONStringToXML(e[s])):(n=document.createComment(this.CommentStringToXML(e[s])),i.appendChild(n)):"boolean"==typeof e[s]?this.elementSetAttribute(i,s.substr(1),e[s]):void 0!==e[s]&&(console.error("Unknown type found in object "+typeof e[s]),console.error(e));if(a&&t.startsWith("@"))if(d){for(var u in r)r[u]=this.SFStringToXML(r[u]);this.elementSetAttribute(i,t.substr(1),'"'+r.join('" "')+'"')}else this.elementSetAttribute(i,t.substr(1),r.join(" "));return i},x3dom.PROTOS=function(){this.protos={},this.names={},this.protoField={},this.scriptField={},this.interfaceField={},this.envField={},this.scopecount=0,this.privatescope=[],this.defs={},this.founddef=null,this.SFNodes={"-appearance":1,"-body":1,"-child":1,"-collidable":1,"-collider":1,"-color":1,"-composableRenderStyle":1,"-coord":1,"-emitter":1,"-fillProperties":1,"-fogCoord":1,"-fontStyle":1,"-geometry":1,"-geoOrigin":1,"-layout":1,"-lineProperties":1,"-massDensityModel":1,"-material":1,"-metadata":1,"-normal":1,"-nurbsCurve":1,"-nurbsCurve2D":1,"-pickingGeometry":1,"-renderStyle":1,"-shape":1,"-source":1,"-texCoord":1,"-texCoordNurbs":1,"-texCoordRamp":1,"-texture":1,"-texture2D":1,"-texture2DMulti":1,"-texture3D":1,"-textureProperties":1,"-textureTransform":1,"-transferFunction":1,"-viewport":1}},x3dom.PROTOS.prototype={flattenerArray:function(e,t){var i,o=[],s=0;for(i in e){var n=this.flattener(e[i],o,e.length);if(Array.isArray(n)){for(var r in n)o[parseInt(i)+s+parseInt(r)]=n[r];s+=n.length-1}else o[parseInt(i)+s]=n}return o},flattenerObject:function(e,t,i){var o,s={};for(o in e){var n=this.flattener(e[o],t,i);if(Array.isArray(n))if(this.SFNodes[o]){if(s[o]=n[0],1<n.length){t[i]={Switch:{"@whichChoice":-1,"-children":[{Group:{"-children":[]}}]}};for(var r=1;r<n.length;r++)t[i].Switch["-children"][0].Group["-children"][r-1]=n[r]}}else s[o]=n;else this.SFNodes[o]&&"object"==typeof n&&n["#comment"]?s["-children"]?(s[o]={},s["-children"].push(n)):(s[o]={},s["-children"]=[n]):s[o]=n}return s},flattener:function(e,t,i){return"object"==typeof e?Array.isArray(e)?this.flattenerArray(e,t):this.flattenerObject(e,t,i):e},pushScope:function(e){this.privatescope.push(e)},popScope:function(){this.privatescope.pop()},saveDef:function(e){return this.defs[e]=this.getScope(),this.getScope(e)},getDef:function(e){return this.defs[e]},getField:function(e,t){return e+"_"+t},getScope:function(e){var t=(e=e?this.defs[e]?this.defs[e]+"_"+e:e:this.privatescope.join("_")).lastIndexOf("DECL");return e=0<t?e.substring(t):e},scopeLength:function(){return this.privatescope.length},upScope:function(e){return this.privatescope.slice(0,this.privatescope.length-e).join("_")},setValueFromInterface:function(e,t,i){var e=this.getInterface(e),o="@";if(i=(o="-"===(o="@"===(o=void 0!==e&&void 0!==e[0]?e[0].substr(0,1):o)&&"children"===i?"-":o)&&"value"===i?"@":o)+i,void 0!==e&&void 0!==e[1]&&void 0!==e[0]&&void 0!==e[1][e[0]])return o=e[1][e[0]],Array.isArray(o)&&"SFNode"===e[1]["@type"]&&"-children"!==i&&(console.error("SFNode is array, reducing",o),o=o[0]),t[i=Array.isArray(o)||"-children"!==i?i:"@value"]=o,[e[1]["@type"],e[2]]},getObjectField:function(e,t){var i,o="value";for(i in 1===t.indexOf("FNode")&&(o="children"),e)"@value"!==i&&"-children"!==i||(o=i.substr(1));return o},findFieldByName:function(e,t){for(var i in e){i=e[i];if(i["@name"]===t)return i}throw"Can't find "+t},getScriptFieldFieldTypeFieldByNameAttribute:function(e,t){var e=this.findFieldByName(e,t),i=e["@name"],o=e["@type"];return[e,i,o,t=this.getObjectField(e,o)]},getScriptFieldFieldTypeField:function(e,t){var e=e[t],t=e["@name"],i=e["@type"];return[e,t,i,this.getObjectField(e,i)]},setScriptFields:function(e,t){var i,o=this.getScope();for(i in e){var s=this.getScriptFieldFieldTypeField(e,i),n=s[0],r=s[1],a=s[2],s=s[3],d=this.setValueFromInterface(r,n,s);this.setScriptField(o,r,n,s,a,t),void 0!==d&&this.setScriptField(d[1],r,n,s,a,t)}},setScriptField:function(e,t,i,o,s,n){void 0===this.scriptField[this.getField(e,t)]&&(this.scriptField[this.getField(e,t)]=[]),this.scriptField[this.getField(e,t)][this.scriptField[this.getField(e,t)].length]=[i,o,s,n]},setEnv:function(e,t,i,o,s,n){var r=this.getInterface(t);void 0!==r&&(e=r[2]),void 0===this.envField[this.getField(e,t)]&&(this.envField[this.getField(e,t)]=[]),this.envField[this.getField(e,t)][this.envField[this.getField(e,t)].length]=[i,o,s,n]},getEnv:function(e,t){return this.envField[this.getField(e,t)]},setConnectField:function(e,t,i,o,s,n){void 0===this.protoField[this.getField(e,t)]&&(this.protoField[this.getField(e,t)]=[]),this.protoField[this.getField(e,t)][this.protoField[this.getField(e,t)].length]=[i,o,s,n]},setConnectFields:function(e,t,i){var o,s=e["@DEF"],n=this.saveDef(s),r=e[t].connect,a=this.getScope();for(o in r){var d,l,h,u=r[o];u&&(d=this.getScope(u["@protoField"]),u=u["@nodeField"],(h=void 0)!==(l=this.setValueFromInterface(d,i,u))?(h=l[0],this.setEnv(a,d,i,u,h,n),this.setConnectField(a,d,i,u,h,n),this.setConnectField(l[1],d,i,u,h,n)):(this.setEnv(a,d,i,u,h,n),this.setConnectField(a,d,i,u,h,n)))}},setScriptConnectFields:function(e,t,i,o){var s,n=t[i].connect,r=this.getScope(),a=t["@DEF"];for(s in o.field=this.realPrototypeExpander(e,t.field,!0),o["@DEF"],n){var d,l,h,u,f=n[s];f&&(d=this.getScope(f["@protoField"]),h=f["@nodeField"],f=(u=this.getScriptFieldFieldTypeFieldByNameAttribute(o.field,h))[0],l=u[2],void 0!==(u=this.setValueFromInterface(d,f,h=u[3]))?(l=u[0],this.setScriptField(r,d,f,h,l,a),this.setScriptField(u[1],d,f,h,l,a)):this.setScriptField(r,d,f,h,l,a))}},getInterface:function(e){for(var t=0;t<this.scopeLength();t++){var i=this.upScope(t);if(!i)break;i=this.interfaceField[this.getField(i,e)];if(i)return i}},setInterface:function(e,t){var i=this.getScope();this.interfaceField[this.getField(i,e["@name"])]=[t,e,i]},clearScope:function(e,t){var i=this.getScope();delete this.scriptField[this.getField(i,e)],delete this.protoField[this.getField(i,e)],this.zap(e,t)},extractConnectedDef:function(e,t){var i,o,s,n;for(o in this.scriptField[this.getField(e,t)])void 0===i&&void 0!==(s=this.scriptField[this.getField(e,t)][o])&&void 0!==s[3]&&-1==(n=this.getField(e,s[3])).indexOf("DECL",1)&&(i=[n,s[0]["@name"]]);if(void 0===i)for(var r in this.protoField[this.getField(e,t)]){r=this.protoField[this.getField(e,t)][r];void 0!==r&&(i=[r[3],r[1]])}if(void 0===i)for(var a in this.protoField[this.getField(e,"__DEF_FIELD__")]){a=this.protoField[this.getField(e,"__DEF_FIELD__")][a];void 0!==a&&(i=[a[3],t])}return i=void 0===i?[e,t]:i},setObjectValues:function(e,t,i,o){var s,n,r=!1;for(s in this.protoField[this.getField(e,t)]){var a=this.protoField[this.getField(e,t)][s];void 0!==a&&(this.setObjectValue(e,t,a,i,o),r=!0)}for(n in this.scriptField[this.getField(e,t)]){var d=this.scriptField[this.getField(e,t)][n];void 0!==d&&(this.setObjectValue(e,t,d,i,o),r=!0)}if(!r)for(var l=0;l<this.scopeLength();l++){var h=this.upScope(l);if(!h)break;var u,f=this.getEnv(h,t);for(u in f){var c=f[u];void 0!==c&&c[3].indexOf(h)===c[3].lastIndexOf(h)&&this.setObjectValue(h,c[1],c,i,o)}}},setObjectValue:function(e,t,i,o,s){Array.isArray(s)&&void 0!==i[2]&&("SFNode"===i[2]?s=s[0]:i[2]);var n=i[1].substr(0,1);"-"===(n="@"===(n="-"!==n&&"@"!==n?o.substr(0,1):"")&&"children"===i[1]?"-":n)&&"value"===i[1]&&(n="@"),Array.isArray(s)||"children"!==i[1]||(s=[s]),i[0][n+i[1]]=s},zap:function(e,t){if("object"==typeof t)for(var i in t)if("is"===i.toLowerCase()){var o,s=t[i].connect;for(o in s){var n=s[o];n&&n["@protoField"]===e&&delete s[o]}}else this.zap(e,t[i]);return t},zapIs:function(e){if("object"==typeof e)for(var t in e)"is"===t.toLowerCase()?delete e[t]:this.zapIs(e[t]);return e},prototypeExpander:function(e,t){return t},readCode:function(e,t,i,o,s,n){void 0!==e&&(n[s]["#sourceText"]=e.split(/\r?\n/),delete n[s]["@url"])},handleScript:function(e,t,i,o){o[i]=this.realPrototypeExpander(e,t[i],!0),this.setScriptFields(o[i].field,o[i]["@DEF"]);t=o[i]["@url"];this.loadURLs(e,t,this.readCode,null,function(){},i,o)},handleProtoDeclare:function(e,t,i){var o=t[i]["@name"],s=t[i]["@DEF"];return this.protos[o]=t[i],this.saveDef(s),void 0!==t[i]["@appinfo"]&&(this.protos[o]["@appinfo"]=t[i]["@appinfo"]),void 0!==t[i]["@documentation"]&&(this.protos[o]["@documentation"]=t[i]["@documentation"]),this.pushScope("DECL"+o),this.names[s]=o,this.realPrototypeExpander(e,t[i],!1),this.popScope(),t},handleProtoInterface:function(e,t,i){var o,s=t[i].field;for(o in s){var n=s[o];void 0!==n["@value"]?this.setInterface(n,"@value"):void 0!==n["-children"]?this.setInterface(n,"-children"):this.setInterface(n)}return t},handleProtoInstance:function(e,t,i){var o=t[i]["@name"],s=t[i]["@DEF"],n=t[i]["@USE"];void 0===(this.names[s]=o)&&void 0!==n&&(o=this.names[n]),this.pushScope("DECL"+o);var r,a={};if(this.getDef(s=void 0===s&&void 0===n?"INSTANCE":s)&&void 0===n&&(this.scopecount+=1e3,s+=""+this.scopecount),void 0!==s&&(this.saveDef(s),this.pushScope(s)),void 0===this.protos[o]||void 0===this.protos[o].ProtoBody)console.error("ProtoBody undefined for",o);else{var d,l=this.protos[o].ProtoBody["-children"];for(d in l){var h,u=l[d];for(h in u)void 0===r&&(r=u[h]["@DEF"],void 0!==n)&&(this.saveDef(n),this.pushScope(n))}a=JSON.parse(JSON.stringify(l))}for(var f=a;Array.isArray(f)&&null!=f[0];)f=f[0];if(void 0!==n&&"object"==typeof f)(_={})[h]={},_[h]["@USE"]=this.getScope(),void 0!==r&&this.popScope();else{var c,_=this.realPrototypeExpander(e,a,!1),m=t[i].fieldValue;for(c in m){var p,x,g,v=m[c],y=v["@name"];for(g in v)"@name"!==g&&(x=v[p=g],this.pushScope("FIELD"+y),"object"==typeof f&&void 0!==f[h]&&(f[h]["@DEF"]=this.getScope()),x=this.realPrototypeExpander(e,x,!1),this.popScope(),this.getInterface(y),this.setObjectValues(this.getScope(),y,p,x))}}return void 0!==n&&this.popScope(),void 0!==s&&this.popScope(),this.popScope(),_},realPrototypeExpander:function(e,t,i){if("object"!=typeof t)return t;var o,s=null,s=Array.isArray(t)?[]:{};for(o in t){var n,r=o.toLowerCase();"script"===r?this.handleScript(e,t,o,s):"protodeclare"===r?this.handleProtoDeclare(e,t,o):"protointerface"===r?this.handleProtoInterface(e,t,o):"protobody"===r?this.realPrototypeExpander(e,t[o],i):"protoinstance"===r?s=this.handleProtoInstance(e,t,o):"connect"===r||"fieldvalue"===r?this.realPrototypeExpander(e,t[o],i):"field"===r||"@value"===r||"-children"===r?s[o]=this.realPrototypeExpander(e,t[o],i):"is"===r?(i?this.setScriptConnectFields(e,t,o,s):this.setConnectFields(t,o,s),this.realPrototypeExpander(e,t[o],i)):"route"===r?(s[o]={},n=this.extractConnectedDef(this.getScope(t[o]["@fromNode"]),t[o]["@fromField"]),s[o]["@fromNode"]=n[0],s[o]["@fromField"]=n[1],n=this.extractConnectedDef(this.getScope(t[o]["@toNode"]),t[o]["@toField"]),s[o]["@toNode"]=n[0],s[o]["@toField"]=n[1]):"@name"===r?s[o]=t[o]:"@def"===r?(s[o]=this.saveDef(t[o]),this.setConnectField(this.getScope(),"__DEF_FIELD__",s,t[o],"SFString",s[o])):s[o]="@use"===r?this.getScope(t[o]):this.realPrototypeExpander(e,t[o],i)}return s},searchForProtoDeclare:function(e,t){var i,o;if("object"==typeof e)for(i in e)"ProtoDeclare"===i&&(e[i]["@name"]===t&&(o=e),void 0===o)&&null===this.founddef&&(this.founddef=e),void 0===o&&(o=this.searchForProtoDeclare(e[i],t));return o},searchAndReplaceProto:function(e,t,i,o,s,n){var r=this.searchForProtoDeclare(t,i);null===(r=void 0===r?o:r)||void 0===r.ProtoDeclare?console.error("ProtoDeclare is still null or undefined",e,i,JSON.stringify(t)):(o=s["@name"],e=s["@appinfo"],i=s["@description"],r.ProtoDeclare["@name"]=o,r.ProtoDeclare["@appinfo"]=e,r.ProtoDeclare["@description"]=i),n(r)},loadedProto:function(e,t,i,o,s,n){if(void 0!==e)try{this.founddef=null;var r;try{r=JSON.parse(e),s.searchAndReplaceProto(o,r,t,s.founddef,i,n)}catch(r){if("function"==typeof DOM2JSONSerializer)try{var a=(new DOM2JSONSerializer).serializeToString(null,e.firstElementChild,o,mapToMethod,fieldTypes);s.searchAndReplaceProto(o,JSON.parse(a),t,s.founddef,i,n)}catch(e){"function"==typeof alert&&alert(e),console.error("Convert failed",e)}else console.error("Did not convert XML to JSON.  Oops!")}}catch(e){console.error("Failed to parse JSON in ",o,e)}else console.error("data is undefined for file",o)},doLoad:function(e,t,i,o,s,n){var r=n["@name"],a=t.indexOf("#");0<=a&&(r=t.substring(a+1));try{i.loadedProto(e,r,n,t,i,function(e){o(s,e,i)})}catch(e){console.error("Error searching for proto",e)}},processURLs:function(e,t){for(var i in e){if(0!==e[i].indexOf("http://")&&0!==e[i].indexOf("https://"))if(0===e[i].indexOf("urn:web3d:media:textures/panoramas/")){var o=e[i].lastIndexOf("/");0<o&&(e[i]="examples/Basic/UniversalMediaPanoramas/"+e[i].substring(o+1))}else{var o=e[i].indexOf("#"),s=t.lastIndexOf("/"),n=t;for(0<=s&&(n=t.substring(0,s));e[i].startsWith("../");)e[i]=e[i].substr(3),n=0<=(s=n.lastIndexOf("/"))?n.substring(0,s):"";e[i]=0==o?t+e[i]:n+"/"+e[i]}var r=e[i].lastIndexOf("#"),a="",r=(0<=r&&(a=e[i].substring(r),e[i]=e[i].substring(0,r)),e[i].lastIndexOf(".wrl")),r=(r===e[i].length-4&&(e[i]=e[i].substring(0,r)+".json"+a),e[i].lastIndexOf(".wrz"));r===e[i].length-4&&(e[i]=e[i].substring(0,r)+".json"+a)}return e},loadURLs:function(l,e,h,u,f,c,_){if(void 0!==e)for(var t in e=this.processURLs(e,l))try{(i=>{var e,t,o=i.indexOf("://"),s="file",n="localhost",r="/"+l;if(0<o&&(s=i.substring(0,o),e=i.indexOf("/",o+3),n=i.substring(o+3,e),r=i.substring(e)),"http"===s)"undefined"!=typeof http?http.get({host:n,path:r},function(e){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){h(t,i,u,f,c,_)})}):((t=new XMLHttpRequest).open("GET",i,!1),t.send(null),200===t.status&&(a=t.responseText,h(a,i,u,f,c,_)));else if("https"===s)"undefined"!=typeof https?https.get({host:n,path:r},function(e){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){h(t,i,u,f,c,_)})}):((t=new XMLHttpRequest).open("GET",i,!1),t.send(null),200===t.status&&(a=t.responseText,h(a,i,u,f,c,_)));else if("undefined"==typeof fs||s.startsWith("http"))(t=new XMLHttpRequest).open("GET",i,!1),t.send(null),200===t.status?(a=t.responseText,h(a,i,u,f,c,_)):console.error("Didn't load",i,".  No file system or http request.");else{o=i.indexOf("#");0<o&&(i=i.substring(0,o));try{var a=fs.readFileSync(i);h(a.toString(),i,u,f,c,_)}catch(e){var d=i;d.endsWith(".json")&&(d=d.substring(0,d.lastIndexOf("."))+".x3d","function"==typeof runAndSend)&&runAndSend(["---silent",d],function(e){a=JSON.stringify(e),h(a,d,u,f,c,_)})}}})(e[t])}catch(l){console.error(l)}},load:function(e,t,i,o,s){var i=i[e],n=i["@url"];this.loadURLs(t,n,o.doLoad,o,s,e,i)},externalPrototypeExpander:function(o,e){if("object"!=typeof e)return e;var t,s=null,s=Array.isArray(e)?[]:{};for(t in e)"ExternProtoDeclare"===t?this.load(t,o,e,this,function(e,t,i){null!=t&&void 0!==t&&(s.ProtoDeclare=i.externalPrototypeExpander(o,t).ProtoDeclare)}):s[t]=this.externalPrototypeExpander(o,e[t]);for(var i=Object.keys(e).length;i>Object.keys(s).length+1;);return setTimeout(function(){},50),s}},x3dom.protoExpander=new x3dom.PROTOS,x3dom.ProtoDeclaration=function(e,t,i,o,s,n){this._nameSpace=e,this.name=t,this._protoBody=i||null,this.fields=o||[],this.isExternProto=s||!1,this.url=n||[],this.needsLoading=!0,this.instanceQueue=[]},x3dom.ProtoDeclaration.prototype.registerNode=function(){var r=this;x3dom.registerNodeType(r.name,"Core",defineClass(x3dom.nodeTypes.X3DNode,function(n){x3dom.nodeTypes[r.name].superClass.call(this,n),this._cf_hash={},r.fields.forEach(function(e){var t,i,o,s;e.dataType.endsWith("ode")?(n&&n.xmlNode&&0==n.xmlNode.querySelectorAll("[containerField='"+e.name+"']").length&&e.cfValue.forEach(function(e){n.xmlNode.appendChild(e.cloneNode(!0))}),t=x3dom.nodeTypes.X3DNode,o=r._protoBody._ISRoutes,e.name in o?(i=(o=o[e.name][0]).nodeField,(s=(o=r._protoBody.querySelector("[DEF="+o.nodeDEF+"]")).localName.toLowerCase())in x3dom.nodeTypesLC&&(o={doc:n.doc,runtime:n.runtime,xmlNode:o.cloneNode(!0),nameSpace:n.nameSpace},i in(s=new x3dom.nodeTypesLC[s](o))._cf)&&(t=s._cf[i].type)):x3dom.debug.logWarning(r.name+" Proto: field without IS connection - "+e.name),this["addField_"+e.dataType](e.name,t),this._cf_hash[e.name]="trigger"):(n&&n.xmlNode&&!n.xmlNode.hasAttribute(e.name)&&e.value&&n.xmlNode.setAttribute(e.name,e.value),this["addField_"+e.dataType](n,e.name,e.value))},this);var e="protoNS";n.xmlNode.hasAttribute("DEF")&&(e=n.xmlNode.getAttribute("DEF")+"NS"),this.innerNameSpace=new x3dom.NodeNameSpace(e,n.doc),this.innerNameSpace.setBaseURL(n.nameSpace.baseURL+r.name),r._nameSpace.addSpace(this.innerNameSpace),r._nameSpace.protos.forEach(function(e){this.innerNameSpace.protos.push(e)},this),this.nodes=[],this.protoBodyClone=r._protoBody.cloneNode(!0),this.declaration=r,this.isProtoInstance=!0,this._changing=!1,this._externTries=0,this._maxTries=5},{nodeChanged:function(e){if(!this._changing){this._changing=!0;var i=this.protoBodyClone;i.querySelectorAll(":scope > *").forEach(function(e){var t=e.localName.toLowerCase();"protodeclare"==t?this.innerNameSpace.protoDeclare(e):"externprotodeclare"==t?this.innerNameSpace.externProtoDeclare(e):"protoinstance"==t&&this.innerNameSpace.protoInstance(e,i)},this);for(var t=this.protoBodyClone.childNodes,o=0;o<t.length;o++){var s=this.innerNameSpace.setupTree.call(this.innerNameSpace,t[o],this);null!=s&&this.nodes.push(s)}this.typeNode=this.nodes[0],this.helperNodes=this.nodes.slice(1);var n,r,a=this._xmlNode.attributes;for(o=0;o<a.length;o++)(n=a[o]).name.startsWith("on")&&this.typeNode._xmlNode.setAttribute(n.name,n.value);for(r in this._vf)this.fieldChanged(r);for(r in this._cf)"nodes"in this._cf[r]&&this._cf_hash[r]===this._get_cf_hash(r)&&r!=e||this.fieldChanged(r);for(r in this._vf)r in this.declaration._protoBody._ISRoutes&&this._setupFieldWatchers(r);for(r in this._changing=!1,this._cf)"nodes"in this._cf[r]&&(this._cf_hash[r]=this._get_cf_hash(r))}},fieldChanged:function(a){try{var e=this.declaration._protoBody._ISRoutes;a in e&&e[a].forEach(function(e){var t=this.innerNameSpace.defMap[e.nodeDEF];if(null!=t){this._externTries=0;var i=this._normalizeName(e.nodeField,t);if(a in this._vf)t._vf[i]=this._vf[a],t.fieldChanged(i);else if(a in this._cf){t._cf[i]=this._cf[a];var o=[];if("MFNode"==t._cfFieldTypes[i]?o=this._cf[a].nodes:"SFNode"==t._cfFieldTypes[i]&&this._cf[a].node?o=[this._cf[a].node]:x3dom.debug.logWarning("Unexpected field type: "+t._cfFieldTypes[i]),t._childNodes.forEach(function(e){t.removeChild(e,i,"force")}),o.forEach(function(e){t.addChild(e,i)}),"MFNode"==t._cfFieldTypes[i])for(var s=0;s<o.length;s++)for(var n=o[s],r=o.length-1;s<r;r--)n==o[r]&&o.splice(r,1);t.nodeChanged(i)}}else"protoinstance"==this.protoBodyClone.querySelector("[DEF="+e.nodeDEF+"]").tagName.toLowerCase()&&this._externTries++<this._maxTries&&(x3dom.debug.logWarning(" ExternProto instance attempt: "+this._externTries),setTimeout(this.fieldChanged.bind(this),1e3,a))},this)}catch(a){x3dom.debug.logWarning("Proto warning: "+a)}},_normalizeName:function(e,t){return e in t._vf?e:e.replace(/^set_/,"").replace(/_changed$/,"")},_setupFieldWatchers:function(a){this.declaration._protoBody._ISRoutes[a].forEach(function(e){var t,i,o,s,n,r=this.innerNameSpace.defMap[e.nodeDEF];null!=r?(t=this._normalizeName(e.nodeField,r),r._fieldWatchers[t]||(r._fieldWatchers[t]=[]),i=this.postMessage.bind(this,a),(o=r._fieldWatchers[t]).push(i),s=o.length-1,this._fieldWatchers[a]||(this._fieldWatchers[a]=[]),n=function(e){o.splice(s,1),r.postMessage(t,e),o.push(i),s=o.length-1}.bind(r),this._fieldWatchers[a].push(n)):"protoinstance"==this.protoBodyClone.querySelector("[DEF="+e.nodeDEF+"]").tagName.toLowerCase()&&this._externTries++<this._maxTries&&(x3dom.debug.logWarning(" retrying ExternProto: "+this._externTries),setTimeout(this._setupFieldWatchers.bind(this),1e3,a))},this)},_get_cf_hash:function(e){return this._cf[e].nodes.length}}))},x3dom.shader={},x3dom.shader.PICKING="picking",x3dom.shader.PICKING_24="picking24",x3dom.shader.PICKING_ID="pickingId",x3dom.shader.PICKING_COLOR="pickingColor",x3dom.shader.PICKING_TEXCOORD="pickingTexCoord",x3dom.shader.FRONTGROUND_TEXTURE="frontgroundTexture",x3dom.shader.BACKGROUND_TEXTURE="backgroundTexture",x3dom.shader.BACKGROUND_SKYTEXTURE="backgroundSkyTexture",x3dom.shader.BACKGROUND_CUBETEXTURE="backgroundCubeTexture",x3dom.shader.BACKGROUND_CUBETEXTURE_DDS="backgroundCubeTextureDDS",x3dom.shader.BLUR="blur",x3dom.shader.DEPTH="depth",x3dom.shader.NORMAL="normal",x3dom.shader.TEXTURE_REFINEMENT="textureRefinement",x3dom.shader.SSAO="ssao",x3dom.shader.material=function(){return"uniform vec3  diffuseColor;\nuniform vec3  specularColor;\nuniform vec3  emissiveColor;\nuniform float shininess;\nuniform float transparency;\nuniform float ambientIntensity;\n"},x3dom.shader.physicalMaterial=function(){return"uniform vec3  baseColorFacor;\nuniform vec3  emissiveFactor;\nuniform float metallicFactor;\nuniform float roughnessFactor;\n"};x3dom.shader.twoSidedMaterial=function(){return"uniform vec3  backDiffuseColor;\nuniform vec3  backSpecularColor;\nuniform vec3  backEmissiveColor;\nuniform float backShininess;\nuniform float backTransparency;\nuniform float backAmbientIntensity;\n"},x3dom.shader.fog=function(){return"uniform vec3  fogColor;\nuniform float fogType;\nuniform float fogRange;\nvarying vec3 fragEyePosition;\nfloat calcFog(in vec3 eye) {\n   float f0 = 0.0;\n   if(fogType == 0.0) {\n       if(length(eye) < fogRange){\n           f0 = (fogRange-length(eye)) / fogRange;\n       }\n   }else{\n       if(length(eye) < fogRange){\n           f0 = exp(-length(eye) / (fogRange-length(eye) ) );\n       }\n   }\n   f0 = clamp(f0, 0.0, 1.0);\n   return f0;\n}\n"},x3dom.shader.clipPlanes=function(e){for(var t="",i=0;i<e;i++)t=(t+="uniform vec4 clipPlane"+i+"_Plane;\n")+("uniform float clipPlane"+i+"_CappingStrength;\n")+("uniform vec3 clipPlane"+i+"_CappingColor;\n");for(t+="vec3 calculateClipPlanes() {\n",i=0;i<e;i++)t=(t=(t=(t+="vec4 clipPlane"+i+";\n")+"if(fragEyeIdx == 1.0){\n"+("    clipPlane"+i+" = clipPlane"+i+"_Plane * viewMatrixInverse2;\n"))+"}else{\n"+("    clipPlane"+i+" = clipPlane"+i+"_Plane * viewMatrixInverse;\n"))+"}\n"+("float dist"+i+" = dot(fragPosition, clipPlane"+i+");\n");for(t+="    if( ",i=0;i<e;i++)0!=i&&(t+=" || "),t+="dist"+i+" < 0.0";for(t=t+" ) "+"{ discard; }\n",i=0;i<e;i++)t=t+("    if( abs(dist"+i+") < clipPlane"+i+"_CappingStrength ) ")+("{ return clipPlane"+i+"_CappingColor; }\n");return(t+="    return vec3(-1.0, -1.0, -1.0);\n")+"}\n"},x3dom.shader.gammaCorrectionDecl=function(e){var t="";return"none"!==e.GAMMACORRECTION&&("fastlinear"===e.GAMMACORRECTION?t=(t=t+"vec4 gammaEncode(vec4 color){\n  vec4 tmp = sqrt(color);\n  return vec4(tmp.rgb, color.a);\n}\n"+"vec4 gammaDecode(vec4 color){\n  vec4 tmp = color * color;\n  return vec4(tmp.rgb, color.a);\n}\n")+"vec3 gammaEncode(vec3 color){\n  return sqrt(color);\n}\n"+"vec3 gammaDecode(vec3 color){\n  return (color * color);\n}\n":t=(t=(t=(t=t+"const vec4 gammaEncode4Vector = vec4(0.4545454545454545, 0.4545454545454545, 0.4545454545454545, 1.0);\n"+"const vec4 gammaDecode4Vector = vec4(2.2, 2.2, 2.2, 1.0);\n")+"vec4 gammaEncode(vec4 color){\n    return pow(abs(color), gammaEncode4Vector);\n}\n"+"vec4 gammaDecode(vec4 color){\n    return pow(abs(color), gammaDecode4Vector);\n}\n")+"const vec3 gammaEncode3Vector = vec3(0.4545454545454545, 0.4545454545454545, 0.4545454545454545);\n"+"const vec3 gammaDecode3Vector = vec3(2.2, 2.2, 2.2);\n")+"vec3 gammaEncode(vec3 color){\n    return pow(abs(color), gammaEncode3Vector);\n}\n"+"vec3 gammaDecode(vec3 color){\n    return pow(abs(color), gammaDecode3Vector);\n}\n"),t},x3dom.shader.encodeGamma=function(e,t){return"none"===e.GAMMACORRECTION?t:"gammaEncode ("+t+")"},x3dom.shader.decodeGamma=function(e,t){return"none"===e.GAMMACORRECTION?t:"gammaDecode ("+t+")"},x3dom.shader.rgbaPacking=function(){return"vec4 packDepth(float depth){\n    depth = (depth + 1.0)*0.5;\n    vec4 outVal = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n    outVal = fract(outVal);\n      outVal -= outVal.yzww * vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);\n      return outVal;\n}\nfloat unpackDepth(vec4 color){\n    float depth = dot(color, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0));\n    return (2.0*depth - 1.0);\n}\n"},x3dom.shader.calcMipLevel=function(){return"vec2 dirToCubeUV( vec3 dir ) {\n    vec2 uv = vec2(0.0);\n    vec3 absDir = abs(dir);\n    if( absDir.x >= absDir.y && absDir.x >= absDir.z) {\n        if(dir.x < 0.0) {\n           uv.x = 1.0 - (((dir.z/absDir.x) + 1.0) * 0.5);\n           uv.y = 1.0 - (((-dir.y/absDir.x) + 1.0) * 0.5);\n       } else {\n           uv.x = 1.0 - (((-dir.z/absDir.x) + 1.0) * 0.5);\n           uv.y = 1.0 - (((-dir.y/absDir.x) + 1.0) * 0.5);\n       }\n   } else if( absDir.y >= absDir.x && absDir.y >= absDir.z) {\n       if(dir.y < 0.0) {\n              uv.x = ((dir.x/absDir.y) + 1.0) * 0.5;\n           uv.y = ((-dir.z/absDir.y) + 1.0) * 0.5;\n       } else {\n           uv.x = ((dir.x/absDir.y) + 1.0) * 0.5;\n           uv.y = ((dir.z/absDir.y) + 1.0) * 0.5;\nif(uv.y == 0.0) { uv.x = 1.0; uv.y = 0.0; }\n       }\n   } else if( absDir.z >= absDir.x && absDir.z >= absDir.y) {\n       if(dir.z < 0.0) {\n           uv.x = (((-dir.x/absDir.z) + 1.0) * 0.5);\n           uv.y = 1.0 - (((-dir.y/absDir.z) + 1.0) * 0.5);\n       } else {\n           uv.x = ((dir.x/absDir.z) + 1.0) * 0.5;\n           uv.y = 1.0 - (((-dir.y/absDir.z) + 1.0) * 0.5);\n       }\n   }\n   float a = pow(64.0,2.0) / pow(64.0,3.0);\n    uv.x = a * pow(uv.x, 3.0) + uv.x;\n    uv.y = a * pow(uv.y, 3.0) + uv.y;\n   return uv;\n}\nfloat calcMipLevel( vec2 uv ) {\n    vec2  dx_vtc        = dFdx(uv) * 64.0;\n    vec2  dy_vtc        = dFdy(uv) * 64.0;\n    float delta_max_sqr = max(dot(dx_vtc, dx_vtc), dot(dy_vtc, dy_vtc));\n    return 0.5 * log2(delta_max_sqr);\n}\nvec3 fixSeams(vec3 vec, float mipmapIndex) {\n    float scale = 1.0 - exp2(mipmapIndex) / 64.0;\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n    if (abs(vec.x) != M) vec.x *= scale;\n    if (abs(vec.y) != M) vec.y *= scale;\n    if (abs(vec.z) != M) vec.z *= scale;\n    return vec;\n}"},x3dom.shader.shadowRendering=function(){var e=(e="")+"float getLightInfluence(float lType, float lShadowIntensity, float lOn, vec3 lLocation, vec3 lDirection, float lCutOffAngle, float lBeamWidth, vec3 lAttenuation, float lRadius, vec3 eyeCoords) {\n    if (lOn == 0.0 || lShadowIntensity == 0.0){ return 0.0;\n    } else if (lType == 0.0) {\n        return 1.0;\n    } else {\n       float attenuation = 0.0;\n       vec3 lightVec = (lLocation - (eyeCoords));\n       float distance = length(lightVec);\n        lightVec = normalize(lightVec);\n        eyeCoords = normalize(-eyeCoords);\n       if(lRadius == 0.0 || distance <= lRadius) {\n           attenuation = 1.0 / max(lAttenuation.x + lAttenuation.y * distance + lAttenuation.z * (distance * distance), 1.0);\n        }\n         if (lType == 1.0) return attenuation;\n       float spotAngle = acos(max(0.0, dot(-lightVec, normalize(lDirection))));\n       if(spotAngle >= lCutOffAngle) return 0.0;\n       else if(spotAngle <= lBeamWidth) return attenuation;\n       else return attenuation * (spotAngle - lCutOffAngle) / (lBeamWidth - lCutOffAngle);\n    }\n}\n"+"void getShadowValues(inout vec4 shadowMapValues, inout float viewSampleDepth, in mat4 lightMatrix, in vec4 worldCoords, in sampler2D shadowMap){\n    vec4 lightSpaceCoords = lightMatrix*worldCoords;\n    vec3 lightSpaceCoordsCart = lightSpaceCoords.xyz / lightSpaceCoords.w;\n    vec2 textureCoords = (lightSpaceCoordsCart.xy + 1.0)*0.5;\n    viewSampleDepth = lightSpaceCoordsCart.z;\n    shadowMapValues = texture2D(shadowMap, textureCoords);\n";return x3dom.caps.FP_TEXTURES||(e+="    shadowMapValues = vec4(1.0,1.0,unpackDepth(shadowMapValues),1.0);\n"),e=(e=e+"}\n"+"void getShadowValuesPointLight(inout vec4 shadowMapValues, inout float viewSampleDepth, in vec3 lLocation, in vec4 worldCoords, in mat4 lightViewMatrix,in mat4 lMatrix_0, in mat4 lMatrix_1, in mat4 lMatrix_2, in mat4 lMatrix_3, in mat4 lMatrix_4, in mat4 lMatrix_5,in sampler2D shadowMap_0, in sampler2D shadowMap_1, in sampler2D shadowMap_2, in sampler2D shadowMap_3,in sampler2D shadowMap_4, in sampler2D shadowMap_5){\n    vec4 transformed = lightViewMatrix * worldCoords;\n    vec3 lightVec = normalize(transformed.xyz/transformed.w);\n    vec3 lightVecAbs = abs(lightVec);\n    float maximum = max(max(lightVecAbs.x, lightVecAbs.y),lightVecAbs.z);\n    if (lightVecAbs.x == maximum) {\n        if (lightVec.x < 0.0) getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_3,worldCoords,shadowMap_3);\n        else getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_1,worldCoords,shadowMap_1);\n    }\n    else if (lightVecAbs.y == maximum) {\n        if (lightVec.y < 0.0) getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_4,worldCoords,shadowMap_4);\n        else getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_5,worldCoords,shadowMap_5);\n    }\n    else if (lightVec.z < 0.0) getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_0,worldCoords,shadowMap_0);\n    else getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_2,worldCoords,shadowMap_2);\n}\n")+"void getShadowValuesCascaded(inout vec4 shadowMapValues, inout float viewSampleDepth, in vec4 worldCoords, in float eyeDepth, in mat4 lMatrix_0, in mat4 lMatrix_1, in mat4 lMatrix_2,in mat4 lMatrix_3, in mat4 lMatrix_4, in mat4 lMatrix_5, in sampler2D shadowMap_0, in sampler2D shadowMap_1, in sampler2D shadowMap_2,in sampler2D shadowMap_3, in sampler2D shadowMap_4, in sampler2D shadowMap_5, in float split_0, in float split_1, in float split_2, in float split_3, in float split_4){\n    if (eyeDepth < split_0) getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_0, worldCoords, shadowMap_0);\n    else if (eyeDepth < split_1) getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_1, worldCoords, shadowMap_1);\n    else if (eyeDepth < split_2) getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_2, worldCoords, shadowMap_2);\n    else if (eyeDepth < split_3) getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_3, worldCoords, shadowMap_3);\n    else if (eyeDepth < split_4) getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_4, worldCoords, shadowMap_4);\n    else getShadowValues(shadowMapValues, viewSampleDepth, lMatrix_5, worldCoords, shadowMap_5);\n}\n"+"float ESM(float shadowMapDepth, float viewSampleDepth, float offset){\n",x3dom.caps.FP_TEXTURES?e+="    return shadowMapDepth * exp(-80.0*(1.0-offset)*viewSampleDepth);\n":e+="    float d = viewSampleDepth - shadowMapDepth;\n    d = step( 0.002, abs(d) ) * d;\n    return exp(-80.0*(1.0-offset)*d);\n",(e+="}\n")+"float VSM(vec2 moments, float viewSampleDepth, float offset){\n    viewSampleDepth = (viewSampleDepth + 1.0) * 0.5;\n    if (viewSampleDepth <= moments.x) return 1.0;\n    float variance = moments.y - moments.x * moments.x;\n    variance = max(variance, 0.00002 + offset*0.01);\n    float d = viewSampleDepth - moments.x;\n    return variance/(variance + d*d);\n}\n"},x3dom.shader.light=function(e){for(var t="",i=0;i<e;i++)t+="uniform float light"+i+"_On;\nuniform float light"+i+"_Type;\nuniform vec3  light"+i+"_Location;\nuniform vec3  light"+i+"_Direction;\nuniform vec3  light"+i+"_Color;\nuniform vec3  light"+i+"_Attenuation;\nuniform float light"+i+"_Radius;\nuniform float light"+i+"_Intensity;\nuniform float light"+i+"_AmbientIntensity;\nuniform float light"+i+"_BeamWidth;\nuniform float light"+i+"_CutOffAngle;\nuniform float light"+i+"_ShadowIntensity;\n";return t+"void lighting(in float lType, in vec3 lLocation, in vec3 lDirection, in vec3 lColor, in vec3 lAttenuation, in float lRadius, in float lIntensity, in float lAmbientIntensity, in float lBeamWidth, in float lCutOffAngle, in vec3 positionVS, in vec3 N, in vec3 V, float shin, float ambIntensity, vec3 reflectivity, inout vec3 ambient, inout vec3 diffuse, inout vec3 specular)\n{\n   vec3 L;\n   float spot = 1.0, attentuation = 0.0;\n   if(lType == 0.0) {\n       L = -normalize(lDirection);\n        V = normalize(V);\n        attentuation = 1.0;\n   } else{\n       L = (lLocation - (-V));\n       float d = length(L);\n        L = normalize(L);\n        V = normalize(V);\n       if(lRadius == 0.0 || d <= lRadius) {\n           attentuation = 1.0 / max(lAttenuation.x + lAttenuation.y * d + lAttenuation.z * (d * d), 1.0);\n        }\n       if(lType == 2.0) {\n           float spotAngle = acos(max(0.0, dot(-L, normalize(lDirection))));\n           if(spotAngle >= lCutOffAngle) spot = 0.0;\n           else if(spotAngle <= lBeamWidth) spot = 1.0;\n           else spot = (spotAngle - lCutOffAngle ) / (lBeamWidth - lCutOffAngle);\n       }\n   }\n   vec3  H = normalize( L + V );\n   float NdotL = clamp(dot(L, N), 0.0, 1.0);\n   float NdotH = clamp(dot(H, N), 0.0, 1.0);\n   float ambientFactor  = lAmbientIntensity * ambIntensity;\n   float diffuseFactor  = lIntensity * NdotL;\n   float specularFactor = lIntensity * pow(NdotH, shin*128.0);\n   ambient  += lColor * ambientFactor * attentuation * spot;\n   diffuse  += lColor * diffuseFactor * attentuation * spot;\n   specular += lColor * specularFactor * attentuation * spot;\n}\n"},x3dom.shader.lightPBR=function(e){for(var t="",i=0;i<e;i++)t+="uniform float light"+i+"_On;\nuniform float light"+i+"_Type;\nuniform vec3  light"+i+"_Location;\nuniform vec3  light"+i+"_Direction;\nuniform vec3  light"+i+"_Color;\nuniform vec3  light"+i+"_Attenuation;\nuniform float light"+i+"_Radius;\nuniform float light"+i+"_Intensity;\nuniform float light"+i+"_AmbientIntensity;\nuniform float light"+i+"_BeamWidth;\nuniform float light"+i+"_CutOffAngle;\nuniform float light"+i+"_ShadowIntensity;\n";return t+"void lighting(in float lType, in vec3 lLocation, in vec3 lDirection, in vec3 lColor, in vec3 lAttenuation, in float lRadius, in float lIntensity, in float lAmbientIntensity, in float lBeamWidth, in float lCutOffAngle, in vec3 positionVS, in vec3 N, in vec3 V, float shin, float ambIntensity, vec3 reflectivity, inout vec3 ambient, inout vec3 diffuse, inout vec3 specular)\n{\n   vec3 L;\n   float spot = 1.0, attentuation = 0.0;\n   if(lType == 0.0) {\n       L = -normalize(lDirection);\n        V = normalize(V);\n        attentuation = 1.0;\n   } else{\n       L = (lLocation - (-V));\n       float d = length(L);\n        L = normalize(L);\n        V = normalize(V);\n       if(lRadius == 0.0 || d <= lRadius) {\n           attentuation = 1.0 / max(lAttenuation.x + lAttenuation.y * d + lAttenuation.z * (d * d), 1.0);\n        }\n       if(lType == 2.0) {\n           float spotAngle = acos(max(0.0, dot(-L, normalize(lDirection))));\n           if(spotAngle >= lCutOffAngle) spot = 0.0;\n           else if(spotAngle <= lBeamWidth) spot = 1.0;\n           else spot = (spotAngle - lCutOffAngle ) / (lBeamWidth - lCutOffAngle);\n       }\n   }\n   vec3  fresnel = vec3(1.0, 1.0, 1.0);\n   vec3  H = normalize( L + V );\n   float NoL = clamp( dot( N, L ), 0.0, 1.0 );\n   float NoH = clamp( dot( N, H ), 0.0, 1.0 );\n   float NoV = clamp( dot( N, V ), 0.0, 1.0 );\n   float VoH = clamp( dot( V, H ), 0.0, 1.0 );\n   float ambientFactor  = lAmbientIntensity * ambIntensity;\n   float diffuseFactor  = lIntensity * NoL;\n   float spec  = lIntensity * NoL;\n   float roughness = 1.0 - shin;\n   float a = max( roughness * roughness, 5e-4 );\n   float a2 = a * a;\n   float denom = NoH * NoH * ( a2 - 1.0 ) + 1.0;\n   float D = a2 / ( denom * denom );\n   float k = a / 2.0;\n   float G_V = ( NoV * ( 1.0 - k ) + k );\n   float G_L = ( NoL * ( 1.0 - k ) + k );\n   float G = 0.25 / ( G_V * G_L );\n   vec3 F = reflectivity + (fresnel - fresnel*reflectivity) * exp2( (-5.55473 * VoH - 6.98316) * VoH );\n   vec3 specularFactor = (D * G) * (F * spec);\n   ambient  += lColor * ambientFactor * attentuation * spot;\n   diffuse  += lColor * diffuseFactor * attentuation * spot;\n   specular += lColor * specularFactor * attentuation * spot;\n}\n"},x3dom.shader.TBNCalculation=function(){return"mat3 cotangent_frame(vec3 N, vec3 p, vec2 uv)\n{\n    // get edge vectors of the pixel triangle\n    vec3 dp1 = dFdx( p );\n    vec3 dp2 = dFdy( p );\n    vec2 duv1 = dFdx( uv );\n    vec2 duv2 = dFdy( uv );\n\n    // solve the linear system\n    vec3 dp2perp = cross( dp2, N );\n    vec3 dp1perp = cross( N, dp1 );\n    vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n\n    // construct a scale-invariant frame\n    float invmax = inversesqrt( max( dot(T,T), dot(B,B) ) );\n    return mat3( T * invmax, B * invmax, N );\n}\n\nvec3 perturb_normal( vec3 N, vec3 V, vec2 texcoord, vec3 bias )\n{\n    // assume N, the interpolated vertex normal and\n    // V, the view vector (vertex to eye)\n    vec3 map = texture2D(normalMap, texcoord ).xyz;\n    map = 2.0 * map - 1.0;\n    map = map * bias;\n    mat3 TBN = cotangent_frame(N, -V, texcoord);\n    return normalize(TBN * map);\n}\n\n"},x3dom.shader.toneMapping=function(){return"uniform float tonemappingOperator;\nvec3 tonemapReinhard(vec3 color) { \n    return color / (color + vec3(1.0));\n}\n\nvec3 uncharted2Tonemap(vec3 color) { \n    float A = 0.15;\n    float B = 0.50;\n    float C = 0.10;\n    float D = 0.20;\n    float E = 0.02;\n    float F = 0.30;\n    return ((color*(A*color+C*B)+D*E)/(color*(A*color+B)+D*F))-E/F;\n}\n\nvec3 tonemapUncharted2(vec3 color) { \n    float W = 11.2;\n   float exposureBias = 2.0;\n    vec3 curr = uncharted2Tonemap(exposureBias * color);\n    vec3 whiteScale = 1.0 / uncharted2Tonemap(vec3(W));\n    return curr * whiteScale;\n}\n\nvec3 tonemapeFilmic(vec3 color) { \n    const float a = 2.51;\n    const float b = 0.03;\n    const float c = 2.43;\n    const float d = 0.59;\n    const float e = 0.14;\n    return clamp((color * (a * color + b)) / (color * (c * color + d ) + e), 0.0, 1.0);\n}\n\nvec3 tonemap(vec3 color) { \n    if(tonemappingOperator == 0.0) {\n       return color;\n    }\n    if(tonemappingOperator == 1.0) {\n       return tonemapReinhard(color);\n    }\n    if(tonemappingOperator == 2.0) {\n       return tonemapUncharted2(color);\n    }\n    if(tonemappingOperator == 3.0) {\n       return tonemapeFilmic(color);\n    }\n}\n\n"},x3dom.shader.DynamicShader=function(e,t){this.program=e.createProgram();var i=this.generateVertexShader(e,t,x3dom.caps.WEBGL_VERSION),t=this.generateFragmentShader(e,t,x3dom.caps.WEBGL_VERSION);return e.attachShader(this.program,i),e.attachShader(this.program,t),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.DynamicShader.prototype.generateVertexShader=function(e,t,i){var o="",t=(o=(o=(o=(o=(o+="uniform mat4 modelMatrix;\n")+"uniform mat4 modelViewMatrix;\n"+"uniform mat4 modelViewProjectionMatrix;\n")+"uniform mat4 modelViewMatrix2;\n"+"uniform mat4 modelViewProjectionMatrix2;\n")+"uniform float isVR;\n"+"attribute float eyeIdx;\n")+"varying float vrOffset;\n"+"varying float fragEyeIdx;\n",3==t.POSCOMPONENTS?o+="attribute vec3 position;\n":4==t.POSCOMPONENTS&&(o+="attribute vec4 position;\n"),t.POPGEOMETRY&&(o=(o=(o=(o=o+"uniform float PG_precisionLevel;\n"+"uniform float PG_powPrecision;\n")+"uniform vec3 PG_maxBBSize;\n"+"uniform vec3 PG_bbMin;\n")+"uniform vec3 PG_bbMaxModF;\n"+"uniform vec3 PG_bboxShiftVec;\n")+"uniform float PG_numAnchorVertices;\n"+"attribute float PG_vertexID;\n"),!t.LIGHTS&&!t.PBR_MATERIAL||t.NORMALMAP&&"OBJECT"==t.NORMALSPACE||(o=(o+="varying vec3 fragNormal;\n")+"uniform mat4 normalMatrix;\n"+"uniform mat4 normalMatrix2;\n",2==t.NORCOMPONENTS?4!=t.POSCOMPONENTS&&(o+="attribute vec2 normal;\n"):3==t.NORCOMPONENTS&&(o+="attribute vec3 normal;\n")),t.VERTEXCOLOR&&(3==t.COLCOMPONENTS?o=o+"attribute vec3 color;\n"+"varying vec3 fragColor;\n":4==t.COLCOMPONENTS&&(o=o+"attribute vec4 color;\n"+"varying vec4 fragColor;\n")),t.TEXTURED&&(o+="varying vec2 fragTexcoord;\n",t.MULTITEXCOORD&&(o+="varying vec2 fragTexcoord2;\n"),t.SPHEREMAPPING||t.IS_PARTICLE||(o+="attribute vec2 texcoord;\n",t.MULTITEXCOORD&&(o+="attribute vec2 texcoord2;\n")),t.TEXTRAFO&&(o+="uniform mat4 texTrafoMatrix;\n"),t.NORMALMAP&&"TANGENT"==t.NORMALSPACE&&(t.TANGENTDATA||x3dom.caps.STD_DERIVATIVES||x3dom.debug.logWarning("Your System doesn't support the 'OES_STANDARD_DERIVATIVES' Extension. You must set tangents and binormals manually via the FloatVertexAttribute-Node to use normal maps"),o=(o=o+"attribute vec3 tangent;\n"+"attribute vec3 binormal;\n")+"varying vec3 fragTangent;\n"+"varying vec3 fragBinormal;\n"),t.DISPLACEMENTMAP&&(o=(o=(o+="uniform sampler2D displacementMap;\n")+"uniform float displacementFactor;\n"+"uniform float displacementWidth;\n")+"uniform float displacementHeight;\n"+"uniform float displacementAxis;\n"),t.DIFFPLACEMENTMAP)&&(o=(o=(o+="uniform sampler2D diffuseDisplacementMap;\n")+"uniform float displacementFactor;\n"+"uniform float displacementWidth;\n")+"uniform float displacementHeight;\n"+"uniform float displacementAxis;\n"),(t.CUBEMAP||t.PBR_MATERIAL)&&(o=(o+="varying vec3 fragViewDir;\n")+"uniform mat4 viewMatrix;\n"+"uniform mat4 viewMatrix2;\n"),t.VERTEXID&&(o=o+"attribute float id;\n"+"varying float fragID;\n"),t.IS_PARTICLE&&(o+="attribute vec3 particleSize;\n"),t.POINTPROPERTIES&&(o=(o=o+"uniform vec3 pointSizeAttenuation;\n"+"uniform float pointSizeFactor;\n")+"uniform float minPointSize;\n"+"uniform float maxPointSize;\n"),(t.LIGHTS||t.FOG||t.CLIPPLANES||t.POINTPROPERTIES)&&(o=(o+="uniform vec3 eyePosition;\n")+"varying vec4 fragPosition;\n"+"varying vec4 fragPositionWS;\n",t.FOG)&&(o+="varying vec3 fragEyePosition;\n"),t.REQUIREBBOX&&(o=(o+="uniform vec3 bgCenter;\n")+"uniform vec3 bgSize;\n"+"uniform float bgPrecisionMax;\n"),t.REQUIREBBOXNOR&&(o+="uniform float bgPrecisionNorMax;\n"),t.REQUIREBBOXCOL&&(o+="uniform float bgPrecisionColMax;\n"),t.REQUIREBBOXTEX&&(o+="uniform float bgPrecisionTexMax;\n"),o=(o=o+"void main(void) {\n"+"mat4 mat_mvp = modelViewProjectionMatrix;\n")+"mat4 mat_mv  = modelViewMatrix;\n"+"fragEyeIdx = eyeIdx;\n",(t.CUBEMAP||t.PBR_MATERIAL)&&(o+="mat4 mat_v   = viewMatrix;\n"),!t.LIGHTS&&!t.PBR_MATERIAL||t.NORMALMAP&&"OBJECT"==t.NORMALSPACE||(o+="mat4 mat_n   = normalMatrix;\n"),o=o+"if(eyeIdx == 1.0){\n"+"    mat_mvp = modelViewProjectionMatrix2;\n",(t.CUBEMAP||t.PBR_MATERIAL)&&(o+="    mat_v   = viewMatrix2;\n"),!t.LIGHTS&&!t.PBR_MATERIAL||t.NORMALMAP&&"OBJECT"==t.NORMALSPACE||(o+="mat4 mat_n   = normalMatrix2;\n"),o=o+"}\n"+"vec3 vertPosition = position.xyz;\n",t.POPGEOMETRY?o=(o=(o=(o=(o+="vec3 offsetVec = step(vertPosition / bgPrecisionMax, PG_bbMaxModF) * PG_bboxShiftVec;\n")+"if ((PG_precisionLevel <= 2.0) || PG_vertexID >= PG_numAnchorVertices) {\n"+"   vertPosition = floor(vertPosition / PG_powPrecision) * PG_powPrecision;\n")+"   vertPosition /= (65536.0 - PG_powPrecision);\n"+"}\n")+"else {\n"+"   vertPosition /= bgPrecisionMax;\n")+"}\n"+"vertPosition = (vertPosition + offsetVec + PG_bbMin) * PG_maxBBSize;\n":t.REQUIREBBOX&&(o+="vertPosition = bgCenter + bgSize * vertPosition / bgPrecisionMax;\n"),t.LIGHTS&&(2==t.NORCOMPONENTS?(4==t.POSCOMPONENTS?o=(o+="vec3 vertNormal = vec3(position.w / 256.0); \n")+"vertNormal.x = floor(vertNormal.x) / 255.0; \n"+"vertNormal.y = fract(vertNormal.y) * 1.00392156862745; \n":t.REQUIREBBOXNOR&&(o+="vec3 vertNormal = vec3(normal.xy, 0.0) / bgPrecisionNorMax;\n"),o=(o=(o+="vec2 thetaPhi = 3.14159265358979 * vec2(vertNormal.x, vertNormal.y*2.0-1.0); \n")+"vec4 sinCosThetaPhi = sin( vec4(thetaPhi, thetaPhi + 1.5707963267949) ); \n"+"vertNormal.x = sinCosThetaPhi.x * sinCosThetaPhi.w; \n")+"vertNormal.y = sinCosThetaPhi.x * sinCosThetaPhi.y; \n"+"vertNormal.z = sinCosThetaPhi.z; \n"):t.NORMALMAP&&"OBJECT"==t.NORMALSPACE||(o+="vec3 vertNormal = normal;\n",t.REQUIREBBOXNOR&&(o+="vertNormal = vertNormal / bgPrecisionNorMax;\n"),t.POPGEOMETRY&&(o+="vertNormal = 2.0*vertNormal - 1.0;\n"))),t.VERTEXCOLOR&&(o+="fragColor = color;\n",t.REQUIREBBOXCOL)&&(o+="fragColor = fragColor / bgPrecisionColMax;\n"),t.TEXTURED&&!t.SPHEREMAPPING&&(t.IS_PARTICLE||t.POINTPROPERTIES?o+="vec2 vertTexCoord = vec2(0.0);\n":(o+="vec2 vertTexCoord = texcoord;\n",t.MULTITEXCOORD&&(o+="vec2 vertTexCoord2 = texcoord2;\n"),t.REQUIREBBOXTEX&&(o+="vertTexCoord = vertTexCoord / bgPrecisionTexMax;\n"))),t.LIGHTS&&(!t.DISPLACEMENTMAP&&!t.DIFFPLACEMENTMAP||t.NORMALMAP?t.NORMALMAP&&"OBJECT"==t.NORMALSPACE||(o+="fragNormal = (mat_n * vec4(vertNormal, 0.0)).xyz;\n"):(o=o+"float dx = 1.0 / displacementWidth;\n"+"float dy = 1.0 / displacementHeight;\n",t.DISPLACEMENTMAP?o=(o=o+"float s1 = texture2D(displacementMap, vec2(vertTexCoord.x - dx, 1.0 - vertTexCoord.y)).r;\n"+"float s2 = texture2D(displacementMap, vec2(vertTexCoord.x, 1.0 - vertTexCoord.y - dy)).r;\n")+"float s3 = texture2D(displacementMap, vec2(vertTexCoord.x + dx, 1.0 - vertTexCoord.y)).r;\n"+"float s4 = texture2D(displacementMap, vec2(vertTexCoord.x, 1.0 - vertTexCoord.y + dy)).r;\n":t.DIFFPLACEMENTMAP&&(o=(o=o+"float s1 = texture2D(diffuseDisplacementMap, vec2(vertTexCoord.x - dx, 1.0 - vertTexCoord.y)).a;\n"+"float s2 = texture2D(diffuseDisplacementMap, vec2(vertTexCoord.x, 1.0 - vertTexCoord.y - dy)).a;\n")+"float s3 = texture2D(diffuseDisplacementMap, vec2(vertTexCoord.x + dx, 1.0 - vertTexCoord.y)).a;\n"+"float s4 = texture2D(diffuseDisplacementMap, vec2(vertTexCoord.x, 1.0 - vertTexCoord.y + dy)).a;\n"),o=(o=(o=(o=(o=(o+="float coef = displacementFactor;\n")+"vec3 calcNormal;\n"+"if (displacementAxis == 0.0) {\n")+"calcNormal = vec3((s1 - s3) * coef, -5.0, (s2 - s4) * coef);\n"+"} else if(displacementAxis == 1.0) {\n")+"calcNormal = vec3((s1 - s3) * coef, -5.0, (s2 - s4) * coef);\n"+"} else {\n")+"calcNormal = vec3((s1 - s3) * coef, -(s2 - s4) * coef, 5.0);\n"+"}\n")+"calcNormal = normalize(calcNormal);\n"+"fragNormal = (mat_n * vec4(calcNormal, 0.0)).xyz;\n")),(t.CUBEMAP||t.PBR_MATERIAL)&&(o+="fragViewDir = (mat_v[3].xyz);\n"),t.TEXTURED&&(t.SPHEREMAPPING?(o+=" fragTexcoord = 0.5 + fragNormal.xy / 2.0;\n",t.TEXTRAFO&&(o+=" fragTexcoord = (texTrafoMatrix * vec4(fragTexcoord, 1.0, 1.0)).xy;\n")):t.TEXTRAFO?o+=" fragTexcoord = (texTrafoMatrix * vec4(vertTexCoord, 1.0, 1.0)).xy;\n":(o+=" fragTexcoord = vertTexCoord;\n",t.MULTITEXCOORD&&(o+=" fragTexcoord2 = vertTexCoord2;\n"),t.POPGEOMETRY&&!0===x3dom.debug.usePrecisionLevelAsTexCoord&&(o+="fragTexcoord = vec2(0.03125 + 0.9375 * (PG_precisionLevel / 16.0), 1.0);")),t.NORMALMAP)&&"TANGENT"==t.NORMALSPACE&&t.TANGENTDATA&&(o=o+"fragTangent  = (mat_n * vec4(tangent, 0.0)).xyz;\n"+"fragBinormal = (mat_n * vec4(binormal, 0.0)).xyz;\n"),(t.LIGHTS||t.FOG||t.CLIPPLANES||t.POINTPROPERTIES)&&(o=o+"fragPosition = (mat_mv * vec4(vertPosition, 1.0));\n"+"fragPositionWS = (modelMatrix * vec4(vertPosition, 1.0));\n",t.FOG)&&(o+="fragEyePosition = eyePosition - fragPosition.xyz;\n"),t.DISPLACEMENTMAP?o+="vertPosition += normalize(vertNormal) * texture2D(displacementMap, vec2(fragTexcoord.x, 1.0-fragTexcoord.y)).r * displacementFactor;\n":t.DIFFPLACEMENTMAP&&(o+="vertPosition += normalize(vertNormal) * texture2D(diffuseDisplacementMap, vec2(fragTexcoord.x, 1.0-fragTexcoord.y)).a * displacementFactor;\n"),o=(o=(o=o+"gl_Position = mat_mvp * vec4(vertPosition, 1.0);\n"+"if(isVR == 1.0){\n")+"    vrOffset = eyeIdx * 0.5;\n"+"    gl_Position.x *= 0.5;\n")+"    gl_Position.x += vrOffset * gl_Position.w;\n"+"}\n",t.IS_PARTICLE?o=(o+="float spriteDist = (gl_Position.w > 0.000001) ? gl_Position.w : 0.000001;\n")+"float pointSize = floor(length(particleSize) * 256.0 / spriteDist + 0.5);\n"+"gl_PointSize = clamp(pointSize, 2.0, 256.0);\n":t.POINTPROPERTIES?o=(o=(o+="float r = length( fragPosition.xyz );\n")+"vec3 a = pointSizeAttenuation;\n"+"float attFactor = ( a.x + a.y * r + a.z * r * r );\n")+"float pointSize =  pointSizeFactor * 1.0 / attFactor;\n"+"gl_PointSize = clamp(pointSize, minPointSize, maxPointSize);\n":o+="gl_PointSize = 2.0;\n",o+="}\n",2==i&&(o=x3dom.shader.convertVertexShader(o)),e.createShader(e.VERTEX_SHADER));return e.shaderSource(t,o),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||(x3dom.debug.logInfo("VERTEX:\n"+o),x3dom.debug.logError("VertexShader "+e.getShaderInfoLog(t))),t},x3dom.shader.DynamicShader.prototype.generateFragmentShader=function(e,t,i){var o,s=(s="#ifdef GL_FRAGMENT_PRECISION_HIGH\n")+" precision highp float;\n#else\n precision mediump float;\n#endif\n\n";if(t.PBR_MATERIAL&&x3dom.caps.TEXTURE_LOD&&(s+="#extension GL_EXT_shader_texture_lod : enable\n"),(t.PBR_MATERIAL||t.NORMALMAP)&&x3dom.caps.STD_DERIVATIVES&&(s+="#extension GL_OES_standard_derivatives:enable\n"),s=(s=(s+="//@insertFragColor\nuniform float isVR;\nvarying float vrOffset;\nvarying float fragEyeIdx;\nuniform float screenWidth;\nuniform vec3 cameraPosWS;\nuniform float alphaCutoff;\n")+x3dom.shader.material())+x3dom.shader.toneMapping(),t.PBR_MATERIAL&&!x3dom.caps.TEXTURE_LOD&&1==x3dom.caps.WEBGL_VERSION&&(s+=x3dom.shader.calcMipLevel()),t.TWOSIDEDMAT&&(s+=x3dom.shader.twoSidedMaterial()),t.PBR_MATERIAL&&(t.ISROUGHNESSMETALLIC&&(s+="uniform float metallicFactor;\n"),s=(s+="uniform sampler2D brdfMap;\n")+"uniform samplerCube diffuseEnvironmentMap;\n"+"uniform samplerCube specularEnvironmentMap;\n"),t.VERTEXCOLOR&&(3==t.COLCOMPONENTS?s+="varying vec3 fragColor;  \n":4==t.COLCOMPONENTS&&(s+="varying vec4 fragColor;  \n")),(t.CUBEMAP||t.CLIPPLANES||t.PBR_MATERIAL)&&(s=(s=s+"uniform mat4 viewMatrixInverse;\n"+"uniform mat4 viewMatrixInverse2;\n")+"uniform mat4 modelViewMatrixInverse;\n"+"uniform mat4 modelViewMatrixInverse2;\n"),t.VERTEXID&&(s+="varying float fragID;\n"),t.TEXTURED&&(s+="varying vec2 fragTexcoord;\n",t.MULTITEXCOORD&&(s+="varying vec2 fragTexcoord2;\n"),(t.TEXTURED||t.DIFFUSEMAP)&&(s+="uniform sampler2D diffuseMap;\n"),(t.CUBEMAP||t.PBR_MATERIAL)&&(s=s+"uniform samplerCube environmentMap;\n"+"varying vec3 fragViewDir;\n",t.CSSHADER)&&(s+="uniform float environmentFactor;\n"),t.EMISSIVEMAP&&(s+="uniform sampler2D emissiveMap;\n"),t.OCCLUSIONMAP&&(s+="uniform sampler2D occlusionMap;\n"),t.ROUGHNESSMETALLICMAP&&(s+="uniform sampler2D roughnessMetallicMap;\n"),t.SPECULARGLOSSINESSMAP&&(s+="uniform sampler2D specularGlossinessMap;\n"),t.OCCLUSIONROUGHNESSMETALLICMAP&&(s+="uniform sampler2D occlusionRoughnessMetallicMap;\n"),t.SPECMAP&&(s+="uniform sampler2D specularMap;\n"),t.SHINMAP&&(s+="uniform sampler2D shininessMap;\n"),t.DISPLACEMENTMAP&&(s=(s+="uniform sampler2D displacementMap;\n")+"uniform float displacementWidth;\n"+"uniform float displacementHeight;\n"),t.DIFFPLACEMENTMAP&&(s=(s+="uniform sampler2D diffuseDisplacementMap;\n")+"uniform float displacementWidth;\n"+"uniform float displacementHeight;\n"),t.NORMALMAP)&&(s=s+"uniform sampler2D normalMap;\n"+"uniform vec3 normalBias;\n","TANGENT"==t.NORMALSPACE?x3dom.caps.STD_DERIVATIVES||2==x3dom.caps.WEBGL_VERSION?s+=x3dom.shader.TBNCalculation():s=s+"varying vec3 fragTangent;\n"+"varying vec3 fragBinormal;\n":"OBJECT"==t.NORMALSPACE&&(s=s+"uniform mat4 normalMatrix;\n"+"uniform mat4 normalMatrix2;\n")),t.FOG&&(s+=x3dom.shader.fog()),(t.LIGHTS||t.CLIPPLANES)&&(s=(s+="varying vec4 fragPosition;\n")+"varying vec4 fragPositionWS;\n"+"uniform float isOrthoView;\n"),t.LIGHTS&&(t.NORMALMAP&&"OBJECT"==t.NORMALSPACE||(s+="varying vec3 fragNormal;\n"),o=t.LIGHTS,t.PHYSICALENVLIGHT&&o--,t.PBR_MATERIAL&&o?s+=x3dom.shader.lightPBR(t.LIGHTS):o&&(s+=x3dom.shader.light(t.LIGHTS))),t.CLIPPLANES&&(s+=x3dom.shader.clipPlanes(t.CLIPPLANES)),s=s+x3dom.shader.gammaCorrectionDecl(t)+"void main(void) {\n",(t.CUBEMAP||t.CLIPPLANES||t.PBR_MATERIAL)&&(s=s+"mat4 mat_mvi = modelViewMatrixInverse;\n"+"mat4 mat_vi  = viewMatrixInverse;\n"),"OBJECT"==t.NORMALSPACE&&(s+="mat4 mat_n = normalMatrix;\n"),s+="if(fragEyeIdx == 1.0){\n",(t.CUBEMAP||t.CLIPPLANES)&&(s=s+"    mat_mvi   = modelViewMatrixInverse2;\n"+"    mat_vi    = viewMatrixInverse2;\n"),"OBJECT"==t.NORMALSPACE&&(s+="    mat_n   = normalMatrix2;\n"),s=(s=s+"}\n"+"if ( isVR == 1.0) {\n")+"    if ( ( step( 0.5, gl_FragCoord.x / screenWidth ) - 0.5 ) * vrOffset < 0.0 ) discard;\n"+"}\n",t.CLIPPLANES&&(s+="vec3 cappingColor = calculateClipPlanes();\n"),s=(s=(s=(s=(s=s+"vec4 color;\n"+"vec4 texColor;\n")+"color.rgb = diffuseColor;\n"+"color.a = 1.0 - transparency;\n")+"vec3 _emissiveColor     = emissiveColor;\n"+"float _shininess        = shininess;\n")+"vec3 _specularColor     = specularColor;\n"+"float _ambientIntensity = ambientIntensity;\n")+"float _transparency     = transparency;\n"+"float _occlusion        = 1.0;\n","OPAQUE"==t.ALPHAMODE&&(s+="color.a = 1.0;\n"),t.PBR_MATERIAL&&t.ISROUGHNESSMETALLIC&&(s+="float _metallic         = metallicFactor;\n"),t.SEPARATEBACKMAT&&(s=(s=(s=(s=(s+="  if(!gl_FrontFacing) {\n")+"    color.rgb = backDiffuseColor;\n"+"    color.a = 1.0 - backTransparency;\n")+"    _transparency = 1.0 - backTransparency;\n"+"    _shininess = backShininess;\n")+"    _emissiveColor = backEmissiveColor;\n"+"    _specularColor = backSpecularColor;\n")+"    _ambientIntensity = backAmbientIntensity;\n"+"  }\n"),t.VERTEXCOLOR&&(3!==t.COLCOMPONENTS&&"OPAQUE"!=t.ALPHAMODE||!t.PBR_MATERIAL?3!==t.COLCOMPONENTS||t.PBR_MATERIAL?4===t.COLCOMPONENTS&&t.PBR_MATERIAL?s+="color *= fragColor;\n":4!==t.COLCOMPONENTS||t.PBR_MATERIAL||(s+="color = fragColor;\n"):s+="color.rgb = fragColor.rgb;\n":s+="color.rgb *= fragColor.rgb;\n"),t.IS_PARTICLE||t.POINTPROPERTIES?(s+="vec2 texcoord = clamp(gl_PointCoord, 0.01, 0.99);\n",t.MULTITEXCOORD&&(s+="vec2 texcoord2 = texcoord;\n")):t.TEXTURED&&(s+="vec2 texcoord = fragTexcoord;\n",t.MULTITEXCOORD)&&(s+="vec2 texcoord2 = fragTexcoord2;\n"),t.UNLIT)t.DIFFUSEMAP&&(t.DIFFUSEMAPCHANNEL?s+="texColor = "+x3dom.shader.decodeGamma(t,"texture2D(diffuseMap, vec2(texcoord2.x, 1.0 - texcoord2.y))")+";\n":s+="texColor = "+x3dom.shader.decodeGamma(t,"texture2D(diffuseMap, vec2(texcoord.x, 1.0 - texcoord.y))")+";\n","OPAQUE"==t.ALPHAMODE&&(s+="texColor.a = 1.0;\n"),s+="color *= texColor;\n");else if(t.LIGHTS){if(s=(s=(s=(s=(s=s+"vec3 ambient   = vec3(0.0, 0.0, 0.0);\n"+"vec3 diffuse   = vec3(0.0, 0.0, 0.0);\n")+"vec3 specular  = vec3(0.0, 0.0, 0.0);\n"+"vec3 eye;\n")+"vec3 positionVS = fragPosition.rgb;\n"+"if ( isOrthoView > 0.0 ) {\n")+"    eye = vec3(0.0, 0.0, 1.0);\n"+"} else {\n")+"    eye = -fragPosition.xyz;\n"+"}\n",t.NORMALMAP&&(s+="vec3 _normalBias = normalBias;\n"),t.NORMALMAP&&"OBJECT"==t.NORMALSPACE?s+="vec3 normal = vec3(0.0, 0.0, 0.0);\n":s+="vec3 normal = normalize(fragNormal);\n",t.SOLID&&!t.TWOSIDEDMAT||(s=s+"if (dot(normalize(fragNormal), eye) < 0.0) {\n"+"  normal *= -1.0;\n",t.NORMALMAP&&(s+="  _normalBias = _normalBias * _normalBias;\n"),s+="}\n"),t.TEXTURED&&(t.NORMALMAP&&("TANGENT"==t.NORMALSPACE?(s+="vec3 n = normal;\n",t.TANGENTDATA||!x3dom.caps.STD_DERIVATIVES&&2!=x3dom.caps.WEBGL_VERSION?s=(s=(s=s+"vec3 t = normalize( fragTangent );\n"+"vec3 b = normalize( fragBinormal );\n")+"mat3 tangentToWorld = mat3(t, b, n);\n"+"normal = texture2D( normalMap, vec2(texcoord.x, 1.0-texcoord.y) ).rgb;\n")+"normal = 2.0 * normal - 1.0;\n"+"normal = normalize( normal * tangentToWorld );\n":s+="normal = perturb_normal( n, fragPosition.xyz, vec2(texcoord.x, 1.0 - texcoord.y), _normalBias);\n"):"OBJECT"==t.NORMALSPACE&&(s=(s=s+"normal = texture2D( normalMap, vec2(texcoord.x, 1.0-texcoord.y) ).rgb;\n"+"normal = 2.0 * normal - 1.0;\n")+"normal = (mat_n * vec4(normal, 0.0)).xyz;\n"+"normal = normalize(normal);\n")),t.CUBEMAP?s=(s=(s+="vec3 viewDir = normalize(fragViewDir);\n")+"vec3 reflected = reflect(-eye, normal);\n"+"reflected = (mat_mvi * vec4(reflected, 0.0)).xyz;\n")+("texColor = "+x3dom.shader.decodeGamma(t,"textureCube(environmentMap, reflected)")+";\n"):t.DIFFPLACEMENTMAP?s+="texColor = texture2D(diffuseDisplacementMap, vec2(texcoord.x, 1.0-texcoord.y));\n":(t.DIFFUSEMAP||t.TEXT)&&(t.PIXELTEX?t.DIFFUSEMAPCHANNEL?s+="texColor = "+x3dom.shader.decodeGamma(t,"texture2D(diffuseMap, texcoord2)")+";\n":s+="texColor = "+x3dom.shader.decodeGamma(t,"texture2D(diffuseMap, texcoord)")+";\n":t.DIFFUSEMAPCHANNEL?s+="texColor = "+x3dom.shader.decodeGamma(t,"texture2D(diffuseMap, vec2(texcoord2.x, 1.0 - texcoord2.y))")+";\n":s+="texColor = "+x3dom.shader.decodeGamma(t,"texture2D(diffuseMap, vec2(texcoord.x, 1.0 - texcoord.y))")+";\n"),"OPAQUE"==t.ALPHAMODE&&(s+="texColor.a = 1.0;\n"),t.BLENDING&&(t.DIFFUSEMAP||t.TEXT||t.DIFFPLACEMENTMAP||t.CUBEMAP)?t.CUBEMAP&&t.CSSHADER?s+="color.rgb *= mix(vec3(1.0,1.0,1.0), texColor.rgb, environmentFactor);\n":s+="color *= texColor;\n":!t.BLENDING&&(t.DIFFUSEMAP||t.TEXT||t.DIFFPLACEMENTMAP||t.CUBEMAP)&&(s+="color = texColor;\n"),t.SHINMAP&&(s+="_shininess *= texture2D( shininessMap, vec2(texcoord.x, 1.0-texcoord.y) ).r;\n"),t.SPECMAP&&(s+="_specularColor = texture2D(specularMap, vec2(texcoord.x, 1.0-texcoord.y)).rgb;\n"),t.EMISSIVEMAP&&(t.EMISSIVEMAPCHANNEL?s+="_emissiveColor = _emissiveColor * texture2D(emissiveMap, vec2(texcoord2.x, 1.0-texcoord2.y)).rgb;\n":s+="_emissiveColor = _emissiveColor * texture2D(emissiveMap, vec2(texcoord.x, 1.0-texcoord.y)).rgb;\n"),t.ROUGHNESSMETALLICMAP&&(t.ROUGHNESSMETALLICMAPCHANNEL?s+="vec3 roughnessMetallic = texture2D(roughnessMetallicMap, vec2(texcoord2.x, 1.0-texcoord2.y)).rgb;\n":s+="vec3 roughnessMetallic = texture2D(roughnessMetallicMap, vec2(texcoord.x, 1.0-texcoord.y)).rgb;\n",s=s+"_shininess = 1.0 - (roughnessMetallic.g * (1.0 - _shininess));\n"+"_metallic  = roughnessMetallic.b * metallicFactor;\n"),t.SPECULARGLOSSINESSMAP&&(t.SPECULARGLOSSINESSMAPCHANNEL?s+="vec4 specularGlossiness = "+x3dom.shader.decodeGamma(t,"texture2D(specularGlossinessMap, vec2(texcoord2.x, 1.0 - texcoord2.y))")+";\n":s+="vec4 specularGlossiness = "+x3dom.shader.decodeGamma(t,"texture2D(specularGlossinessMap, vec2(texcoord.x, 1.0 - texcoord.y))")+";\n",s+="_shininess = specularGlossiness.a * _shininess;\n"),t.OCCLUSIONROUGHNESSMETALLICMAP&&(t.OCCLUSIONROUGHNESSMETALLICMAPCHANNEL?s+="vec3 occlusionRoughnessMetallic = texture2D(occlusionRoughnessMetallicMap, vec2(texcoord2.x, 1.0-texcoord2.y)).rgb;\n":s+="vec3 occlusionRoughnessMetallic = texture2D(occlusionRoughnessMetallicMap, vec2(texcoord.x, 1.0-texcoord.y)).rgb;\n",s=(s+="_occlusion = occlusionRoughnessMetallic.r;\n")+"_shininess = 1.0 - occlusionRoughnessMetallic.g;\n"+"_metallic  = occlusionRoughnessMetallic.b;\n"),t.OCCLUSIONMAP)&&(t.OCCLUSIONMAPCHANNEL?s+="_occlusion = texture2D(occlusionMap, vec2(texcoord2.x, 1.0-texcoord2.y)).r;\n":s+="_occlusion = texture2D(occlusionMap, vec2(texcoord.x, 1.0-texcoord.y)).r;\n"),t.PBR_MATERIAL&&t.ISROUGHNESSMETALLIC?s=s+"_specularColor = mix(vec3(0.04, 0.04, 0.04), color.rgb, _metallic);\n"+"color.rgb *= (1.0 - _metallic);\n":t.PBR_MATERIAL&&t.SPECULARGLOSSINESSMAP&&(s+="_specularColor = specularGlossiness.rgb * _specularColor;\n"),o){for(var n=0;n<o;n++)s+=" lighting(light"+n+"_Type, light"+n+"_Location, light"+n+"_Direction, light"+n+"_Color, light"+n+"_Attenuation, light"+n+"_Radius, light"+n+"_Intensity, light"+n+"_AmbientIntensity, light"+n+"_BeamWidth, light"+n+"_CutOffAngle, positionVS, normal, eye, _shininess, _ambientIntensity, _specularColor, ambient, diffuse, specular);\n";s=(s+="ambient = max(ambient, 0.0);\n")+"diffuse = max(diffuse, 0.0);\n"+"specular = max(specular, 0.0);\n"}t.PBR_MATERIAL&&t.PHYSICALENVLIGHT&&(s=(s=(s=(s=s+"float camDistance = length(cameraPosWS.xyz - fragPositionWS.xyz);\n"+"vec3 N = (mat_vi * vec4(normal, 0.0)).rgb;\n")+"vec3 V = normalize ( cameraPosWS.xyz - fragPositionWS.xyz );\n"+"vec3 R = normalize( reflect ( -V, N ) );\n")+"float roughness  =  1.0 - _shininess;\n"+"float NoV = clamp(dot( N, V ), 0.0, 1.0);\n")+"float lod = roughness * 6.0;"+"diffuse = textureCube( diffuseEnvironmentMap, N ).rgb;\n",x3dom.caps.TEXTURE_LOD||2==x3dom.caps.WEBGL_VERSION?s+="specular = textureCubeLodEXT( specularEnvironmentMap, R, lod ).rgb;\n":s=(s+="float level = calcMipLevel(dirToCubeUV(R));\n")+"float bias  = lod - level;\n"+"specular    = textureCube( specularEnvironmentMap, R, bias ).rgb;\n",s=s+"vec3 brdf      = texture2D( brdfMap, vec2( NoV, roughness ) ).rgb;\n"+"_specularColor = ( _specularColor * brdf.x + brdf.y );\n"),s+="color.rgb = _emissiveColor + ((ambient + diffuse) * color.rgb + specular * _specularColor) * _occlusion;\n",(t.IS_PARTICLE||t.POINTPROPERTIES)&&(t.TEXTURED?s+="if (color.a < 0.01 ) discard;\n":s=s+"float pAlpha = 1.0 - clamp(length((gl_PointCoord - 0.5) * 2.0), 0.0, 1.0);\n"+"if ( pAlpha < 0.01 ) discard;\n")}else!t.APPMAT||t.VERTEXCOLOR||t.TEXTURED||t.PBR_MATERIAL||(s+="color = vec4(0.0, 0.0, 0.0, 1.0 - _transparency);\n"),t.TEXTURED&&(t.DIFFUSEMAP||t.DIFFPLACEMENTMAP||t.TEXT)?(t.PIXELTEX?t.IS_PARTICLE||t.POINTPROPERTIES?s+="vec2 texCoord = clamp(gl_PointCoord, 0.01, 0.99);\n":s+="vec2 texCoord = fragTexcoord;\n":t.IS_PARTICLE||t.POINTPROPERTIES?s=s+"vec2 texCoord = clamp(gl_PointCoord, 0.01, 0.99);\n"+"texCoord.y = 1.0 - texCoord.y;\n":s+="vec2 texCoord = vec2(fragTexcoord.x, 1.0-fragTexcoord.y);\n",s=s+("texColor = "+x3dom.shader.decodeGamma(t,"texture2D(diffuseMap, texCoord)")+";\n")+"color.a = texColor.a;\n",t.BLENDING||t.IS_PARTICLE||t.POINTPROPERTIES?s=(s+="if (color.a < 0.01 ) discard;\n")+"color.rgb += _emissiveColor.rgb;\n"+"color.rgb *= texColor.rgb;\n":s+="color = texColor;\n"):t.VERTEXCOLOR||t.PBR_MATERIAL||t.POINTLINE2D?(t.VERTEXCOLOR||t.PBR_MATERIAL||!t.POINTLINE2D||(s+="color.rgb = _emissiveColor;\n"),t.IS_PARTICLE?s=(s+="float pAlpha = 1.0 - clamp(length((gl_PointCoord - 0.5) * 2.0), 0.0, 1.0);\n")+"color.rgb *= vec3(pAlpha);\n"+"color.a = pAlpha;\n":t.POINTPROPERTIES&&!t.TEXTURED&&(s=s+"float pAlpha = 1.0 - clamp(length((gl_PointCoord - 0.5) * 2.0), 0.0, 1.0);\n"+"if ( pAlpha < 0.01 ) discard;\n")):s+="color.rgb += _emissiveColor;\n";t.CLIPPLANES&&(s=(s+="if (cappingColor.r != -1.0) {\n")+"    color.rgb = cappingColor;\n"+"}\n"),t.TEXT?s+="if (color.a < (1.0 - _transparency) * 0.5) discard;\n":t.ALPHAMASK?s=s+"if (color.a < alphaCutoff) discard;\n"+"color.a = 1.0;\n":0<+t.ALPHATHRESHOLD&&(s+="if (color.a <= alphaCutoff) discard;\n"),s=(s+="if(tonemappingOperator == 1.0) {\n       color.rgb = tonemapReinhard(color.rgb);\n    }\n    if(tonemappingOperator == 2.0) {\n       color.rgb = tonemapUncharted2(color.rgb);\n    }\n    if(tonemappingOperator == 3.0) {\n       color.rgb = tonemapeFilmic(color.rgb);\n    }\n")+"color = "+x3dom.shader.encodeGamma(t,"color")+";\n",s=(t.FOG&&!t.SHADOW?s+"float f0 = calcFog(fragEyePosition);\ncolor.rgb = fogColor * (1.0-f0) + f0 * (color.rgb);\n":s)+"gl_FragColor = color;\n}\n",2==i&&(s=x3dom.shader.convertFragmentShader(s));t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,s),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||(x3dom.debug.logInfo("FRAGMENT:\n"+s),x3dom.debug.logError("FragmentShader "+e.getShaderInfoLog(t))),t},x3dom.shader.DynamicShaderPicking=function(e,t,i){this.program=e.createProgram();var o=this.generateVertexShader(e,t,i),t=this.generateFragmentShader(e,t,i);return e.attachShader(this.program,o),e.attachShader(this.program,t),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.DynamicShaderPicking.prototype.generateVertexShader=function(e,t,i){var o="",i=(o=(o=(o=(o=(o=(o+="uniform mat4 modelMatrix;\n")+"uniform mat4 modelViewProjectionMatrix;\n"+"uniform mat4 modelMatrix2;\n")+"uniform mat4 modelViewProjectionMatrix2;\n"+"uniform float isVR;\n")+"attribute float eyeIdx;\n"+"varying float vrOffset;\n")+"varying float fragEyeIdx;\n"+"attribute vec3 position;\n")+"uniform vec3 from;\n"+"varying vec3 worldCoord;\n",1==i?o=o+"attribute vec3 color;\n"+"varying vec3 fragColor;\n":2==i&&(o=o+"attribute vec2 texcoord;\n"+"varying vec3 fragColor;\n"),t.REQUIREBBOX&&(o=(o+="uniform vec3 bgCenter;\n")+"uniform vec3 bgSize;\n"+"uniform float bgPrecisionMax;\n"),t.REQUIREBBOXCOL&&(o+="uniform float bgPrecisionColMax;\n"),t.REQUIREBBOXTEX&&(o+="uniform float bgPrecisionTexMax;\n"),t.VERTEXID&&(o=(o=o+"uniform float shadowIDs;\n"+(3==i?"varying vec3 idCoord;\n":"varying vec2 idCoord;\n"))+"varying float fragID;\n"+"attribute float id;\n"),t.POPGEOMETRY&&(o=(o=(o=(o=o+"uniform float PG_precisionLevel;\n"+"uniform float PG_powPrecision;\n")+"uniform vec3 PG_maxBBSize;\n"+"uniform vec3 PG_bbMin;\n")+"uniform vec3 PG_bbMaxModF;\n"+"uniform vec3 PG_bboxShiftVec;\n")+"uniform float PG_numAnchorVertices;\n"+"attribute float PG_vertexID;\n"),t.IS_PARTICLE&&(o+="attribute vec3 particleSize;\n"),t.POINTPROPERTIES&&(o=(o=o+"uniform vec3 pointSizeAttenuation;\n"+"uniform float pointSizeFactor;\n")+"uniform float minPointSize;\n"+"uniform float maxPointSize;\n"),(t.CLIPPLANES||t.POINTPROPERTIES)&&(o=(o=(o+="uniform mat4 modelViewMatrix;\n")+"uniform mat4 modelViewMatrix2;\n"+"uniform vec3 eyePosition;\n")+"varying vec4 fragPosition;\n"+"varying vec4 fragPositionWS;\n"),o=(o+="void main(void) {\n")+"fragEyeIdx = eyeIdx;\n"+"vec3 pos = position;\n",t.VERTEXID&&(0==i?o=(o=o+"idCoord = vec2((id + shadowIDs) / 256.0);\n"+"idCoord.x = floor(idCoord.x) / 255.0;\n")+"idCoord.y = fract(idCoord.y) * 1.00392156862745;\n"+"fragID = id;\n":3==i?o=(o=(o=(o+="float ID = id + shadowIDs;\n")+"float h = floor(ID / 256.0);\n"+"idCoord.x = ID - (h * 256.0);\n")+"idCoord.z = floor(h / 256.0);\n"+"idCoord.y = h - (idCoord.z * 256.0);\n")+"idCoord = idCoord.zyx / 255.0;\n"+"fragID = id;\n":4==i&&(o=(o=o+"idCoord = vec2((id + shadowIDs) / 256.0);\n"+"idCoord.x = floor(idCoord.x) / 255.0;\n")+"idCoord.y = fract(idCoord.y) * 1.00392156862745;\n"+"fragID = id;\n")),t.POPGEOMETRY?o=(o=(o=(o=(o+="vec3 offsetVec = step(pos / bgPrecisionMax, PG_bbMaxModF) * PG_bboxShiftVec;\n")+"if (PG_precisionLevel <= 2.0) {\n"+"pos = floor(pos / PG_powPrecision) * PG_powPrecision;\n")+"pos /= (65536.0 - PG_powPrecision);\n"+"}\n")+"else {\n"+"pos /= bgPrecisionMax;\n")+"}\n"+"pos = (pos + offsetVec + PG_bbMin) * PG_maxBBSize;\n":(t.REQUIREBBOX&&(o+="pos = bgCenter + bgSize * pos / bgPrecisionMax;\n"),1!=i||t.REQUIREBBOXCOL?1==i&&t.REQUIREBBOXCOL?o+="fragColor = color / bgPrecisionColMax;\n":2!=i||t.REQUIREBBOXTEX?2==i&&t.REQUIREBBOXTEX&&(o=o+"vec2 texCoord = texcoord / bgPrecisionTexMax;\n"+"fragColor = vec3(abs(texCoord.x), abs(texCoord.y), 0.0);\n"):o+="fragColor = vec3(abs(texcoord.x), abs(texcoord.y), 0.0);\n":o+="fragColor = color;\n"),(t.CLIPPLANES||t.POINTPROPERTIES)&&(o=(o=(o+="if(eyeIdx == 1.0){\n")+"    fragPosition = (modelViewMatrix2 * vec4(pos, 1.0));\n"+"}else{\n")+"    fragPosition = (modelViewMatrix * vec4(pos, 1.0));\n"+"}\n"),t.IS_PARTICLE?o=(o+="float spriteDist = (gl_Position.w > 0.000001) ? gl_Position.w : 0.000001;\n")+"float pointSize = floor(length(particleSize) * 256.0 / spriteDist + 0.5);\n"+"gl_PointSize = clamp(pointSize, 2.0, 256.0);\n":t.POINTPROPERTIES?o=(o=(o+="float r = length( fragPosition.xyz );\n")+"vec3 a = pointSizeAttenuation;\n"+"float attFactor = ( a.x + a.y * r + a.z * r * r );\n")+"float pointSize =  pointSizeFactor * 1.0 / attFactor;\n"+"gl_PointSize = clamp(pointSize, minPointSize, maxPointSize);\n":o+="gl_PointSize = 2.0;\n",o=(o=(o=(o=(o=(o=o+"worldCoord = (modelMatrix * vec4(pos, 1.0)).xyz - from;\n"+"if(eyeIdx == 1.0){\n")+"    gl_Position = modelViewProjectionMatrix2 * vec4(pos, 1.0);\n"+"}else{\n")+"    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n"+"}\n")+"if(isVR == 1.0){\n"+"    vrOffset = eyeIdx * 0.5;\n")+"    gl_Position.x *= 0.5;\n"+"    gl_Position.x += vrOffset * gl_Position.w;\n")+"}\n"+"}\n",e.createShader(e.VERTEX_SHADER));return e.shaderSource(i,o),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||(x3dom.debug.logInfo("VERTEX:\n"+o),x3dom.debug.logError("VertexShader "+e.getShaderInfoLog(i))),i},x3dom.shader.DynamicShaderPicking.prototype.generateFragmentShader=function(e,t,i){var o="#ifdef GL_FRAGMENT_PRECISION_HIGH\n",i=(o=(o=(o=(o=(o=(o=o+" precision highp float;\n"+"#else\n")+" precision mediump float;\n"+"#endif\n\n")+"uniform float highBit;\n"+"uniform float lowBit;\n")+"uniform float sceneSize;\n"+"varying vec3 worldCoord;\n")+"uniform float isVR;\n"+"varying float vrOffset;\n")+"varying float fragEyeIdx;\n"+"uniform float screenWidth;\n",1!=i&&2!=i||(o+="varying vec3 fragColor;\n"),t.VERTEXID&&(o=o+(3==i?"varying vec3 idCoord;\n":"varying vec2 idCoord;\n")+"varying float fragID;\n"),t.CLIPPLANES&&(o=(o+="uniform mat4 viewMatrixInverse;\n")+"uniform mat4 viewMatrixInverse2;\n"+"varying vec4 fragPosition;\n"),t.CLIPPLANES&&(o+=x3dom.shader.clipPlanes(t.CLIPPLANES)),o=(o=o+"void main(void) {\n"+"if ( isVR == 1.0) {\n")+"    if ( ( step( 0.5, gl_FragCoord.x / screenWidth ) - 0.5 ) * vrOffset < 0.0 ) discard;\n"+"}\n",t.CLIPPLANES&&(o+="calculateClipPlanes();\n"),o+=1==i||2==i?"vec4 color = vec4(fragColor, lowBit);\n":4==i?"vec4 color = vec4(highBit, lowBit, 0.0, 0.0);\n":"vec4 color = vec4(0.0, 0.0, highBit, lowBit);\n",t.VERTEXID&&(0==i||4==i?o+="color.ba = idCoord;\n":3==i&&(o+="color.gba = idCoord;\n")),1!=i&&2!=i&&(o+="float d = length(worldCoord) / sceneSize;\n"),0==i?o=o+"vec2 comp = fract(d * vec2(256.0, 1.0));\n"+"color.rg = comp - (comp.rr * vec2(0.0, 1.0/256.0));\n":3==i&&(o+="color.r = d;\n"),o=(o=!t.POINTPROPERTIES&&!t.IS_PARTICLE||t.TEXTURED?o:o+"float pAlpha = 1.0 - clamp(length((gl_PointCoord - 0.5) * 2.0), 0.0, 1.0);\n"+"if ( pAlpha < 0.01 ) discard;\n")+"gl_FragColor = color;\n"+"}\n",e.createShader(e.FRAGMENT_SHADER));return e.shaderSource(i,o),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||(x3dom.debug.logInfo("FRAGMENT:\n"+o),x3dom.debug.logError("FragmentShader "+e.getShaderInfoLog(i))),i},x3dom.shader.DynamicShadowShader=function(e,t){this.program=e.createProgram();var i=this.generateVertexShader(e,t),t=this.generateFragmentShader(e,t);return e.attachShader(this.program,i),e.attachShader(this.program,t),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.DynamicShadowShader.prototype.generateVertexShader=function(e,t){var i="",t=(i=(i+="attribute vec3 position;\n")+"uniform mat4 modelViewProjectionMatrix;\n"+"varying vec4 projCoords;\n",t.VERTEXID&&(i=i+"varying float fragID;\n"+"attribute float id;\n"),t.REQUIREBBOX&&(i=(i+="uniform vec3 bgCenter;\n")+"uniform vec3 bgSize;\n"+"uniform float bgPrecisionMax;\n"),t.POPGEOMETRY&&(i=(i=(i=(i=i+"uniform float PG_precisionLevel;\n"+"uniform float PG_powPrecision;\n")+"uniform vec3 PG_maxBBSize;\n"+"uniform vec3 PG_bbMin;\n")+"uniform vec3 PG_bbMaxModF;\n"+"uniform vec3 PG_bboxShiftVec;\n")+"uniform float PG_numAnchorVertices;\n"+"attribute float PG_vertexID;\n"),i=(i=t.CLIPPLANES?i+"uniform mat4 modelViewMatrix;\n"+"varying vec4 fragPosition;\n":i)+"void main(void) {\n"+"    vec3 pos = position;\n",t.POPGEOMETRY?i=(i=(i=(i=(i+="    vec3 offsetVec = step(pos / bgPrecisionMax, PG_bbMaxModF) * PG_bboxShiftVec;\n")+"    if (PG_precisionLevel <= 2.0) {\n"+"        pos = floor(pos / PG_powPrecision) * PG_powPrecision;\n")+"        pos /= (65536.0 - PG_powPrecision);\n"+"    }\n")+"    else {\n"+"        pos /= bgPrecisionMax;\n")+"    }\n"+"    pos = (pos + offsetVec + PG_bbMin) * PG_maxBBSize;\n":t.REQUIREBBOX&&(i+="    pos = bgCenter + bgSize * pos / bgPrecisionMax;\n"),t.VERTEXID&&(i+="    fragID = id;\n"),t.CLIPPLANES&&(i+="    fragPosition = (modelViewMatrix * vec4(pos, 1.0));\n"),i=(i+="    projCoords = modelViewProjectionMatrix * vec4(pos, 1.0);\n")+"    gl_Position = projCoords;\n"+"}\n",e.createShader(e.VERTEX_SHADER));return e.shaderSource(t,i),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[ShadowShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.DynamicShadowShader.prototype.generateFragmentShader=function(e,t){var i="",t=(i=(i=(i=(i=i+"#ifdef GL_FRAGMENT_PRECISION_HIGH\n"+"    precision highp float;\n")+"#else\n"+"    precision mediump float;\n")+"#endif\n\n"+"varying vec4 projCoords;\n")+"uniform float offset;\n"+"uniform bool cameraView;\n",t.VERTEXID&&(i+="varying float fragID;\n"),t.CLIPPLANES&&(i=(i=i+"uniform mat4 viewMatrixInverse;\n"+"varying vec4 fragPosition;\n")+x3dom.shader.clipPlanes(t.CLIPPLANES)),x3dom.caps.FP_TEXTURES||(i+=x3dom.shader.rgbaPacking()),i+="void main(void) {\n",t.CLIPPLANES&&(i+="calculateClipPlanes();\n"),i+="    vec3 proj = (projCoords.xyz / projCoords.w);\n",x3dom.caps.FP_TEXTURES?i=(i=(i+="       if (!cameraView){\n")+"           proj.z = (proj.z + 1.0)*0.5;\n"+"           proj.y = proj.z * proj.z;\n")+"       }\n"+"    gl_FragColor = vec4(proj, 1.0);\n":i+="    gl_FragColor = packDepth(proj.z);\n",i+="}\n",e.createShader(e.FRAGMENT_SHADER));return e.shaderSource(t,i),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[ShadowShader] FragmentShader "+e.getShaderInfoLog(t)),t},x3dom.shader.ComposedShader=function(e,t){this.program=e.createProgram();var i=this.generateVertexShader(e,t),t=this.generateFragmentShader(e,t);return e.attachShader(this.program,i),e.attachShader(this.program,t),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.ComposedShader.prototype.generateVertexShader=function(e,t){var t=t._cf.appearance.node._shader._vertex._vf.url[0],t=this.injectVRPartsVS(t),i=e.createShader(e.VERTEX_SHADER);return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||x3dom.debug.logError("[ComposedShader] VertexShader "+e.getShaderInfoLog(i)),i},x3dom.shader.ComposedShader.prototype.generateFragmentShader=function(e,t){var t=t._cf.appearance.node._shader._fragment._vf.url[0],t=this.injectVRPartsFS(t),i=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||x3dom.debug.logError("[ComposedShader] FragmentShader "+e.getShaderInfoLog(i)),i},x3dom.shader.ComposedShader.prototype.injectVRPartsVS=function(e){e=this.extractShaderSections(e);return e.before+"attribute float eyeIdx;\nuniform   float isVR;\nuniform   mat4  modelViewProjectionMatrix2;\nuniform   mat4  modelViewProjectionInverseMatrix;\nvarying   float vrOffset;\nvarying   float fragEyeIdx;\n"+e.mainStart+e.main+"fragEyeIdx = eyeIdx;\nif(isVR == 1.0)\n{\n    vec4 webVRPos = modelViewProjectionInverseMatrix * gl_Position;\n    webVRPos.xyz = webVRPos.xyz / webVRPos.w;\n    if(fragEyeIdx == 1.0) {\n        gl_Position = modelViewProjectionMatrix2 * webVRPos;\n    } else {\n        gl_Position = modelViewProjectionMatrix  * webVRPos;\n    }\n    vrOffset = fragEyeIdx * 0.5;\n    gl_Position.x *= 0.5;\n    gl_Position.x += vrOffset * gl_Position.w;\n}"+e.mainEnd},x3dom.shader.ComposedShader.prototype.injectVRPartsFS=function(e){e=this.extractShaderSections(e);return e.before+"uniform   float isVR;\nuniform   float screenWidth;\nvarying   float vrOffset;\nvarying   float fragEyeIdx;\n"+e.mainStart+"if ( isVR == 1.0) {\n    if ( ( step( 0.5, gl_FragCoord.x / screenWidth ) - 0.5 ) * vrOffset < 0.0 ) discard;\n}\n"+e.main+e.mainEnd},x3dom.shader.ComposedShader.prototype.extractShaderSections=function(e){var t=/void\s*main\s*\(\s*(?:void)?\s*\)\s*{[\s\S]*}/.exec(e),i=t[0].indexOf("{")+t.index+1,o=t[0].lastIndexOf("}")+t.index;return{before:e.substring(0,t.index),mainStart:e.substring(t.index,i),main:e.substring(i,o),mainEnd:e.substring(o,e.length)}},x3dom.shader.NormalShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.NormalShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec3 position;\nattribute vec3 normal;\nuniform vec3 bgCenter;\nuniform vec3 bgSize;\nuniform float bgPrecisionMax;\nuniform float bgPrecisionNorMax;\nuniform mat4 normalMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvarying vec3 fragNormal;\nvoid main(void) {\n    vec3 pos = bgCenter + bgSize * position / bgPrecisionMax;\n    fragNormal = (normalMatrix * vec4(normal / bgPrecisionNorMax, 0.0)).xyz;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[NormalShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.NormalShader.prototype.generateFragmentShader=function(e){var t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\n precision mediump float;\n#endif\n\nvarying vec3 fragNormal;\nvoid main(void) {\n    gl_FragColor = vec4(normalize(fragNormal) / 2.0 + 0.5, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[NormalShader] FragmentShader "+e.getShaderInfoLog(t)),t},x3dom.shader.FrontgroundTextureShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.FrontgroundTextureShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec3 position;\nvarying vec2 fragTexCoord;\n\nvoid main(void) {\n    vec2 texCoord = (position.xy + 1.0) * 0.5;\n    fragTexCoord = texCoord;\n    gl_Position = vec4(position.xy, 0.0, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[FrontgroundTextureShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.FrontgroundTextureShader.prototype.generateFragmentShader=function(e){var t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\n precision mediump float;\n#endif\n\nuniform sampler2D tex;\nvarying vec2 fragTexCoord;\n\nvoid main(void) {\n    vec4 col = texture2D(tex, fragTexCoord);\n    gl_FragColor = vec4(col.rgb, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[FrontgroundTextureShader] FragmentShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BackgroundTextureShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.BackgroundTextureShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec3 position;\nvarying vec2 fragTexCoord;\nuniform vec2 scale;\nuniform vec2 translation;\nuniform float isVR;\nattribute float eyeIdx;\nvarying float vrOffset;\nvarying float fragEyeIdx;\n\nvoid main(void) {\n   vec2 texCoord = (position.xy + 1.0) * 0.5;\n   fragTexCoord = texCoord * scale + translation;\n    fragEyeIdx = eyeIdx;\n   gl_Position = vec4(position.xy, 0.0, 1.0);\n    if(isVR == 1.0){\n        vrOffset = eyeIdx * 0.5;\n        gl_Position.x *= 0.5;\n        gl_Position.x += vrOffset * gl_Position.w;\n    }\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[BackgroundTextureShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BackgroundTextureShader.prototype.generateFragmentShader=function(e){var t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\n precision mediump float;\n#endif\n\nuniform float isVR;\nvarying float vrOffset;\nvarying float fragEyeIdx;\nuniform float screenWidth;\nuniform sampler2D tex;\nvarying vec2 fragTexCoord;\n\nvoid main(void) {\n       if ( isVR == 1.0 ) {\n        if ( ( step( 0.5, gl_FragCoord.x / screenWidth ) - 0.5 ) * vrOffset < 0.0 ) discard;\n       }\n    gl_FragColor = texture2D(tex, fragTexCoord);\n}"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[BackgroundTextureShader] FragmentShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BackgroundSkyTextureShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.BackgroundSkyTextureShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec3 position;\nattribute vec2 texcoord;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewProjectionMatrix2;\nvarying vec2 fragTexCoord;\nuniform float isVR;\nattribute float eyeIdx;\nvarying float vrOffset;\nvarying float fragEyeIdx;\n\nvoid main(void) {\n    fragTexCoord = texcoord;\n     fragEyeIdx = eyeIdx;\n     if(eyeIdx == 1.0){\n       gl_Position = modelViewProjectionMatrix2 * vec4(position, 1.0);\n     } else {\n       gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n     }\n     if(isVR == 1.0){\n        vrOffset = eyeIdx * 0.5;\n        gl_Position.x *= 0.5;\n        gl_Position.x += vrOffset * gl_Position.w;\n     }\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[BackgroundSkyTextureShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BackgroundSkyTextureShader.prototype.generateFragmentShader=function(e){var t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\n precision mediump float;\n#endif\n\nuniform float isVR;\nvarying float vrOffset;\nvarying float fragEyeIdx;\nuniform float screenWidth;\nuniform sampler2D tex;\nvarying vec2 fragTexCoord;\n\nvoid main(void) {\n    if ( isVR == 1.0 ) {\n        if ( ( step( 0.5, gl_FragCoord.x / screenWidth ) - 0.5 ) * vrOffset < 0.0 ) discard;\n    }\n    gl_FragColor = texture2D(tex, fragTexCoord);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[BackgroundSkyTextureShader] FragmentShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BackgroundCubeTextureShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.BackgroundCubeTextureShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec3 position;\nuniform mat4 modelViewProjectionMatrix;\nvarying vec3 fragNormal;\n\nvoid main(void) {\n    fragNormal = normalize(position);\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[BackgroundCubeTextureShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BackgroundCubeTextureShader.prototype.generateFragmentShader=function(e){var t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\n precision mediump float;\n#endif\n\nuniform samplerCube tex;\nvarying vec3 fragNormal;\n\nfloat magn(float val) {\n    return ((val >= 0.0) ? val : -1.0 * val);\n}\nvoid main(void) {\n    gl_FragColor = textureCube(tex, fragNormal);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[BackgroundCubeTextureShader] FragmentShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BackgroundCubeTextureDDSShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);if(e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),e.getProgramParameter(this.program,e.LINK_STATUS))return this.program;throw"Error linking shaders:"+e.getProgramInfoLog(this.program)},x3dom.shader.BackgroundCubeTextureDDSShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec3 position;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewProjectionMatrix2;\nvarying vec3 fragNormal;\nuniform float isVR;\nattribute float eyeIdx;\nvarying float vrOffset;\nvarying float fragEyeIdx;\n\nvoid main(void) {\n    fragEyeIdx = eyeIdx;\n   fragNormal = normalize(position);\n    if(eyeIdx == 1.0){\n       gl_Position = modelViewProjectionMatrix2 * vec4(position, 1.0);\n    } else {\n       gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n    }\n    if(isVR == 1.0){\n        vrOffset = eyeIdx * 0.5;\n        gl_Position.x *= 0.5;\n        gl_Position.x += vrOffset * gl_Position.w;\n    }\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[BackgroundCubeTextureDDSShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BackgroundCubeTextureDDSShader.prototype.generateFragmentShader=function(e){var t="#ifdef GL_FRAGMENT_PRECISION_HIGH\n",i=(t=(t=(t=t+"precision highp float;\n"+"#else\n")+" precision mediump float;\n"+"#endif\n\n")+x3dom.shader.toneMapping(),{GAMMACORRECTION:e.canvas.parent.doc._viewarea._scene.getEnvironment()._vf.gammaCorrectionDefault}),i=(t=(t+=x3dom.shader.gammaCorrectionDecl(i))+("uniform float isVR;\nvarying float vrOffset;\nvarying float fragEyeIdx;\nuniform float screenWidth;\nuniform samplerCube tex;\nvarying vec3 fragNormal;\n\nvoid main(void) {\n    if ( isVR == 1.0 ) {\n       if ( ( step( 0.5, gl_FragCoord.x / screenWidth ) - 0.5 ) * vrOffset < 0.0 ) discard;\n    }\n   vec4 color = textureCube(tex, fragNormal);\n    if(tonemappingOperator == 1.0) {\n       color.rgb = tonemapReinhard(color.rgb);\n    }\n    if(tonemappingOperator == 2.0) {\n       color.rgb = tonemapUncharted2(color.rgb);\n    }\n    if(tonemappingOperator == 3.0) {\n       color.rgb = tonemapeFilmic(color.rgb);\n    }\n   color = "+x3dom.shader.encodeGamma(i,"color")+";\n   gl_FragColor = color;\n}\n"),e.createShader(e.FRAGMENT_SHADER));return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||x3dom.debug.logError("[BackgroundCubeTextureDDSShader] FragmentShader "+e.getShaderInfoLog(i)),i},x3dom.shader.ShadowRenderingShader=function(e,t,i){this.program=e.createProgram();var o=this.generateVertexShader(e),t=this.generateFragmentShader(e,t,i);return e.attachShader(this.program,o),e.attachShader(this.program,t),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.ShadowRenderingShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec2 position;\nvarying vec2 vPosition;\nvoid main(void) {\n vPosition = position;\n gl_Position = vec4(position, -1.0, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[ShadowRendering] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.ShadowRenderingShader.prototype.generateFragmentShader=function(e,t,i){for(var o=(o=(o=(o=(o="#ifdef GL_FRAGMENT_PRECISION_HIGH\n")+"precision highp float;\n"+"#else\n")+" precision mediump float;\n"+"#endif\n\n")+"uniform mat4 inverseViewProj;\n"+"uniform mat4 inverseProj;\n")+"varying vec2 vPosition;\n"+"uniform sampler2D sceneMap;\n",s=0;s<5;s++)o+="uniform float cascade"+s+"_Depth;\n";for(var n=0;n<t.length;n++){o+="uniform float light"+n+"_On;\nuniform float light"+n+"_Type;\nuniform vec3  light"+n+"_Location;\nuniform vec3  light"+n+"_Direction;\nuniform vec3  light"+n+"_Attenuation;\nuniform float light"+n+"_Radius;\nuniform float light"+n+"_BeamWidth;\nuniform float light"+n+"_CutOffAngle;\nuniform float light"+n+"_ShadowIntensity;\nuniform float light"+n+"_ShadowOffset;\nuniform mat4 light"+n+"_ViewMatrix;\n";for(var r=0;r<6;r++)o=o+("uniform mat4 light"+n+"_"+r+"_Matrix;\n")+("uniform sampler2D light"+n+"_"+r+"_ShadowMap;\n");for(r=0;r<5;r++)o+="uniform float light"+n+"_"+r+"_Split;\n"}for(x3dom.caps.FP_TEXTURES||(o+=x3dom.shader.rgbaPacking()),o=(o+=x3dom.shader.shadowRendering())+x3dom.shader.gammaCorrectionDecl({}),i.FOG&&(o+=x3dom.shader.fog()),o+="void main(void) {\n    vec4 color = vec4( 1.0 );\n    vec2 texCoordsSceneMap = (vPosition + 1.0)*0.5;\n    vec4 projCoords = texture2D(sceneMap, texCoordsSceneMap);\n    if ( projCoords == vec4(1.0, 1.0, 1.0, 0.0) ){ gl_FragColor = vec4( 1.0 ); return; }\n",x3dom.caps.FP_TEXTURES||(o+="        projCoords.z = unpackDepth(projCoords);\n        projCoords.w = 1.0;\n"),o+="    projCoords = projCoords / projCoords.w;\n    projCoords.xy = vPosition;\n    vec4 eyeCoords = inverseProj*projCoords;\n",i.FOG&&(o+="    if (fogType < 2.0) {\n        vec3 eye = eyeCoords.xyz / eyeCoords.w;\n        float f0 = calcFog( eye );\n        color = vec4(  1.0 - f0, 1.0 - f0, 1.0 - f0, 1.0 );\n    }\n    else {\n"),o+="    float shadowValue = 1.0;\n    vec4 worldCoords = inverseViewProj*projCoords;\n    float lightInfluence = 0.0;\n",n=0;n<t.length;n++)o+="    lightInfluence = getLightInfluence(light"+n+"_Type, light"+n+"_ShadowIntensity, light"+n+"_On, light"+n+"_Location, light"+n+"_Direction, light"+n+"_CutOffAngle, light"+n+"_BeamWidth, light"+n+"_Attenuation, light"+n+"_Radius, eyeCoords.xyz/eyeCoords.w);\n    if (lightInfluence != 0.0){\n        vec4 shadowMapValues;\n        float viewSampleDepth;\n",x3dom.isa(t[n],x3dom.nodeTypes.PointLight)?o+="        getShadowValuesPointLight(shadowMapValues, viewSampleDepth, light"+n+"_Location, worldCoords, light"+n+"_ViewMatrix, light"+n+"_0_Matrix,light"+n+"_1_Matrix,light"+n+"_2_Matrix,light"+n+"_3_Matrix,light"+n+"_4_Matrix,light"+n+"_5_Matrix,light"+n+"_0_ShadowMap,light"+n+"_1_ShadowMap,light"+n+"_2_ShadowMap,light"+n+"_3_ShadowMap,light"+n+"_4_ShadowMap,light"+n+"_5_ShadowMap);\n":o+="        getShadowValuesCascaded(shadowMapValues, viewSampleDepth, worldCoords, -eyeCoords.z/eyeCoords.w,light"+n+"_0_Matrix,light"+n+"_1_Matrix,light"+n+"_2_Matrix,light"+n+"_3_Matrix,light"+n+"_4_Matrix,light"+n+"_5_Matrix,light"+n+"_0_ShadowMap,light"+n+"_1_ShadowMap,light"+n+"_2_ShadowMap,light"+n+"_3_ShadowMap,light"+n+"_4_ShadowMap,light"+n+"_5_ShadowMap, light"+n+"_0_Split, light"+n+"_1_Split, light"+n+"_2_Split, light"+n+"_3_Split, \nlight"+n+"_4_Split);\n",x3dom.caps.FP_TEXTURES?o+="     shadowValue *= clamp(VSM(shadowMapValues.zy, viewSampleDepth, light"+n+"_ShadowOffset),                 1.0 - light"+n+"_ShadowIntensity*lightInfluence, 1.0);\n":o+="    shadowValue *= clamp(ESM(shadowMapValues.z, viewSampleDepth, light"+n+"_ShadowOffset),                 1.0 - light"+n+"_ShadowIntensity*lightInfluence, 1.0);\n",o+="    }\n";o+="    color = "+x3dom.shader.encodeGamma({},"vec4(shadowValue, shadowValue, shadowValue, 1.0)")+" ;\n",i.FOG&&(o+="    }\n"),o+="    gl_FragColor = color;\n}\n";i=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(i,o),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||x3dom.debug.logError("[ShadowRendering] FragmentShader "+e.getShaderInfoLog(i)),i},x3dom.shader.TextureRefinementShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.TextureRefinementShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec2 position;\nvarying vec2 fragTexCoord;\n\nvoid main(void) {\n    fragTexCoord = (position.xy + 1.0) / 2.0;\n    gl_Position = vec4(position, -1.0, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[TextureRefinementShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.TextureRefinementShader.prototype.generateFragmentShader=function(e){var t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n#else\n precision mediump float;\n#endif\n\nuniform sampler2D stamp;\nuniform sampler2D lastTex;\nuniform sampler2D curTex;\nuniform int mode;\nuniform vec2 repeat;\nvarying vec2 fragTexCoord;\n\nvoid init(void);\nvoid refine(void);\n\nvoid main(void) {\n    if (mode == 0) { init(); }\n    else { refine(); }\n}\n\nvoid init(void) {\n    gl_FragColor = texture2D(curTex, fragTexCoord);\n}\n\nvoid refine(void) {\n    vec3 red = texture2D(stamp, repeat * fragTexCoord).rgb;\n    vec3 v1  = texture2D(lastTex, fragTexCoord).rgb;\n    vec3 v2  = texture2D(curTex, fragTexCoord).rgb;\n    if (red.r <= 0.5) {\n        gl_FragColor = vec4(v1, 1.0);\n    }\n    else {\n        gl_FragColor = vec4(v2, 1.0);\n    }\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[TextureRefinementShader] FragmentShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BlurShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.BlurShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec2 position;\nvarying vec2 vPosition;\nvoid main(void) {\n vPosition = position;\n gl_Position = vec4(position, -1.0, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[BlurShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.BlurShader.prototype.generateFragmentShader=function(e){var t="#ifdef GL_FRAGMENT_PRECISION_HIGH\n",i=(t=(t=(t+="precision highp float;\n")+"#else\n"+" precision mediump float;\n")+"#endif\n\n"+"varying vec2 vPosition;\nuniform sampler2D texture;\nuniform bool horizontal;\nuniform float pixelSizeHor;\nuniform float pixelSizeVert;\nuniform int filterSize;\n",x3dom.caps.FP_TEXTURES?t+="void main(void) {\n    vec2 texCoords = (vPosition + 1.0)*0.5;\n    vec2 offset;\n    if (horizontal) offset = vec2(pixelSizeHor, 0.0);\n    else offset = vec2(0.0, pixelSizeVert);\n    vec4 color = texture2D(texture, texCoords);\n    if (filterSize == 3){\n        color = color * 0.3844;\n        color += 0.3078*texture2D(texture, texCoords-offset);\n        color += 0.3078*texture2D(texture, texCoords+offset);\n    } else if (filterSize == 5){\n        color = color * 0.2921;\n        color += 0.2339*texture2D(texture, texCoords-offset);\n        color += 0.2339*texture2D(texture, texCoords+offset);\n        color += 0.1201*texture2D(texture, texCoords-2.0*offset);\n        color += 0.1201*texture2D(texture, texCoords+2.0*offset);\n    } else if (filterSize == 7){\n        color = color * 0.2161;\n        color += 0.1907*texture2D(texture, texCoords-offset);\n        color += 0.1907*texture2D(texture, texCoords+offset);\n        color += 0.1311*texture2D(texture, texCoords-2.0*offset);\n        color += 0.1311*texture2D(texture, texCoords+2.0*offset);\n        color += 0.0702*texture2D(texture, texCoords-3.0*offset);\n        color += 0.0702*texture2D(texture, texCoords+3.0*offset);\n    }\n    gl_FragColor = color;\n}\n":t+=x3dom.shader.rgbaPacking()+"void main(void) {\n    vec2 texCoords = (vPosition + 1.0)*0.5;\n    vec2 offset;\n    if (horizontal) offset = vec2(pixelSizeHor, 0.0);\n    else offset = vec2(0.0, pixelSizeVert);\n    vec4 packedDepth = texture2D(texture, texCoords);\n    const vec4 clearColor = vec4(1.0, 1.0, 1.0, 0.0);\n    if ( packedDepth == clearColor ) { discard; };\n    float depth = unpackDepth(packedDepth);\n    if (filterSize == 3){\n        vec4 packedDn1 = texture2D(texture, texCoords-offset);\n        vec4 packedDp1 = texture2D(texture, texCoords+offset);\n        if ( (packedDn1 - clearColor) * (packedDp1 - clearColor) == vec4(0.0) ) { discard; };\n        depth = depth * 0.3844;\n        depth += 0.3078*unpackDepth(packedDn1);\n        depth += 0.3078*unpackDepth(packedDp1);\n    } else if (filterSize == 5){\n        vec4 packedDn1 = texture2D(texture, texCoords-offset);\n        vec4 packedDp1 = texture2D(texture, texCoords+offset);\n        vec4 packedDn2 = texture2D(texture, texCoords-2.0*offset);\n        vec4 packedDp2 = texture2D(texture, texCoords+2.0*offset);\n        if ( packedDn1 == clearColor || packedDp1 == clearColor ||              packedDn2 == clearColor || packedDp2 == clearColor ) { discard; };\n        depth = depth * 0.2921;\n        depth += 0.2339*unpackDepth(packedDn1);\n        depth += 0.2339*unpackDepth(packedDp1);\n        depth += 0.1201*unpackDepth(packedDn2);\n        depth += 0.1201*unpackDepth(packedDp2);\n    } else if (filterSize == 7){\n        vec4 packedDn1 = texture2D(texture, texCoords-offset);\n        vec4 packedDp1 = texture2D(texture, texCoords+offset);\n        vec4 packedDn2 = texture2D(texture, texCoords-2.0*offset);\n        vec4 packedDp2 = texture2D(texture, texCoords+2.0*offset);\n        vec4 packedDn3 = texture2D(texture, texCoords-3.0*offset);\n        vec4 packedDp3 = texture2D(texture, texCoords+3.0*offset);\n        if ( packedDn1 == clearColor || packedDp1 == clearColor ||              packedDn2 == clearColor || packedDp2 == clearColor ||              packedDn3 == clearColor || packedDp3 == clearColor ) { discard; };\n        depth = depth * 0.2161;\n        depth += 0.1907*unpackDepth(packedDn1);\n        depth += 0.1907*unpackDepth(packedDp1);\n        depth += 0.1311*unpackDepth(packedDn2);\n        depth += 0.1311*unpackDepth(packedDp2);\n        depth += 0.0702*unpackDepth(packedDn3);\n        depth += 0.0702*unpackDepth(packedDp3);\n    }\n    gl_FragColor = packDepth(depth);\n}\n",e.createShader(e.FRAGMENT_SHADER));return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||x3dom.debug.logError("[BlurShader] FragmentShader "+e.getShaderInfoLog(i)),i},x3dom.shader.SSAOShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.SSAOShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec3 position;\nvarying vec2 depthTexCoord;\nvarying vec2 randomTexCoord;\nuniform vec2 randomTextureTilingFactor;\n\nvoid main(void) {\n    vec2 texCoord = (position.xy + 1.0) * 0.5;\n    depthTexCoord = texCoord;\n     randomTexCoord = randomTextureTilingFactor*texCoord;\n    gl_Position = vec4(position.xy, 0.0, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[SSAOShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.SSAOShader.depthReconsructionFunctionCode=function(){var e="uniform float depthReconstructionConstantA;\nuniform float depthReconstructionConstantB;\n";return x3dom.caps.FP_TEXTURES||(e+=x3dom.shader.rgbaPacking()),e+="float getDepth(vec2 depthTexCoord) {\n    vec4 col = texture2D(depthTexture, depthTexCoord);\n    float d;\n",x3dom.caps.FP_TEXTURES?e+="    d = col.b;\n":e+="    d = unpackDepth(col);\n",(e+="    return depthReconstructionConstantB/(depthReconstructionConstantA+d);\n")+"}\n"},x3dom.shader.SSAOShader.prototype.generateFragmentShader=function(e){var t="#ifdef GL_FRAGMENT_PRECISION_HIGH\n",i=(t=(t=(t=(t+="precision highp float;\n")+"#else\n"+" precision mediump float;\n")+"#endif\n\n"+"uniform sampler2D depthTexture;\nuniform sampler2D randomTexture;\nuniform float nearPlane;\nuniform float farPlane;\nuniform float radius;\nuniform float depthBufferEpsilon;\nuniform vec3 samples[16];\nvarying vec2 depthTexCoord;\nvarying vec2 randomTexCoord;\n")+x3dom.shader.SSAOShader.depthReconsructionFunctionCode()+"void main(void) {\n    float referenceDepth = getDepth(depthTexCoord);\n    if(referenceDepth == 1.0)\n    {\n        gl_FragColor = vec4(1.0,1.0,1.0, 1.0);\n        return;\n    }\n    int numOcclusions = 0;\n    for(int i = 0; i<16; ++i){\n        float scale  = 1.0/referenceDepth;\n        vec3 samplepos = reflect(samples[i],texture2D(randomTexture,randomTexCoord).xyz*2.0-vec3(1.0,1.0,1.0));\n        float sampleDepth = getDepth(depthTexCoord+samplepos.xy*scale*radius);\n        //if(abs(sampleDepth-referenceDepth)<=radius*(1.0/nearPlane))\n        if( sampleDepth < referenceDepth-depthBufferEpsilon) {\n            ++numOcclusions;\n        }\n    }\n    float r = 1.0-float(numOcclusions)/16.0;\n    r*=2.0;\n    gl_FragColor = vec4(r,r,r, 1.0);\n}\n",e.createShader(e.FRAGMENT_SHADER));return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||x3dom.debug.logError("[SSAOhader] FragmentShader "+e.getShaderInfoLog(i)),i},x3dom.shader.SSAOBlurShader=function(e){this.program=e.createProgram();var t=this.generateVertexShader(e),i=this.generateFragmentShader(e);return e.attachShader(this.program,t),e.attachShader(this.program,i),e.bindAttribLocation(this.program,0,"position"),e.linkProgram(this.program),this.program},x3dom.shader.SSAOBlurShader.prototype.generateVertexShader=function(e){var t=e.createShader(e.VERTEX_SHADER);return e.shaderSource(t,"attribute vec3 position;\nvarying vec2 fragTexCoord;\n\nvoid main(void) {\n    vec2 texCoord = (position.xy + 1.0) * 0.5;\n    fragTexCoord = texCoord;\n    gl_Position = vec4(position.xy, 0.0, 1.0);\n}\n"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||x3dom.debug.logError("[SSAOShader] VertexShader "+e.getShaderInfoLog(t)),t},x3dom.shader.SSAOBlurShader.prototype.generateFragmentShader=function(e){var t="#ifdef GL_FRAGMENT_PRECISION_HIGH\n",i=(t=(t=(t=(t+="precision highp float;\n")+"#else\n"+" precision mediump float;\n")+"#endif\n\n"+"uniform sampler2D SSAOTexture;\nuniform sampler2D depthTexture;\nuniform float nearPlane;\nuniform float farPlane;\nuniform float amount;\nuniform vec2 pixelSize;\nuniform float depthThreshold;\nvarying vec2 fragTexCoord;\n")+x3dom.shader.SSAOShader.depthReconsructionFunctionCode()+"void main(void) {\n    float sum = 0.0;\n    float numSamples = 0.0;\n    float referenceDepth = getDepth(fragTexCoord);\n    for(int i = -2; i<2;i++){\n        for(int j = -2; j<2;j++){\n            vec2 sampleTexCoord = fragTexCoord+vec2(pixelSize.x*float(i),pixelSize.y*float(j));\n            if(abs(referenceDepth - getDepth(sampleTexCoord))<depthThreshold){\n                sum+= texture2D(SSAOTexture,sampleTexCoord).r;\n                numSamples++;\n    }}}\n    float intensity = mix(1.0,sum/numSamples,amount);\n    gl_FragColor = vec4(intensity,intensity,intensity,1.0);\n}\n",e.createShader(e.FRAGMENT_SHADER));return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||x3dom.debug.logError("[SSAOhader] FragmentShader "+e.getShaderInfoLog(i)),i},x3dom.shader.FRAG_COLOR="x3dom_fragColor",x3dom.shader.convertVertexShader=function(e){return"#version 300 es\n"+(e=(e=e.replace(/attribute/g,"in")).replace(/varying/g,"out")).replace(/texture2D/g,"texture")},x3dom.shader.convertFragmentShader=function(e){return"#version 300 es\n"+(e=(e=(e=(e=e.replace(/varying/g,"in")).replace(/textureCubeLodEXT/g,"textureLod")).replace(/texture2D|textureCube/g,"texture")).replace(/\/\/@insertFragColor/g,"out vec4 "+x3dom.shader.FRAG_COLOR+";\n")).replace(/gl_FragColor/g,x3dom.shader.FRAG_COLOR)},x3dom.registerNodeType("X3DNode","Core",defineClass(null,function(e){this._xmlNode=null,this._runtime=e&&e.runtime?e.runtime:null,this._DEF=null,this._nameSpace=e&&e.nameSpace?e.nameSpace:null,this._vf={},this._vfFieldTypes={},this._cf={},this._cfFieldTypes={},this._fieldWatchers={},this._routes={},this._listeners={},this._parentNodes=[],this._childNodes=[],this.addField_SFNode("metadata",x3dom.nodeTypes.X3DMetadataObject)},{type:function(){return this.constructor},typeName:function(){return this.constructor._typeName},addChild:function(e,t){var i;e&&"isProtoInstance"in e?(this.addChild(e.typeNode,t),0<e.helperNodes.length&&((i=new x3dom.nodeTypes.Switch)._nameSpace=this._nameSpace,e.helperNodes.forEach(function(e){i.addChild(e,"children")}),this.addChild2(i))):this.addChild2(e,t)},addChild2:function(e,t){if(e){var i=null;if(t)i=this._cf[t];else for(var o in this._cf)if(this._cf.hasOwnProperty(o)){o=this._cf[o];if(x3dom.isa(e,o.type)){i=o;break}}if(i&&i.addLink(e))return e._parentNodes.push(this),this._childNodes.push(e),"isProtoInstance"in this||e.parentAdded(this),!0;"isProtoInstance"in this&&("isProtoInstance"in e?this.nodes.concat(e.nodes):(this.nodes.push(e),that=this,function t(i){Object.keys(i).forEach(function(e){i[e].node&&i[e].node._DEF&&(that.innerNameSpace.defMap[i[e].node._DEF]=i[e].node),i[e].node&&i[e].node._cf&&t(i[e].node._cf)})}({child:{node:e}})))}return!1},removeChild:function(e,t,i){if(t=t||"any",e)for(var o in this._cf)if(this._cf.hasOwnProperty(o)&&("any"==t||o==t)&&(this._cf[o].rmLink(e)||i)){for(var s=e._parentNodes.length-1;0<=s;s--)e._parentNodes[s]===this&&(e._parentNodes.splice(s,1),e.parentRemoved(this));for(var n=this._childNodes.length-1;0<=n;n--)if(this._childNodes[n]===e)return e.onRemove(),this._childNodes.splice(n,1),!0}return!1},onRemove:function(){},parentAdded:function(e){},parentRemoved:function(e){for(var t=0,i=this._childNodes.length;t<i;t++)this._childNodes[t]&&this._childNodes[t].parentRemoved(this)},getCurrentTransform:function(){return 1<=this._parentNodes.length?this.transformMatrix(this._parentNodes[0].getCurrentTransform()):x3dom.fields.SFMatrix4f.identity()},transformMatrix:function(e){return e},getVolume:function(){return null},invalidateVolume:function(){},invalidateCache:function(){},volumeValid:function(){return!1},collectDrawableObjects:function(e,t,i,o,s,n){},highlight:function(e,t){this._vf.hasOwnProperty("diffuseColor")&&(e?(void 0===this._actDiffuseColor&&(this._actDiffuseColor=new x3dom.fields.SFColor,this._highlightOn=!1),this._highlightOn||(this._actDiffuseColor.setValues(this._vf.diffuseColor),this._highlightOn=!0),this._vf.diffuseColor.setValues(t)):void 0!==this._actDiffuseColor&&(this._vf.diffuseColor.setValues(this._actDiffuseColor),this._highlightOn=!1,delete this._actDiffuseColor));for(var i=0,o=this._childNodes.length;i<o;i++)this._childNodes[i]&&this._childNodes[i].highlight(e,t)},getRuntime:function(){return this._runtime},findX3DDoc:function(){return this._nameSpace?this._nameSpace.doc:null},doIntersect:function(e){for(var t=!1,i=0;i<this._childNodes.length;i++)this._childNodes[i]&&(t=this._childNodes[i].doIntersect(e)||t);return t},postMessage:function(e,t){this._vf[e]=t;var i=this._fieldWatchers[e],o=this,i=(i&&i.forEach(function(e){e.call(o,t)}),{target:o._xmlNode,type:"outputchange",fieldName:e,value:t});this.callEvtHandler("onoutputchange",i)},updateField:function(e,t){var i,o=this._vf[e];if(void 0===o){for(var s in this._vf)if(s.toLowerCase()==e){e=s,o=this._vf[e];break}void 0===(o=void 0===o&&0==e.indexOf("set_")&&(i=e.substr("set_".length,e.length-1),void 0!==this._vf[i])?this._vf[e=i]:o)&&(this._vf[e]=o=null)}if(null!==o){try{this._vf[e].setValueByStr(t)}catch(s){try{switch((typeof this._vf[e]).toString()){case"number":this._vf[e]="number"==typeof t?t:+t;break;case"boolean":this._vf[e]="boolean"==typeof t?t:"true"==t.toLowerCase();break;case"string":this._vf[e]=t}}catch(e){x3dom.debug.logError("updateField: setValueByStr() NYI for "+typeof o)}}this.fieldChanged(e)}},setupRoute:function(e,t,i){var o,s="set_",n="_changed",s=(this._vf[e]||(0===e.indexOf(s)?(o=e.substr(s.length,e.length-1),void 0!==this._vf[o]&&(e=o)):0<e.indexOf(n)&&(o=e.substr(0,e.length-n.length),void 0!==this._vf[o])&&(e=o)),t._vf[i]||(0===i.indexOf(s)?(o=i.substr(s.length,i.length-1),void 0!==t._vf[o]&&(i=o)):0<i.indexOf(n)&&(o=i.substr(0,i.length-n.length),void 0!==t._vf[o])&&(i=o)),this._DEF+"&"+e+"&"+t._DEF+"&"+i);this._routes[s]||(this._fieldWatchers[e]||(this._fieldWatchers[e]=[]),this._fieldWatchers[e].push(function(e){t.postMessage(i,e)}),t._fieldWatchers[i]||(t._fieldWatchers[i]=[]),t._fieldWatchers[i].push(function(e){t._vf[i]=e,t.fieldChanged(i)}),this._routes[s]={from:this._fieldWatchers[e].length-1,to:t._fieldWatchers[i].length-1})},removeRoute:function(e,t,i){var o,s="set_",n="_changed",s=(this._vf[e]||(0===e.indexOf(s)?(o=e.substr(s.length,e.length-1),void 0!==this._vf[o]&&(e=o)):0<e.indexOf(n)&&(o=e.substr(0,e.length-n.length),void 0!==this._vf[o])&&(e=o)),t._vf[i]||(0===i.indexOf(s)?(o=i.substr(s.length,i.length-1),void 0!==t._vf[o]&&(i=o)):0<i.indexOf(n)&&(o=i.substr(0,i.length-n.length),void 0!==t._vf[o])&&(i=o)),this._DEF+"&"+e+"&"+t._DEF+"&"+i);this._routes[s]&&(this._fieldWatchers[e].splice(this._routes[s].from,1),t._fieldWatchers[i].splice(this._routes[s].to,1),delete this._routes[s])},fieldChanged:function(e){},nodeChanged:function(){},callEvtHandler:function(e,t){var i=this._xmlNode;if(this._xmlNode&&(i.getAttribute(e)||i[e]||this._listeners[t.type]))try{var o,s=i[e],n=(t.target=i,"function"==typeof s?s.call(this._xmlNode,t):i.hasAttribute(e)&&(o=i.getAttribute(e),new Function("event",o).call(i,t)),this._listeners[t.type]);if(n)for(var r=0;r<n.length;r++)n[r].call(i,t)}catch(e){x3dom.debug.logException(e)}return t.cancelBubble},hasEventListener:function(e){return this._xmlNode&&(this._xmlNode["on"+e]||this._xmlNode.hasAttribute("on"+e)||this._listeners[e])},initSetter:function(t,i){if(t&&i){var e=i.toLowerCase();if(t.__defineSetter__&&t.__defineGetter__?(t.__defineSetter__(i,function(e){t.setAttribute(i,e)}),t.__defineGetter__(i,function(){return t.getAttribute(i)}),e!=i&&(t.__defineSetter__(e,function(e){t.setAttribute(i,e)}),t.__defineGetter__(e,function(){return t.getAttribute(i)}))):Object.defineProperty(t,i,{set:function(e){t.setAttribute(i,e)},get:function(){return t.getAttribute(i)},configurable:!0,enumerable:!0}),void 0!==this._vf[i]&&!t.attributes[i]&&!t.attributes[i.toLowerCase()]){e="";try{e=(this._vf[i].toGL?this._vf[i].toGL():this._vf[i]).toString()}catch(t){e=this._vf[i].toString()}t.setAttribute(i,e=e||"")}}},addField_SFInt32:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?parseInt(e.xmlNode.getAttribute(t),10):i,e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFInt32"},addField_SFFloat:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?+e.xmlNode.getAttribute(t):i,e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFFloat"},addField_SFDouble:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?+e.xmlNode.getAttribute(t):i,e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFDouble"},addField_SFTime:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?+e.xmlNode.getAttribute(t):i,e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFTime"},addField_SFBool:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?"true"===e.xmlNode.getAttribute(t).toLowerCase():i,e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFBool"},addField_SFString:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?e.xmlNode.getAttribute(t):i,e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFString"},addField_SFColor:function(e,t,i,o,s){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.SFColor.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.SFColor(i,o,s),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFColor"},addField_SFColorRGBA:function(e,t,i,o,s,n){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.SFColorRGBA.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.SFColorRGBA(i,o,s,n),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFColorRGBA"},addField_SFVec2f:function(e,t,i,o){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.SFVec2f.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.SFVec2f(i,o),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFVec2f"},addField_SFVec3f:function(e,t,i,o,s){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.SFVec3f.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.SFVec3f(i,o,s),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFVec3f"},addField_SFVec4f:function(e,t,i,o,s,n){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.SFVec4f.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.SFVec4f(i,o,s,n),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFVec4f"},addField_SFVec3d:function(e,t,i,o,s){this.addField_SFVec3f(e,t,i,o,s),this._vfFieldTypes[t]="SFVec3d"},addField_SFRotation:function(e,t,i,o,s,n){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.Quaternion.parseAxisAngle(e.xmlNode.getAttribute(t)):x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(i,o,s),n),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFRotation"},addField_SFMatrix4f:function(e,t,i,o,s,n,r,a,d,l,h,u,f,c,_,m,p,x){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.SFMatrix4f.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.SFMatrix4f(i,o,s,n,r,a,d,l,h,u,f,c,_,m,p,x),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFMatrix4f"},addField_SFImage:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.SFImage.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.SFImage(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="SFImage"},addField_MFString:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFString.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFString(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFString"},addField_MFBoolean:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFBoolean.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFBoolean(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFBoolean"},addField_MFInt32:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFInt32.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFInt32(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFInt32"},addField_MFFloat:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFFloat.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFFloat(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFFloat"},addField_MFDouble:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFFloat.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFFloat(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFDouble"},addField_MFColor:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFColor.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFColor(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFColor"},addField_MFColorRGBA:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFColorRGBA.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFColorRGBA(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFColorRGBA"},addField_MFVec2f:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFVec2f.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFVec2f(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFVec2f"},addField_MFVec3f:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFVec3f.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFVec3f(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFVec3f"},addField_MFVec3d:function(e,t,i){this.addField_MFVec3f(e,t,i),this._vfFieldTypes[t]="MFVec3d"},addField_MFRotation:function(e,t,i){this._vf[t]=e&&e.xmlNode&&e.xmlNode.hasAttribute(t)?x3dom.fields.MFRotation.parse(e.xmlNode.getAttribute(t)):new x3dom.fields.MFRotation(i),e&&e.xmlNode&&this.initSetter(e.xmlNode,t),this._vfFieldTypes[t]="MFRotation"},addField_SFNode:function(e,t){this._cf[e]=new x3dom.fields.SFNode(t),this._cfFieldTypes[e]="SFNode"},addField_MFNode:function(e,t){this._cf[e]=new x3dom.fields.MFNode(t),this._cfFieldTypes[e]="MFNode"}})),x3dom.registerNodeType("X3DMetadataObject","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.X3DMetadataObject.superClass.call(this,e),this.addField_SFString(e,"name",""),this.addField_SFString(e,"reference","")})),x3dom.registerNodeType("MetadataBoolean","Core",defineClass(x3dom.nodeTypes.X3DMetadataObject,function(e){x3dom.nodeTypes.MetadataBoolean.superClass.call(this,e),this.addField_MFBoolean(e,"value",[])})),x3dom.registerNodeType("MetadataDouble","Core",defineClass(x3dom.nodeTypes.X3DMetadataObject,function(e){x3dom.nodeTypes.MetadataDouble.superClass.call(this,e),this.addField_MFDouble(e,"value",[])})),x3dom.registerNodeType("MetadataFloat","Core",defineClass(x3dom.nodeTypes.X3DMetadataObject,function(e){x3dom.nodeTypes.MetadataFloat.superClass.call(this,e),this.addField_MFFloat(e,"value",[])})),x3dom.registerNodeType("MetadataInteger","Core",defineClass(x3dom.nodeTypes.X3DMetadataObject,function(e){x3dom.nodeTypes.MetadataInteger.superClass.call(this,e),this.addField_MFInt32(e,"value",[])})),x3dom.registerNodeType("MetadataSet","Core",defineClass(x3dom.nodeTypes.X3DMetadataObject,function(e){x3dom.nodeTypes.MetadataSet.superClass.call(this,e),this.addField_MFNode("value",x3dom.nodeTypes.X3DMetadataObject)})),x3dom.registerNodeType("MetadataString","Core",defineClass(x3dom.nodeTypes.X3DMetadataObject,function(e){x3dom.nodeTypes.MetadataString.superClass.call(this,e),this.addField_MFString(e,"value",[])})),x3dom.registerNodeType("Field","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.Field.superClass.call(this,e),this.addField_SFString(e,"name",""),this.addField_SFString(e,"type",""),this.addField_SFString(e,"value","")},{fieldChanged:function(e){var t=this;"value"===e&&this._parentNodes.forEach(function(e){e.fieldChanged(t._vf.name)})}})),x3dom.registerNodeType("X3DChildNode","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.X3DChildNode.superClass.call(this,e)})),x3dom.registerNodeType("X3DBindableNode","Core",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DBindableNode.superClass.call(this,e),this.addField_SFBool(e,"bind",!1),this.addField_SFString(e,"description",""),this.addField_SFBool(e,"isActive",!1),this._autoGen=!(!e||!e.autoGen),this._autoGen&&(this._vf.description="default"+this.constructor.superClass._typeName),this._stack=null,this._bindAnimation=!0},{bind:function(e){this._stack?e?this._stack.push(this):this._stack.pop(this):x3dom.debug.logError("No BindStack in "+this.typeName()+"Bindable")},activate:function(e){this.postMessage("isActive",!0),x3dom.debug.logInfo("activate "+this.typeName()+"Bindable "+this._DEF+"/"+this._vf.description)},deactivate:function(e){this.postMessage("isActive",!1),x3dom.debug.logInfo("deactivate "+this.typeName()+"Bindable "+this._DEF+"/"+this._vf.description)},fieldChanged:function(e){0<=e.indexOf("bind")&&this.bind(this._vf.bind)},nodeChanged:function(){this._stack=this._nameSpace.doc._bindableBag.addBindable(this)}})),x3dom.registerNodeType("X3DInfoNode","Core",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DInfoNode.superClass.call(this,e)})),x3dom.registerNodeType("WorldInfo","Core",defineClass(x3dom.nodeTypes.X3DInfoNode,function(e){x3dom.nodeTypes.WorldInfo.superClass.call(this,e),this.addField_MFString(e,"info",[]),this.addField_SFString(e,"title",""),x3dom.debug.logInfo(this._vf.info),x3dom.debug.logInfo(this._vf.title)})),x3dom.registerNodeType("X3DSensorNode","Core",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DSensorNode.superClass.call(this,e),this.addField_SFBool(e,"enabled",!0)})),x3dom.registerNodeType("Param","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.Param.superClass.call(this,e),x3dom.debug.logWarning('DEPRECATED: Param element needs to be child of X3D element [<a href="http://x3dom.org/docs/latest/configuration.html">DOCS</a>]')})),x3dom.registerNodeType("X3DBoundedObject","Grouping",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DBoundedObject.superClass.call(this,e),this.addField_SFBool(e,"render",!0),this.addField_SFBool(e,"visible",!0),this.addField_SFVec3f(e,"bboxCenter",0,0,0),this.addField_SFVec3f(e,"bboxSize",-1,-1,-1),this.addField_SFBool(e,"bboxDisplay",!1),this.addField_SFFloat(e,"bboxMargin",.01),this.addField_SFColor(e,"bboxColor",1,1,0),this._graph={boundedNode:this,localMatrix:x3dom.fields.SFMatrix4f.identity(),globalMatrix:null,volume:new x3dom.fields.BoxVolume,lastVolume:new x3dom.fields.BoxVolume,worldVolume:new x3dom.fields.BoxVolume,center:new x3dom.fields.SFVec3f(0,0,0),coverage:-1,needCulling:!0},this._render=!0,this._bboxNode=null,this._bboxColor=new x3dom.fields.SFColor},{fieldChanged:function(e){this._vf.hasOwnProperty(e)&&this.invalidateVolume()},nodeChanged:function(){this.invalidateVolume()},parentAdded:function(e){this.invalidateVolume()},getVolume:function(){var e,t=this._graph.volume;if(!this.volumeValid()&&(this._vf.bboxDisplay||this.renderFlag&&this.renderFlag()))for(var i=0,o=this._childNodes.length;i<o;i++){var s=this._childNodes[i];!s||s.renderFlag&&!0!==s.renderFlag()&&!s._vf.bboxDisplay||(s=s.getVolume())&&s.isValid()&&t.extendBounds(s.min,s.max)}return t.equals(this._graph.lastVolume)||(this._graph.lastVolume=x3dom.fields.BoxVolume.copy(t),e={target:this._xmlNode,type:"volumechanged",volume:x3dom.fields.BoxVolume.copy(t)},this.callEvtHandler("onvolumechanged",e)),t},invalidateVolume:function(){var e=this._graph;e.volume.invalidate(),e.worldVolume.invalidate(),e.globalMatrix=null;for(var t=0,i=this._parentNodes.length;t<i;t++){var o=this._parentNodes[t];o&&o.invalidateVolume()}},invalidateCache:function(){var e=this._graph;e.worldVolume.invalidate(),e.globalMatrix=null},cacheInvalid:function(){return null==this._graph.globalMatrix||!this._graph.worldVolume.isValid()},volumeValid:function(){return this._graph.volume.isValid()},graphState:function(){return this._graph},forceUpdateCoverage:function(){return!1},renderFlag:function(){return this._render!==this._vf.render?(this._vf.visible=this._vf.render,this._render=this._vf.visible):this._render!==this._vf.visible&&(this._vf.render=this._vf.visible,this._render=this._vf.visible),this._render},getBboxNode:function(){null==this._bboxNode&&(e=x3dom.bboxDom.cloneNode(!0),this._bboxNode=this._nameSpace.setupTree(e,this._xmlNode.parentElement));var e=this._graph.volume,t=((bboxNode=this._bboxNode)._vf.translation=e.center,e.max.subtract(e.min)),e=e.diameter*this._vf.bboxMargin;return bboxNode._vf.scale.set(t.x+e,t.y+e,t.z+e),bboxNode.fieldChanged("scale"),this._bboxColor.equals(this._vf.bboxColor,.01)||(this._bboxColor.setValues(this._vf.bboxColor),(t=this._bboxNode._cf.children.nodes[0]._cf.appearance.node._cf.material.node)._vf.emissiveColor=this._bboxColor.multiply(.8),t._vf.diffuseColor=this._bboxColor.multiply(.2),t.fieldChanged("emissiveColor")),this._bboxNode},collectBbox:function(e,t,i,o,s,n){this._vf.bboxDisplay&&this.getBboxNode().collectDrawableObjects(e,t,i,o,s,n)}})),x3dom.bboxDom=(new DOMParser).parseFromString("<Transform><Shape isPickable='false'>  <Appearance>   <Material transparency='0.6' specularColor='0.3 0.3 0.3' diffuseColor='0 0.5 0' emissiveColor='1 0.5 0'></Material>   </Appearance>  <Box size='1 1 1'></Box></Shape></Transform>","text/xml").children[0],x3dom.registerNodeType("X3DGroupingNode","Grouping",defineClass(x3dom.nodeTypes.X3DBoundedObject,function(e){x3dom.nodeTypes.X3DGroupingNode.superClass.call(this,e),this.addField_MFNode("children",x3dom.nodeTypes.X3DChildNode)},{collectDrawableObjects:function(e,t,i,o,s,n){var r,a;if((i=i&&1<this._parentNodes.length?!1:i)&&(o=o||this.cacheInvalid())&&this.invalidateCache(),a=i?(this._graph.globalMatrix||(this._graph.globalMatrix=this.transformMatrix(e)),this._graph.globalMatrix):this.transformMatrix(e),this.collectBbox(e,t,i,o,s,n),!((s=t.cull(e,this.graphState(),i,s))<0)){var d=this._childNodes.length;if(0<x3dom.nodeTypes.ClipPlane.count){for(var l=[],h=0;h<d;h++)(r=this._childNodes[h])&&x3dom.isa(r,x3dom.nodeTypes.ClipPlane)&&r._vf.on&&r._vf.enabled&&l.push({plane:r,trafo:a});n=l.concat(n)}for(var u=0;u<d;u++)(r=this._childNodes[u])&&r.collectDrawableObjects(a,t,i,o,s,n)}}})),x3dom.registerNodeType("Switch","Grouping",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.Switch.superClass.call(this,e),this.addField_SFInt32(e,"whichChoice",-1)},{fieldChanged:function(e){"whichChoice"==e&&this.invalidateVolume()},getVolume:function(){var e,t=this._graph.volume;return!this.volumeValid()&&(this._vf.bboxDisplay||this.renderFlag&&this.renderFlag())&&0<=this._vf.whichChoice&&this._vf.whichChoice<this._childNodes.length&&(e=(e=this._childNodes[this._vf.whichChoice])&&(e._vf.bboxDisplay||e.renderFlag&&e.renderFlag())?e.getVolume():null)&&e.isValid()&&t.extendBounds(e.min,e.max),t},collectDrawableObjects:function(e,t,i,o,s,n){var r;(i=i&&1<this._parentNodes.length?!1:i)&&(o=o||this.cacheInvalid())&&this.invalidateCache(),r=i?(this._graph.globalMatrix||(this._graph.globalMatrix=this.transformMatrix(e)),this._graph.globalMatrix):this.transformMatrix(e),this.collectBbox(r,t,i,o,s,n),this._vf.whichChoice<0||this._vf.whichChoice>=this._childNodes.length||(s=t.cull(e,this.graphState(),i,s))<0||(e=this._childNodes[this._vf.whichChoice])&&e.collectDrawableObjects(r,t,i,o,s,n)},doIntersect:function(e){var t;return!(this._vf.whichChoice<0||this._vf.whichChoice>=this._childNodes.length||!(t=this._childNodes[this._vf.whichChoice]))&&t.doIntersect(e)}})),x3dom.registerNodeType("X3DTransformNode","Grouping",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.X3DTransformNode.superClass.call(this,e),e?e.doc._nodeBag.trans.push(this):x3dom.debug.logWarning("X3DTransformNode: No runtime context found!"),this._trafo=null,this._needCssStyleUpdates=!0},{tick:function(e){var t=this._xmlNode;if(t&&(t.ontransform||t.hasAttribute("ontransform")||this._listeners.transform)&&(i={target:t,type:"transform",worldX:(i=this.getCurrentTransform())._03,worldY:i._13,worldZ:i._23,cancelBubble:!1,stopPropagation:function(){this.cancelBubble=!0}},this.callEvtHandler("ontransform",i)),this._needCssStyleUpdates&&t){var i=x3dom.getStyle(t,"-webkit-transform")||x3dom.getStyle(t,"-moz-transform")||x3dom.getStyle(t,"-ms-transform")||x3dom.getStyle(t,"transform");if(i&&"none"!=i)return this._trafo.setValueByStr(i),this.invalidateVolume(),!0;this._needCssStyleUpdates=!1}return!1},transformMatrix:function(e){return e.mult(this._trafo)},getVolume:function(){var e=this._graph.volume;if(!this.volumeValid()&&(this._vf.bboxDisplay||this.renderFlag&&this.renderFlag())){this._graph.localMatrix=this._trafo;for(var t=0,i=this._childNodes.length;t<i;t++){var o=this._childNodes[t];!o||o.renderFlag&&!0!==o.renderFlag()&&!o._vf.bboxDisplay||(o=o.getVolume())&&o.isValid()&&e.extendBounds(o.min,o.max)}e.isValid()&&e.transform(this._trafo)}return e},doIntersect:function(e){var t=!1,i=this._trafo.inverse(),o=new x3dom.fields.SFVec3f(e.pos.x,e.pos.y,e.pos.z),s=new x3dom.fields.SFVec3f(e.dir.x,e.dir.y,e.dir.z);e.pos=i.multMatrixPnt(e.pos),e.dir=i.multMatrixVec(e.dir),e.hitObject&&(e.dist*=e.dir.length());for(var n=0;n<this._childNodes.length;n++)this._childNodes[n]&&(t=this._childNodes[n].doIntersect(e)||t);return e.pos.setValues(o),e.dir.setValues(s),t&&(e.hitPoint=this._trafo.multMatrixPnt(e.hitPoint),e.dist*=e.dir.length()),t},parentRemoved:function(e){var t,i,o=this.findX3DDoc();if(o)for(t=0,i=o._nodeBag.trans.length;t<i;t++)o._nodeBag.trans[t]===this&&o._nodeBag.trans.splice(t,1);for(t=0,i=this._childNodes.length;t<i;t++)this._childNodes[t]&&this._childNodes[t].parentRemoved(this)}})),x3dom.registerNodeType("Transform","Grouping",defineClass(x3dom.nodeTypes.X3DTransformNode,function(e){x3dom.nodeTypes.Transform.superClass.call(this,e),this.addField_SFVec3f(e,"center",0,0,0),this.addField_SFVec3f(e,"translation",0,0,0),this.addField_SFRotation(e,"rotation",0,0,1,0),this.addField_SFVec3f(e,"scale",1,1,1),this.addField_SFRotation(e,"scaleOrientation",0,0,1,0),this._trafo=x3dom.fields.SFMatrix4f.translation(this._vf.translation.add(this._vf.center)).mult(this._vf.rotation.toMatrix()).mult(this._vf.scaleOrientation.toMatrix()).mult(x3dom.fields.SFMatrix4f.scale(this._vf.scale)).mult(this._vf.scaleOrientation.toMatrix().inverse()).mult(x3dom.fields.SFMatrix4f.translation(this._vf.center.negate()))},{fieldChanged:function(e){"center"==e||"translation"==e||"rotation"==e||"scale"==e||"scaleOrientation"==e?(this._trafo=x3dom.fields.SFMatrix4f.translation(this._vf.translation.add(this._vf.center)).mult(this._vf.rotation.toMatrix()).mult(this._vf.scaleOrientation.toMatrix()).mult(x3dom.fields.SFMatrix4f.scale(this._vf.scale)).mult(this._vf.scaleOrientation.toMatrix().inverse()).mult(x3dom.fields.SFMatrix4f.translation(this._vf.center.negate())),this.invalidateVolume()):"render"==e&&this.invalidateVolume()}})),x3dom.registerNodeType("MatrixTransform","Grouping",defineClass(x3dom.nodeTypes.X3DTransformNode,function(e){x3dom.nodeTypes.MatrixTransform.superClass.call(this,e),this.addField_SFMatrix4f(e,"matrix",1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this._trafo=this._vf.matrix.transpose()},{fieldChanged:function(e){"matrix"==e?(this._trafo=this._vf.matrix.transpose(),this.invalidateVolume()):"render"==e&&this.invalidateVolume()}})),x3dom.registerNodeType("Group","Grouping",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.Group.superClass.call(this,e)})),x3dom.registerNodeType("Block","Grouping",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.Block.superClass.call(this,e),this.addField_MFString(e,"nameSpaceName",[])})),x3dom.registerNodeType("StaticGroup","Grouping",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.StaticGroup.superClass.call(this,e),x3dom.debug.logWarning("StaticGroup erroneously also bakes parent transforms, if happens use Group node!"),this.addField_SFBool(e,"debug",!1),this.addField_SFBool(e,"showDebugBoxVolumes",!1),this.addField_SFString(e,"bvhType","jsBIH"),this.addField_SFInt32(e,"maxObjectsPerNode",1),this.addField_SFInt32(e,"maxDepth",-1),this.addField_SFFloat(e,"minRelativeBBoxSize",.01),this.needBvhRebuild=!0,this.drawableCollection=null,this.bvh=null},{getMaxDepth:function(){return-1==this._vf.maxDepth?"jsBIH"==this._vf.bvhType?50:4:this._vf.maxDepth},collectDrawableObjects:function(e,t,i,o,s,n){if((i=i&&1<this._parentNodes.length?!1:i)&&(o=o||this.cacheInvalid())&&this.invalidateCache(),!((s=t.cull(e,this.graphState(),i,s))<0)){var r,a=i?(this._graph.globalMatrix||(this._graph.globalMatrix=this.transformMatrix(e)),this._graph.globalMatrix):this.transformMatrix(e);if(this.needBvhRebuild){e={viewArea:t.viewarea,sortTrans:t.sortTrans,viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,sceneMatrix:t.sceneMatrix,frustumCulling:!1,smallFeatureThreshold:0,context:t.context};this.drawableCollection=new x3dom.DrawableCollection(e);for(var d=this._childNodes.length,l=0;l<d;l++)(r=this._childNodes[l])&&r.collectDrawableObjects(a,this.drawableCollection,i,o,s,n);this.drawableCollection.concat();var e=this._nameSpace.doc._scene,h=new x3dom.bvh.Settings(this._vf.debug,this._vf.showDebugBoxVolumes,this._vf.bvhType,this._vf.maxObjectsPerNode,this.getMaxDepth(),this._vf.minRelativeBBoxSize);for(this.bvh="jsBIH"==this._vf.bvhType?new x3dom.bvh.BIH(e,h):new x3dom.bvh.Culler(this.drawableCollection,e,h),(this._vf.debug||this._vf.showDebugBoxVolumes)&&(this.bvh=new x3dom.bvh.DebugDecorator(this.bvh,e,h)),d=this.drawableCollection.length,l=0;l<d;l++)this.bvh.addDrawable(this.drawableCollection.get(l));this.bvh.compile(),this._vf.debug&&this.bvh.showCompileStats(),this.needBvhRebuild=!1}x3dom.Utils.startMeasure("bvhTraverse"),this.bvh.collectDrawables(t);e=x3dom.Utils.stopMeasure("bvhTraverse");this._nameSpace.doc.ctx.x3dElem.runtime.addMeasurement("BVH",e),this.bvh.showTraverseStats(this._nameSpace.doc.ctx.x3dElem.runtime)}}})),x3dom.registerNodeType("RemoteSelectionGroup","Grouping",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.RemoteSelectionGroup.superClass.call(this,e),this.addField_MFString(e,"url",["ws://localhost:35668/cstreams/0"]),this.addField_MFString(e,"label",[]),this.addField_SFInt32(e,"maxRenderedIds",-1),this.addField_SFBool(e,"reconnect",!0),this.addField_SFFloat(e,"scaleRenderedIdsOnMove",1),this.addField_SFBool(e,"enableCulling",!0),this.addField_MFString(e,"invisibleNodes",[]),this._idList=[],this._websocket=null,this._nameObjMap={},this._createTime=[],this._visibleList=[],e?this.initializeSocket():x3dom.debug.logWarning("RemoteSelectionGroup: No runtime context found!")},{initializeSocket:function(){var e,s=this;"WebSocket"in window?(e="ws://localhost:35668/cstreams/0",this._vf.url.length&&this._vf.url[0].length&&(e=this._vf.url[0]),this._websocket=new WebSocket(e),this._websocket._lastMsg=null,this._websocket._lastData="",this._websocket.onopen=function(e){x3dom.debug.logInfo("WS Connected");var t=s._nameSpace.doc._viewarea.getViewMatrix();this._lastMsg=t.toGL().toString(),t=s._nameSpace.doc._viewarea.getProjectionMatrix(),this._lastMsg+=","+t.toGL().toString(),this.send(this._lastMsg),x3dom.debug.logInfo("WS Sent: "+this._lastMsg),this._lastMsg="",this._lastData=""},this._websocket.onclose=function(e){x3dom.debug.logInfo("WS Disconnected"),s._vf.reconnect&&window.setTimeout(function(){s.initializeSocket()},2e3)},this._websocket.onmessage=function(e){if(s._vf.maxRenderedIds<0)s._idList=x3dom.fields.MFString.parse(e.data);else if(0<s._vf.maxRenderedIds){s._idList=[];for(var t=x3dom.fields.MFString.parse(e.data),i=Math.min(t.length,Math.abs(s._vf.maxRenderedIds)),o=0;o<i;++o)s._idList[o]=t[o]}0!=s._vf.maxRenderedIds&&this._lastData!=e.data&&(this._lastData=e.data,s._nameSpace.doc.needRender=!0,s.invalidateVolume())},this._websocket.onerror=function(e){x3dom.debug.logError(e.data)},this._websocket.updateCamera=function(){var e=s._nameSpace.doc._viewarea.getViewMatrix().toGL().toString();e+=","+s._nameSpace.doc._viewarea.getProjectionMatrix().toGL().toString(),null!=this._lastMsg&&this._lastMsg!=e&&(this._lastMsg=e,this.send(e))}):x3dom.debug.logError("Browser has no WebSocket support!")},nodeChanged:function(){var e=this._vf.label.length;this._nameObjMap={},this._createTime=new Array(e),this._visibleList=new Array(e);for(var t=0;t<e;++t){var i=this._childNodes[t];i&&x3dom.isa(i,x3dom.nodeTypes.X3DShapeNode)?(this._nameObjMap[this._vf.label[t]]={shape:i,pos:t},this._visibleList[t]=!0):(this._visibleList[t]=!1,x3dom.debug.logError("Invalid children: "+this._vf.label[t])),this._createTime[t]=0}this.invalidateVolume(),x3dom.debug.logInfo("RemoteSelectionGroup has "+e+" entries.")},fieldChanged:function(e){if("url"==e)this._websocket&&(this._websocket.close(),this._websocket=null),this.initializeSocket();else if("invisibleNodes"==e){for(var t=0,i=this._vf.label.length;t<i;++t){var o=this._childNodes[t];if(o&&x3dom.isa(o,x3dom.nodeTypes.X3DShapeNode)){this._visibleList[t]=!0;for(var s=0,n=this._vf.invisibleNodes.length;s<n;++s){var r=this._vf.invisibleNodes[s],a=r.lastIndexOf("*"),d=!1;if(0<a&&(r=r.substring(0,a),d=!0),!(r.length<=1)&&(d&&0==this._vf.label[t].indexOf(r)||this._vf.label[t]==r)){this._visibleList[t]=!1;break}}}else this._visibleList[t]=!1}this.invalidateVolume()}else"render"==e&&this.invalidateVolume()},getNumRenderedObjects:function(e,t){var i,o;return 0<this._vf.maxRenderedIds&&(i=Math.max(this._vf.maxRenderedIds,16),o=1,t&&(o=Math.min(this._vf.scaleRenderedIdsOnMove,1)),i=Math.max(Math.round(o*i),0),e=Math.min(e,i)),e},collectDrawableObjects:function(e,t,i,o,s,n){if((i=i&&1<this._parentNodes.length?!1:i)&&(o=o||this.cacheInvalid())&&this.invalidateCache(),!((s=t.cull(e,this.graphState(),i,s))<=0)){var r=this._nameSpace.doc._viewarea.isMovingOrAnimating(),a=(new Date).getTime(),d=this._childNodes.length;if(this._vf.enableCulling){if(this._websocket&&this._websocket.updateCamera(),this._vf.label.length){for(h=this.getNumRenderedObjects(this._idList.length,r),f=0;f<h;f++){var l=this._nameObjMap[this._idList[f]];l&&l.shape?(l.shape.collectDrawableObjects(e,t,i,o,s,n),this._createTime[l.pos]=a):x3dom.debug.logError("Invalid label: "+this._idList[f])}for(f=0;f<this._childNodes.length;f++)this._childNodes[f]&&!r&&0<this._createTime[f]&&1e4<a-this._createTime[f]&&this._childNodes[f]._cleanupGLObjects&&(this._childNodes[f]._cleanupGLObjects(!0),this._createTime[f]=0)}}else for(var h=this.getNumRenderedObjects(d,r),u=0,f=0;f<d;f++){var c,_=this._childNodes[f];_&&(c=!0,this._visibleList[f]&&u<h&&_.collectDrawableObjects(e,t,i,o,s,n)&&(this._createTime[f]=a,u++,c=!1),c)&&!r&&0<this._createTime[f]&&1e4<a-this._createTime[f]&&_._cleanupGLObjects&&(_._cleanupGLObjects(!0),this._createTime[f]=0)}}}})),x3dom.registerNodeType("Scene","Grouping",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.Scene.superClass.call(this,e),this.addField_SFString(e,"pickMode","idBuf"),this.addField_SFBool(e,"doPickPass",!0),this.addField_SFString(e,"shadowObjectIdMapping",""),this._lastMin=new x3dom.fields.SFVec3f(0,0,0),this._lastMax=new x3dom.fields.SFVec3f(1,1,1),this._shadowIdMap=null,this.loadMapping()},{fieldChanged:function(e){"shadowObjectIdMapping"==e&&this.loadMapping()},updateVolume:function(){var e=this.getVolume();e.isValid()&&(this._lastMin=x3dom.fields.SFVec3f.copy(e.min),this._lastMax=x3dom.fields.SFVec3f.copy(e.max))},loadMapping:function(){var e,t;this._shadowIdMap=null,0!=this._vf.shadowObjectIdMapping.length&&(e=this,(t=new XMLHttpRequest).open("GET",this._nameSpace.getURL(this._vf.shadowObjectIdMapping),!0),x3dom.RequestManager.addRequest(t),t.onload=function(){e._shadowIdMap=JSON.parse(t.response),e._shadowIdMap&&e._shadowIdMap.mapping?x3dom.debug.assert(e._shadowIdMap.maxID<=e._shadowIdMap.mapping.length,"Too few ID map entries in "+e._vf.shadowObjectIdMapping+", length of mapping array is only "+e._shadowIdMap.mapping.length+" instead of "+e._shadowIdMap.ids.length+"!"):x3dom.debug.logWarning("Invalid ID map: "+e._vf.shadowObjectIdMapping)})}})),x3dom.registerNodeType("X3DGeometryNode","Rendering",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.X3DGeometryNode.superClass.call(this,e),this.addField_SFBool(e,"solid",!0),this.addField_SFBool(e,"ccw",!0),this.addField_SFBool(e,"useGeoCache",!!this._nameSpace&&"true"==this._nameSpace.doc.properties.getProperty("useGeoCache","true").toLowerCase()),this.addField_SFBool(e,"lit",!0),this._mesh=new x3dom.Mesh(this)},{getVolume:function(){return this._mesh.getVolume()},invalidateVolume:function(){this._mesh.invalidate()},getCenter:function(){return this._mesh.getCenter()},getDiameter:function(){return this._mesh.getDiameter()},doIntersect:function(e){return this._mesh.doIntersect(e)},forceUpdateCoverage:function(){return!1},hasIndexOffset:function(){return!1},getColorTexture:function(){return null},getColorTextureURL:function(){return null},parentAdded:function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)&&(e._cleanupGLObjects&&e._cleanupGLObjects(!0),e.setAllDirty(),e.invalidateVolume())},needLighting:function(){var e=0<=this._mesh._primType.indexOf("TRIANGLE");return this._vf.lit&&e}})),x3dom.registerNodeType("Mesh","Rendering",defineClass(x3dom.nodeTypes.X3DGeometryNode,function(e){x3dom.nodeTypes.Mesh.superClass.call(this,e),this.addField_SFString(e,"primType","triangle"),this.addField_MFInt32(e,"index",[]),this.addField_MFNode("vertexAttributes",x3dom.nodeTypes.X3DVertexAttributeNode)},{nodeChanged:function(){for(var e=(new Date).getTime(),t=this._cf.vertexAttributes.nodes.length,i=0;i<t;i++){var o=this._cf.vertexAttributes.nodes[i]._vf.name;switch(o.toLowerCase()){case"position":this._mesh._positions[0]=this._cf.vertexAttributes.nodes[i]._vf.value.toGL();break;case"normal":this._mesh._normals[0]=this._cf.vertexAttributes.nodes[i]._vf.value.toGL();break;case"texcoord":this._mesh._texCoords[0]=this._cf.vertexAttributes.nodes[i]._vf.value.toGL();break;case"color":this._mesh._colors[0]=this._cf.vertexAttributes.nodes[i]._vf.value.toGL();break;default:this._mesh._dynamicFields[o]={},this._mesh._dynamicFields[o].numComponents=this._cf.vertexAttributes.nodes[i]._vf.numComponents,this._mesh._dynamicFields[o].value=this._cf.vertexAttributes.nodes[i]._vf.value.toGL()}}this._mesh._indices[0]=this._vf.index.toGL(),this.invalidateVolume(),this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3;e=(new Date).getTime()-e;x3dom.debug.logWarning("Mesh load time: "+e+" ms")}})),x3dom.registerNodeType("PointSet","Rendering",defineClass(x3dom.nodeTypes.X3DGeometryNode,function(e){x3dom.nodeTypes.PointSet.superClass.call(this,e),this.addField_SFNode("coord",x3dom.nodeTypes.X3DCoordinateNode),this.addField_SFNode("color",x3dom.nodeTypes.X3DColorNode),this.addField_SFNode("normal",x3dom.nodeTypes.Normal),this._mesh._primType="POINTS"},{nodeChanged:function(){(new Date).getTime();var e=this._cf.coord.node,e=(x3dom.debug.assert(e,"PointSet without coord node!"),e.getPoints()),t=3,i=this._cf.color.node,o=new x3dom.fields.MFColor,i=(i&&(o=i._vf.color,x3dom.debug.assert(e.length==o.length,"Size of color and coord array differs!"),x3dom.isa(i,x3dom.nodeTypes.ColorRGBA))&&(t=4),this._cf.normal.node),s=new x3dom.fields.MFVec3f;i&&(s=i._vf.vector),this._mesh._numColComponents=t,this._mesh._lit=!1,this._mesh._indices[0]=[],this._mesh._positions[0]=e.toGL(),this._mesh._colors[0]=o.toGL(),this._mesh._normals[0]=s.toGL(),this._mesh._texCoords[0]=[],this.invalidateVolume(),this._mesh._numCoords=this._mesh._positions[0].length/3,(new Date).getTime()},fieldChanged:function(e){var t=null;"coord"==e?(t=this._cf.coord.node.getPoints(),this._mesh._positions[0]=t.toGL(),this.invalidateVolume(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()})):"color"==e&&(t=this._cf.color.node._vf.color,this._mesh._colors[0]=t.toGL(),this._parentNodes.forEach(function(e){e._dirty.colors=!0}))},needLighting:function(){return this._vf.lit&&this._cf.normal.node}})),x3dom.registerNodeType("X3DComposedGeometryNode","Rendering",defineClass(x3dom.nodeTypes.X3DGeometryNode,function(e){x3dom.nodeTypes.X3DComposedGeometryNode.superClass.call(this,e),this.addField_SFBool(e,"colorPerVertex",!0),this.addField_SFBool(e,"normalPerVertex",!0),this.addField_SFString(e,"normalUpdateMode","fast"),this.addField_MFNode("attrib",x3dom.nodeTypes.X3DVertexAttributeNode),this.addField_SFNode("coord",x3dom.nodeTypes.X3DCoordinateNode),this.addField_SFNode("normal",x3dom.nodeTypes.Normal),this.addField_SFNode("color",x3dom.nodeTypes.X3DColorNode),this.addField_SFNode("texCoord",x3dom.nodeTypes.X3DTextureCoordinateNode)},{handleAttribs:function(){for(var e=this._cf.attrib.nodes.length,t=0;t<e;t++){var i=this._cf.attrib.nodes[t]._vf.name;switch(i.toLowerCase()){case"position":this._mesh._positions[0]=this._cf.attrib.nodes[t]._vf.value.toGL();break;case"normal":this._mesh._normals[0]=this._cf.attrib.nodes[t]._vf.value.toGL();break;case"texcoord":this._mesh._texCoords[0]=this._cf.attrib.nodes[t]._vf.value.toGL();break;case"color":this._mesh._colors[0]=this._cf.attrib.nodes[t]._vf.value.toGL();break;default:this._mesh._dynamicFields[i]={},this._mesh._dynamicFields[i].numComponents=this._cf.attrib.nodes[t]._vf.numComponents,this._mesh._dynamicFields[i].value=this._cf.attrib.nodes[t]._vf.value.toGL()}}}})),x3dom.registerNodeType("LineSet","Rendering",defineClass(x3dom.nodeTypes.X3DGeometryNode,function(e){x3dom.nodeTypes.LineSet.superClass.call(this,e),this.addField_MFInt32(e,"vertexCount",[]),this.addField_MFNode("attrib",x3dom.nodeTypes.X3DVertexAttributeNode),this.addField_SFNode("coord",x3dom.nodeTypes.X3DCoordinateNode),this.addField_SFNode("color",x3dom.nodeTypes.X3DColorNode),this._mesh._primType="LINES",x3dom.Utils.needLineWidth=!0},{nodeChanged:function(){var e,t=this._cf.coord.node,t=(x3dom.debug.assert(t),t.getPoints()),t=(this._mesh._positions[0]=t.toGL(),this._cf.color.node),i=(t&&(e=t._vf.color,this._mesh._colors[0]=e.toGL(),this._mesh._numColComponents=3,x3dom.isa(t,x3dom.nodeTypes.ColorRGBA))&&(this._mesh._numColComponents=4),0);this._mesh._indices[0]=[];for(var o=0,s=this._vf.vertexCount.length;o<s;o++){var n=this._vf.vertexCount[o];if(n<2){x3dom.debug.logError("LineSet.vertexCount must not be smaller than 2!");break}for(var r=n-2;0<=r;r--)this._mesh._indices[0].push(i++,i),0==r&&i++}},fieldChanged:function(e){var t;"coord"==e?(t=this._cf.coord.node.getPoints(),this._mesh._positions[0]=t.toGL(),this.invalidateVolume(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()})):"color"==e&&(t=this._cf.color.node._vf.color,this._mesh._colors[0]=t.toGL(),this._parentNodes.forEach(function(e){e._dirty.colors=!0}))}})),x3dom.registerNodeType("IndexedLineSet","Rendering",defineClass(x3dom.nodeTypes.X3DGeometryNode,function(e){x3dom.nodeTypes.IndexedLineSet.superClass.call(this,e),this.addField_SFBool(e,"colorPerVertex",!0),this.addField_MFNode("attrib",x3dom.nodeTypes.X3DVertexAttributeNode),this.addField_SFNode("coord",x3dom.nodeTypes.X3DCoordinateNode),this.addField_SFNode("color",x3dom.nodeTypes.X3DColorNode),this.addField_MFInt32(e,"coordIndex",[]),this.addField_MFInt32(e,"colorIndex",[]),this._mesh._primType="LINES",x3dom.Utils.needLineWidth=!0},{_buildGeometry:function(){(new Date).getTime();var t=this._vf.coordIndex,e=(-1!=t.slice(-1)[0]&&t.push(-1),t.filter(function(e){return-1==e}).length),i=this._vf.colorPerVertex,o=this._vf.colorIndex;if(0==o.length&&!i)for(;o.length<e;)o.push(o.length);var s,n,r,a,d,l,h,u=!1,f=!1,c=(i&&o.length>=t.length&&(f=!0),!i&&o.length>=e&&(f=!0),this._cf.coord.node),_=(x3dom.debug.assert(c),c.getPoints()),c=3,m=this._cf.color.node;if(m&&(u=!0,s=m._vf.color,x3dom.isa(m,x3dom.nodeTypes.ColorRGBA))&&(c=4),this._mesh._indices[0]=[],this._mesh._positions[0]=[],this._mesh._colors[0]=[],u&&f||_.length>x3dom.Utils.maxIndexableCoords){for(g=r=n=x=0;g<t.length;++g)if(!(t[g]>_.length-1))if(-1!==t[g])switch(f&&x3dom.debug.assert(-1!=o[g]),x){case 0:a=+t[g],l=f&&i?+o[g]:f&&!i?+o[r]:a,x=1;break;case 1:v(this._mesh),x=2;break;case 2:a=d,l=h,v(this._mesh)}else x=0,r+=i?0:1;_.length>x3dom.Utils.maxIndexableCoords&&this._mesh.splitMesh(2)}else{for(var p=t.length,x=0,g=0;g<p;++g)if(-1!=t[g])switch(x){case 0:a=+t[g],x=1;break;case 1:d=+t[g],x=2,this._mesh._indices[0].push(a,d);break;case 2:a=d,d=+t[g],this._mesh._indices[0].push(a,d)}else x=0;this._mesh._positions[0]=_.toGL(),u&&(this._mesh._colors[0]=s.toGL(),this._mesh._numColComponents=c)}for(this.invalidateVolume(),this._mesh._numCoords=0,g=0;g<this._mesh._indices.length;g++)this._mesh._numCoords+=this._mesh._positions[g].length/3;function v(e){d=+t[g],h=f&&i?+o[g]:f&&!i?+o[r]:d,e._indices[0].push(n++,n++),e._positions[0].push(_[a].x),e._positions[0].push(_[a].y),e._positions[0].push(_[a].z),e._positions[0].push(_[d].x),e._positions[0].push(_[d].y),e._positions[0].push(_[d].z),u&&(i||(l=h),e._colors[0].push(s[l].r),e._colors[0].push(s[l].g),e._colors[0].push(s[l].b),e._colors[0].push(s[h].r),e._colors[0].push(s[h].g),e._colors[0].push(s[h].b)),r+=i?1:0}(new Date).getTime()},nodeChanged:function(){this._buildGeometry()},fieldChanged:function(e){"coord"==e?(this._buildGeometry(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()})):"color"==e?(this._buildGeometry(),this._parentNodes.forEach(function(e){e._dirty.colors=!0})):"coordIndex"==e?(this._buildGeometry(),this._parentNodes.forEach(function(e){e._dirty.indexes=!0,e.invalidateVolume()})):"colorIndex"==e&&(this._buildGeometry(),this._parentNodes.forEach(function(e){e._dirty.colors=!0,e.invalidateVolume()}))}})),x3dom.registerNodeType("IndexedTriangleSet","Rendering",defineClass(x3dom.nodeTypes.X3DComposedGeometryNode,function(e){x3dom.nodeTypes.IndexedTriangleSet.superClass.call(this,e),this.addField_MFInt32(e,"index",[])},{nodeChanged:function(){(new Date).getTime();this.handleAttribs();var e,t,i,o,s=this._vf.colorPerVertex,n=this._vf.normalPerVertex,r=this._vf.ccw,a=this._vf.index,d=!1,l=!1,h=!1,u=this._cf.coord.node,u=(x3dom.debug.assert(u),e=u._vf.point,this._cf.normal.node),u=(u?(d=!0,t=u._vf.vector):d=!1,""),f=2,c=this._cf.texCoord.node;(c=x3dom.isa(c,x3dom.nodeTypes.MultiTextureCoordinate)&&c._cf.texCoord.nodes.length?c._cf.texCoord.nodes[0]:c)?c._vf.point?(l=!0,i=c._vf.point,x3dom.isa(c,x3dom.nodeTypes.TextureCoordinate3D)&&(f=3)):c._vf.mode&&(u=c._vf.mode):l=!1;var _,m,p,x,g,v,y,T,b,S,F,E,M,C,w,A,R=3,c=this._cf.color.node;for(c?(h=!0,o=c._vf.color,x3dom.isa(c,x3dom.nodeTypes.ColorRGBA)&&(R=4)):h=!1,this._mesh._indices[0]=[],this._mesh._positions[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[],this._mesh._colors[0]=[];0<e.length%3;)e.push(e.length-1);if(c=e.length,!n||!s||c>x3dom.Utils.maxIndexableCoords){for(x=p=m=0,this._mesh._multiIndIndices=[],this._mesh._posSize=e.length,_=0;_<a.length;++_)switch(0<_&&_%3==0&&(m=0,x++),m){case 0:g=+a[_],T=n?g:x,F=g,C=s?g:x,m=1;break;case 1:v=+a[_],b=n?v:x,E=v,w=s?v:x,m=2;break;case 2:y=+a[_],S=n?y:x,M=y,A=s?y:x,m=3,this._mesh._indices[0].push(p++,p++,p++),this._mesh._positions[0].push(e[g].x),this._mesh._positions[0].push(e[g].y),this._mesh._positions[0].push(e[g].z),this._mesh._positions[0].push(e[v].x),this._mesh._positions[0].push(e[v].y),this._mesh._positions[0].push(e[v].z),this._mesh._positions[0].push(e[y].x),this._mesh._positions[0].push(e[y].y),this._mesh._positions[0].push(e[y].z),d?(this._mesh._normals[0].push(t[T].x),this._mesh._normals[0].push(t[T].y),this._mesh._normals[0].push(t[T].z),this._mesh._normals[0].push(t[b].x),this._mesh._normals[0].push(t[b].y),this._mesh._normals[0].push(t[b].z),this._mesh._normals[0].push(t[S].x),this._mesh._normals[0].push(t[S].y),this._mesh._normals[0].push(t[S].z)):this._mesh._multiIndIndices.push(g,v,y),h&&(this._mesh._colors[0].push(o[C].r),this._mesh._colors[0].push(o[C].g),this._mesh._colors[0].push(o[C].b),4===R&&this._mesh._colors[0].push(o[C].a),this._mesh._colors[0].push(o[w].r),this._mesh._colors[0].push(o[w].g),this._mesh._colors[0].push(o[w].b),4===R&&this._mesh._colors[0].push(o[w].a),this._mesh._colors[0].push(o[A].r),this._mesh._colors[0].push(o[A].g),this._mesh._colors[0].push(o[A].b),4===R)&&this._mesh._colors[0].push(o[A].a),l&&(this._mesh._texCoords[0].push(i[F].x),this._mesh._texCoords[0].push(i[F].y),3===f&&this._mesh._texCoords[0].push(i[F].z),this._mesh._texCoords[0].push(i[E].x),this._mesh._texCoords[0].push(i[E].y),3===f&&this._mesh._texCoords[0].push(i[E].z),this._mesh._texCoords[0].push(i[M].x),this._mesh._texCoords[0].push(i[M].y),3===f)&&this._mesh._texCoords[0].push(i[M].z)}d||this._mesh.calcNormals(n?Math.PI:0),l||this._mesh.calcTexCoords(u),this._mesh.splitMesh()}else{for(_=x=0;_<a.length;_++)0<_&&_%3==0&&x++,this._mesh._indices[0].push(a[_]),!n&&d&&(this._mesh._normals[0].push(t[x].x),this._mesh._normals[0].push(t[x].y),this._mesh._normals[0].push(t[x].z)),!s&&h&&(this._mesh._colors[0].push(o[x].r),this._mesh._colors[0].push(o[x].g),this._mesh._colors[0].push(o[x].b),4===R)&&this._mesh._colors[0].push(o[x].a);this._mesh._positions[0]=e.toGL(),d?this._mesh._normals[0]=t.toGL():this._mesh.calcNormals(n?Math.PI:0,r),l?(this._mesh._texCoords[0]=i.toGL(),this._mesh._numTexComponents=f):this._mesh.calcTexCoords(u),h&&s&&(this._mesh._colors[0]=o.toGL(),this._mesh._numColComponents=R)}for(this.invalidateVolume(),this._mesh._numFaces=0,_=this._mesh._numCoords=0;_<this._mesh._indices.length;_++)this._mesh._numFaces+=this._mesh._indices[_].length/3,this._mesh._numCoords+=this._mesh._positions[_].length/3;(new Date).getTime()},fieldChanged:function(e){var t=this._cf.coord.node._vf.point;if(t.length>x3dom.Utils.maxIndexableCoords)x3dom.debug.logWarning("IndexedTriangleSet: fieldChanged with too many coordinates not yet implemented!");else if("coord"==e)this._mesh._positions[0]=t.toGL(),this.invalidateVolume(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()});else if("color"==e){if(t=this._cf.color.node._vf.color,this._vf.colorPerVertex)this._mesh._colors[0]=t.toGL();else if(!this._vf.colorPerVertex){var i=0,o=3;x3dom.isa(this._cf.color.node,x3dom.nodeTypes.ColorRGBA)&&(o=4),this._mesh._colors[0]=[];for(var s=this._vf.index,n=0;n<s.length;++n)0<n&&n%3==0&&i++,this._mesh._colors[0].push(t[i].r),this._mesh._colors[0].push(t[i].g),this._mesh._colors[0].push(t[i].b),4===o&&this._mesh._colors[0].push(t[i].a)}this._parentNodes.forEach(function(e){e._dirty.colors=!0})}else if("normal"==e){if(t=this._cf.normal.node._vf.vector,this._vf.normalPerVertex)this._mesh._normals[0]=t.toGL();else if(!this._vf.normalPerVertex)for(s=this._vf.index,this._mesh._normals[0]=[],n=i=0;n<s.length;++n)0<n&&n%3==0&&i++,this._mesh._normals[0].push(t[i].x),this._mesh._normals[0].push(t[i].y),this._mesh._normals[0].push(t[i].z);this._parentNodes.forEach(function(e){e._dirty.normals=!0})}else"texCoord"==e&&(e=this._cf.texCoord.node,t=(e=x3dom.isa(e,x3dom.nodeTypes.MultiTextureCoordinate)&&e._cf.texCoord.nodes.length?e._cf.texCoord.nodes[0]:e)._vf.point,this._mesh._texCoords[0]=t.toGL(),this._parentNodes.forEach(function(e){e._dirty.texcoords=!0}))}})),x3dom.registerNodeType("IndexedTriangleStripSet","Rendering",defineClass(x3dom.nodeTypes.X3DComposedGeometryNode,function(e){x3dom.nodeTypes.IndexedTriangleStripSet.superClass.call(this,e),this.addField_MFInt32(e,"index",[]),this._hasIndexOffset=!1,this._indexOffset=null},{hasIndexOffset:function(){return this._hasIndexOffset},nodeChanged:function(){this.handleAttribs();var e,t,i,o,s=!1,n=!1,r=!1,a=this._vf.colorPerVertex,d=this._vf.normalPerVertex,l=this._vf.index,h=(l.length&&-1!=l[l.length-1]&&l.push(-1),this._cf.coord.node),h=(x3dom.debug.assert(h),e=h._vf.point,this._cf.normal.node),h=(h?(s=!0,t=h._vf.vector):s=!1,""),u=2,f=this._cf.texCoord.node,c=((f=x3dom.isa(f,x3dom.nodeTypes.MultiTextureCoordinate)&&f._cf.texCoord.nodes.length?f._cf.texCoord.nodes[0]:f)?f._vf.point?(n=!0,i=f._vf.point,x3dom.isa(f,x3dom.nodeTypes.TextureCoordinate3D)&&(u=3)):f._vf.mode&&(h=f._vf.mode):n=!1,this._mesh._numTexComponents=u,3),f=this._cf.color.node,_=(f?(r=!0,o=f._vf.color,x3dom.isa(f,x3dom.nodeTypes.ColorRGBA)&&(c=4)):r=!1,this._mesh._numColComponents=c,this._mesh._indices[0]=[],this._mesh._positions[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[],this._mesh._colors[0]=[],this.invalidateVolume(),this._mesh._numFaces=0,this._mesh._numCoords=0),m=0;if(s&&e.length<=x3dom.Utils.maxIndexableCoords){this._hasIndexOffset=!0,this._indexOffset=[],this._mesh._primType="TRIANGLESTRIP";for(var p=[0],x=0;x<l.length;x++)-1==l[x]?(_++,p.push(this._mesh._indices[0].length)):(this._mesh._indices[0].push(+l[x]),d||(this._mesh._normals[0].push(t[_].x),this._mesh._normals[0].push(t[_].y),this._mesh._normals[0].push(t[_].z)),a||(this._mesh._colors[0].push(o[_].r),this._mesh._colors[0].push(o[_].g),this._mesh._colors[0].push(o[_].b),4===c&&this._mesh._colors[0].push(o[_].a)));for(this._mesh._positions[0]=e.toGL(),d&&(this._mesh._normals[0]=t.toGL()),n?(this._mesh._texCoords[0]=i.toGL(),this._mesh._numTexComponents=u):x3dom.debug.logWarning("IndexedTriangleStripSet: no texCoords given and won't calculate!"),r&&(a&&(this._mesh._colors[0]=o.toGL()),this._mesh._numColComponents=c),x=1;x<p.length;x++){var g=p[x]-p[x-1];this._indexOffset.push({count:g,offset:2*p[x-1]}),this._mesh._numFaces+=g-2}this._mesh._numCoords=this._mesh._positions[0].length/3}else{for(var v,y,T,b,S,F,E,M,C,w,A,R,D=this._hasIndexOffset=!1,x=1;x<l.length-2;++x)-1!=l[x+1]?(T=(y=D?(v=l[x],l[x-1]):(v=l[x-1],l[x]),l[x+1]),D=!D,d?(b=v,S=y,F=T):b=S=F=_,E=v,M=y,C=T,a?(w=v,A=y,R=T):w=A=R=_,this._mesh._indices[0].push(m++,m++,m++),this._mesh._positions[0].push(e[v].x),this._mesh._positions[0].push(e[v].y),this._mesh._positions[0].push(e[v].z),this._mesh._positions[0].push(e[y].x),this._mesh._positions[0].push(e[y].y),this._mesh._positions[0].push(e[y].z),this._mesh._positions[0].push(e[T].x),this._mesh._positions[0].push(e[T].y),this._mesh._positions[0].push(e[T].z),s&&(this._mesh._normals[0].push(t[b].x),this._mesh._normals[0].push(t[b].y),this._mesh._normals[0].push(t[b].z),this._mesh._normals[0].push(t[S].x),this._mesh._normals[0].push(t[S].y),this._mesh._normals[0].push(t[S].z),this._mesh._normals[0].push(t[F].x),this._mesh._normals[0].push(t[F].y),this._mesh._normals[0].push(t[F].z)),r&&(this._mesh._colors[0].push(o[w].r),this._mesh._colors[0].push(o[w].g),this._mesh._colors[0].push(o[w].b),4===c&&this._mesh._colors[0].push(o[w].a),this._mesh._colors[0].push(o[A].r),this._mesh._colors[0].push(o[A].g),this._mesh._colors[0].push(o[A].b),4===c&&this._mesh._colors[0].push(o[A].a),this._mesh._colors[0].push(o[R].r),this._mesh._colors[0].push(o[R].g),this._mesh._colors[0].push(o[R].b),4===c)&&this._mesh._colors[0].push(o[R].a),n&&(this._mesh._texCoords[0].push(i[E].x),this._mesh._texCoords[0].push(i[E].y),3===u&&this._mesh._texCoords[0].push(i[E].z),this._mesh._texCoords[0].push(i[M].x),this._mesh._texCoords[0].push(i[M].y),3===u&&this._mesh._texCoords[0].push(i[M].z),this._mesh._texCoords[0].push(i[C].x),this._mesh._texCoords[0].push(i[C].y),3===u)&&this._mesh._texCoords[0].push(i[C].z)):(x+=2,_++);for(s||this._mesh.calcNormals(Math.PI),n||this._mesh.calcTexCoords(h),this._mesh.splitMesh(),this.invalidateVolume(),x=0;x<this._mesh._indices.length;x++)this._mesh._numFaces+=this._mesh._indices[x].length/3,this._mesh._numCoords+=this._mesh._positions[x].length/3}},fieldChanged:function(e){if("coord"==e||"normal"==e||"texCoord"==e||"color"==e){var t=this._cf.coord.node._vf.point;if(null===this._cf.normal.node||t.length>x3dom.Utils.maxIndexableCoords){if("coord"==e){this._mesh._positions[0]=[],this._mesh._indices[0]=[],this._mesh._normals[0]=[];var i,o,s,n,r=!(this._mesh._texCoords[0]=[]),a=!1,d=!1,l=this._vf.colorPerVertex,h=this._vf.normalPerVertex,u=this._vf.index,f=this._cf.coord.node,f=(x3dom.debug.assert(f),i=f._vf.point,this._cf.normal.node),f=(f?(r=!0,o=f._vf.vector):r=!1,""),c=2,_=this._cf.texCoord.node,m=((_=x3dom.isa(_,x3dom.nodeTypes.MultiTextureCoordinate)&&_._cf.texCoord.nodes.length?_._cf.texCoord.nodes[0]:_)?_._vf.point?(a=!0,s=_._vf.point,x3dom.isa(_,x3dom.nodeTypes.TextureCoordinate3D)&&(c=3)):_._vf.mode&&(f=_._vf.mode):a=!1,this._mesh._numTexComponents=c,3),p=this._cf.color.node;p?(d=!0,n=p._vf.color,x3dom.isa(p,x3dom.nodeTypes.ColorRGBA)&&(m=4)):d=!1,this._mesh._numColComponents=m,this._mesh._indices[0]=[],this._mesh._positions[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[];var x,g,v,y,T,b,S,F,E,M=0,C=0,w=!(this._mesh._colors[0]=[]);if(r||a||d){for(var A=1;A<u.length-2;++A)-1!=u[A+1]?(v=(g=w?(x=u[A],u[A-1]):(x=u[A-1],u[A]),u[A+1]),w=!w,h?(I=x,y=g,T=v):I=y=T=M,V=x,b=g,S=v,l?(D=x,F=g,E=v):D=F=E=M,this._mesh._indices[0].push(C++,C++,C++),this._mesh._positions[0].push(i[x].x),this._mesh._positions[0].push(i[x].y),this._mesh._positions[0].push(i[x].z),this._mesh._positions[0].push(i[g].x),this._mesh._positions[0].push(i[g].y),this._mesh._positions[0].push(i[g].z),this._mesh._positions[0].push(i[v].x),this._mesh._positions[0].push(i[v].y),this._mesh._positions[0].push(i[v].z),r&&(this._mesh._normals[0].push(o[I].x),this._mesh._normals[0].push(o[I].y),this._mesh._normals[0].push(o[I].z),this._mesh._normals[0].push(o[y].x),this._mesh._normals[0].push(o[y].y),this._mesh._normals[0].push(o[y].z),this._mesh._normals[0].push(o[T].x),this._mesh._normals[0].push(o[T].y),this._mesh._normals[0].push(o[T].z)),d&&(this._mesh._colors[0].push(n[D].r),this._mesh._colors[0].push(n[D].g),this._mesh._colors[0].push(n[D].b),4===m&&this._mesh._colors[0].push(n[D].a),this._mesh._colors[0].push(n[F].r),this._mesh._colors[0].push(n[F].g),this._mesh._colors[0].push(n[F].b),4===m&&this._mesh._colors[0].push(n[F].a),this._mesh._colors[0].push(n[E].r),this._mesh._colors[0].push(n[E].g),this._mesh._colors[0].push(n[E].b),4===m)&&this._mesh._colors[0].push(n[E].a),a&&(this._mesh._texCoords[0].push(s[V].x),this._mesh._texCoords[0].push(s[V].y),3===c&&this._mesh._texCoords[0].push(s[V].z),this._mesh._texCoords[0].push(s[b].x),this._mesh._texCoords[0].push(s[b].y),3===c&&this._mesh._texCoords[0].push(s[b].z),this._mesh._texCoords[0].push(s[S].x),this._mesh._texCoords[0].push(s[S].y),3===c)&&this._mesh._texCoords[0].push(s[S].z)):(A+=2,M++);r||this._mesh.calcNormals(Math.PI),a||this._mesh.calcTexCoords(f),this._mesh.splitMesh()}else{for(w=!1,A=1;A<u.length;++A)-1!=u[A+1]?(w?(this._mesh._indices[0].push(u[A]),this._mesh._indices[0].push(u[A-1])):(this._mesh._indices[0].push(u[A-1]),this._mesh._indices[0].push(u[A])),this._mesh._indices[0].push(u[A+1]),w=!w):A+=2;this._mesh._positions[0]=i.toGL(),this._mesh.calcNormals(Math.PI),this._mesh.calcTexCoords(f)}for(this.invalidateVolume(),this._mesh._numFaces=0,A=this._mesh._numCoords=0;A<this._mesh._indices.length;A++)this._mesh._numFaces+=this._mesh._indices[A].length/3,this._mesh._numCoords+=this._mesh._positions[A].length/3;this._parentNodes.forEach(function(e){e.setAllDirty(),e.invalidateVolume()})}else if("color"==e){var R=this._cf.color.node._vf.color,D=F=E=M=0,m=3;for(x3dom.isa(this._cf.color.node,x3dom.nodeTypes.ColorRGBA)&&(m=4),this._mesh._colors[0]=[],u=this._vf.index,w=!1,A=1;A<u.length-2;++A)-1!=u[A+1]?(this._vf.colorPerVertex?(E=(F=w?(D=u[A],u[A-1]):(D=u[A-1],u[A]),u[A+1]),w=!w):(this._vf.colorPerVertex,D=F=E=M),this._mesh._colors[0].push(R[D].r),this._mesh._colors[0].push(R[D].g),this._mesh._colors[0].push(R[D].b),4===m&&this._mesh._colors[0].push(R[D].a),this._mesh._colors[0].push(R[F].r),this._mesh._colors[0].push(R[F].g),this._mesh._colors[0].push(R[F].b),4===m&&this._mesh._colors[0].push(R[F].a),this._mesh._colors[0].push(R[E].r),this._mesh._colors[0].push(R[E].g),this._mesh._colors[0].push(R[E].b),4===m&&this._mesh._colors[0].push(R[E].a)):(A+=2,M++);this._parentNodes.forEach(function(e){e._dirty.colors=!0})}else if("normal"==e){var N=this._cf.normal.node._vf.vector,I=y=T=M=0;for(this._mesh._normals[0]=[],u=this._vf.index,w=!1,A=1;A<u.length-2;++A)-1!=u[A+1]?(this._vf.normalPerVertex?(T=(y=w?(I=u[A],u[A-1]):(I=u[A-1],u[A]),u[A+1]),w=!w):(this._vf.normalPerVertex,I=y=T=M),this._mesh._normals[0].push(N[I].x),this._mesh._normals[0].push(N[I].y),this._mesh._normals[0].push(N[I].z),this._mesh._normals[0].push(N[y].x),this._mesh._normals[0].push(N[y].y),this._mesh._normals[0].push(N[y].z),this._mesh._normals[0].push(N[T].x),this._mesh._normals[0].push(N[T].y),this._mesh._normals[0].push(N[T].z)):(A+=2,M++);this._parentNodes.forEach(function(e){e._dirty.normals=!0})}else if("texCoord"==e){var _=this._cf.texCoord.node,P=(_=x3dom.isa(_,x3dom.nodeTypes.MultiTextureCoordinate)&&_._cf.texCoord.nodes.length?_._cf.texCoord.nodes[0]:_)._vf.point,V=b=S=0,c=2;for(x3dom.isa(_,x3dom.nodeTypes.TextureCoordinate3D)&&(c=3),this._mesh._texCoords[0]=[],u=this._vf.index,w=!1,A=1;A<u.length-2;++A)-1!=u[A+1]?(S=(b=w?(V=u[A],u[A-1]):(V=u[A-1],u[A]),u[A+1]),w=!w,this._mesh._texCoords[0].push(P[V].x),this._mesh._texCoords[0].push(P[V].y),3===c&&this._mesh._texCoords[0].push(P[V].z),this._mesh._texCoords[0].push(P[b].x),this._mesh._texCoords[0].push(P[b].y),3===c&&this._mesh._texCoords[0].push(P[b].z),this._mesh._texCoords[0].push(P[S].x),this._mesh._texCoords[0].push(P[S].y),3===c&&this._mesh._texCoords[0].push(P[S].z)):A+=2;this._parentNodes.forEach(function(e){e._dirty.texcoords=!0})}}else if("coord"==e)this._mesh._positions[0]=t.toGL(),this.invalidateVolume(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()});else if("color"==e){if(t=this._cf.color.node._vf.color,this._vf.colorPerVertex)this._mesh._colors[0]=t.toGL();else if(!this._vf.colorPerVertex)for(M=0,m=3,x3dom.isa(this._cf.color.node,x3dom.nodeTypes.ColorRGBA)&&(m=4),this._mesh._colors[0]=[],u=this._vf.index,A=0;A<u.length;++A)-1!=u[A]?(this._mesh._colors[0].push(t[M].r),this._mesh._colors[0].push(t[M].g),this._mesh._colors[0].push(t[M].b),4===m&&this._mesh._colors[0].push(t[M].a)):M++;this._parentNodes.forEach(function(e){e._dirty.colors=!0})}else if("normal"==e){if(t=this._cf.normal.node._vf.vector,this._vf.normalPerVertex)this._mesh._normals[0]=t.toGL();else if(!this._vf.normalPerVertex)for(u=this._vf.index,this._mesh._normals[0]=[],A=M=0;A<u.length;++A)-1!=u[A]?(this._mesh._normals[0].push(t[M].x),this._mesh._normals[0].push(t[M].y),this._mesh._normals[0].push(t[M].z)):M++;this._parentNodes.forEach(function(e){e._dirty.normals=!0})}else"texCoord"==e&&(_=this._cf.texCoord.node,t=(_=x3dom.isa(_,x3dom.nodeTypes.MultiTextureCoordinate)&&_._cf.texCoord.nodes.length?_._cf.texCoord.nodes[0]:_)._vf.point,this._mesh._texCoords[0]=t.toGL(),this._parentNodes.forEach(function(e){e._dirty.texcoords=!0}))}else x3dom.debug.logWarning("IndexedTriangleStripSet: fieldChanged for "+e+" not yet implemented!")}})),x3dom.registerNodeType("TriangleSet","Rendering",defineClass(x3dom.nodeTypes.X3DComposedGeometryNode,function(e){x3dom.nodeTypes.TriangleSet.superClass.call(this,e)},{_buildGeometry:function(){var e,t,i,o=this._vf.colorPerVertex,s=this._vf.normalPerVertex,n=this._vf.ccw,r=!1,a=!1,d=!1,l=this._cf.coord.node;if(x3dom.debug.assert(l),!l||l._vf.point.length<3)this._vf.visible=!1;else{var h=l._vf.point,l=this._cf.normal.node,l=(l?(r=!0,e=l._vf.vector):r=!1,""),u=2,f=this._cf.texCoord.node,c=((f=x3dom.isa(f,x3dom.nodeTypes.MultiTextureCoordinate)&&f._cf.texCoord.nodes.length?f._cf.texCoord.nodes[0]:f)?f._vf.point?(a=!0,t=f._vf.point,x3dom.isa(f,x3dom.nodeTypes.TextureCoordinate3D)&&(u=3)):f._vf.mode&&(l=f._vf.mode):a=!1,3),f=this._cf.color.node;for(f?(d=!0,i=f._vf.color,x3dom.isa(f,x3dom.nodeTypes.ColorRGBA)&&(c=4)):d=!1;0<h.length%3;)h.pop();this._mesh._indices[0]=new Array(h.length),this._mesh._positions[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[],this._mesh._colors[0]=[];for(var _=h.length/3,m=0,p=0;p<_;p++)this._mesh._indices[0][m]=m++,this._mesh._indices[0][m]=m++,this._mesh._indices[0][m]=m++,!s&&r&&(this._mesh._normals[0].push(e[p].x),this._mesh._normals[0].push(e[p].y),this._mesh._normals[0].push(e[p].z)),!o&&d&&(this._mesh._colors[0].push(i[p].r),this._mesh._colors[0].push(i[p].g),this._mesh._colors[0].push(i[p].b),4===c)&&this._mesh._colors[0].push(i[p].a);this._mesh._positions[0]=h.toGL(),r?this._mesh._normals[0]=e.toGL():this._mesh.calcNormals(s?Math.PI:0,n),a?(this._mesh._texCoords[0]=t.toGL(),this._mesh._numTexComponents=u):this._mesh.calcTexCoords(l),d&&o&&(this._mesh._colors[0]=i.toGL(),this._mesh._numColComponents=c),this._mesh._numFaces=_,this._mesh._numCoords=h.length,this.invalidateVolume()}},nodeChanged:function(){this._buildGeometry()},fieldChanged:function(e){"coord"==e?(this._buildGeometry(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()})):"color"==e?(this._buildGeometry(),this._parentNodes.forEach(function(e){e._dirty.colors=!0})):"normal"==e?(this._buildGeometry(),this._parentNodes.forEach(function(e){e._dirty.normals=!0})):"texCoord"==e&&(this._buildGeometry(),this._parentNodes.forEach(function(e){e._dirty.texcoords=!0}))}})),x3dom.registerNodeType("X3DGeometricPropertyNode","Rendering",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.X3DGeometricPropertyNode.superClass.call(this,e)})),x3dom.registerNodeType("X3DCoordinateNode","Rendering",defineClass(x3dom.nodeTypes.X3DGeometricPropertyNode,function(e){x3dom.nodeTypes.X3DCoordinateNode.superClass.call(this,e)},{fieldChanged:function(e){"coord"!==e&&"point"!==e||this._parentNodes.forEach(function(e){e.fieldChanged("coord")})},parentAdded:function(e){e._mesh&&e._cf.coord&&e._cf.coord.node!==this&&e.fieldChanged("coord")}})),x3dom.registerNodeType("Coordinate","Rendering",defineClass(x3dom.nodeTypes.X3DCoordinateNode,function(e){x3dom.nodeTypes.Coordinate.superClass.call(this,e),this.addField_MFVec3f(e,"point",[])},{getPoints:function(){return this._vf.point}})),x3dom.registerNodeType("CoordinateDouble","Nurbs",defineClass(x3dom.nodeTypes.X3DCoordinateNode,function(e){x3dom.nodeTypes.CoordinateDouble.superClass.call(this,e),this.addField_MFVec3d(e,"point",[])},{getPoints:function(){return this._vf.point}})),x3dom.registerNodeType("Normal","Rendering",defineClass(x3dom.nodeTypes.X3DGeometricPropertyNode,function(e){x3dom.nodeTypes.Normal.superClass.call(this,e),this.addField_MFVec3f(e,"vector",[])},{fieldChanged:function(e){"normal"!==e&&"vector"!==e||this._parentNodes.forEach(function(e){e.fieldChanged("normal")})},parentAdded:function(e){e._mesh&&e._cf.normal.node!==this&&e.fieldChanged("normal")}})),x3dom.registerNodeType("X3DColorNode","Rendering",defineClass(x3dom.nodeTypes.X3DGeometricPropertyNode,function(e){x3dom.nodeTypes.X3DColorNode.superClass.call(this,e)},{fieldChanged:function(e){"color"===e&&this._parentNodes.forEach(function(e){e.fieldChanged("color")})},parentAdded:function(e){e._mesh&&e._cf.color.node!==this&&e.fieldChanged("color")}})),x3dom.registerNodeType("Color","Rendering",defineClass(x3dom.nodeTypes.X3DColorNode,function(e){x3dom.nodeTypes.Color.superClass.call(this,e),this.addField_MFColor(e,"color",[])})),x3dom.registerNodeType("ColorRGBA","Rendering",defineClass(x3dom.nodeTypes.X3DColorNode,function(e){x3dom.nodeTypes.ColorRGBA.superClass.call(this,e),this.addField_MFColorRGBA(e,"color",[])})),x3dom.registerNodeType("ParticleSet","Rendering",defineClass(x3dom.nodeTypes.PointSet,function(e){x3dom.nodeTypes.ParticleSet.superClass.call(this,e),this.addField_SFString(e,"mode","ViewDirQuads"),this.addField_SFString(e,"drawOrder","Any"),this.addField_SFNode("normal",x3dom.nodeTypes.Normal),this.addField_MFVec3f(e,"size",[]),this.addField_MFInt32(e,"index",[]),this.addField_MFFloat(e,"textureZ",[]),this._mesh._primType="POINTS"},{drawOrder:function(){return this._vf.drawOrder.toLowerCase()},nodeChanged:function(){var e=this._cf.coord.node,e=(x3dom.debug.assert(e,"ParticleSet without coord node!"),e.getPoints()),t=3,i=this._cf.color.node,o=new x3dom.fields.MFColor,i=(i&&(o=i._vf.color,x3dom.debug.assert(e.length==o.length,"Size of color and coord array differs!"),x3dom.isa(i,x3dom.nodeTypes.ColorRGBA))&&(t=4),this._cf.normal.node),s=new x3dom.fields.MFVec3f,n=(i&&(s=i._vf.vector),[]);if("any"!=this.drawOrder()&&0==(n=this._vf.index.toGL()).length)for(var r=e.length,n=new Array(r),a=0;a<r;a++)n[a]=a;this._mesh._numColComponents=t,this._mesh._lit=!1,this._mesh._indices[0]=n,this._mesh._positions[0]=e.toGL(),this._mesh._colors[0]=o.toGL(),this._mesh._normals[0]=s.toGL(),this._mesh._texCoords[0]=[],this.invalidateVolume(),this._mesh._numCoords=this._mesh._positions[0].length/3},fieldChanged:function(e){var t=null;if("index"==e)this._mesh._indices[0]=this._vf.index.toGL(),this._parentNodes.forEach(function(e){e._dirty.indexes=!0});else if("size"==e)this._parentNodes.forEach(function(e){e._dirty.specialAttribs=!0});else if("coord"==e){t=this._cf.coord.node.getPoints(),this._mesh._positions[0]=t.toGL();var i=[];if("any"!=this.drawOrder()&&0==(i=this._vf.index.toGL()).length)for(var o=t.length,i=new Array(o),s=0;s<o;s++)i[s]=s;this._mesh._indices[0]=i,this.invalidateVolume(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,e._dirty.indexes=!0,e.invalidateVolume()})}else"color"==e&&(t=this._cf.color.node._vf.color,this._mesh._colors[0]=t.toGL(),this._parentNodes.forEach(function(e){e._dirty.colors=!0}))}})),x3dom.registerNodeType("ClipPlane","Rendering",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.ClipPlane.superClass.call(this,e),this.addField_SFBool(e,"enabled",!0),this.addField_SFVec4f(e,"plane",0,1,0,0),this.addField_SFFloat(e,"cappingStrength",0),this.addField_SFColor(e,"cappingColor",1,1,1),this.addField_SFBool(e,"on",!0)},{fieldChanged:function(e){},nodeChanged:function(){x3dom.nodeTypes.ClipPlane.count++},onRemove:function(){x3dom.nodeTypes.ClipPlane.count--},parentAdded:function(e){},parentRemoved:function(e){}})),x3dom.nodeTypes.ClipPlane.count=0,x3dom.registerNodeType("X3DAppearanceNode","Shape",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.X3DAppearanceNode.superClass.call(this,e)})),x3dom.registerNodeType("Appearance","Shape",defineClass(x3dom.nodeTypes.X3DAppearanceNode,function(e){x3dom.nodeTypes.Appearance.superClass.call(this,e),this.addField_SFNode("material",x3dom.nodeTypes.X3DMaterialNode),this.addField_SFNode("texture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("textureTransform",x3dom.nodeTypes.X3DTextureTransformNode),this.addField_SFNode("lineProperties",x3dom.nodeTypes.LineProperties),this.addField_SFNode("pointProperties",x3dom.nodeTypes.PointProperties),this.addField_SFNode("colorMaskMode",x3dom.nodeTypes.ColorMaskMode),this.addField_SFNode("blendMode",x3dom.nodeTypes.BlendMode),this.addField_SFNode("depthMode",x3dom.nodeTypes.DepthMode),this.addField_MFNode("shaders",x3dom.nodeTypes.X3DShaderNode),this.addField_SFString(e,"sortType","auto"),this.addField_SFInt32(e,"sortKey",0),this.addField_SFFloat(e,"alphaClipThreshold",.1),this._shader=null,this._origSortType=this._vf.sortType},{fieldChanged:function(e){"alphaClipThreshold"==e&&this._parentNodes.forEach(function(e){e.setAppDirty()}),"sortType"==e&&(this._origSortType=this._vf.sortType,this.checkSortType())},nodeChanged:function(){this._cf.material.node,this._cf.shaders.nodes.length?this._shader=this._cf.shaders.nodes[0]:this._shader&&(this._shader=null),this._parentNodes.forEach(function(e){e.setAppDirty()}),this.checkSortType()},checkSortType:function(){var e;"auto"==this._origSortType&&(this._cf.material.node&&(0<this._cf.material.node._vf.transparency||this._cf.material.node._vf.backTransparency&&0<this._cf.material.node._vf.backTransparency)?this._vf.sortType="transparent":this._cf.texture.node&&this._cf.texture.node._vf.url.length?4==this._cf.texture.node._vf.origChannelCount||2==this._cf.texture.node._vf.origChannelCount?this._vf.sortType="transparent":this._vf.sortType="opaque":x3dom.isa(this._cf.material.node,x3dom.nodeTypes.PhysicalMaterial)?("OPAQUE"==(e=this._cf.material.node)._vf.alphaMode?this._vf.sortType="opaque":"BLEND"!=e._vf.alphaMode&&"MASK"!=e._vf.alphaMode||(this._vf.sortType="transparent"),e=e._cf.baseColorTexture.node,"opaque"==this._vf.sortType&&e&&e._vf.url.length&&0<=e._vf.url[0].toLowerCase().indexOf(".png")&&(this._vf.sortType="transparent")):this._vf.sortType="opaque")},texTransformMatrix:function(){return null===this._cf.textureTransform.node?x3dom.fields.SFMatrix4f.identity():this._cf.textureTransform.node.texTransformMatrix()},parentAdded:function(e){this!=x3dom.nodeTypes.Appearance._defaultNode&&e.setAppDirty()}})),x3dom.nodeTypes.Appearance.defaultNode=function(){return x3dom.nodeTypes.Appearance._defaultNode||(x3dom.nodeTypes.Appearance._defaultNode=new x3dom.nodeTypes.Appearance,x3dom.nodeTypes.Appearance._defaultNode.nodeChanged()),x3dom.nodeTypes.Appearance._defaultNode},x3dom.registerNodeType("X3DAppearanceChildNode","Shape",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.X3DAppearanceChildNode.superClass.call(this,e)})),x3dom.registerNodeType("BlendMode","Shape",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.BlendMode.superClass.call(this,e),this.addField_SFString(e,"srcFactor","src_alpha"),this.addField_SFString(e,"destFactor","one_minus_src_alpha"),this.addField_SFColor(e,"color",1,1,1),this.addField_SFFloat(e,"colorTransparency",0),this.addField_SFString(e,"alphaFunc","none"),this.addField_SFFloat(e,"alphaFuncValue",0),this.addField_SFString(e,"equation","none")})),x3dom.registerNodeType("DepthMode","Shape",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.DepthMode.superClass.call(this,e),this.addField_SFBool(e,"enableDepthTest",!0),this.addField_SFString(e,"depthFunc","none"),this.addField_SFBool(e,"readOnly",!1),this.addField_SFFloat(e,"zNearRange",-1),this.addField_SFFloat(e,"zFarRange",-1)})),x3dom.registerNodeType("ColorMaskMode","Shape",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.ColorMaskMode.superClass.call(this,e),this.addField_SFBool(e,"maskR",!0),this.addField_SFBool(e,"maskG",!0),this.addField_SFBool(e,"maskB",!0),this.addField_SFBool(e,"maskA",!0)})),x3dom.registerNodeType("LineProperties","Shape",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.LineProperties.superClass.call(this,e),this.addField_SFBool(e,"applied",!0),this.addField_SFInt32(e,"linetype",1),this.addField_SFFloat(e,"linewidthScaleFactor",0)})),x3dom.registerNodeType("PointProperties","Shape",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.PointProperties.superClass.call(this,e),this.addField_SFFloat(e,"pointSizeScaleFactor",1),this.addField_SFFloat(e,"pointSizeMinValue",1),this.addField_SFFloat(e,"pointSizeMaxValue",1),this.addField_SFVec3f(e,"attenuation",1,0,0)},{nodeChanged:function(){this._vf.pointSizeMinValue>this._vf.pointSizeMaxValue&&(x3dom.debug.logWarning("pointSizeMinValue is larger than pointSizeMaxValue, will set to MaxValue"),this._vf.pointSizeMinValue=this._vf.pointSizeMaxValue)},fieldChanged:function(e){this._nodeChanged()}})),x3dom.registerNodeType("X3DMaterialNode","Shape",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.X3DMaterialNode.superClass.call(this,e)},{_fieldChanged:function(e,t){-1<t.indexOf(e)&&this._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)&&(e._dirty.material=!0)}),x3dom.isa(e,x3dom.nodeTypes.X3DAppearanceNode)&&e.checkSortType()})}})),x3dom.registerNodeType("Material","Shape",defineClass(x3dom.nodeTypes.X3DMaterialNode,function(e){x3dom.nodeTypes.Material.superClass.call(this,e),this.addField_SFFloat(e,"ambientIntensity",.2),this.addField_SFColor(e,"diffuseColor",.8,.8,.8),this.addField_SFColor(e,"emissiveColor",0,0,0),this.addField_SFFloat(e,"shininess",.2),this.addField_SFColor(e,"specularColor",0,0,0),this.addField_SFFloat(e,"transparency",0)},{fieldChanged:function(e){this._fieldChanged(e,["ambientIntensity","diffuseColor","emissiveColor","shininess","specularColor","transparency"])}})),x3dom.nodeTypes.Material.defaultNode=function(){return x3dom.nodeTypes.Material._defaultNode||(x3dom.nodeTypes.Material._defaultNode=new x3dom.nodeTypes.Material,x3dom.nodeTypes.Material._defaultNode.nodeChanged()),x3dom.nodeTypes.Material._defaultNode},x3dom.registerNodeType("TwoSidedMaterial","Shape",defineClass(x3dom.nodeTypes.Material,function(e){x3dom.nodeTypes.TwoSidedMaterial.superClass.call(this,e),this.addField_SFFloat(e,"backAmbientIntensity",.2),this.addField_SFColor(e,"backDiffuseColor",.8,.8,.8),this.addField_SFColor(e,"backEmissiveColor",0,0,0),this.addField_SFFloat(e,"backShininess",.2),this.addField_SFColor(e,"backSpecularColor",0,0,0),this.addField_SFFloat(e,"backTransparency",0),this.addField_SFBool(e,"separateBackColor",!1)},{fieldChanged:function(e){this._fieldChanged(e,["ambientIntensity","diffuseColor","emissiveColor","shininess","specularColor","transparency","backAmbientIntensity","backDiffuseColor","backEmissiveColor","backShininess","backSpecularColor","backTransparency","separateBackColor"])}})),x3dom.registerNodeType("PhysicalMaterial","Shape",defineClass(x3dom.nodeTypes.X3DMaterialNode,function(e){x3dom.nodeTypes.X3DMaterialNode.superClass.call(this,e),this.addField_SFString(e,"model","roughnessMetallic"),this.addField_SFColorRGBA(e,"baseColorFactor",1,1,1,1),this.addField_SFFloat(e,"metallicFactor",0),this.addField_SFFloat(e,"roughnessFactor",.2),this.addField_SFColorRGBA(e,"diffuseFactor",1,1,1,1),this.addField_SFColor(e,"specularFactor",1,1,1),this.addField_SFFloat(e,"glossinessFactor",1),this.addField_SFColor(e,"emissiveFactor",0,0,0),this.addField_SFString(e,"normalSpace","TANGENT"),this.addField_SFString(e,"alphaMode","OPAQUE"),this.addField_SFFloat(e,"alphaCutoff",.5),this.addField_SFVec3f(e,"normalBias",-1,-1,1),this.addField_SFFloat(e,"normalScale",1),this.addField_SFBool(e,"unlit",!1),this.addField_SFNode("baseColorTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("emissiveTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("roughnessMetallicTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("specularGlossinessTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("occlusionRoughnessMetallicTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("normalTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("occlusionTexture",x3dom.nodeTypes.X3DTextureNode)},{fieldChanged:function(e){this._fieldChanged(e,["baseColorFactor","metallicFactor","roughnessFactor","emissiveFactor"]),"alphaMode"==e&&this._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)&&(e._dirty.shader=!0)}),x3dom.isa(e,x3dom.nodeTypes.X3DAppearanceNode)&&e.checkSortType()})},hasTextures:function(){return this._cf.baseColorTexture.node||this._cf.normalTexture.node||this._cf.occlusionTexture.node||this._cf.emissiveTexture.node||this._cf.roughnessMetallicTexture.node},getTextures:function(){var e=[];return this._cf.baseColorTexture.node&&(this._cf.baseColorTexture.node._type="diffuseMap",e.push(this._cf.baseColorTexture.node)),this._cf.normalTexture.node&&(this._cf.normalTexture.node._type="normalMap",e.push(this._cf.normalTexture.node)),this._cf.occlusionTexture.node&&(this._cf.occlusionTexture.node._type="occlusionMap",e.push(this._cf.occlusionTexture.node)),this._cf.emissiveTexture.node&&(this._cf.emissiveTexture.node._type="emissiveMap",e.push(this._cf.emissiveTexture.node)),this._cf.roughnessMetallicTexture.node&&(this._cf.roughnessMetallicTexture.node._type="roughnessMetallicMap",e.push(this._cf.roughnessMetallicTexture.node)),this._cf.specularGlossinessTexture.node&&(this._cf.specularGlossinessTexture.node._type="specularGlossinessMap",e.push(this._cf.specularGlossinessTexture.node)),this._cf.occlusionRoughnessMetallicTexture.node&&(this._cf.occlusionRoughnessMetallicTexture.node._type="occlusionRoughnessMetallicMap",e.push(this._cf.occlusionRoughnessMetallicTexture.node)),e}})),x3dom.registerNodeType("X3DShapeNode","Shape",defineClass(x3dom.nodeTypes.X3DBoundedObject,function(e){x3dom.nodeTypes.X3DShapeNode.superClass.call(this,e),this.addField_SFBool(e,"isPickable",!0),this.addField_SFInt32(e,"idOffset",0),this.addField_SFNode("appearance",x3dom.nodeTypes.X3DAppearanceNode),this.addField_SFNode("geometry",x3dom.nodeTypes.X3DGeometryNode),this._objectID=0,this._shaderProperties=null,this._clipPlanes=[],this._cleanupGLObjects=null,this._dirty={positions:!0,normals:!0,texcoords:!0,colors:!0,tangents:!0,binormals:!0,specialAttribs:!0,indexes:!0,texture:!0,material:!0,text:!0,shader:!0,ids:!0},this._indexOffset=0,this._coordStrideOffset=[0,0],this._normalStrideOffset=[0,0],this._texCoordStrideOffset=[0,0],this._texCoord2StrideOffset=[0,0],this._colorStrideOffset=[0,0],this._idStrideOffset=[0,0],this._tangentStrideOffset=[0,0],this._binormalStrideOffset=[0,0],this._tessellationProperties=[]},{collectDrawableObjects:function(e,t,i,o,s,n){var r=this.graphState();return(i=i&&1<this._parentNodes.length?!1:i)&&(o=o||this.cacheInvalid())&&this.invalidateCache(),i&&!this._graph.globalMatrix&&(this._graph.globalMatrix=e),this._clipPlanes.length!=n.length&&(this._dirty.shader=!0),this._clipPlanes=n,this.collectBbox(e,t,i,o,s,n),!(!this._cf.geometry.node||t.cull(e,r,i,s)<=0||(t.addShape(this,e,r),0))},getVolume:function(){var e,t=this._graph.volume;return!this.volumeValid()&&(this._vf.bboxDisplay||this.renderFlag&&this.renderFlag())&&(e=(e=this._cf.geometry.node)?e.getVolume():null)&&e.isValid()&&t.extendBounds(e.min,e.max),t},getCenter:function(){var e=this._cf.geometry.node;return e?e.getCenter():new x3dom.fields.SFVec3f(0,0,0)},getDiameter:function(){var e=this._cf.geometry.node;return e?e.getDiameter():0},doIntersect:function(e){return this._cf.geometry.node.doIntersect(e)},forceUpdateCoverage:function(){var e=this._cf.geometry.node;return!!e&&e.forceUpdateCoverage()},tessellationProperties:function(){var e=this._cf.geometry.node;return e&&e._indexOffset?e._indexOffset:this._tessellationProperties},isLit:function(){return this._cf.geometry.node._vf.lit},isSolid:function(){var e=this._cf.appearance.node&&this._cf.appearance.node._cf.material.node&&x3dom.isa(this._cf.appearance.node._cf.material.node,x3dom.nodeTypes.TwoSidedMaterial);return this._cf.geometry.node._vf.solid&&!e},isCCW:function(){return this._cf.geometry.node._vf.ccw},parentRemoved:function(e){for(var t=0,i=this._childNodes.length;t<i;t++){var o=this._childNodes[t];o&&o.parentRemoved(this)}e&&e.invalidateVolume(),0<this._parentNodes.length&&this.invalidateVolume(),this._cleanupGLObjects&&this._cleanupGLObjects()},unsetDirty:function(){this._dirty.positions=!1,this._dirty.normals=!1,this._dirty.texcoords=!1,this._dirty.colors=!1,this._dirty.tangents=!1,this._dirty.binormals=!1,this._dirty.specialAttribs=!1,this._dirty.indexes=!1,this._dirty.texture=!1,this._dirty.material=!1,this._dirty.text=!1,this._dirty.shader=!1},unsetGeoDirty:function(){this._dirty.positions=!1,this._dirty.normals=!1,this._dirty.texcoords=!1,this._dirty.colors=!1,this._dirty.tangents=!1,this._dirty.binormals=!1,this._dirty.specialAttribs=!1,this._dirty.indexes=!1},setAllDirty:function(){this._dirty.positions=!0,this._dirty.normals=!0,this._dirty.texcoords=!0,this._dirty.colors=!0,this._dirty.tangents=!0,this._dirty.binormals=!0,this._dirty.specialAttribs=!0,this._dirty.indexes=!0,this._dirty.texture=!0,this._dirty.material=!0,this._dirty.text=!0,this._dirty.shader=!0,this.invalidateVolume()},setAppDirty:function(){this._dirty.texture=!0,this._dirty.material=!0,this._dirty.shader=!0},setGeoDirty:function(){this._dirty.positions=!0,this._dirty.normals=!0,this._dirty.texcoords=!0,this._dirty.colors=!0,this._dirty.tangents=!0,this._dirty.binormals=!0,this._dirty.specialAttribs=!0,this._dirty.indexes=!0,this.invalidateVolume()},getShaderProperties:function(e){return(null==this._shaderProperties||1==this._dirty.shader||x3dom.Utils.checkDirtyEnvironment(e,this._shaderProperties)||x3dom.Utils.checkDirtyPhysicalEnvironmentLight(e,this._shaderProperties)||void 0!==this._webgl&&this._webgl.dirtyLighting!=x3dom.Utils.checkDirtyLighting(e))&&(this._shaderProperties=x3dom.Utils.generateProperties(e,this),this._dirty.shader=!1,void 0!==this._webgl)&&(this._webgl.dirtyLighting=x3dom.Utils.checkDirtyLighting(e)),this._shaderProperties},getTextures:function(){var e,t=[],i=this._cf.appearance.node,i=(i&&((e=i._cf.texture.node)&&(x3dom.isa(e,x3dom.nodeTypes.MultiTexture)?t=t.concat(e.getTextures()):t.push(e)),(e=i._cf.shaders.nodes[0])&&x3dom.isa(e,x3dom.nodeTypes.CommonSurfaceShader)&&(t=t.concat(e.getTextures())),e=i._cf.material.node)&&x3dom.isa(e,x3dom.nodeTypes.PhysicalMaterial)&&(t=t.concat(e.getTextures())),this._cf.geometry.node);return t=i&&x3dom.isa(i,x3dom.nodeTypes.Text)?t.concat(i):t}})),x3dom.registerNodeType("Shape","Shape",defineClass(x3dom.nodeTypes.X3DShapeNode,function(e){x3dom.nodeTypes.Shape.superClass.call(this,e)},{nodeChanged:function(){this._cf.appearance.node,this._cf.geometry.node?this._objectID||(this._objectID=++x3dom.nodeTypes.Shape.objectID,x3dom.nodeTypes.Shape.idMap.nodeID[this._objectID]=this):this._DEF&&x3dom.debug.logError("No geometry given in Shape/"+this._DEF),this.setAllDirty()}})),x3dom.nodeTypes.Shape.shaderPartID=0,x3dom.nodeTypes.Shape.objectID=0,x3dom.nodeTypes.Shape.idMap={nodeID:{},remove:function(e){for(var t in this.nodeID){var i;this.nodeID.hasOwnProperty(t)&&(i=this.nodeID[t])._objectID&&e._objectID&&i._objectID===e._objectID&&(delete this.nodeID[t],x3dom.debug.logInfo("Unreg "+i._objectID))}}},x3dom.registerNodeType("X3DLightNode","Lighting",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DLightNode.superClass.call(this,e),e?e.doc._nodeBag.lights.push(this):x3dom.debug.logWarning("X3DLightNode: No runtime context found!"),this._lightID=0,this._dirty=!0,this.addField_SFFloat(e,"ambientIntensity",0),this.addField_SFColor(e,"color",1,1,1),this.addField_SFFloat(e,"intensity",1),this.addField_SFBool(e,"global",!1),this.addField_SFBool(e,"on",!0),this.addField_SFFloat(e,"shadowIntensity",0),this.addField_SFInt32(e,"shadowMapSize",1024),this.addField_SFInt32(e,"shadowFilterSize",0),this.addField_SFFloat(e,"shadowOffset",0),this.addField_SFFloat(e,"zNear",-1),this.addField_SFFloat(e,"zFar",-1)},{getViewMatrix:function(e){return x3dom.fields.SFMatrix4f.identity},nodeChanged:function(){this._lightID||(this._lightID=++x3dom.nodeTypes.X3DLightNode.lightID)},fieldChanged:function(e){this._vf.hasOwnProperty(e)&&(this._dirty=!0,this.postMessage(e+"_changed",this._vf[e]))},parentRemoved:function(e){if(1===this._parentNodes.length&&this._parentNodes[0]==e){var t=this.findX3DDoc();if(t)for(var i=0,o=t._nodeBag.lights.length;i<o;i++)t._nodeBag.lights[i]===this&&t._nodeBag.lights.splice(i,1)}},onRemove:function(){}})),x3dom.nodeTypes.X3DLightNode.lightID=0,x3dom.registerNodeType("DirectionalLight","Lighting",defineClass(x3dom.nodeTypes.X3DLightNode,function(e){x3dom.nodeTypes.DirectionalLight.superClass.call(this,e),this.addField_SFVec3f(e,"direction",0,0,-1),this.addField_SFInt32(e,"shadowCascades",1),this.addField_SFFloat(e,"shadowSplitFactor",1),this.addField_SFFloat(e,"shadowSplitOffset",.1)},{getViewMatrix:function(e){var t=this.getCurrentTransform().multMatrixVec(this._vf.direction).normalize();return x3dom.fields.Quaternion.rotateFromTo(new x3dom.fields.SFVec3f(0,0,-1),t).toMatrix().transpose().mult(x3dom.fields.SFMatrix4f.translation(e.negate()))}})),x3dom.registerNodeType("PointLight","Lighting",defineClass(x3dom.nodeTypes.X3DLightNode,function(e){x3dom.nodeTypes.PointLight.superClass.call(this,e),this.addField_SFVec3f(e,"attenuation",1,0,0),this.addField_SFVec3f(e,"location",0,0,0),this.addField_SFFloat(e,"radius",100),this._vf.global=!0},{getViewMatrix:function(e){var t=this.getCurrentTransform().multMatrixPnt(this._vf.location);return x3dom.fields.Quaternion.rotateFromTo(new x3dom.fields.SFVec3f(0,0,-1),e).toMatrix().transpose().mult(x3dom.fields.SFMatrix4f.translation(t.negate()))}})),x3dom.registerNodeType("SpotLight","Lighting",defineClass(x3dom.nodeTypes.X3DLightNode,function(e){x3dom.nodeTypes.SpotLight.superClass.call(this,e),this.addField_SFVec3f(e,"direction",0,0,-1),this.addField_SFVec3f(e,"attenuation",1,0,0),this.addField_SFVec3f(e,"location",0,0,0),this.addField_SFFloat(e,"radius",100),this.addField_SFFloat(e,"beamWidth",3*Math.PI/16),this.addField_SFFloat(e,"cutOffAngle",Math.PI/2),this.addField_SFInt32(e,"shadowCascades",1),this.addField_SFFloat(e,"shadowSplitFactor",1),this.addField_SFFloat(e,"shadowSplitOffset",.1),this._vf.global=!0},{getViewMatrix:function(e){var t=this.getCurrentTransform().multMatrixPnt(this._vf.location),i=this.getCurrentTransform().multMatrixVec(this._vf.direction).normalize();return x3dom.fields.Quaternion.rotateFromTo(new x3dom.fields.SFVec3f(0,0,-1),i).toMatrix().transpose().mult(x3dom.fields.SFMatrix4f.translation(t.negate()))}})),x3dom.registerNodeType("PhysicalEnvironmentLight","Lighting",defineClass(x3dom.nodeTypes.X3DLightNode,function(e){x3dom.nodeTypes.PhysicalEnvironmentLight.superClass.call(this,e),this.addField_SFVec3f(e,"direction",0,0,-1),this.addField_SFString(e,"diffuse","https://x3dom.org/download/assets/pbr/papermillDiffuse.dds"),this.addField_SFString(e,"specular","https://x3dom.org/download/assets/pbr/papermillSpecular.dds"),this.addField_SFInt32(e,"shadowCascades",1),this.addField_SFFloat(e,"shadowSplitFactor",1),this.addField_SFFloat(e,"shadowSplitOffset",.1)},{fieldChanged:function(e){},getViewMatrix:function(e){var t=this.getCurrentTransform().multMatrixVec(this._vf.direction).normalize();return x3dom.fields.Quaternion.rotateFromTo(new x3dom.fields.SFVec3f(0,0,-1),t).toMatrix().transpose().mult(x3dom.fields.SFMatrix4f.translation(e.negate()))}})),x3dom.registerNodeType("X3DFollowerNode","Followers",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DFollowerNode.superClass.call(this,e),e?e.doc._nodeBag.followers.push(this):x3dom.debug.logWarning("X3DFollowerNode: No runtime context found!"),this.addField_SFBool(e,"isActive",!1),this._eps=x3dom.fields.Eps},{parentRemoved:function(e){if(0===this._parentNodes.length){var t=this.findX3DDoc();if(t)for(var i=0,o=t._nodeBag.followers.length;i<o;i++)t._nodeBag.followers[i]===this&&t._nodeBag.followers.splice(i,1)}},tick:function(e){return!1},stepResponse:function(e){return e<=0?0:e>=this._vf.duration?1:this.stepResponseCore(e/this._vf.duration)},stepResponseCore:function(e){return.5-.5*Math.cos(e*Math.PI)}})),x3dom.registerNodeType("X3DChaserNode","Followers",defineClass(x3dom.nodeTypes.X3DFollowerNode,function(e){x3dom.nodeTypes.X3DChaserNode.superClass.call(this,e),this.addField_SFTime(e,"duration",1),this._initDone=!1,this._stepTime=0,this._currTime=0,this._bufferEndTime=0,this._numSupports=60})),x3dom.registerNodeType("X3DDamperNode","Followers",defineClass(x3dom.nodeTypes.X3DFollowerNode,function(e){x3dom.nodeTypes.X3DDamperNode.superClass.call(this,e),this.addField_SFTime(e,"tau",.3),this.addField_SFFloat(e,"tolerance",-1),this.addField_SFInt32(e,"order",3),this._eps=this._vf.tolerance<0?this._eps:this._vf.tolerance,this._lastTick=0})),x3dom.registerNodeType("ColorChaser","Followers",defineClass(x3dom.nodeTypes.X3DChaserNode,function(e){x3dom.nodeTypes.ColorChaser.superClass.call(this,e),this.addField_SFColor(e,"initialDestination",.8,.8,.8),this.addField_SFColor(e,"initialValue",.8,.8,.8),this.addField_SFColor(e,"value",0,0,0),this.addField_SFColor(e,"destination",0,0,0),this._buffer=new x3dom.fields.MFColor,this._previousValue=new x3dom.fields.SFColor(0,0,0),this._value=new x3dom.fields.SFColor(0,0,0),this.initialize()},{fieldChanged:function(e){if(0<=e.indexOf("destination"))this.initialize(),this.updateBuffer(this._currTime),this._vf.isActive||this.postMessage("isActive",!0);else if(0<=e.indexOf("value")){this.initialize(),this._previousValue.setValues(this._vf.value);for(var t=1;t<this._buffer.length;t++)this._buffer[t].setValues(this._vf.value);this.postMessage("value",this._vf.value),this._vf.isActive||this.postMessage("isActive",!0)}},initialize:function(){if(!this._initDone){this._initDone=!0,this._vf.destination=this._vf.initialDestination,this._buffer.length=this._numSupports,this._buffer[0]=this._vf.initialDestination;for(var e=1;e<this._buffer.length;e++)this._buffer[e]=this._vf.initialValue;this._previousValue=this._vf.initialValue,this._stepTime=this._vf.duration/this._numSupports;var t=!this._buffer[0].equals(this._buffer[1],this._eps);this._vf.isActive!==t&&this.postMessage("isActive",t)}},tick:function(e){if(this.initialize(),this._currTime=e,!this._bufferEndTime)return this._bufferEndTime=e,this._value=this._vf.initialValue,this.postMessage("value",this._value),!0;for(var t=this.updateBuffer(e),i=this._previousValue,o=this._buffer[this._buffer.length-1].subtract(this._previousValue).multiply(this.stepResponse((this._buffer.length-1+t)*this._stepTime)),i=i.add(o),s=this._buffer.length-2;0<=s;s--)o=this._buffer[s].subtract(this._buffer[s+1]).multiply(this.stepResponse((s+t)*this._stepTime)),i=i.add(o);return i.equals(this._value,this._eps)?this.postMessage("isActive",!1):(this._value.setValues(i),this.postMessage("value",this._value)),this._vf.isActive},updateBuffer:function(e){var t,i,o,e=(e-this._bufferEndTime)/this._stepTime;if(1<=e){if(e-=i=Math.floor(e),i<this._buffer.length){for(this._previousValue=this._buffer[this._buffer.length-i],t=this._buffer.length-1;i<=t;t--)this._buffer[t]=this._buffer[t-i];for(t=0;t<i;t++)this._buffer[t]=this._buffer[i].multiply(o=t/i).add(this._vf.destination.multiply(1-o))}else for(this._previousValue=i==this._buffer.length?this._buffer[0]:this._vf.destination,t=0;t<this._buffer.length;t++)this._buffer[t]=this._vf.destination;this._bufferEndTime+=i*this._stepTime}return e}})),x3dom.registerNodeType("ColorDamper","Followers",defineClass(x3dom.nodeTypes.X3DDamperNode,function(e){x3dom.nodeTypes.ColorDamper.superClass.call(this,e),this.addField_SFColor(e,"initialDestination",.8,.8,.8),this.addField_SFColor(e,"initialValue",.8,.8,.8),this.addField_SFColor(e,"value",0,0,0),this.addField_SFColor(e,"destination",0,0,0),this._value0=new x3dom.fields.SFColor(0,0,0),this._value1=new x3dom.fields.SFColor(0,0,0),this._value2=new x3dom.fields.SFColor(0,0,0),this._value3=new x3dom.fields.SFColor(0,0,0),this._value4=new x3dom.fields.SFColor(0,0,0),this._value5=new x3dom.fields.SFColor(0,0,0),this.initialize()},{fieldChanged:function(e){"tolerance"===e?this._eps=this._vf.tolerance<0?.001:this._vf.tolerance:0<=e.indexOf("destination")?this._value0.equals(this._vf.destination,this._eps)||(this._value0=this._vf.destination,this._vf.isActive)||this.postMessage("isActive",!0):0<=e.indexOf("value")&&(this._value1.setValues(this._vf.value),this._value2.setValues(this._vf.value),this._value3.setValues(this._vf.value),this._value4.setValues(this._vf.value),this._value5.setValues(this._vf.value),this._lastTick=0,this.postMessage("value",this._value5),this._vf.isActive||(this._lastTick=0,this.postMessage("isActive",!0)))},initialize:function(){this._value0.setValues(this._vf.initialDestination),this._value1.setValues(this._vf.initialValue),this._value2.setValues(this._vf.initialValue),this._value3.setValues(this._vf.initialValue),this._value4.setValues(this._vf.initialValue),this._value5.setValues(this._vf.initialValue),this._lastTick=0;var e=!this._value0.equals(this._value1,this._eps);this._vf.isActive!==e&&this.postMessage("isActive",e)},distance:function(e,t){e=e.subtract(t);return Math.sqrt(e.r*e.r+e.g*e.g+e.b*e.b)},tick:function(e){var t,i;return this._lastTick?(t=e-this._lastTick,t=Math.exp(-t/this._vf.tau),this._value1=0<this._vf.order&&this._vf.tau?this._value0.add(this._value1.subtract(this._value0).multiply(t)):new x3dom.fields.SFColor(this._value0.r,this._value0.g,this._value0.b),this._value2=1<this._vf.order&&this._vf.tau?this._value1.add(this._value2.subtract(this._value1).multiply(t)):new x3dom.fields.SFColor(this._value1.r,this._value1.g,this._value1.b),this._value3=2<this._vf.order&&this._vf.tau?this._value2.add(this._value3.subtract(this._value2).multiply(t)):new x3dom.fields.SFColor(this._value2.r,this._value2.g,this._value2.b),this._value4=3<this._vf.order&&this._vf.tau?this._value3.add(this._value4.subtract(this._value3).multiply(t)):new x3dom.fields.SFColor(this._value3.r,this._value3.g,this._value3.b),this._value5=4<this._vf.order&&this._vf.tau?this._value4.add(this._value5.subtract(this._value4).multiply(t)):new x3dom.fields.SFColor(this._value4.r,this._value4.g,this._value4.b),t=this.distance(this._value1,this._value0),1<this._vf.order&&t<(i=this.distance(this._value2,this._value1))&&(t=i),2<this._vf.order&&t<(i=this.distance(this._value3,this._value2))&&(t=i),3<this._vf.order&&t<(i=this.distance(this._value4,this._value3))&&(t=i),(t=4<this._vf.order&&t<(i=this.distance(this._value5,this._value4))?i:t)<=this._eps?(this._value1.setValues(this._value0),this._value2.setValues(this._value0),this._value3.setValues(this._value0),this._value4.setValues(this._value0),this._value5.setValues(this._value0),this.postMessage("value",this._value0),this.postMessage("isActive",!1),this._lastTick=0,!1):(this.postMessage("value",this._value5),this._lastTick=e,!0)):(this._lastTick=e,!1)}})),x3dom.registerNodeType("OrientationChaser","Followers",defineClass(x3dom.nodeTypes.X3DChaserNode,function(e){x3dom.nodeTypes.OrientationChaser.superClass.call(this,e),this.addField_SFRotation(e,"initialDestination",0,1,0,0),this.addField_SFRotation(e,"initialValue",0,1,0,0),this.addField_SFRotation(e,"value",0,1,0,0),this.addField_SFRotation(e,"destination",0,1,0,0),this._numSupports=30,this._buffer=new x3dom.fields.MFRotation,this._previousValue=new x3dom.fields.Quaternion(0,1,0,0),this._value=new x3dom.fields.Quaternion(0,1,0,0),this.initialize()},{fieldChanged:function(e){if(0<=e.indexOf("destination"))this.initialize(),this.updateBuffer(this._currTime),this._vf.isActive||this.postMessage("isActive",!0);else if(0<=e.indexOf("value")){this.initialize(),this._previousValue.setValues(this._vf.value);for(var t=1;t<this._buffer.length;t++)this._buffer[t].setValues(this._vf.value);this.postMessage("value",this._vf.value),this._vf.isActive||this.postMessage("isActive",!0)}},initialize:function(){if(!this._initDone){this._initDone=!0,this._vf.destination=x3dom.fields.Quaternion.copy(this._vf.initialDestination),this._buffer.length=this._numSupports,this._buffer[0]=x3dom.fields.Quaternion.copy(this._vf.initialDestination);for(var e=1;e<this._buffer.length;e++)this._buffer[e]=x3dom.fields.Quaternion.copy(this._vf.initialValue);this._previousValue=x3dom.fields.Quaternion.copy(this._vf.initialValue),this._stepTime=this._vf.duration/this._numSupports;var t=!this._buffer[0].equals(this._buffer[1],this._eps);this._vf.isActive!==t&&this.postMessage("isActive",t)}},tick:function(e){if(this.initialize(),this._currTime=e,!this._bufferEndTime)return this._bufferEndTime=e,this._value=x3dom.fields.Quaternion.copy(this._vf.initialValue),this.postMessage("value",this._value),!0;for(var t=this.updateBuffer(e),i=x3dom.fields.Quaternion.copy(this._previousValue),o=this._previousValue.inverse().multiply(this._buffer[this._buffer.length-1]),i=i.slerp(i.multiply(o),this.stepResponse((this._buffer.length-1+t)*this._stepTime)),s=this._buffer.length-2;0<=s;s--)o=this._buffer[s+1].inverse().multiply(this._buffer[s]),i=i.slerp(i.multiply(o),this.stepResponse((s+t)*this._stepTime));return i.equals(this._value,this._eps)?this.postMessage("isActive",!1):(i=i.normalize(i),this._value.setValues(i),this.postMessage("value",this._value)),this._vf.isActive},updateBuffer:function(e){var t,i,e=(e-this._bufferEndTime)/this._stepTime;if(1<=e){if(e-=i=Math.floor(e),i<this._buffer.length){for(this._previousValue=x3dom.fields.Quaternion.copy(this._buffer[this._buffer.length-i]),t=this._buffer.length-1;i<=t;t--)this._buffer[t]=x3dom.fields.Quaternion.copy(this._buffer[t-i]);for(t=0;t<i;t++)this._buffer[t]=this._vf.destination.slerp(this._buffer[i],t/i)}else for(this._previousValue=x3dom.fields.Quaternion.copy(i==this._buffer.length?this._buffer[0]:this._vf.destination),t=0;t<this._buffer.length;t++)this._buffer[t]=x3dom.fields.Quaternion.copy(this._vf.destination);this._bufferEndTime+=i*this._stepTime}return e}})),x3dom.registerNodeType("OrientationDamper","Followers",defineClass(x3dom.nodeTypes.X3DDamperNode,function(e){x3dom.nodeTypes.OrientationDamper.superClass.call(this,e),this.addField_SFRotation(e,"initialDestination",0,1,0,0),this.addField_SFRotation(e,"initialValue",0,1,0,0),this.addField_SFRotation(e,"value",0,1,0,0),this.addField_SFRotation(e,"destination",0,1,0,0),this._value0=new x3dom.fields.Quaternion(0,1,0,0),this._value1=new x3dom.fields.Quaternion(0,1,0,0),this._value2=new x3dom.fields.Quaternion(0,1,0,0),this._value3=new x3dom.fields.Quaternion(0,1,0,0),this._value4=new x3dom.fields.Quaternion(0,1,0,0),this._value5=new x3dom.fields.Quaternion(0,1,0,0),this.initialize()},{fieldChanged:function(e){"tolerance"===e?this._eps=this._vf.tolerance<0?.001:this._vf.tolerance:0<=e.indexOf("destination")?this._value0.equals(this._vf.destination,this._eps)||(this._value0=this._vf.destination,this._vf.isActive)||this.postMessage("isActive",!0):0<=e.indexOf("value")&&(this._value1.setValues(this._vf.value),this._value2.setValues(this._vf.value),this._value3.setValues(this._vf.value),this._value4.setValues(this._vf.value),this._value5.setValues(this._vf.value),this._lastTick=0,this.postMessage("value",this._value5),this._vf.isActive||(this._lastTick=0,this.postMessage("isActive",!0)))},initialize:function(){this._value0.setValues(this._vf.initialDestination),this._value1.setValues(this._vf.initialValue),this._value2.setValues(this._vf.initialValue),this._value3.setValues(this._vf.initialValue),this._value4.setValues(this._vf.initialValue),this._value5.setValues(this._vf.initialValue),this._lastTick=0;var e=!this._value0.equals(this._value1,this._eps);this._vf.isActive!==e&&this.postMessage("isActive",e)},tick:function(e){var t,i;return this._lastTick?(t=e-this._lastTick,t=Math.exp(-t/this._vf.tau),this._value1=0<this._vf.order&&this._vf.tau?this._value0.slerp(this._value1,t):new x3dom.fields.Quaternion(this._value0.x,this._value0.y,this._value0.z,this._value0.w),this._value2=1<this._vf.order&&this._vf.tau?this._value1.slerp(this._value2,t):new x3dom.fields.Quaternion(this._value1.x,this._value1.y,this._value1.z,this._value1.w),this._value3=2<this._vf.order&&this._vf.tau?this._value2.slerp(this._value3,t):new x3dom.fields.Quaternion(this._value2.x,this._value2.y,this._value2.z,this._value2.w),this._value4=3<this._vf.order&&this._vf.tau?this._value3.slerp(this._value4,t):new x3dom.fields.Quaternion(this._value3.x,this._value3.y,this._value3.z,this._value3.w),this._value5=4<this._vf.order&&this._vf.tau?this._value4.slerp(this._value5,t):new x3dom.fields.Quaternion(this._value4.x,this._value4.y,this._value4.z,this._value4.w),t=Math.abs(this._value1.inverse().multiply(this._value0).angle()),1<this._vf.order&&t<(i=Math.abs(this._value2.inverse().multiply(this._value1).angle()))&&(t=i),2<this._vf.order&&t<(i=Math.abs(this._value3.inverse().multiply(this._value2).angle()))&&(t=i),3<this._vf.order&&t<(i=Math.abs(this._value4.inverse().multiply(this._value3).angle()))&&(t=i),(t=4<this._vf.order&&t<(i=Math.abs(this._value5.inverse().multiply(this._value4).angle()))?i:t)<=this._eps?(this._value1.setValues(this._value0),this._value2.setValues(this._value0),this._value3.setValues(this._value0),this._value4.setValues(this._value0),this._value5.setValues(this._value0),this.postMessage("value",this._value0),this.postMessage("isActive",!1),this._lastTick=0,!1):(this.postMessage("value",this._value5),this._lastTick=e,!0)):(this._lastTick=e,!1)}})),x3dom.registerNodeType("PositionChaser","Followers",defineClass(x3dom.nodeTypes.X3DChaserNode,function(e){x3dom.nodeTypes.PositionChaser.superClass.call(this,e),this.addField_SFVec3f(e,"initialDestination",0,0,0),this.addField_SFVec3f(e,"initialValue",0,0,0),this.addField_SFVec3f(e,"value",0,0,0),this.addField_SFVec3f(e,"destination",0,0,0),this._buffer=new x3dom.fields.MFVec3f,this._previousValue=new x3dom.fields.SFVec3f(0,0,0),this._value=new x3dom.fields.SFVec3f(0,0,0),this.initialize()},{fieldChanged:function(e){if(0<=e.indexOf("destination"))this.initialize(),this.updateBuffer(this._currTime),this._vf.isActive||this.postMessage("isActive",!0);else if(0<=e.indexOf("value")){this.initialize(),this._previousValue.setValues(this._vf.value);for(var t=1;t<this._buffer.length;t++)this._buffer[t].setValues(this._vf.value);this.postMessage("value",this._vf.value),this._vf.isActive||this.postMessage("isActive",!0)}},initialize:function(){if(!this._initDone){this._initDone=!0,this._vf.destination=x3dom.fields.SFVec3f.copy(this._vf.initialDestination),this._buffer.length=this._numSupports,this._buffer[0]=x3dom.fields.SFVec3f.copy(this._vf.initialDestination);for(var e=1;e<this._buffer.length;e++)this._buffer[e]=x3dom.fields.SFVec3f.copy(this._vf.initialValue);this._previousValue=x3dom.fields.SFVec3f.copy(this._vf.initialValue),this._stepTime=this._vf.duration/this._numSupports;var t=!this._buffer[0].equals(this._buffer[1],this._eps);this._vf.isActive!==t&&this.postMessage("isActive",t)}},tick:function(e){if(this.initialize(),this._currTime=e,!this._bufferEndTime)return this._bufferEndTime=e,this._value=x3dom.fields.SFVec3f.copy(this._vf.initialValue),this.postMessage("value",this._value),!0;for(var t=this.updateBuffer(e),i=x3dom.fields.SFVec3f.copy(this._previousValue),o=this._buffer[this._buffer.length-1].subtract(this._previousValue).multiply(this.stepResponse((this._buffer.length-1+t)*this._stepTime)),i=i.add(o),s=this._buffer.length-2;0<=s;s--)o=this._buffer[s].subtract(this._buffer[s+1]).multiply(this.stepResponse((s+t)*this._stepTime)),i=i.add(o);return i.equals(this._value,this._eps)?this.postMessage("isActive",!1):(this._value.setValues(i),this.postMessage("value",this._value)),this._vf.isActive},updateBuffer:function(e){var t,i,o,e=(e-this._bufferEndTime)/this._stepTime;if(1<=e){if(e-=i=Math.floor(e),i<this._buffer.length){for(this._previousValue=x3dom.fields.SFVec3f.copy(this._buffer[this._buffer.length-i]),t=this._buffer.length-1;i<=t;t--)this._buffer[t]=x3dom.fields.SFVec3f.copy(this._buffer[t-i]);for(t=0;t<i;t++)this._buffer[t]=this._buffer[i].multiply(o=t/i).add(this._vf.destination.multiply(1-o))}else for(this._previousValue=x3dom.fields.SFVec3f.copy(i==this._buffer.length?this._buffer[0]:this._vf.destination),t=0;t<this._buffer.length;t++)this._buffer[t]=x3dom.fields.SFVec3f.copy(this._vf.destination);this._bufferEndTime+=i*this._stepTime}return e}})),x3dom.registerNodeType("PositionChaser2D","Followers",defineClass(x3dom.nodeTypes.X3DChaserNode,function(e){x3dom.nodeTypes.PositionChaser2D.superClass.call(this,e),this.addField_SFVec2f(e,"initialDestination",0,0),this.addField_SFVec2f(e,"initialValue",0,0),this.addField_SFVec2f(e,"value",0,0),this.addField_SFVec2f(e,"destination",0,0),this._buffer=new x3dom.fields.MFVec2f,this._previousValue=new x3dom.fields.SFVec2f(0,0),this._value=new x3dom.fields.SFVec2f(0,0),this.initialize()},{fieldChanged:function(e){if(0<=e.indexOf("destination"))this.initialize(),this.updateBuffer(this._currTime),this._vf.isActive||this.postMessage("isActive",!0);else if(0<=e.indexOf("value")){this.initialize(),this._previousValue.setValues(this._vf.value);for(var t=1;t<this._buffer.length;t++)this._buffer[t].setValues(this._vf.value);this.postMessage("value",this._vf.value),this._vf.isActive||this.postMessage("isActive",!0)}},initialize:function(){if(!this._initDone){this._initDone=!0,this._vf.destination=x3dom.fields.SFVec2f.copy(this._vf.initialDestination),this._buffer.length=this._numSupports,this._buffer[0]=x3dom.fields.SFVec2f.copy(this._vf.initialDestination);for(var e=1;e<this._buffer.length;e++)this._buffer[e]=x3dom.fields.SFVec2f.copy(this._vf.initialValue);this._previousValue=x3dom.fields.SFVec2f.copy(this._vf.initialValue),this._stepTime=this._vf.duration/this._numSupports;var t=!this._buffer[0].equals(this._buffer[1],this._eps);this._vf.isActive!==t&&this.postMessage("isActive",t)}},tick:function(e){if(this.initialize(),this._currTime=e,!this._bufferEndTime)return this._bufferEndTime=e,this._value=x3dom.fields.SFVec2f.copy(this._vf.initialValue),this.postMessage("value",this._value),!0;for(var t=this.updateBuffer(e),i=x3dom.fields.SFVec2f.copy(this._previousValue),o=this._buffer[this._buffer.length-1].subtract(this._previousValue).multiply(this.stepResponse((this._buffer.length-1+t)*this._stepTime)),i=i.add(o),s=this._buffer.length-2;0<=s;s--)o=this._buffer[s].subtract(this._buffer[s+1]).multiply(this.stepResponse((s+t)*this._stepTime)),i=i.add(o);return i.equals(this._value,this._eps)?this.postMessage("isActive",!1):(this._value.setValues(i),this.postMessage("value",this._value)),this._vf.isActive},updateBuffer:function(e){var t,i,o,e=(e-this._bufferEndTime)/this._stepTime;if(1<=e){if(e-=i=Math.floor(e),i<this._buffer.length){for(this._previousValue=x3dom.fields.SFVec2f.copy(this._buffer[this._buffer.length-i]),t=this._buffer.length-1;i<=t;t--)this._buffer[t]=x3dom.fields.SFVec2f.copy(this._buffer[t-i]);for(t=0;t<i;t++)this._buffer[t]=this._buffer[i].multiply(o=t/i).add(this._vf.destination.multiply(1-o))}else for(this._previousValue=x3dom.fields.SFVec2f.copy(i==this._buffer.length?this._buffer[0]:this._vf.destination),t=0;t<this._buffer.length;t++)this._buffer[t]=x3dom.fields.SFVec2f.copy(this._vf.destination);this._bufferEndTime+=i*this._stepTime}return e}})),x3dom.registerNodeType("PositionDamper","Followers",defineClass(x3dom.nodeTypes.X3DDamperNode,function(e){x3dom.nodeTypes.PositionDamper.superClass.call(this,e),this.addField_SFVec3f(e,"initialDestination",0,0,0),this.addField_SFVec3f(e,"initialValue",0,0,0),this.addField_SFVec3f(e,"value",0,0,0),this.addField_SFVec3f(e,"destination",0,0,0),this._value0=new x3dom.fields.SFVec3f(0,0,0),this._value1=new x3dom.fields.SFVec3f(0,0,0),this._value2=new x3dom.fields.SFVec3f(0,0,0),this._value3=new x3dom.fields.SFVec3f(0,0,0),this._value4=new x3dom.fields.SFVec3f(0,0,0),this._value5=new x3dom.fields.SFVec3f(0,0,0),this.initialize()},{fieldChanged:function(e){"tolerance"===e?this._eps=this._vf.tolerance<0?.001:this._vf.tolerance:0<=e.indexOf("destination")?this._value0.equals(this._vf.destination,this._eps)||(this._value0=this._vf.destination,this._vf.isActive)||this.postMessage("isActive",!0):0<=e.indexOf("value")&&(this._value1.setValues(this._vf.value),this._value2.setValues(this._vf.value),this._value3.setValues(this._vf.value),this._value4.setValues(this._vf.value),this._value5.setValues(this._vf.value),this._lastTick=0,this.postMessage("value",this._value5),this._vf.isActive||(this._lastTick=0,this.postMessage("isActive",!0)))},initialize:function(){this._value0.setValues(this._vf.initialDestination),this._value1.setValues(this._vf.initialValue),this._value2.setValues(this._vf.initialValue),this._value3.setValues(this._vf.initialValue),this._value4.setValues(this._vf.initialValue),this._value5.setValues(this._vf.initialValue),this._lastTick=0;var e=!this._value0.equals(this._value1,this._eps);this._vf.isActive!==e&&this.postMessage("isActive",e)},tick:function(e){var t,i;return this._lastTick?(t=e-this._lastTick,t=Math.exp(-t/this._vf.tau),this._value1=0<this._vf.order&&this._vf.tau?this._value0.add(this._value1.subtract(this._value0).multiply(t)):new x3dom.fields.SFVec3f(this._value0.x,this._value0.y,this._value0.z),this._value2=1<this._vf.order&&this._vf.tau?this._value1.add(this._value2.subtract(this._value1).multiply(t)):new x3dom.fields.SFVec3f(this._value1.x,this._value1.y,this._value1.z),this._value3=2<this._vf.order&&this._vf.tau?this._value2.add(this._value3.subtract(this._value2).multiply(t)):new x3dom.fields.SFVec3f(this._value2.x,this._value2.y,this._value2.z),this._value4=3<this._vf.order&&this._vf.tau?this._value3.add(this._value4.subtract(this._value3).multiply(t)):new x3dom.fields.SFVec3f(this._value3.x,this._value3.y,this._value3.z),this._value5=4<this._vf.order&&this._vf.tau?this._value4.add(this._value5.subtract(this._value4).multiply(t)):new x3dom.fields.SFVec3f(this._value4.x,this._value4.y,this._value4.z),t=this._value1.subtract(this._value0).length(),1<this._vf.order&&t<(i=this._value2.subtract(this._value1).length())&&(t=i),2<this._vf.order&&t<(i=this._value3.subtract(this._value2).length())&&(t=i),3<this._vf.order&&t<(i=this._value4.subtract(this._value3).length())&&(t=i),(t=4<this._vf.order&&t<(i=this._value5.subtract(this._value4).length())?i:t)<=this._eps?(this._value1.setValues(this._value0),this._value2.setValues(this._value0),this._value3.setValues(this._value0),this._value4.setValues(this._value0),this._value5.setValues(this._value0),this.postMessage("value",this._value0),this.postMessage("isActive",!1),this._lastTick=0,!1):(this.postMessage("value",this._value5),this._lastTick=e,!0)):(this._lastTick=e,!1)}})),x3dom.registerNodeType("PositionDamper2D","Followers",defineClass(x3dom.nodeTypes.X3DDamperNode,function(e){x3dom.nodeTypes.PositionDamper2D.superClass.call(this,e),this.addField_SFVec2f(e,"initialDestination",0,0),this.addField_SFVec2f(e,"initialValue",0,0),this.addField_SFVec2f(e,"value",0,0),this.addField_SFVec2f(e,"destination",0,0),this._value0=new x3dom.fields.SFVec2f(0,0),this._value1=new x3dom.fields.SFVec2f(0,0),this._value2=new x3dom.fields.SFVec2f(0,0),this._value3=new x3dom.fields.SFVec2f(0,0),this._value4=new x3dom.fields.SFVec2f(0,0),this._value5=new x3dom.fields.SFVec2f(0,0),this.initialize()},{fieldChanged:function(e){"tolerance"===e?this._eps=this._vf.tolerance<0?.001:this._vf.tolerance:0<=e.indexOf("destination")?this._value0.equals(this._vf.destination,this._eps)||(this._value0=this._vf.destination,this._vf.isActive)||this.postMessage("isActive",!0):0<=e.indexOf("value")&&(this._value1.setValues(this._vf.value),this._value2.setValues(this._vf.value),this._value3.setValues(this._vf.value),this._value4.setValues(this._vf.value),this._value5.setValues(this._vf.value),this._lastTick=0,this.postMessage("value",this._value5),this._vf.isActive||(this._lastTick=0,this.postMessage("isActive",!0)))},initialize:function(){this._value0.setValues(this._vf.initialDestination),this._value1.setValues(this._vf.initialValue),this._value2.setValues(this._vf.initialValue),this._value3.setValues(this._vf.initialValue),this._value4.setValues(this._vf.initialValue),this._value5.setValues(this._vf.initialValue),this._lastTick=0;var e=!this._value0.equals(this._value1,this._eps);this._vf.isActive!==e&&this.postMessage("isActive",e)},tick:function(e){var t,i;return this._lastTick?(t=e-this._lastTick,t=Math.exp(-t/this._vf.tau),this._value1=0<this._vf.order&&this._vf.tau?this._value0.add(this._value1.subtract(this._value0).multiply(t)):new x3dom.fields.SFVec2f(this._value0.x,this._value0.y,this._value0.z),this._value2=1<this._vf.order&&this._vf.tau?this._value1.add(this._value2.subtract(this._value1).multiply(t)):new x3dom.fields.SFVec2f(this._value1.x,this._value1.y,this._value1.z),this._value3=2<this._vf.order&&this._vf.tau?this._value2.add(this._value3.subtract(this._value2).multiply(t)):new x3dom.fields.SFVec2f(this._value2.x,this._value2.y,this._value2.z),this._value4=3<this._vf.order&&this._vf.tau?this._value3.add(this._value4.subtract(this._value3).multiply(t)):new x3dom.fields.SFVec2f(this._value3.x,this._value3.y,this._value3.z),this._value5=4<this._vf.order&&this._vf.tau?this._value4.add(this._value5.subtract(this._value4).multiply(t)):new x3dom.fields.SFVec2f(this._value4.x,this._value4.y,this._value4.z),t=this._value1.subtract(this._value0).length(),1<this._vf.order&&t<(i=this._value2.subtract(this._value1).length())&&(t=i),2<this._vf.order&&t<(i=this._value3.subtract(this._value2).length())&&(t=i),3<this._vf.order&&t<(i=this._value4.subtract(this._value3).length())&&(t=i),(t=4<this._vf.order&&t<(i=this._value5.subtract(this._value4).length())?i:t)<=this._eps?(this._value1.setValues(this._value0),this._value2.setValues(this._value0),this._value3.setValues(this._value0),this._value4.setValues(this._value0),this._value5.setValues(this._value0),this.postMessage("value",this._value0),this.postMessage("isActive",!1),this._lastTick=0,!1):(this.postMessage("value",this._value5),this._lastTick=e,!0)):(this._lastTick=e,!1)}})),x3dom.registerNodeType("ScalarChaser","Followers",defineClass(x3dom.nodeTypes.X3DChaserNode,function(e){x3dom.nodeTypes.ScalarChaser.superClass.call(this,e),this.addField_SFFloat(e,"initialDestination",0),this.addField_SFFloat(e,"initialValue",0),this.addField_SFFloat(e,"value",0),this.addField_SFFloat(e,"destination",0),this._buffer=[],this._previousValue=0,this._value=0,this.initialize()},{fieldChanged:function(e){if(0<=e.indexOf("destination"))this.initialize(),this.updateBuffer(this._currTime),this._vf.isActive||this.postMessage("isActive",!0);else if(0<=e.indexOf("value")){this.initialize(),this._previousValue=this._vf.value;for(var t=1;t<this._buffer.length;t++)this._buffer[t]=this._vf.value;this.postMessage("value",this._vf.value),this._vf.isActive||this.postMessage("isActive",!0)}},initialize:function(){if(!this._initDone){this._initDone=!0,this._vf.destination=this._vf.initialDestination,this._buffer.length=this._numSupports,this._buffer[0]=this._vf.initialDestination;for(var e=1;e<this._buffer.length;e++)this._buffer[e]=this._vf.initialValue;this._previousValue=this._vf.initialValue,this._stepTime=this._vf.duration/this._numSupports;var t=Math.abs(this._buffer[0]-this._buffer[1])>this._eps;this._vf.isActive!==t&&this.postMessage("isActive",t)}},tick:function(e){if(this.initialize(),this._currTime=e,!this._bufferEndTime)return this._bufferEndTime=e,this._value=this._vf.initialValue,this.postMessage("value",this._value),!0;var t=this.updateBuffer(e),i=this._previousValue;i+=(this._buffer[this._buffer.length-1]-this._previousValue)*this.stepResponse((this._buffer.length-1+t)*this._stepTime);for(var o=this._buffer.length-2;0<=o;o--)i+=(this._buffer[o]-this._buffer[o+1])*this.stepResponse((o+t)*this._stepTime);return Math.abs(i-this._value)>this._eps?(this._value=i,this.postMessage("value",this._value)):this.postMessage("isActive",!1),this._vf.isActive},updateBuffer:function(e){var t,i,o,e=(e-this._bufferEndTime)/this._stepTime;if(1<=e){if(e-=i=Math.floor(e),i<this._buffer.length){for(this._previousValue=this._buffer[this._buffer.length-i],t=this._buffer.length-1;i<=t;t--)this._buffer[t]=this._buffer[t-i];for(t=0;t<i;t++)this._buffer[t]=this._buffer[i]*(o=t/i)+this._vf.destination*(1-o)}else for(this._previousValue=i==this._buffer.length?this._buffer[0]:this._vf.destination,t=0;t<this._buffer.length;t++)this._buffer[t]=this._vf.destination;this._bufferEndTime+=i*this._stepTime}return e}})),x3dom.registerNodeType("ScalarDamper","Followers",defineClass(x3dom.nodeTypes.X3DDamperNode,function(e){x3dom.nodeTypes.ScalarDamper.superClass.call(this,e),this.addField_SFFloat(e,"initialDestination",0),this.addField_SFFloat(e,"initialValue",0),this.addField_SFFloat(e,"value",0),this.addField_SFFloat(e,"destination",0),this._value0=0,this._value1=0,this._value2=0,this._value3=0,this._value4=0,this._value5=0,this.initialize()},{fieldChanged:function(e){"tolerance"===e?this._eps=this._vf.tolerance<0?.001:this._vf.tolerance:0<=e.indexOf("destination")?Math.abs(this._value0-this._vf.destination)>this._eps&&(this._value0=this._vf.destination,this._vf.isActive||this.postMessage("isActive",!0)):0<=e.indexOf("value")&&(this._value1=this._vf.value,this._value2=this._vf.value,this._value3=this._vf.value,this._value4=this._vf.value,this._value5=this._vf.value,this._lastTick=0,this.postMessage("value",this._value5),this._vf.isActive||(this._lastTick=0,this.postMessage("isActive",!0)))},initialize:function(){this._value0=this._vf.initialDestination,this._value1=this._vf.initialValue,this._value2=this._vf.initialValue,this._value3=this._vf.initialValue,this._value4=this._vf.initialValue,this._value5=this._vf.initialValue,this._lastTick=0;var e=Math.abs(this._value0-this._value1)>this._eps;this._vf.isActive!==e&&this.postMessage("isActive",e)},tick:function(e){var t,i;return this._lastTick?(t=e-this._lastTick,t=Math.exp(-t/this._vf.tau),this._value1=0<this._vf.order&&this._vf.tau?this._value0+t*(this._value1-this._value0):this._value0,this._value2=1<this._vf.order&&this._vf.tau?this._value1+t*(this._value2-this._value1):this._value1,this._value3=2<this._vf.order&&this._vf.tau?this._value2+t*(this._value3-this._value2):this._value2,this._value4=3<this._vf.order&&this._vf.tau?this._value3+t*(this._value4-this._value3):this._value3,this._value5=4<this._vf.order&&this._vf.tau?this._value4+t*(this._value5-this._value4):this._value4,t=Math.abs(this._value1-this._value0),1<this._vf.order&&t<(i=Math.abs(this._value2-this._value1))&&(t=i),2<this._vf.order&&t<(i=Math.abs(this._value3-this._value2))&&(t=i),3<this._vf.order&&t<(i=Math.abs(this._value4-this._value3))&&(t=i),(t=4<this._vf.order&&t<(i=Math.abs(this._value5-this._value4))?i:t)<=this._eps?(this._value1=this._value0,this._value2=this._value0,this._value3=this._value0,this._value4=this._value0,this._value5=this._value0,this.postMessage("value",this._value0),this.postMessage("isActive",!1),this._lastTick=0,!1):(this.postMessage("value",this._value5),this._lastTick=e,!0)):(this._lastTick=e,!1)}})),x3dom.registerNodeType("CoordinateDamper","Followers",defineClass(x3dom.nodeTypes.X3DDamperNode,function(e){x3dom.nodeTypes.CoordinateDamper.superClass.call(this,e),this.addField_MFVec3f(e,"initialDestination",[]),this.addField_MFVec3f(e,"initialValue",[]),this.addField_MFVec3f(e,"value",[]),this.addField_MFVec3f(e,"destination",[]),x3dom.debug.logWarning("CoordinateDamper NYI")})),x3dom.registerNodeType("TexCoordDamper2D","Followers",defineClass(x3dom.nodeTypes.X3DDamperNode,function(e){x3dom.nodeTypes.TexCoordDamper2D.superClass.call(this,e),this.addField_MFVec2f(e,"initialDestination",[]),this.addField_MFVec2f(e,"initialValue",[]),this.addField_MFVec2f(e,"value",[]),this.addField_MFVec2f(e,"destination",[]),x3dom.debug.logWarning("TexCoordDamper2D NYI")})),x3dom.registerNodeType("X3DInterpolatorNode","Interpolation",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DInterpolatorNode.superClass.call(this,e),this.addField_MFFloat(e,"key",[]),this.addField_SFFloat(e,"set_fraction",0),this.addField_SFString(e,"buffer",""),this.addField_SFString(e,"interpolation","LINEAR"),this.addField_SFFloat(e,"duration",1),this.addField_MFNode("views",x3dom.nodeTypes.BufferView),this.addField_MFNode("accessors",x3dom.nodeTypes.BufferAccessor),this._lastValue=void 0,this.normalizeFromType={5120:function(e){return Math.max(e/127,-1)},5121:function(e){return e/255},5122:function(e){return Math.max(e/32767,-1)},5123:function(e){return e/65535},5125:function(e){return e/4294967295},5126:function(e){return e}}},{nodeChanged:function(){this._vf.buffer&&x3dom.BinaryContainerLoader.setupBufferInterpolator(this)},linearInterp:function(e,t){var i=this._vf.key,o=this._vf.keyValue;if(0!=i.length){if(e<=i[0])return t(o[0],o[0],0);if(e>=i[i.length-1])return t(o[i.length-1],o[i.length-1],1);for(var s=0,n=i.length-1;s<n;++s)if(i[s]<e&&e<=i[s+1])return t(o[s],o[s+1],(e-i[s])/(i[s+1]-i[s]));return o[0]}},cubicSplineInterp:function(e,t){if(0!=this._vf.key.length){var i,o,s,n,r;if(e<=this._vf.key[0])return this._vf.keyValue[1];if(e>=this._vf.key[this._vf.key.length-1])return this._vf.keyValue[this._vf.keyValue.length-2];for(i=0,s=this._vf.key.length-1;i<s;++i)if(this._vf.key[i]<e&&e<=this._vf.key[i+1])return o=3*i,r=this._vf.key[i+1]-this._vf.key[i],n=(e-this._vf.key[i])/r,r=r*this._vf.duration,n=this.cubicSplineBasis(n,r),t(this._vf.keyValue[2+o],this._vf.keyValue[1+o],this._vf.keyValue[3+o],this._vf.keyValue[4+o],n.h00,n.h10,n.h01,n.h11);return this._vf.keyValue[0]}},cubicSplineBasis:function(e,t){var i=e*e,o=i*e,s=-2*o+3*i,o=o-i;return{h00:1-s,h10:t*(o-i+e),h01:s,h11:t*o}},keyValueFromArray:function(e){return e}})),x3dom.XHRCache={},x3dom.registerNodeType("OrientationInterpolator","Interpolation",defineClass(x3dom.nodeTypes.X3DInterpolatorNode,function(e){x3dom.nodeTypes.OrientationInterpolator.superClass.call(this,e),this.addField_MFRotation(e,"keyValue",[])},{fieldChanged:function(e){"set_fraction"===e&&null!=(e="CUBICSPLINE"===this._vf.interpolation?this.cubicSplineInterp(this._vf.set_fraction,function(t,i,o,s,n,r,a,d){function e(e){return n*i[e]+r*t[e]+a*s[e]+d*o[e]}var l=new x3dom.fields.Quaternion(0,0,0,0),h=(l.x=e("x"),l.y=e("y"),l.z=e("z"),l.w=e("w"),Math.sqrt(1/l.dot(l)));return l.x*=h,l.y*=h,l.z*=h,l.w*=h,l}):this.linearInterp(this._vf.set_fraction,function(e,t,i){return e.slerp(t,i)}))&&e!=this._lastValue&&(this._lastValue=e,this.postMessage("value_changed",e))},keyValueFromAccessor:function(i,e){var o=new x3dom.fields.MFRotation,s=this.normalizeFromType[e];return i.forEach(function(e,t){t%4==3&&o.push(new x3dom.fields.Quaternion(s(i[t-3]),s(i[t-2]),s(i[t-1]),s(e)))}),o}})),x3dom.registerNodeType("PositionInterpolator","Interpolation",defineClass(x3dom.nodeTypes.X3DInterpolatorNode,function(e){x3dom.nodeTypes.PositionInterpolator.superClass.call(this,e),this.addField_MFVec3f(e,"keyValue",[])},{fieldChanged:function(e){"set_fraction"===e&&null!=(e="CUBICSPLINE"===this._vf.interpolation?this.cubicSplineInterp(this._vf.set_fraction,function(t,i,o,s,n,r,a,d){function e(e){return n*i[e]+r*t[e]+a*s[e]+d*o[e]}var l=new x3dom.fields.SFVec3f;return l.x=e("x"),l.y=e("y"),l.z=e("z"),l}):this.linearInterp(this._vf.set_fraction,function(e,t,i){e=e.multiply(1-i);return e.x+=i*t.x,e.y+=i*t.y,e.z+=i*t.z,e}))&&e!=this._lastValue&&(this._lastValue=e,this.postMessage("value_changed",e))},keyValueFromAccessor:function(i){var o=new x3dom.fields.MFVec3f;return i.forEach(function(e,t){t%3==2&&o.push(new x3dom.fields.SFVec3f(i[t-2],i[t-1],e))}),o}})),x3dom.registerNodeType("PositionInterpolator2D","Interpolation",defineClass(x3dom.nodeTypes.X3DInterpolatorNode,function(e){x3dom.nodeTypes.PositionInterpolator2D.superClass.call(this,e),this.addField_MFVec2f(e,"keyValue",[])},{fieldChanged:function(e){"set_fraction"===e&&(e=this.linearInterp(this._vf.set_fraction,function(e,t,i){return e.multiply(1-i).add(t.multiply(i))}),this.postMessage("value_changed",e))}})),x3dom.registerNodeType("NormalInterpolator","Interpolation",defineClass(x3dom.nodeTypes.X3DInterpolatorNode,function(e){if(x3dom.nodeTypes.NormalInterpolator.superClass.call(this,e),this.addField_MFVec3f(e,"keyValue",[]),e&&e.xmlNode.hasAttribute("keyValue")){this._vf.keyValue=[];for(var t=x3dom.fields.MFVec3f.parse(e.xmlNode.getAttribute("keyValue")),i=0<this._vf.key.length?this._vf.key.length:1,o=t.length/i,s=0;s<i;s++){for(var n=new x3dom.fields.MFVec3f,r=0;r<o;r++)n.push(t[s*o+r]);this._vf.keyValue.push(n)}}},{fieldChanged:function(e){"set_fraction"===e&&null!=(e=this.linearInterp(this._vf.set_fraction,function(e,t,i){for(var o=new x3dom.fields.MFVec3f,s=0;s<e.length;s++)o.push(e[s].multiply(1-i).add(t[s].multiply(i)).normalize());return o}))&&e!=this._lastValue&&(this._lastValue=e,this.postMessage("value_changed",e))},keyValueFromAccessor:function(i){var o=new x3dom.fields.MFVec3f;i.forEach(function(e,t){t%3==2&&o.push(new x3dom.fields.SFVec3f(i[t-2],i[t-1],e))});for(var e=0<this._vf.key.length?this._vf.key.length:1,t=o.length/e,s=[],n=0;n<e;n++){for(var r=new x3dom.fields.MFVec3f,a=0;a<t;a++)r.push(o[n*t+a]);s.push(r)}return s}})),x3dom.registerNodeType("ColorInterpolator","Interpolation",defineClass(x3dom.nodeTypes.X3DInterpolatorNode,function(e){x3dom.nodeTypes.ColorInterpolator.superClass.call(this,e),this.addField_MFColor(e,"keyValue",[]),this.addField_SFBool(e,"RGB",!1),this._lastValue=new x3dom.fields.SFColor(-1,-1,-1),this.fieldChanged("keyValue")},{fieldChanged:function(e){var t,o;"set_fraction"===e&&(this._vf.RGB?t=this.linearInterp(this._vf.set_fraction,function(e,t,i){return o=e.multiply(1-i).add(t.multiply(i))}):(this._vf.keyValue=this._keyValueHSV,t=this.linearInterp(this._vf.set_fraction,function(e,t,i){e=e.copy(),t=t.copy();return t.r=t.r>e.r?t.r:t.r+360,t.r-e.r<180||(e.r=e.r+360),(o=e.multiply(1-i).add(t.multiply(i))).setHSV(o.r%360,o.g,o.b)}),this._vf.keyValue=this._keyValue),null==t||t.equals(this._lastValue,x3dom.fields.Eps)||(this._lastValue=t,this.postMessage("value_changed",t))),"keyValue"===e&&(this._keyValueHSV=this._vf.keyValue.map(function(e){e=e.getHSV();return new x3dom.fields.SFColor(e[0],e[1],e[2])}),this._keyValue=this._vf.keyValue.copy())},keyValueFromAccessor:function(i){var o=new x3dom.fields.MFColor;return i.forEach(function(e,t){t%3==2&&o.push(new x3dom.fields.SFColor(i[t-2],i[t-1],e))}),this._vf.keyValue=o,this.fieldChanged("keyValue"),o}})),x3dom.registerNodeType("ScalarInterpolator","Interpolation",defineClass(x3dom.nodeTypes.X3DInterpolatorNode,function(e){x3dom.nodeTypes.ScalarInterpolator.superClass.call(this,e),this.addField_MFFloat(e,"keyValue",[])},{fieldChanged:function(e){"set_fraction"===e&&null!=(e="CUBICSPLINE"===this._vf.interpolation?this.cubicSplineInterp(this._vf.set_fraction,function(e,t,i,o,s,n,r,a){return s*t+n*e+r*o+a*i}):this.linearInterp(this._vf.set_fraction,function(e,t,i){return(1-i)*e+i*t}))&&e!=this._lastValue&&(this._lastValue=e,this.postMessage("value_changed",e))},keyValueFromAccessor:function(e,t){var i=this.normalizeFromType[t];return e.map(function(e){return i(e)})}})),x3dom.registerNodeType("CoordinateInterpolator","Interpolation",defineClass(x3dom.nodeTypes.X3DInterpolatorNode,function(e){if(x3dom.nodeTypes.CoordinateInterpolator.superClass.call(this,e),this.addField_MFVec3f(e,"keyValue",[]),e&&e.xmlNode.hasAttribute("keyValue")){this._vf.keyValue=[];for(var t=x3dom.fields.MFVec3f.parse(e.xmlNode.getAttribute("keyValue")),i=0<this._vf.key.length?this._vf.key.length:1,o=t.length/i,s=0;s<i;s++){for(var n=new x3dom.fields.MFVec3f,r=0;r<o;r++)n.push(t[s*o+r]);this._vf.keyValue.push(n)}}},{fieldChanged:function(e){"set_fraction"===e&&null!=(e=this.linearInterp(this._vf.set_fraction,function(e,t,i){for(var o=new x3dom.fields.MFVec3f,s=0;s<e.length;s++)o.push(e[s].multiply(1-i).add(t[s].multiply(i)));return o}))&&e!=this._lastValue&&(this._lastValue=e,this.postMessage("value_changed",e))},keyValueFromAccessor:function(i){var o=new x3dom.fields.MFVec3f;i.forEach(function(e,t){t%3==2&&o.push(new x3dom.fields.SFVec3f(i[t-2],i[t-1],e))});for(var e=0<this._vf.key.length?this._vf.key.length:1,t=o.length/e,s=[],n=0;n<e;n++){for(var r=new x3dom.fields.MFVec3f,a=0;a<t;a++)r.push(o[n*t+a]);s.push(r)}return s}})),x3dom.registerNodeType("SplinePositionInterpolator","Interpolation",defineClass(x3dom.nodeTypes.X3DInterpolatorNode,function(e){x3dom.nodeTypes.SplinePositionInterpolator.superClass.call(this,e),this.addField_MFVec3f(e,"keyValue",[]),this.addField_MFVec3f(e,"keyVelocity",[]),this.addField_SFBool(e,"closed",!1),this.addField_SFBool(e,"normalizeVelocity",!1),this.dtot=0,this.T0=[],this.T1=[],this.checkSanity=function(){this._vf.key.length==this._vf.keyValue.length&&(this._vf.key.length==this._vf.keyVelocity.length||2==this._vf.keyVelocity.length&&2<=this._vf.key.length||0==this._vf.keyVelocity.length)||x3dom.debug.logWarning("SplinePositionInterpolator Node: 'key' , 'keyValue' and/or 'keyVelocity' fields have inappropriate sizes")},this.calcDtot=function(){for(var e=this.dtot=0;e<this._vf.key.length-1;e++)this.dtot+=Math.abs(this._vf.key[e]-this._vf.key[e+1])},this.calcAdjustedKeyVelocity=function(){var e,t,i,o=this._vf.key.length;if(this._vf.keyVelocity.length==o)for(n=0;n<o;n++)e=this._vf.keyVelocity[n],this._vf.normalizeVelocity&&(e=e.multiply(this.dtot/e.length())),t=0==n||n==o-1?1:2*(this._vf.key[n]-this._vf.key[n-1])/(this._vf.key[n+1]-this._vf.key[n-1]),i=0==n||n==o-1?1:2*(this._vf.key[n+1]-this._vf.key[n])/(this._vf.key[n+1]-this._vf.key[n-1]),this.T0[n]=e.multiply(t),this.T1[n]=e.multiply(i);else if(2==this._vf.keyVelocity.length&&2<o)for(n=0;n<o;n++)e=0==n?this._vf.keyVelocity[0]:n==o-1?this._vf.keyVelocity[1]:this._vf.keyValue[n+1].subtract(this._vf.keyValue[n-1]).multiply(.5),this._vf.normalizeVelocity&&(e=e.multiply(this.dtot/e.length())),t=0==n||n==o-1?1:2*(this._vf.key[n]-this._vf.key[n-1])/(this._vf.key[n+1]-this._vf.key[n-1]),i=0==n||n==o-1?1:2*(this._vf.key[n+1]-this._vf.key[n])/(this._vf.key[n+1]-this._vf.key[n-1]),this.T0[n]=e.multiply(t),this.T1[n]=e.multiply(i);else for(var s=this._vf.closed&&this._vf.keyValue[0].equals(this._vf.keyValue[o-1],1e-5),n=0;n<o;n++)0!=n&&n!=o-1||s?(i=0!=n&&n!=o-1||!s?(e=this._vf.keyValue[n+1].subtract(this._vf.keyValue[n-1]).multiply(.5),t=2*(this._vf.key[n]-this._vf.key[n-1])/(this._vf.key[n+1]-this._vf.key[n-1]),2*(this._vf.key[n+1]-this._vf.key[n])/(this._vf.key[n+1]-this._vf.key[n-1])):(e=this._vf.keyValue[1].subtract(this._vf.keyValue[o-2]).multiply(.5),i=0==n?(t=2*(this._vf.key[0]-this._vf.key[o-2])/(this._vf.key[1]-this._vf.key[o-2]),2*(this._vf.key[1]-this._vf.key[0])/(this._vf.key[1]-this._vf.key[o-2])):(t=2*(this._vf.key[o-1]-this._vf.key[o-2])/(this._vf.key[1]-this._vf.key[o-2]),2*(this._vf.key[1]-this._vf.key[o-1])/(this._vf.key[1]-this._vf.key[o-2])),t=2*(this._vf.key[o-1]-this._vf.key[o-2])/(this._vf.key[o-2]-this._vf.key[1]),2*(this._vf.key[1]-this._vf.key[0])/(this._vf.key[o-2]-this._vf.key[1])),this.T0[n]=e.multiply(t),this.T1[n]=e.multiply(i)):(this.T0[n]=new x3dom.fields.SFVec3f(0,0,0),this.T1[n]=new x3dom.fields.SFVec3f(0,0,0))},this.checkSanity(),this.calcDtot(),this.calcAdjustedKeyVelocity()},{fieldChanged:function(e){switch(e){case"key":case"keyValue":case"keyVelocity":this.checkSanity(),this.calcDtot(),this.calcAdjustedKeyVelocity();break;case"closed":case"normalizeVelocity":this.calcAdjustedKeyVelocity();break;case"set_fraction":0<this._vf.key.length&&(this._vf.set_fraction<=this._vf.key[0]?o=x3dom.fields.SFVec3f.copy(this._vf.keyValue[0]):this._vf.set_fraction>=this._vf.key[this._vf.key.length-1]&&(o=x3dom.fields.SFVec3f.copy(this._vf.keyValue[this._vf.key.length-1])));for(var t=0;t<this._vf.key.length-1;t++)if(this._vf.key[t]<this._vf.set_fraction&&this._vf.set_fraction<=this._vf.key[t+1]){var i=(this._vf.set_fraction-this._vf.key[t])/(this._vf.key[t+1]-this._vf.key[t]),i=new x3dom.fields.SFVec4f(2*i*i*i-3*i*i+1,-2*i*i*i+3*i*i,i*i*i-2*i*i+i,i*i*i-i*i),o=new x3dom.fields.SFVec3f(i.x*this._vf.keyValue[t].x+i.y*this._vf.keyValue[t+1].x+i.z*this.T0[t].x+i.w*this.T1[t+1].x,i.x*this._vf.keyValue[t].y+i.y*this._vf.keyValue[t+1].y+i.z*this.T0[t].y+i.w*this.T1[t+1].y,i.x*this._vf.keyValue[t].z+i.y*this._vf.keyValue[t+1].z+i.z*this.T0[t].z+i.w*this.T1[t+1].z);break}null!=o&&o!=this._lastValue&&(this._lastValue=o,this.postMessage("value_changed",o))}}})),x3dom.registerNodeType("TimeSensor","Time",defineClass(x3dom.nodeTypes.X3DSensorNode,function(e){x3dom.nodeTypes.TimeSensor.superClass.call(this,e),e?e.doc._nodeBag.timer.push(this):x3dom.debug.logWarning("TimeSensor: No runtime context found!"),this.addField_SFTime(e,"cycleInterval",1),this.addField_SFBool(e,"loop",!1),this.addField_SFTime(e,"startTime",0),this.addField_SFTime(e,"stopTime",0),this.addField_SFTime(e,"pauseTime",0),this.addField_SFTime(e,"resumeTime",0),this.addField_SFTime(e,"cycleTime",0),this.addField_SFTime(e,"elapsedTime",0),this.addField_SFFloat(e,"fraction_changed",0),this.addField_SFBool(e,"isActive",!1),this.addField_SFBool(e,"isPaused",!1),this.addField_SFTime(e,"time",0),this.addField_SFBool(e,"first",!0),this.addField_SFFloat(e,"firstCycle",0),this._prevCycle=-1,this._lastTime=0,this._cycleStopTime=0,(this._activatedTime=0)<this._vf.startTime&&this._updateCycleStopTime(),this._backupStartTime=this._vf.startTime,this._backupStopTime=this._vf.stopTime,this._backupCycleInterval=this._vf.cycleInterval},{tick:function(e){var t,i,o,s,n;return this._vf.enabled?((t=0<this._vf.cycleInterval&&e>=this._vf.startTime&&(e<this._vf.stopTime||this._vf.stopTime<=this._vf.startTime)&&(1==this._vf.loop||0==this._vf.loop&&e<this._cycleStopTime))&&!this._vf.isActive&&(this.postMessage("isActive",!0),this._activatedTime=e),(t||this._vf.isActive)&&(this.postMessage("elapsedTime",e-this._activatedTime),(i=e>=this._vf.pauseTime&&this._vf.pauseTime>this._vf.resumeTime)&&!this._vf.isPaused?(this.postMessage("isPaused",!0),this.postMessage("pauseTime",e)):!i&&this._vf.isPaused&&(this.postMessage("isPaused",!1),this.postMessage("resumeTime",e)),i||(i=this._getCycleAt(e),o=Math.floor(i),n=this._vf.startTime+o*this._vf.cycleInterval,s=0,this._vf.stopTime>this._vf.startTime&&this._lastTime<this._vf.stopTime&&e>=this._vf.stopTime?s=this._vf.stopTime:this._lastTime<n&&n<=e&&(s=n),0<s&&(e=s,i=this._getCycleAt(e),o=Math.floor(i)),(n=i-o)<x3dom.fields.Eps&&(n=this._lastTime<this._vf.startTime?0:1,this.postMessage("cycleTime",e)),this._fraction=n,this.postMessage("fraction_changed",n),this.postMessage("time",e))),!t&&this._vf.isActive&&this.postMessage("isActive",!1),this._lastTime=e,!0):(this._lastTime=e,!1)},fieldChanged:function(e){"enabled"==e?!this._vf.enabled&&this._vf.isActive&&this.postMessage("isActive",!1):"startTime"==e?this._vf.isActive?this._vf.startTime=this._backupStartTime:(this._backupStartTime=this._vf.startTime,this._updateCycleStopTime()):"stopTime"==e?this._vf.isActive&&this._vf.stopTime<=this._vf.startTime?this._vf.stopTime=this._backupStopTime:this._backupStopTime=this._vf.stopTime:"cycleInterval"==e?this._vf.isActive?this._vf.cycleInterval=this._backupCycleInterval:this._backupCycleInterval=this._vf.cycleInterval:"loop"==e?this._updateCycleStopTime():"resumeTime"!=e||this._vf.resumeTime<this._vf.pauseTime||this._vf.resumeTime<this._vf.startTime||!this._vf.enabled||(this._vf.startTime=this._vf.resumeTime-this._fraction*this._vf.cycleInterval,this._backupStartTime=this._vf.startTime,this._updateCycleStopTime())},parentRemoved:function(e){if(0===this._parentNodes.length){var t=this.findX3DDoc();if(t)for(var i=0,o=t._nodeBag.timer.length;i<o;i++)t._nodeBag.timer[i]===this&&t._nodeBag.timer.splice(i,1)}},_getCycleAt:function(e){return Math.max(0,e-this._vf.startTime)/this._vf.cycleInterval},_updateCycleStopTime:function(){var e;0==this._vf.loop?(e=(new Date).getTime()/1e3,e=Math.floor(this._getCycleAt(e))+1,this._cycleStopTime=this._vf.startTime+e*this._vf.cycleInterval):this._cycleStopTime=0}})),x3dom.registerNodeType("X3DTimeDependentNode","Time",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DTimeDependentNode.superClass.call(this,e),this.addField_SFBool(e,"loop",!1),this.addField_SFString(e,"description","")})),x3dom.registerNodeType("Anchor","Networking",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.Anchor.superClass.call(this,e),this.addField_MFString(e,"url",[]),this.addField_MFString(e,"parameter",[]),this.addField_SFString(e,"description",""),this.urlIndex=0},{nodeChanged:function(){this.updateUrlIndex()},fieldChanged:function(e){"url"==e&&this.updateUrlIndex()},updateUrlIndex:function(){this.urlIndex=0,that=this,function t(){var i=that._nameSpace.doc,o=that._vf.url[that.urlIndex]||"",e=o.lastIndexOf("."),e=o.substr(e).toLowerCase();!o.startsWith("javascript")&&(e.includes("x3d")||e.includes("json")||e.includes("html"))&&(i.incrementDownloads(),fetch(that._nameSpace.getURL(o)).then(function(e){if(e.ok)return e.text();throw new Error("Network response was not OK: "+e.status)}).then(function(e){return i.decrementDownloads(),e}).catch(function(e){if(x3dom.debug.logWarning(o+": Anchor fetch failed: "+e),i.decrementDownloads(),that.urlIndex++,!(that.urlIndex<that._vf.url.length))return x3dom.debug.logError("Anchor fetch failed for all x3d urls."),null;t()}))}()},doIntersect:function(e){for(var t=!1,i=0;i<this._childNodes.length;i++)this._childNodes[i]&&(t=this._childNodes[i].doIntersect(e)||t);return t},handleTouch:function(){var e=this._vf.url.length?this._vf.url[this.urlIndex]:"",t=e.search("#"),i="",t=(0<=t&&(i=e.slice(t+1)),this._vf.parameter.length>this.urlIndex?this._vf.parameter[this.urlIndex]:""),o=t.search("target="),s="";0<=o&&(s=t.slice(o+7)),x3dom.debug.logInfo("Anchor "+this._vf.description+" url="+e+", target="+s+", #viewpoint="+i),0!=this._vf.url.length&&(0<i.length&&e=="#"+i?i in this._nameSpace.defMap?this._nameSpace.defMap[i]._xmlNode.setAttribute("bind","true"):x3dom.debug.logWarning("Anchor #viewpoint="+i+" not in DEF list."):e.includes(".x3d")||e.includes(".json")?this.getRuntime().loadURL(this._nameSpace.getURL(e)):0!=s.length||"_self"!=s?window.open(this._nameSpace.getURL(e),s):window.location=this._nameSpace.getURL(e))}})),x3dom.registerNodeType("Inline","Networking",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.Inline.superClass.call(this,e),this.addField_MFString(e,"url",[]),this.addField_SFBool(e,"load",!0),this.addField_SFString(e,"description",""),this.addField_MFString(e,"nameSpaceName",[]),this.addField_SFString(e,"contentType",""),this.addField_SFBool(e,"mapDEFToID",!1),this.initDone=!1,this.urlIndex=0,this.count=0,this.numRetries=x3dom.nodeTypes.Inline.MaximumRetries,this.ContentType={X3D:"model/x3d+xml",GLTF:"model/gltf+json",GLB:"model/gltf-binary",X3DJ:"model/x3d+json"}},{fieldChanged:function(e){if("url"==e||"load"==e){for(var t=0;t<this._childNodes.length;t++)this.removeChild(this._childNodes[t]);if(0!=this._vf.nameSpaceName.length){var i=this._xmlNode;if(i&&i.hasChildNodes())for(;1<=i.childNodes.length;)i.removeChild(i.firstChild)}this.urlIndex=0,this.loadInline()}else"render"==e&&this.invalidateVolume()},nodeChanged:function(){this.initDone||(this.initDone=!0,this.urlIndex=0,this.loadInline())},parentRemoved:function(){var e=x3dom.getGlobal();0<this._childNodes.length&&this._childNodes[0]&&this._childNodes[0]._nameSpace&&this._nameSpace.removeSpace(this._childNodes[0]._nameSpace);for(var t=0,i=this._childNodes.length;t<i;t++)this._childNodes[t]&&(this._childNodes[t].parentRemoved(this),e._remover=this.removeChild(this._childNodes[t]));delete e._remover},fireEvents:function(e){if(this._xmlNode&&(this._xmlNode["on"+e]||this._xmlNode.hasAttribute("on"+e)||this._listeners[e])){var t=this._xmlNode,i={target:t,type:e,error:"error"==e?"XMLHttpRequest Error":"",cancelBubble:!1,stopPropagation:function(){this.cancelBubble=!0}};try{var o,s=t["on"+e],n=("function"==typeof s?s.call(t,i):t.hasAttribute("on"+e)&&(o=t.getAttribute("on"+e),new Function("event",o).call(t,i)),this._listeners[e]);if(n)for(var r=0;r<n.length;r++)n[r].call(t,i)}catch(e){x3dom.debug.logException(e)}}},isValidContentType:function(e){for(var t in this.ContentType)if(e===this.ContentType[t])return!0;return!1},getContentType:function(){if(""!=this._vf.contentType&&this.isValidContentType(this._vf.contentType))return this._vf.contentType;if(this._vf.url.length&&this._vf.url[this.urlIndex].length){var e=this._vf.url[this.urlIndex],t=e.lastIndexOf(".");if(-1!=t)switch(e.substr(t).toLowerCase()){case".x3d":return this.ContentType.X3D;case".gltf":return this.ContentType.GLTF;case".glb":return this.ContentType.GLB;case".json":return this.ContentType.X3DJ}}},loadX3D:function(e,t){if(this._vf.load){var i=this,o=null;if(e){if(0!=((o=t.setupTree(e))._nameSpace.superInlineNode=i)._vf.nameSpaceName.length)for(;e.children.length;){var s=e.children[0];setNamespace(i._vf.nameSpaceName,s,i._vf.mapDEFToID),i._xmlNode.appendChild(s)}}else x3dom.debug.logError("No Scene in resource");var n,r=x3dom.getGlobal();for(0<i._childNodes.length&&i._childNodes[0]&&i._childNodes[0]._nameSpace&&i._nameSpace.removeSpace(i._childNodes[0]._nameSpace);0!==i._childNodes.length;)r._remover=i.removeChild(i._childNodes[0]);delete r._remover,o&&(i.addChild(o),i.invalidateVolume(),(n=i._nameSpace.doc._scene)&&(n.invalidateVolume(),window.setTimeout(function(){i.invalidateVolume(),n.updateVolume(),i._nameSpace.doc.needRender=!0,i._nameSpace.doc.decrementDownloads(),i._nameSpace.doc.needRender=!0,x3dom.debug.logInfo("Inline: added "+i._vf.url[i.urlIndex]+" to scene.")},1e3)),i._nameSpace.importNodes(o._nameSpace),i.fireEvents("load")),t=o=null}else x3dom.debug.logInfo("Inline: load field prevented loading of "+this._vf.url[this.urlIndex])},loadInline:function(){var o=this,s=this.getContentType(),n=!1,r=new window.XMLHttpRequest;if(r.onreadystatechange=function(){var e,t,i;4==r.readyState&&(r.status===x3dom.nodeTypes.Inline.AwaitTranscoding?o.count<o.numRetries?(o.count++,t=+r.getResponseHeader("Refresh")||5,x3dom.debug.logInfo("XHR status: "+r.status+" - Await Transcoding ("+o.count+"/"+o.numRetries+"): Next request in "+t+" seconds"),window.setTimeout(function(){o._nameSpace.doc.decrementDownloads(),o.loadInline()},1e3*t)):(x3dom.debug.logError("XHR status: "+r.status+" - Await Transcoding ("+o.count+"/"+o.numRetries+"): No Retries left"),o._nameSpace.doc.decrementDownloads(),o.count=0):200==r.status||0==r.status?(x3dom.debug.logInfo("Inline: downloading "+o._vf.url[o.urlIndex]+" done."),null==s&&(s=r.getResponseHeader("Content-Type")),o.count=0,t=o.addNameSpace(),s==o.ContentType.GLTF||s==o.ContentType.GLB?r.response?(e=new x3dom.glTF2Loader(t).load(r.response,n),o.loadX3D(e,t)):o.nextUrlOrError("Invalid XHR response for glTF"):s==o.ContentType.X3DJ?r.response?(i=x3dom.protoExpander.prototypeExpander(r.responseURL,r.response),null!=(i=(new x3dom.JSONParser).parseJavaScript(i))?(e=i.getElementsByTagName("Scene")[0]||i.getElementsByTagName("scene")[0],o.loadX3D(e,t)):o.nextUrlOrError("Invalid XML parsing of JSON")):o.nextUrlOrError("Invalid XHR response for JSON"):s==o.ContentType.X3D&&(null!=(i="Microsoft Internet Explorer"==navigator.appName?(new DOMParser).parseFromString(r.responseText,"text/xml"):r.responseXML)?(e=i.getElementsByTagName("Scene")[0]||i.getElementsByTagName("scene")[0],o.loadX3D(e,t)):o.nextUrlOrError("Invalid xml parsing for X3D"))):o.nextUrlOrError(o._vf.url[o.urlIndex]+" status: "+r.status+" - XMLHttpRequest requires web server running!"))},this._vf.url.length&&this._vf.url[this.urlIndex].length){var e=this._nameSpace.getURL(this._vf.url[this.urlIndex]);r.open("GET",e,!0),r.setRequestHeader("Accept","model/x3d+xml; q=1.0, model/gltf+json; q=0.5, model/gltf-binary; q=0.5"),r.overrideMimeType&&(s==this.ContentType.X3D&&r.overrideMimeType("text/xml"),s==this.ContentType.X3DJ?(r.overrideMimeType("application/json"),r.responseType="json"):s==this.ContentType.GLTF?(n=!1,r.responseType="json"):s==this.ContentType.GLB&&(n=!0,r.responseType="arraybuffer"));try{this._nameSpace.doc.incrementDownloads(),x3dom.RequestManager.addRequest(r)}catch(s){o.nextUrlOrError(this._vf.url[this.urlIndex]+": "+s)}}},nextUrlOrError:function(e){x3dom.debug.logWarning(e),this._nameSpace.doc.decrementDownloads(),this.urlIndex++,this.urlIndex<this._vf.url.length?this.loadInline():(this.fireEvents("error"),this.count=0)},addNameSpace:function(){var e=0!=this._vf.nameSpaceName.length?this._vf.nameSpaceName.toString().replace(" ",""):"",e=new x3dom.NodeNameSpace(e,this._nameSpace.doc),t=this._vf.url.length?this._vf.url[0]:"";return"/"===t[0]||0<=t.indexOf(":")?e.setBaseURL(t):e.setBaseURL(this._nameSpace.baseURL+t),this._nameSpace.addSpace(e),e}})),x3dom.nodeTypes.Inline.AwaitTranscoding=202,x3dom.nodeTypes.Inline.MaximumRetries=15,x3dom.registerNodeType("X3DBackgroundNode","EnvironmentalEffects",defineClass(x3dom.nodeTypes.X3DBindableNode,function(e){x3dom.nodeTypes.X3DBackgroundNode.superClass.call(this,e);var t=e&&e.autoGen?1:0;this.addField_SFString(e,"crossOrigin",""),this.addField_MFColor(e,"groundColor",[]),this.addField_MFFloat(e,"groundAngle",[]),this.addField_MFColor(e,"skyColor",[new x3dom.fields.SFColor(0,0,0)]),this.addField_MFFloat(e,"skyAngle",[]),this.addField_SFFloat(e,"transparency",t),this._dirty=!0},{getSkyColor:function(){return new x3dom.fields.SFColor(0,0,0)},getTransparency:function(){return 0},getTexUrl:function(){return[]}})),x3dom.registerNodeType("X3DFogNode","EnvironmentalEffects",defineClass(x3dom.nodeTypes.X3DBindableNode,function(e){x3dom.nodeTypes.X3DFogNode.superClass.call(this,e),this.addField_SFColor(e,"color",1,1,1),this.addField_SFString(e,"fogType","LINEAR"),this.addField_SFFloat(e,"visibilityRange",0)},{})),x3dom.registerNodeType("Fog","EnvironmentalEffects",defineClass(x3dom.nodeTypes.X3DFogNode,function(e){x3dom.nodeTypes.Fog.superClass.call(this,e)},{})),x3dom.registerNodeType("Background","EnvironmentalEffects",defineClass(x3dom.nodeTypes.X3DBackgroundNode,function(e){x3dom.nodeTypes.Background.superClass.call(this,e),this.addField_MFString(e,"backUrl",[]),this.addField_MFString(e,"bottomUrl",[]),this.addField_MFString(e,"frontUrl",[]),this.addField_MFString(e,"leftUrl",[]),this.addField_MFString(e,"rightUrl",[]),this.addField_MFString(e,"topUrl",[]),this.addField_SFBool(e,"scaling",!1)},{fieldChanged:function(e){0<e.indexOf("Url")||"transparency"==e||0<=e.search("sky")||0<=e.search("ground")?this._dirty=!0:0<=e.indexOf("bind")&&this.bind(this._vf.bind)},getSkyColor:function(){return this._vf.skyColor},getGroundColor:function(){return this._vf.groundColor},getTransparency:function(){return this._vf.transparency},getTexUrl:function(){return[this._nameSpace.getURL(this._vf.backUrl[0]),this._nameSpace.getURL(this._vf.frontUrl[0]),this._nameSpace.getURL(this._vf.bottomUrl[0]),this._nameSpace.getURL(this._vf.topUrl[0]),this._nameSpace.getURL(this._vf.leftUrl[0]),this._nameSpace.getURL(this._vf.rightUrl[0])]}})),x3dom.registerNodeType("X3DEnvironmentNode","EnvironmentalEffects",defineClass(x3dom.nodeTypes.X3DBindableNode,function(e){x3dom.nodeTypes.X3DEnvironmentNode.superClass.call(this,e)})),x3dom.registerNodeType("Environment","EnvironmentalEffects",defineClass(x3dom.nodeTypes.X3DEnvironmentNode,function(e){x3dom.nodeTypes.Environment.superClass.call(this,e),this.addField_SFBool(e,"sortTrans",!0),this.addField_SFBool(e,"shadowExcludeTransparentObjects",!1),this.addField_SFString(e,"gammaCorrectionDefault","linear"),this.addField_SFString(e,"tonemapping","none"),this.addField_SFBool(e,"frustumCulling",!0),this.addField_SFBool(e,"smallFeatureCulling",!1),this.addField_SFFloat(e,"smallFeatureThreshold",1),this.addField_SFBool(e,"occlusionCulling",!1),this.addField_SFFloat(e,"occlusionVisibilityThreshold",0),this.addField_SFBool(e,"lowPriorityCulling",!1),this.addField_SFFloat(e,"lowPriorityThreshold",1),this.addField_SFBool(e,"tessellationDetailCulling",!1),this.addField_SFFloat(e,"tessellationErrorThreshold",0),this.addField_SFBool(e,"enableARC",!1),this.addField_SFFloat(e,"minFrameRate",1),this.addField_SFFloat(e,"maxFrameRate",62.5),this.addField_SFFloat(e,"userDataFactor",-1),this.addField_SFFloat(e,"smallFeatureFactor",-1),this.addField_SFFloat(e,"occlusionVisibilityFactor",-1),this.addField_SFFloat(e,"lowPriorityFactor",-1),this.addField_SFFloat(e,"tessellationErrorFactor",-1),this.addField_SFBool(e,"SSAO",!1),this.addField_SFFloat(e,"SSAOradius",.7),this.addField_SFFloat(e,"SSAOamount",.3),this.addField_SFInt32(e,"SSAOrandomTextureSize",4),this.addField_SFInt32(e,"SSAOblurDepthTreshold",1),this._validGammaCorrectionTypes=["none","fastlinear","linear"],this.checkSanity()},{checkSanity:function(){function e(e,t,i,o){return e&&t==o?i:e||t==o?t:o}var t,i;this._smallFeatureThreshold=e(this._vf.smallFeatureCulling,this._vf.smallFeatureThreshold,10,0),this._lowPriorityThreshold=e(this._vf.lowPriorityCulling,this._vf.lowPriorityThreshold,.5,1),this._occlusionVisibilityThreshold=e(this._vf.occlusionCulling,this._vf.occlusionVisibilityThreshold,1,0),this._tessellationErrorThreshold=e(this._vf.tessellationDetailCulling,this._vf.tessellationErrorThreshold,1,0),this._vf.gammaCorrectionDefault=(t=this._vf.gammaCorrectionDefault,i=this,t=t.toLowerCase(),-1<i._validGammaCorrectionTypes.indexOf(t)?t:(x3dom.debug.logWarning(t+" gammaCorrectionDefault may only be linear (default), fastLinear, or none"),i._validGammaCorrectionTypes[0]))}})),x3dom.registerNodeType("X3DViewpointNode","Navigation",defineClass(x3dom.nodeTypes.X3DBindableNode,function(e){x3dom.nodeTypes.X3DViewpointNode.superClass.call(this,e),this.addField_SFFloat(e,"nearClippingPlane",-1),this.addField_SFFloat(e,"farClippingPlane",-1),this.addField_SFBool(e,"viewAll",!1),this.addField_SFNode("navigationInfo",x3dom.nodeTypes.NavigationInfo),e&&e.xmlNode&&((e=e.xmlNode).resetView||e.getFieldOfView||e.getNear||e.getFar||(e.resetView=function(){var e=this._x3domNode;e.resetView(),e._nameSpace.doc.needRender=!0},e.getFieldOfView=function(){return this._x3domNode.getFieldOfView()},e.getNear=function(){return this._x3domNode.getNear()},e.getFar=function(){return this._x3domNode.getFar()}))},{activate:function(e){var t,i=this._nameSpace.doc._viewarea,o=(e=e||this,this);this._bindAnimation&&(this._vf.viewAll&&(t=this._runtime.getSceneBBox(),o=i.getFitViewMatrix(t.min,t.max,e,!0)),i.animateTo(o,e._autoGen?null:e)),i._needNavigationMatrixUpdate=!0,this._cf.navigationInfo.node&&this._cf.navigationInfo.node.bind(!0),x3dom.nodeTypes.X3DBindableNode.prototype.activate.call(this,e)},deactivate:function(e){x3dom.nodeTypes.X3DBindableNode.prototype.deactivate.call(this,e)},getTransformation:function(){return this.getCurrentTransform()},getCenterOfRotation:function(){return new x3dom.fields.SFVec3f(0,0,0)},setCenterOfRotation:function(e){this._vf.centerOfRotation.setValues(e)},getFieldOfView:function(){return Math.PI/2},setView:function(e){var t=this.getCurrentTransform();this._viewMatrix=e.mult(t)},setViewAbsolute:function(e){this._viewMatrix=e},setProjectionMatrix:function(e){},resetView:function(){},getNear:function(){return.1},getFar:function(){return 1e4},getImgPlaneHeightAtDistOne:function(){return 2},getViewMatrix:function(){return null},getProjectionMatrix:function(e){return null},setZoom:function(e){}})),x3dom.registerNodeType("Viewpoint","Navigation",defineClass(x3dom.nodeTypes.X3DViewpointNode,function(e){x3dom.nodeTypes.Viewpoint.superClass.call(this,e),this.addField_SFFloat(e,"fieldOfView",.785398),this.addField_SFVec3f(e,"position",0,0,10),this.addField_SFRotation(e,"orientation",0,0,1,0),this.addField_SFVec3f(e,"centerOfRotation",0,0,0),this.addField_SFFloat(e,"zNear",-1),this.addField_SFFloat(e,"zFar",-1),this._viewMatrix=x3dom.fields.SFMatrix4f.translation(this._vf.position).mult(this._vf.orientation.toMatrix()).inverse(),this._projMatrix=null,-(this._lastAspect=1)<this._vf.nearClippingPlane&&(this._vf.zNear=this._vf.nearClippingPlane),-1<this._vf.farClippingPlane&&(this._vf.zFar=this._vf.farClippingPlane),this._zRatio=1e4,this._zNear=this._vf.zNear,this._zFar=this._vf.zFar,this._imgPlaneHeightAtDistOne=2*Math.tan(this._vf.fieldOfView/2)},{fieldChanged:function(e){"nearClippingPlane"==e?(this._vf.zNear=this._vf.nearClippingPlane,e="zNear"):"farClippingPlane"==e&&(this._vf.zFar=this._vf.farClippingPlane,e="zFar"),"position"==e||"orientation"==e?this.resetView():"fieldOfView"==e||"zNear"==e||"zFar"==e?(this._projMatrix=null,this._zNear=this._vf.zNear,this._zFar=this._vf.zFar,this._imgPlaneHeightAtDistOne=2*Math.tan(this._vf.fieldOfView/2)):0<=e.indexOf("bind")?(this.bind(this._vf.bind),this._cf.navigationInfo.node&&this._cf.navigationInfo.node.bind(this._vf.bind)):"viewAll"==e&&this._vf.viewAll&&this._nameSpace.doc._x3dElem.runtime.fitAll()},setProjectionMatrix:function(e){this._projMatrix=e},getCenterOfRotation:function(){return this._vf.centerOfRotation},getViewMatrix:function(){return this._viewMatrix},getFieldOfView:function(){return this._vf.fieldOfView},resetView:function(){this._viewMatrix=x3dom.fields.SFMatrix4f.translation(this._vf.position).mult(this._vf.orientation.toMatrix()).inverse(),this._vf.isActive&&this._nameSpace&&this._nameSpace.doc._viewarea&&this._nameSpace.doc._viewarea.resetNavHelpers()},getNear:function(){return this._zNear},getFar:function(){return this._zFar},getImgPlaneHeightAtDistOne:function(){return this._imgPlaneHeightAtDistOne},getProjectionMatrix:function(e){var t,i,o,s,n,r,a,d,l,h,u,f=this._vf.fieldOfView,c=this._vf.zFar,_=this._vf.zNear;return(_<=0||c<=0)&&(t=.8,i=1.2,s=(a=this._nameSpace.doc._viewarea)._scene,o=x3dom.fields.SFVec3f.copy(s._lastMin),n=(s=x3dom.fields.SFVec3f.copy(s._lastMax).subtract(o)).length()/2,r=(a=a.getViewMatrix().inverse()).e3(),u=new x3dom.fields.SFVec3f(0,0,0),h=new x3dom.fields.SFVec3f(1,1,1),d=new x3dom.fields.Quaternion(0,0,1,0),l=new x3dom.fields.Quaternion(0,0,1,0),a.getTransform(u,d,h,l),a=h.x,(u=h.x)<h.y&&(u=h.y),a>h.y&&(a=h.y),u<h.z&&(u=h.z),a>h.z&&(a=h.z),1<u?t/=u:a>x3dom.fields.Eps&&a<1&&(i/=a),d=o.add(s.multiply(.5)),l=r.subtract(d).length(),h=(c=n?(_=n<l?(l-n)*t:0,(l+n)*i):(_=.1,1e5))/this._zRatio,_=Math.max(_,Math.max(x3dom.fields.Eps,h)),c>this._vf.zNear&&0<this._vf.zNear&&(_=this._vf.zNear),(c=this._vf.zFar>_?this._vf.zFar:c)<=_)&&(c=_+1),null==this._projMatrix?this._projMatrix=x3dom.fields.SFMatrix4f.perspective(f,e,_,c):this._zNear!=_||this._zFar!=c?(this._projMatrix._22=(_+c)/(u=_-c),this._projMatrix._23=2*_*c/u):this._lastAspect!=e&&(this._projMatrix._00=1/Math.tan(f/2)/e,this._lastAspect=e),this._zNear=_,this._zFar=c,this._projMatrix}})),x3dom.registerNodeType("OrthoViewpoint","Navigation",defineClass(x3dom.nodeTypes.X3DViewpointNode,function(e){x3dom.nodeTypes.OrthoViewpoint.superClass.call(this,e),this.addField_MFFloat(e,"fieldOfView",[-1,-1,1,1]),this.addField_SFVec3f(e,"position",0,0,10),this.addField_SFRotation(e,"orientation",0,0,0,1),this.addField_SFVec3f(e,"centerOfRotation",0,0,0),this.addField_SFFloat(e,"zNear",-1),this.addField_SFFloat(e,"zFar",-1),this._viewMatrix=null,this._projMatrix=null,-(this._lastAspect=1)<this._vf.nearClippingPlane&&(this._vf.zNear=this._vf.nearClippingPlane),-1<this._vf.farClippingPlane&&(this._vf.zFar=this._vf.farClippingPlane),this._zRatio=1e4,this._zNear=this._vf.zNear,this._zFar=this._vf.zFar,this._fieldOfView=this._vf.fieldOfView.slice(0),this.resetView()},{fieldChanged:function(e){"nearClippingPlane"==e?(this._vf.zNear=this._vf.nearClippingPlane,e="zNear"):"farClippingPlane"==e&&(this._vf.zFar=this._vf.farClippingPlane,e="zFar"),"position"==e||"orientation"==e?this.resetView():"fieldOfView"==e?(this._fieldOfView=this._vf.fieldOfView,this._projMatrix=null):"zNear"==e||"zFar"==e?(this._projMatrix=null,this.resetView()):0<=e.indexOf("bind")?(this.bind(this._vf.bind),this._cf.navigationInfo.node&&this._cf.navigationInfo.node.bind(this._vf.bind)):"viewAll"==e&&this._vf.viewAll&&this._nameSpace.doc._x3dElem.runtime.fitAll()},getCenterOfRotation:function(){return this.getCurrentTransform().multMatrixPnt(this._vf.centerOfRotation)},getViewMatrix:function(){return this._viewMatrix},resetView:function(){x3dom.fields.SFMatrix4f.translation(new x3dom.fields.SFVec3f((this._vf.fieldOfView[0]+this._vf.fieldOfView[2])/2,(this._vf.fieldOfView[1]+this._vf.fieldOfView[3])/2,0)),this._viewMatrix=x3dom.fields.SFMatrix4f.translation(this._vf.position).mult(this._vf.orientation.toMatrix()),this._viewMatrix=this._viewMatrix.inverse(),this._projMatrix=null,this._vf.isActive&&this._nameSpace&&this._nameSpace.doc._viewarea&&this._nameSpace.doc._viewarea.resetNavHelpers()},getNear:function(){return this._vf.zNear},getFar:function(){return this._vf.zFar},getFieldOfView:function(){return.785},setZoom:function(e){this._fieldOfView[0]=-e,this._fieldOfView[1]=-e,this._fieldOfView[2]=e,this._fieldOfView[3]=e,this._projMatrix=null},getZoom:function(e){return this._fieldOfView},getProjectionMatrix:function(e){var t,i,o,s=this.getFieldOfView(),n=this._vf.zFar,r=this._vf.zNear;return(r<=0||n<=0)&&(i=this._nameSpace.doc._viewarea._scene,t=x3dom.fields.SFVec3f.copy(i._lastMin),i=x3dom.fields.SFVec3f.copy(i._lastMax).subtract(t),t=Math.tan(s/2),s=i.y/2/t+i.z+this._fieldOfView[2],n=4*(i=(t=i.x/2/t+i.z+this._fieldOfView[2])<s?s:t),r=1e-4,this._viewMatrix._23=-2*i),null!=this._projMatrix&&this._lastAspect==e&&this._zNear==r&&this._zFar==n||(s=this._zNear=r,t=this._zFar=n,i=this._fieldOfView[0],r=this._fieldOfView[1],n=this._fieldOfView[2],o=this._fieldOfView[3],this._projMatrix=x3dom.fields.SFMatrix4f.ortho(i,n,r,o,s,t,e)),this._lastAspect=e,this._projMatrix}})),x3dom.registerNodeType("Viewfrustum","Navigation",defineClass(x3dom.nodeTypes.X3DViewpointNode,function(e){x3dom.nodeTypes.Viewfrustum.superClass.call(this,e),this.addField_SFMatrix4f(e,"modelview",1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this.addField_SFMatrix4f(e,"projection",1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this._viewMatrix=this._vf.modelview.transpose().inverse(),this._projMatrix=this._vf.projection.transpose(),this._centerOfRotation=new x3dom.fields.SFVec3f(0,0,0)},{fieldChanged:function(e){"modelview"==e?this.resetView():"projection"==e?this._projMatrix=this._vf.projection.transpose():0<=e.indexOf("bind")&&this.bind(this._vf.bind)},getCenterOfRotation:function(){return this.getCurrentTransform().multMatrixPnt(this._centerOfRotation)},setCenterOfRotation:function(e){this._centerOfRotation.setValues(e)},getViewMatrix:function(){return this._viewMatrix},getFieldOfView:function(){return 2*Math.atan(1/this._projMatrix._11)},getImgPlaneHeightAtDistOne:function(){return 2/this._projMatrix._11},resetView:function(){this._viewMatrix=this._vf.modelview.transpose().inverse(),this._centerOfRotation=new x3dom.fields.SFVec3f(0,0,0)},getProjectionMatrix:function(e){return this._projMatrix}})),x3dom.registerNodeType("X3DNavigationInfoNode","Navigation",defineClass(x3dom.nodeTypes.X3DBindableNode,function(e){x3dom.nodeTypes.X3DNavigationInfoNode.superClass.call(this,e)})),x3dom.registerNodeType("NavigationInfo","Navigation",defineClass(x3dom.nodeTypes.X3DNavigationInfoNode,function(e){x3dom.nodeTypes.NavigationInfo.superClass.call(this,e),this.addField_SFBool(e,"headlight",!0),this.addField_SFBool(e,"reverseScroll",!1),this.addField_MFString(e,"type",["EXAMINE","ANY"]),this.addField_MFFloat(e,"typeParams",[-.4,60,.05,2.8]),this.addField_SFString(e,"explorationMode","all"),this.addField_MFFloat(e,"avatarSize",[.25,1.6,.75]),this.addField_SFFloat(e,"walkDamping",2),this.addField_SFFloat(e,"visibilityLimit",0),this.addField_SFFloat(e,"speed",1),this.addField_SFTime(e,"transitionTime",1),this.addField_MFString(e,"transitionType",["LINEAR"]),this._validTypes=["none","examine","turntable","fly","freefly","lookat","lookaround","walk","game","helicopter","any"],this._typeMapping={default:x3dom.DefaultNavigation,turntable:x3dom.TurntableNavigation,walk:x3dom.WalkNavigation},this._heliUpdated=!1;e=this.setType(this.getType());x3dom.debug.logInfo("NavType: "+e)},{fieldChanged:function(e){"typeParams"==e?this._heliUpdated=!1:"type"==e?this.setType(this.getType()):0<=e.indexOf("bind")&&this.bind(this._vf.bind)},setType:function(e,t){e=this.checkType(e.toLowerCase());if(this.checkType(this.getType())!==e||null==this._impl){switch(null==this._typeMapping[e]?this._impl=new this._typeMapping.default(this):this._impl=new this._typeMapping[e](this),e){case"game":t?t.initMouseState():this._nameSpace.doc._viewarea&&this._nameSpace.doc._viewarea.initMouseState();break;case"helicopter":this._heliUpdated=!1;break;case"turntable":t?t.initMouseState():this._nameSpace.doc._viewarea&&this._nameSpace.doc._viewarea.initMouseState()}this._nameSpace.doc._viewarea&&this._impl.init(this._nameSpace.doc._viewarea,!1)}this._vf.type[0]=e,x3dom.debug.logInfo("Switch to "+e+" mode.")},getType:function(){var e=this._vf.type[0].toLowerCase();return e.length<=1?e="none":"any"==e&&(e="examine"),e},getTypeParams:function(){var e=this._vf.typeParams.length,t=[1<=e?this._vf.typeParams[0]:-.4,2<=e?this._vf.typeParams[1]:60,3<=e?this._vf.typeParams[2]:x3dom.fields.Eps,4<=e?this._vf.typeParams[3]:Math.PI-x3dom.fields.Eps];return t=5<=e?t.concat(this._vf.typeParams.slice(4)):t},setTypeParams:function(e){for(var t=0;t<e.length;t++)this._vf.typeParams[t]=e[t]},checkType:function(e){return-1<this._validTypes.indexOf(e)?e:(x3dom.debug.logWarning(e+" is no valid navigation type, use one of "+this._validTypes.toString()),"examine")},getExplorationMode:function(){switch(this._vf.explorationMode.toLowerCase()){case"all":return 7;case"rotate":return 1;case"zoom":return 2;case"pan":return 4;case"-rotate":return 6;case"-zoom":return 5;case"-pan":return 3;case"none":return 0;default:return 7}}})),x3dom.registerNodeType("Billboard","Navigation",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.Billboard.superClass.call(this,e),this.addField_SFVec3f(e,"axisOfRotation",0,1,0),this._eye=new x3dom.fields.SFVec3f(0,0,0),this._eyeViewUp=new x3dom.fields.SFVec3f(0,0,0),this._eyeLook=new x3dom.fields.SFVec3f(0,0,0)},{collectDrawableObjects:function(e,t,i,o,s,n){if((i=i&&1<this._parentNodes.length?!1:i)&&(o=o||this.cacheInvalid())&&this.invalidateCache(),this.collectBbox(e,t,i,o,s,n),!((s=t.cull(e,this.graphState(),i,s))<0)){i=!1;var r=this.getVolume(),a=x3dom.fields.SFVec3f.MAX(),d=x3dom.fields.SFVec3f.MIN(),r=(r.getBounds(a,d),t.viewMatrix),l=new x3dom.fields.SFVec3f(0,0,0),l=r.inverse().multMatrixPnt(l),r=r.mult(e),l=(this._eye=e.inverse().multMatrixPnt(l),this._eyeViewUp=new x3dom.fields.SFVec3f(r._10,r._11,r._12),this._eyeLook=new x3dom.fields.SFVec3f(r._20,r._21,r._22),x3dom.fields.SFMatrix4f.identity()),r=d.add(a).multiply(.5),d=this._eye.subtract(r);this._vf.axisOfRotation.equals(new x3dom.fields.SFVec3f(0,0,0),x3dom.fields.Eps)?(a=(l=x3dom.fields.Quaternion.rotateFromTo(d,new x3dom.fields.SFVec3f(0,0,1)).toMatrix().transpose()).multMatrixPnt(new x3dom.fields.SFVec3f(0,1,0)).normalize(),r=l.multMatrixPnt(new x3dom.fields.SFVec3f(0,0,1)).normalize(),this._eyeViewUp.equals(new x3dom.fields.SFVec3f(0,0,0),x3dom.fields.Eps)||(a=(r=x3dom.fields.Quaternion.rotateFromTo(this._eyeLook,r)).toMatrix().transpose().multMatrixVec(a),a=x3dom.fields.Quaternion.rotateFromTo(this._eyeViewUp,a),l=r.toMatrix().transpose().mult(l),l=a.toMatrix().transpose().mult(l))):(r=this._vf.axisOfRotation.cross(d).normalize(),this._eye.z<0&&(r=r.multiply(-1)),a=Math.asin(r.dot(new x3dom.fields.SFVec3f(0,0,1))),this._eye.z<0&&(a+=Math.PI),l=x3dom.fields.SFMatrix4f.parseRotation(this._vf.axisOfRotation.x+", "+this._vf.axisOfRotation.y+", "+this._vf.axisOfRotation.z+", "+-1*a));for(var h=this.transformMatrix(e.mult(l)),u=0,f=this._childNodes.length;u<f;u++){var c=this._childNodes[u];c&&c.collectDrawableObjects(h,t,i,o,s,n)}}}})),x3dom.registerNodeType("Collision","Navigation",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.Collision.superClass.call(this,e),this.addField_SFBool(e,"enabled",!0),this.addField_SFNode("proxy",x3dom.nodeTypes.X3DGroupingNode),this.addField_SFTime(e,"collideTime",0),this.addField_SFBool(e,"isActive",!0)},{collectDrawableObjects:function(e,t,i,o,s,n){var r,a;if((i=i&&1<this._parentNodes.length?!1:i)&&(o=o||this.cacheInvalid())&&this.invalidateCache(),a=i?(this._graph.globalMatrix||(this._graph.globalMatrix=this.transformMatrix(e)),this._graph.globalMatrix):this.transformMatrix(e),this.collectBbox(a,t,i,o,s,n),!((s=t.cull(e,this.graphState(),i,s))<0))for(var d=0,l=this._childNodes.length;d<l;d++)(r=this._childNodes[d])&&r!==this._cf.proxy.node&&r.collectDrawableObjects(a,t,i,o,s,n)}})),x3dom.registerNodeType("X3DLODNode","Navigation",defineClass(x3dom.nodeTypes.X3DGroupingNode,function(e){x3dom.nodeTypes.X3DLODNode.superClass.call(this,e),this.addField_SFBool(e,"forceTransitions",!1),this.addField_SFVec3f(e,"center",0,0,0),this._eye=new x3dom.fields.SFVec3f(0,0,0)},{collectDrawableObjects:function(e,t,i,o,s,n){(i=i&&1<this._parentNodes.length?!1:i)&&(o=o||this.cacheInvalid())&&this.invalidateCache(),this.collectBbox(e,t,i,o,s,n),(s=t.cull(e,this.graphState(),i,s))<0||this.visitChildren(e,t,i=!1,o,s,n)},visitChildren:function(e,t,i,o,s,n){}})),x3dom.registerNodeType("LOD","Navigation",defineClass(x3dom.nodeTypes.X3DLODNode,function(e){x3dom.nodeTypes.LOD.superClass.call(this,e),this.addField_MFFloat(e,"range",[]),this.addField_SFInt32(e,"level_changed",0),this._lastRangePos=-1},{visitChildren:function(e,t,i,o,s,n){var r=0,a=this._childNodes.length,d=t.viewMatrix,l=new x3dom.fields.SFVec3f(0,0,0),l=d.inverse().multMatrixPnt(l);this._eye=e.inverse().multMatrixPnt(l);for(var h=this._vf.center.subtract(this._eye).length();r<this._vf.range.length&&h>this._vf.range[r];)r++;(r=r&&a<=r?a-1:r)!==this._lastRangePos&&this.postMessage("level_changed",r),this._lastRangePos=r;d=this._childNodes[r];a&&d&&(l=this.transformMatrix(e),d.collectDrawableObjects(l,t,i,o,s,n))},getVolume:function(){var e,t,i=this._graph.volume;if(!this.volumeValid()&&(this._vf.bboxDisplay||this.renderFlag&&this.renderFlag()))if(0<=this._lastRangePos)(t=(e=this._childNodes[this._lastRangePos])&&(e._vf.bboxDisplay||e.renderFlag&&e.renderFlag())?e.getVolume():null)&&t.isValid()&&i.extendBounds(t.min,t.max);else for(var o=0,s=this._childNodes.length;o<s;o++)!(e=this._childNodes[o])||e.renderFlag&&!0!==e.renderFlag()&&!e._vf.bboxDisplay||(t=e.getVolume())&&t.isValid()&&i.extendBounds(t.min,t.max);return i},nodeChanged:function(){this.invalidateVolume()},fieldChanged:function(e){"render"!=e&&"center"!=e&&"range"!=e||this.invalidateVolume()}})),x3dom.registerNodeType("DynamicLOD","Navigation",defineClass(x3dom.nodeTypes.X3DLODNode,function(e){x3dom.nodeTypes.DynamicLOD.superClass.call(this,e),this.addField_SFFloat(e,"subScale",.5),this.addField_SFVec2f(e,"size",2,2),this.addField_SFVec2f(e,"subdivision",1,1),this.addField_SFNode("root",x3dom.nodeTypes.X3DShapeNode),this.addField_SFString(e,"urlHead","http://r"),this.addField_SFString(e,"urlCenter",".ortho.tiles.virtualearth.net/tiles/h"),this.addField_SFString(e,"urlTail",".png?g=-1"),this.rootGeometry=new x3dom.nodeTypes.Plane(e),this.level=0,this.quadrant=4,this.cell=""},{nodeChanged:function(){var e=this._cf.root.node;null!=e&&null==e._cf.geometry.node&&(this.rootGeometry._vf.size.setValues(this._vf.size),this.rootGeometry._vf.subdivision.setValues(this._vf.subdivision),this.rootGeometry._vf.center.setValues(this._vf.center),this.rootGeometry.fieldChanged("subdivision"),this._cf.root.node.addChild(this.rootGeometry),this.rootGeometry.nodeChanged(),this._cf.root.node.nodeChanged(),this._nameSpace.doc.needRender=!0)},visitChildren:function(e,t,i,o,s,n){var r=this._cf.root.node;if(null!=r){var a=t.viewMatrix,d=new x3dom.fields.SFVec3f(0,0,0),d=a.inverse().multMatrixPnt(d);this._eye=e.inverse().multMatrixPnt(d);a=this._vf.center.subtract(this._eye).length();if(a>x3dom.fields.Eps&&a*this._vf.subScale<=this._vf.size.length())if(this._childNodes.length<=1)for(var l=new Array(new x3dom.fields.SFVec3f(-.25*this._vf.size.x,.25*this._vf.size.y,0),new x3dom.fields.SFVec3f(.25*this._vf.size.x,.25*this._vf.size.y,0),new x3dom.fields.SFVec3f(-.25*this._vf.size.x,-.25*this._vf.size.y,0),new x3dom.fields.SFVec3f(.25*this._vf.size.x,-.25*this._vf.size.y,0)),h=0;h<4;h++){var u=new x3dom.nodeTypes.DynamicLOD,f=(u._nameSpace=this._nameSpace,u._eye.setValues(this._eye),u.level=this.level+1,u.quadrant=h,u.cell=this.cell+h,u._vf.urlHead=this._vf.urlHead,u._vf.urlCenter=this._vf.urlCenter,u._vf.urlTail=this._vf.urlTail,u._vf.center=this._vf.center.add(l[h]),u._vf.size=this._vf.size.multiply(.5),u._vf.subdivision.setValues(this._vf.subdivision),new x3dom.nodeTypes.Appearance),c=new x3dom.nodeTypes.ImageTexture,c=(c._nameSpace=this._nameSpace,c._vf.url[0]=this._vf.urlHead+u.quadrant+this._vf.urlCenter+u.cell+this._vf.urlTail,f.addChild(c),c.nodeChanged(),new x3dom.nodeTypes.Shape);c._nameSpace=this._nameSpace,c.addChild(f),f.nodeChanged(),u.addChild(c,"root"),c.nodeChanged(),this.addChild(u),u.nodeChanged()}else for(h=1;h<this._childNodes.length;h++)this._childNodes[h].collectDrawableObjects(e,t,i,o,s,n);else r.collectDrawableObjects(e,t,i,o,s,n)}},getVolume:function(){var e=this._graph.volume;return e.isValid()||(e.min.setValues(this._vf.center),e.min.x-=.5*this._vf.size.x,e.min.y-=.5*this._vf.size.y,e.min.z-=x3dom.fields.Eps,e.max.setValues(this._vf.center),e.max.x+=.5*this._vf.size.x,e.max.y+=.5*this._vf.size.y,e.max.z+=x3dom.fields.Eps),e}})),x3dom.DefaultNavigation=function(e){this.navi=e},x3dom.DefaultNavigation.prototype.onMousePress=function(e,t,i,o){},x3dom.DefaultNavigation.prototype.onMouseReleased=function(e,t,i,o,s){},x3dom.DefaultNavigation.prototype.init=function(e,t){},x3dom.DefaultNavigation.prototype.zoom=function(e,t){var i=this.navi,o=e._scene.getViewpoint(),s=e._scene._lastMax.subtract(e._scene._lastMin).length(),s=((s=Math.min(s,o.getFar()))<x3dom.fields.Eps?1:s)*i._vf.speed,s=new x3dom.fields.SFVec3f(0,0,s*t/e._height),i=(x3dom.isa(o,x3dom.nodeTypes.OrthoViewpoint)&&o.setZoom(Math.abs(o._fieldOfView[0])-s.z),6<=i._vf.typeParams.length&&(t=-i._vf.typeParams[5],o=i._vf.typeParams[4],e._movement.z=Math.min(Math.max(e._movement.z,t),o)),e._movement=e._movement.add(s),e.getViewpointMatrix().mult(e._transMat));e._transMat=i.inverse().mult(x3dom.fields.SFMatrix4f.translation(e._movement)).mult(i)},x3dom.DefaultNavigation.prototype.moveForward=function(e){var t,i,o,s,n=this.navi;"game"===n.getType()&&(t=.25,2<n._vf.avatarSize.length&&(t=n._vf.avatarSize[0]),n=5*e._deltaT*n._vf.speed,i=e._yaw/180*Math.PI,o=e._pitch/180*Math.PI,s=e._flyMat.inverse(),e._scene._nameSpace.doc.ctx.pickValue(e,e._width/2,e._height/2,e._lastButton),!e._pickingInfo.pickObj||e._pickingInfo.pickPos.subtract(s.e3()).length()<=2*t||(e._eyePos.x-=Math.sin(i)*n,e._eyePos.z+=Math.cos(i)*n,e._eyePos.y+=Math.sin(o)*n))},x3dom.DefaultNavigation.prototype.moveBackwards=function(e){var t,i,o=this.navi;"game"===o.getType()&&(o=5*e._deltaT*o._vf.speed,t=e._yaw/180*Math.PI,i=e._pitch/180*Math.PI,e._eyePos.x+=Math.sin(t)*o,e._eyePos.z-=Math.cos(t)*o,e._eyePos.y-=Math.sin(i)*o)},x3dom.DefaultNavigation.prototype.strafeLeft=function(e){var t,i=this.navi;"game"===i.getType()&&(i=5*e._deltaT*i._vf.speed,t=e._yaw/180*Math.PI,e._eyePos.x+=Math.cos(t)*i,e._eyePos.z+=Math.sin(t)*i)},x3dom.DefaultNavigation.prototype.strafeRight=function(e){var t,i=this.navi;"game"===i.getType()&&(i=5*e._deltaT*i._vf.speed,t=e._yaw/180*Math.PI,e._eyePos.x-=Math.cos(t)*i,e._eyePos.z-=Math.sin(t)*i)},x3dom.DefaultNavigation.prototype.navigateTo=function(e,t){function i(e,t){return 0<e?e<=t?0:e-t:e<=0?-t<=e?0:e+t:void 0}function o(e,t){return(t<0?-1:1)*Math.pow(e*Math.abs(t),1.65)}var s=this.navi,n=s.getType(),r=null,a=e._currentInputType==x3dom.InputTypes.NAVIGATION&&("game"===n||0<e._lastButton&&(0<=n.indexOf("fly")||"walk"===n||"helicopter"===n||"looka"===n.substr(0,5)));e._deltaT=t-e._lastTS;if(a){null!==e._pickingInfo.pickObj&&(r={pickPos:e._pickingInfo.pickPos,pickNorm:e._pickingInfo.pickNorm,pickObj:e._pickingInfo.pickObj,firstObj:e._pickingInfo.firstObj,lastObj:e._pickingInfo.lastObj,lastClickObj:e._pickingInfo.lastClickObj,shadowObjectId:e._pickingInfo.shadowObjectId});var t=.25,d=1.6,l=(2<s._vf.avatarSize.length&&(t=s._vf.avatarSize[0],d=s._vf.avatarSize[1],s._vf.avatarSize[2]),e.getViewMatrix()),h=0,u=Math.min(e._width,e._height),f=i((e._pressX-e._lastX)/u,.01),u=i((e._pressY-e._lastY)/u,.01),f=o(1,f),u=o(1,u),c=2&e._lastButton?-1:1,_=(c*=e._deltaT*s._vf.speed,s._vf.speed,e._deltaT*s._vf.speed*u),f=Math.PI*e._deltaT*f,u=Math.PI*e._deltaT*u;!0===e._needNavigationMatrixUpdate&&(e._needNavigationMatrixUpdate=!1,e._rotMat=x3dom.fields.SFMatrix4f.identity(),e._transMat=x3dom.fields.SFMatrix4f.identity(),e._movement=new x3dom.fields.SFVec3f(0,0,0),T=0,b=Math.asin(l._02),y=Math.cos(b),1e-4<Math.abs(y)&&(T=Math.atan2(-l._12/y,l._22/y)),e._flyMat=l.inverse(),e._from=e._flyMat.e3(),e._at=e._from.subtract(e._flyMat.e2()),"helicopter"===n&&(e._at.y=e._from.y),e._up=e._flyMat.e1(),e._pitch=180*T/Math.PI,e._yaw=180*b/Math.PI,e._eyePos=e._from.negate());var m,p,x,g,v,y=null,l=null,T=null;if("game"===n)return e._pitch+=e._dy,e._yaw+=e._dx,89<=e._pitch&&(e._pitch=89),e._pitch<=-89&&(e._pitch=-89),360<=e._yaw&&(e._yaw-=360),e._yaw<0&&(e._yaw=360+e._yaw),e._dx=0,e._dy=0,b=x3dom.fields.SFMatrix4f.rotationX(e._pitch/180*Math.PI),v=x3dom.fields.SFMatrix4f.rotationY(e._yaw/180*Math.PI),g=x3dom.fields.SFMatrix4f.translation(e._eyePos),e._flyMat=b.mult(v).mult(g),v=(b=e._flyMat.inverse()).e3(),l=new x3dom.fields.SFVec3f(0,-1,0),y=v.add(l),l=b.e0().cross(l).normalize(),T=(T=x3dom.fields.SFMatrix4f.lookAt(v,y,l)).inverse(),e._scene._nameSpace.doc.ctx.pickValue(e,e._width/2,e._height/2,e._lastButton,T,e.getProjectionMatrix().mult(T)),e._pickingInfo.pickObj&&(h=e._pickingInfo.pickPos.subtract(v).length(),v.y+=d-h,b.setTranslate(v),e._eyePos=b.e3().negate(),e._flyMat=b.inverse(),e._pickingInfo.pickObj=null),e._scene.getViewpoint().setView(e._flyMat),a;if("helicopter"===n)return g=s.getTypeParams(),2&e._lastButton&&(g[1]+=200*_,s.setTypeParams(g)),c=1&e._lastButton?300*_:0,u=g[0],e._from.y=g[1],e._at.y=e._from.y,S=x3dom.fields.Quaternion.axisAngle(e._up,f).toMatrix(),F=(F=x3dom.fields.SFMatrix4f.translation(e._from)).mult(S),S=x3dom.fields.SFMatrix4f.translation(e._from.negate()),F=F.mult(S),e._at=F.multMatrixPnt(e._at),x=(p=(m=e._at.subtract(e._from).normalize()).cross(e._up).normalize()).cross(m).normalize(),m=m.multiply(c),e._from=e._from.add(m),e._at=e._at.add(m),S=x3dom.fields.Quaternion.axisAngle(p,u).toMatrix(),F=(F=x3dom.fields.SFMatrix4f.translation(e._from)).mult(S),S=x3dom.fields.SFMatrix4f.translation(e._from.negate()),v=(F=F.mult(S)).multMatrixPnt(e._at),e._flyMat=x3dom.fields.SFMatrix4f.lookAt(e._from,v,x),e._scene.getViewpoint().setView(e._flyMat.inverse()),a;var b,S=x3dom.fields.Quaternion.axisAngle(e._up,f).toMatrix(),F=(F=x3dom.fields.SFMatrix4f.translation(e._from)).mult(S);S=x3dom.fields.SFMatrix4f.translation(e._from.negate()),F=F.mult(S),e._at=F.multMatrixPnt(e._at),x=(p=(m=e._at.subtract(e._from).normalize()).cross(e._up).normalize()).cross(m).normalize(),S=x3dom.fields.Quaternion.axisAngle(p,u).toMatrix(),F=(F=x3dom.fields.SFMatrix4f.translation(e._from)).mult(S),S=x3dom.fields.SFMatrix4f.translation(e._from.negate()),F=F.mult(S),e._at=F.multMatrixPnt(e._at),"looka"!==n.substr(0,5)&&(b=e.getProjectionMatrix(),"freefly"!==n&&(c<0?((T=new x3dom.fields.SFMatrix4f).setValue(e._last_mat_view.e0(),e._last_mat_view.e1(),e._last_mat_view.e2().negate(),e._last_mat_view.e3()),e._scene._nameSpace.doc.ctx.pickValue(e,e._width/2,e._height/2,e._lastButton,T,b.mult(T))):e._scene._nameSpace.doc.ctx.pickValue(e,e._width/2,e._height/2,e._lastButton),e._pickingInfo.pickObj)&&(h=e._pickingInfo.pickPos.subtract(e._from).length())<=t+c&&(c=0),m=e._at.subtract(e._from).normalize().multiply(c),e._at=e._at.add(m),e._from=e._from.add(m),"walk"===n&&(x.x=0,x.y=1,x.z=0,y=e._from.addScaled(x,-1),l=p.cross(x.negate()).normalize(),T=(T=x3dom.fields.SFMatrix4f.lookAt(e._from,y,l)).inverse(),e._scene._nameSpace.doc.ctx.pickValue(e,e._width/2,e._height/2,e._lastButton,T,b.mult(T)),e._pickingInfo.pickObj)&&(h=(d-(h=e._pickingInfo.pickPos.subtract(e._from).length()))/s._vf.walkDamping,e._at=e._at.add(x.multiply(h)),e._from=e._from.add(x.multiply(h))),e._pickingInfo.pickObj=null),e._flyMat=x3dom.fields.SFMatrix4f.lookAt(e._from,e._at,x),e._scene.getViewpoint().setView(e._flyMat.inverse()),null!==r&&(e._pickingInfo=r)}return a},x3dom.DefaultNavigation.prototype.animateTo=function(e,t,i,o){var s,n=this.navi;e._mixer._isVPtarget=x3dom.isa(t,x3dom.nodeTypes.X3DViewpointNode),e._mixer._isVPtarget&&(t=t.getViewMatrix().mult(t.getCurrentTransform().inverse())),"teleport"!==n._vf.transitionType[0].toLowerCase()&&0!=o&&"game"!==n.getType()&&i&&x3dom.isa(i,x3dom.nodeTypes.X3DViewpointNode)?(s=i.getViewMatrix().mult(i.getCurrentTransform().inverse()).mult(e._transMat).mult(e._rotMat),e._mixer.isActive()&&(i.setView(e._mixer.getEndMatrix()),e._mixer.reset()),e._mixer.beginTime=e._lastTS,e._mixer.endTime=4<=arguments.length&&null!=o?e._lastTS+o:e._lastTS+n._vf.transitionTime,e._mixer.setBeginMatrix(s),e._mixer.setEndMatrix(t),e._scene.getViewpoint().setView(s)):e._scene.getViewpoint().setView(t),e._rotMat=x3dom.fields.SFMatrix4f.identity(),e._transMat=x3dom.fields.SFMatrix4f.identity(),e._movement=new x3dom.fields.SFVec3f(0,0,0),e._needNavigationMatrixUpdate=!0},x3dom.DefaultNavigation.prototype.orthoAnimateTo=function(e,t,i,o){var s=this.navi;o=o||s._vf.transitionTime,e._interpolator.beginValue=i,e._interpolator.endValue=t,e._interpolator.beginTime=e._lastTS,e._interpolator.endTime=e._lastTS+o},x3dom.DefaultNavigation.prototype.resetView=function(e){var t,i=this.navi;"teleport"!==i._vf.transitionType[0].toLowerCase()&&"game"!==i.getType()?(t=e._scene.getViewpoint(),e._mixer.beginTime=e._lastTS,e._mixer.endTime=e._lastTS+i._vf.transitionTime,e._mixer.setBeginMatrix(e.getViewMatrix()),x3dom.isa(t,x3dom.nodeTypes.OrthoViewpoint)&&this.orthoAnimateTo(e,Math.abs(t._vf.fieldOfView[0]),Math.abs(t._fieldOfView[0])),(t=e._scene.getViewpoint()).resetView(),t=t.getViewMatrix().mult(t.getCurrentTransform().inverse()),e._mixer.setEndMatrix(t)):e._scene.getViewpoint().resetView(),e.resetNavHelpers(),i._heliUpdated=!1},x3dom.DefaultNavigation.prototype.onDrag=function(e,t,i,o){var s,n,r,a,d,l=this.navi,h=l.getType(),u=l.getExplorationMode();"none"!==h&&0!=u&&(s=e._scene.getViewpoint(),n=t-e._lastX,r=i-e._lastY,e._dx=n,e._dy=r,e._lastX=t,e._lastY=i,"examine"===h)&&(t=null,1&(o&=u)&&(i=2*r*Math.PI/e._width,h=2*n*Math.PI/e._height,t=e.getViewMatrix(),u=x3dom.fields.SFMatrix4f.rotationX(i),i=x3dom.fields.SFMatrix4f.rotationY(h),h=s.getCenterOfRotation(),t.setTranslate(new x3dom.fields.SFVec3f(0,0,0)),e._rotMat=e._rotMat.mult(x3dom.fields.SFMatrix4f.translation(h)).mult(t.inverse()).mult(u).mult(i).mult(t).mult(x3dom.fields.SFMatrix4f.translation(h.negate()))),4&o&&(d=e._scene._lastMax.subtract(e._scene._lastMin).length(),d=((d=Math.min(d,s.getFar()))<x3dom.fields.Eps?1:d)*l._vf.speed,a=new x3dom.fields.SFVec3f(d*n/e._width,d*-r/e._height,0),e._movement=e._movement.add(a),t=e.getViewpointMatrix().mult(e._transMat),e._transMat=t.inverse().mult(x3dom.fields.SFMatrix4f.translation(e._movement)).mult(t)),2&o&&(d=e._scene._lastMax.subtract(e._scene._lastMin).length(),d=((d=Math.min(d,s.getFar()))<x3dom.fields.Eps?1:d)*l._vf.speed,a=new x3dom.fields.SFVec3f(0,0,d*(n+r)/e._height),x3dom.isa(s,x3dom.nodeTypes.OrthoViewpoint)&&s.setZoom(Math.abs(s._fieldOfView[0])-a.z),6<=l._vf.typeParams.length&&(u=-l._vf.typeParams[5],i=l._vf.typeParams[4],e._movement.z=Math.min(Math.max(e._movement.z,u),i)),e._movement=e._movement.add(a),t=e.getViewpointMatrix().mult(e._transMat),e._transMat=t.inverse().mult(x3dom.fields.SFMatrix4f.translation(e._movement)).mult(t)),e._isMoving=!0)},x3dom.DefaultNavigation.prototype.onTouchStart=function(e,t,i){},x3dom.DefaultNavigation.prototype.onTouchDrag=function(e,t,i,o,s){var n,r,a,d;e._currentInputType==x3dom.InputTypes.NAVIGATION&&(a=this.navi,n=e._scene.getViewpoint(),r=a.getExplorationMode(),"examine"===a.getType())&&0!==r&&(o&&4&r&&(d=e._scene._lastMax.subtract(e._scene._lastMin).length(),d=((d=Math.min(d,n.getFar()))<x3dom.fields.Eps?1:d)*a._vf.speed,o=o.multiply(d),x3dom.isa(n,x3dom.nodeTypes.OrthoViewpoint)&&(n.setZoom(Math.abs(n._fieldOfView[0])-o.z),o.z=0),e._movement=e._movement.add(o),e._transMat=n.getViewMatrix().inverse().mult(x3dom.fields.SFMatrix4f.translation(e._movement)).mult(n.getViewMatrix())),s&&1&r&&(a=n.getCenterOfRotation(),(d=e.getViewMatrix()).setTranslate(new x3dom.fields.SFVec3f(0,0,0)),e._rotMat=e._rotMat.mult(x3dom.fields.SFMatrix4f.translation(a)).mult(d.inverse()).mult(s).mult(d).mult(x3dom.fields.SFMatrix4f.translation(a.negate()))),e._isMoving=!0)},x3dom.DefaultNavigation.prototype.onTouchEnd=function(e,t){},x3dom.DefaultNavigation.prototype.onDoubleClick=function(e,t,i){var o,s,n,r,a,d,l;e._doc._x3dElem.hasAttribute("disableDoubleClick")&&"true"===e._doc._x3dElem.getAttribute("disableDoubleClick")||"none"==e._scene.getNavigationInfo().getType()||"color"!=(o=e._scene._vf.pickMode.toLowerCase())&&"texcoord"!=o&&((o=e._scene.getViewpoint()).setCenterOfRotation(e._pick),x3dom.debug.logInfo("New center of Rotation:  "+e._pick),d=(l=e.getViewMatrix().inverse()).e3(),s=e._pick,n=l.e1(),a=(r=l.e0().cross(n).normalize()).dot(e._pick.subtract(d)),d=s.addScaled(r,-a),l=x3dom.fields.SFMatrix4f.lookAt(d,s,n),x3dom.debug.logInfo("New camera position:  "+d),e.animateTo(l.inverse(),o))},x3dom.TurntableNavigation=function(e){x3dom.DefaultNavigation.call(this,e),this.panAxisX=null,this.panAxisY=null,this.panEnabled=!0},x3dom.TurntableNavigation.prototype=Object.create(x3dom.DefaultNavigation.prototype),x3dom.TurntableNavigation.prototype.constructor=x3dom.TurntableNavigation,x3dom.TurntableNavigation.prototype.onDrag=function(e,t,i,o){var s,n,r=this.navi,a=(e._flyMat||this.initTurnTable(e,!1),r.getType()),d=r.getExplorationMode();"none"!==a&&0!=d&&(a=t-e._lastX,s=i-e._lastY,n=null,1&(o&=d)?(d=2*s*Math.PI/e._height,this.rotate(e,d,2*a*Math.PI/e._width)):2&o?(d=(n=((n=e._scene._lastMax.subtract(e._scene._lastMin).length())<x3dom.fields.Eps?1:n)*r._vf.speed)*(a+s)/e._height,this.zoom(e,d)):4&o&&1==this.panEnabled&&(d=-(n=((n=e._scene._lastMax.subtract(e._scene._lastMin).length())<x3dom.fields.Eps?1:n)*r._vf.speed*.75)*a/e._width,this.pan(e,d,n*s/e._height)),e._isMoving=!0,e._dx=a,e._dy=s,e._lastX=t,e._lastY=i)},x3dom.TurntableNavigation.prototype.pan=function(e,t,i){var o,s,n,r,a=e._scene.getViewpoint();null!=this.target?(s=this.target._x3domNode.getVolume(),e._up=e._flyMat.e1(),e._from=e._flyMat.e3(),r=o=(o=e._at).addScaled(this.panAxisY,i),o.y>s.max.y||o.y<s.min.y?r=e._at:e._from=e._from.addScaled(this.panAxisY,i),(o=r.addScaled(this.panAxisX,t)).x>s.max.x||o.x<s.min.x?o=r:e._from=e._from.addScaled(this.panAxisX,t)):null!=this.panAxisX&&null!=this.panAxisY?(e._up=e._flyMat.e1(),e._from=e._flyMat.e3(),r=o=(o=e._at).addScaled(this.panAxisY,i),e._from=e._from.addScaled(this.panAxisY,i),o=r.addScaled(this.panAxisX,t),e._from=e._from.addScaled(this.panAxisX,t)):(e._up=e._flyMat.e1(),e._from=e._flyMat.e3(),s=e._up.cross(e._from).normalize(),n=e._from.cross(s).normalize(),r=o=(o=e._at).addScaled(n,i),e._from=e._from.addScaled(n,i),o=r.addScaled(s,t),e._from=e._from.addScaled(s,t)),e._at=o,e._flyMat=x3dom.fields.SFMatrix4f.lookAt(e._from,o,e._up),a.setViewAbsolute(e._flyMat.inverse())},x3dom.TurntableNavigation.prototype.rotate=function(e,t,i){var o=e._scene.getViewpoint();e._flyMat=this.calcOrbit(e,t,i),o.setView(e._flyMat.inverse())},x3dom.TurntableNavigation.prototype.zoom=function(e,t){var i=this.navi,o=e._scene.getViewpoint(),s=(e._up=e._flyMat.e1(),e._from=e._flyMat.e3(),e._at),n=(r=s.subtract(e._from)).length(),r=r.normalize(),a=t;i._vf.typeParams[6]&&(a=Math.min(t,n-i._vf.typeParams[6])),i._vf.typeParams[7]&&(a=Math.max(a,n-i._vf.typeParams[7])),e._from=e._from.addScaled(r,a),e._flyMat=x3dom.fields.SFMatrix4f.lookAt(e._from,s,e._up),o.setViewAbsolute(e._flyMat.inverse())},x3dom.TurntableNavigation.prototype.calcOrbit=function(e,t,i,o){var s=this.navi;e._up=e._flyMat.e1(),e._from=e._flyMat.e3();var n,r,a=e._from.subtract(e._at),o=(1==o?(n=i,r=t):(n=Math.atan2(a.x,a.z),r=Math.atan2(Math.sqrt(a.x*a.x+a.z*a.z),a.y),n-=i,r-=t),r=Math.max(s._vf.typeParams[2],Math.min(s._vf.typeParams[3],r)),s._vf.typeParams[4]<=s._vf.typeParams[5]?n=Math.max(s._vf.typeParams[4],Math.min(s._vf.typeParams[5],n)):0<i&&n<s._vf.typeParams[4]&&n>s._vf.typeParams[5]?n=s._vf.typeParams[4]:i<0&&n>s._vf.typeParams[5]&&n<s._vf.typeParams[4]&&(n=s._vf.typeParams[5]),a.length()),t=o*Math.sin(r),i=(a.x=t*Math.sin(n),a.y=o*Math.cos(r),a.z=t*Math.cos(n),a=e._at.add(a),r-=Math.PI/2,Math.sin(r)),s=Math.cos(r),o=new x3dom.fields.SFVec3f(i*Math.sin(n),s,i*Math.cos(n));return o.y<0&&(o=o.negate()),x3dom.fields.SFMatrix4f.lookAt(a,e._at,o)},x3dom.TurntableNavigation.prototype.initTurnTable=function(e,t){var i=this.navi,o=(t=null==t||t,e.getViewMatrix()),s=(e._rotMat=x3dom.fields.SFMatrix4f.identity(),e._transMat=x3dom.fields.SFMatrix4f.identity(),e._scene.getViewpoint()),n=x3dom.fields.SFVec3f.copy(s.getCenterOfRotation()),s=(e._flyMat=o.inverse(),e._from=s._vf.position,e._at=n,e._up=new x3dom.fields.SFVec3f(0,1,0),e._flyMat=x3dom.fields.SFMatrix4f.lookAt(e._from,e._at,e._up),o.inverse().e3().subtract(e._at)),n=Math.atan2(s.x,s.z),s=Math.atan2(Math.sqrt(s.x*s.x+s.z*s.z),s.y);e._flyMat=this.calcOrbit(e,s,n,!0);t&&(s=.2/i._vf.speed,this.animateTo(e,e._flyMat.inverse(),o,s)),e.resetNavHelpers()},x3dom.TurntableNavigation.prototype.onMousePress=function(e,t,i,o){e._flyMat||this.initTurnTable(e,!1)},x3dom.TurntableNavigation.prototype.init=function(e,t){this.initTurnTable(e,!0)},x3dom.TurntableNavigation.prototype.resetView=function(e){e._mixer.beginTime=e._lastTS,e._mixer.endTime=e._lastTS+this.navi._vf.transitionTime,e._mixer.setBeginMatrix(e.getViewMatrix());var t=e._scene.getViewpoint();t.resetView(),t=x3dom.fields.SFMatrix4f.lookAt(t._vf.position,t.getCenterOfRotation(),new x3dom.fields.SFVec3f(0,1,0)),e._mixer.setEndMatrix(t.inverse()),this.updateFlyMat(e)},x3dom.TurntableNavigation.prototype.updateFlyMat=function(e,t,i){e._flyMat||this.initTurnTable(e,!1);var o=e.getViewMatrix(),s=(null!=t&&x3dom.isa(t,x3dom.nodeTypes.X3DViewpointNode)||(t=e._scene.getViewpoint()),x3dom.fields.SFVec3f.copy(t.getCenterOfRotation())),i=(e._flyMat=o.inverse(),e._from=i?i.inverse().e3():t._vf.position,e._at=s,e._up=new x3dom.fields.SFVec3f(0,1,0),e._flyMat=x3dom.fields.SFMatrix4f.lookAt(e._from,e._at,e._up),o.inverse().e3().subtract(e._at)),t=Math.atan2(i.x,i.z),s=Math.atan2(Math.sqrt(i.x*i.x+i.z*i.z),i.y);e._flyMat=this.calcOrbit(e,s,t,!0)},x3dom.TurntableNavigation.prototype.animateTo=function(e,t,i,o){var s=this.navi,n=x3dom.isa(t,x3dom.nodeTypes.X3DViewpointNode)?x3dom.fields.SFMatrix4f.lookAt(t._vf.position,t.getCenterOfRotation(),new x3dom.fields.SFVec3f(0,1,0)):t;"teleport"!==s._vf.transitionType[0].toLowerCase()&&0!=o&&"game"!==s.getType()?i&&x3dom.isa(i,x3dom.nodeTypes.X3DViewpointNode)?(i=i.getViewMatrix().mult(i.getCurrentTransform().inverse()).mult(e._transMat).mult(e._rotMat),e._mixer.beginTime=e._lastTS,e._mixer.endTime=4<=arguments.length&&null!=o?e._lastTS+o:e._lastTS+s._vf.transitionTime,e._mixer.setBeginMatrix(i),e._mixer.setEndMatrix(n),e._scene.getViewpoint().setViewAbsolute(i)):i?(e._mixer.beginTime=e._lastTS,e._mixer.endTime=4<=arguments.length&&null!=o?e._lastTS+o:e._lastTS+s._vf.transitionTime,e._mixer.setBeginMatrix(i),e._mixer.setEndMatrix(n),e._scene.getViewpoint().setViewAbsolute(i)):e._scene.getViewpoint().setViewAbsolute(n):e._scene.getViewpoint().setViewAbsolute(t),e._rotMat=x3dom.fields.SFMatrix4f.identity(),e._transMat=x3dom.fields.SFMatrix4f.identity(),e._movement=new x3dom.fields.SFVec3f(0,0,0),e._needNavigationMatrixUpdate=!0,this.updateFlyMat(e,t,n)},x3dom.TurntableNavigation.prototype.onTouchStart=function(e,t,i){e._numTouches=t.touches.length,e._lastX=t.touches[0].screenX,e._lastY=t.touches[0].screenY},x3dom.TurntableNavigation.prototype.onTouchDrag=function(e,t,i,o,s){var n,r;e._currentInputType==x3dom.InputTypes.NAVIGATION&&(1==t.touches.length?(n=t.touches[0].screenX-e._lastX,r=2*(t.touches[0].screenY-e._lastY)*Math.PI/e._height,this.rotate(e,r,2*n*Math.PI/e._width),e._lastX=t.touches[0].screenX,e._lastY=t.touches[0].screenY):2<=t.touches.length&&(1==this.panEnabled&&this.pan(e,4*-o.x,4*-o.y),this.zoom(e,4*o.z)))},x3dom.TurntableNavigation.prototype.onTouchEnd=function(e,t,i){2==e._numTouches&&1==t.touches.length&&(e._lastX=t.touches[0].screenX,e._lastY=t.touches[0].screenY),e._numTouches=t.touches.length},x3dom.TurntableNavigation.prototype.setPanTarget=function(e){this.target=e},x3dom.TurntableNavigation.prototype.setPanAxis=function(e,t){this.panAxisX=e,this.panAxisY=t},x3dom.TurntableNavigation.prototype.setPanEnabled=function(e){this.panEnabled=e},x3dom.TurntableNavigation.prototype.onDoubleClick=function(e,t,i){var o,s;e._doc._x3dElem.hasAttribute("disableDoubleClick")&&"true"===e._doc._x3dElem.getAttribute("disableDoubleClick")||"none"==e._scene.getNavigationInfo().getType()||"color"!=(s=e._scene._vf.pickMode.toLowerCase())&&"texcoord"!=s&&(e._scene.getViewpoint().setCenterOfRotation(e._pick),x3dom.debug.logInfo("New center of Rotation:  "+e._pick),s=e.getViewMatrix().inverse(),e._from=s.e3(),e._up=s.e1(),e._at=e._pick,e._flyMat=x3dom.fields.SFMatrix4f.lookAt(e._from,e._at,e._up),s=e._from.subtract(e._at),o=Math.atan2(s.x,s.z),s=Math.atan2(Math.sqrt(s.x*s.x+s.z*s.z),s.y),e._flyMat=this.calcOrbit(e,s,o,!0),x3dom.debug.logInfo("New camera position:  "+e._from),this.animateTo(e,e._flyMat.inverse(),e.getViewMatrix()))},x3dom.WalkNavigation=function(e){x3dom.DefaultNavigation.call(this,e)},x3dom.WalkNavigation.prototype=Object.create(x3dom.DefaultNavigation.prototype),x3dom.WalkNavigation.prototype.constructor=x3dom.WalkNavigation,x3dom.WalkNavigation.prototype.onDrag=function(e,t,i,o){var s,n=this.navi,r=n.getType();0!==n.getExplorationMode()&&(e._scene.getViewpoint(),n=t-e._lastX,s=i-e._lastY,e._dx=n,e._dy=s,e._lastX=t,e._lastY=i,"walk"!==r)&&console.log("#### CHECK: in WalkNavigation but nav. type is not walk !")},x3dom.registerNodeType("X3DFontStyleNode","Text",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.X3DFontStyleNode.superClass.call(this,e)})),x3dom.registerNodeType("FontStyle","Text",defineClass(x3dom.nodeTypes.X3DFontStyleNode,function(e){x3dom.nodeTypes.FontStyle.superClass.call(this,e),this.addField_MFString(e,"family",["SERIF"]),this.addField_SFBool(e,"horizontal",!0),this.addField_MFString(e,"justify",["BEGIN","FIRST"]),this.addField_SFString(e,"language",""),this.addField_SFBool(e,"leftToRight",!0),this.addField_SFFloat(e,"size",1),this.addField_SFFloat(e,"spacing",1),this.addField_SFString(e,"style","PLAIN"),this.addField_SFBool(e,"topToBottom",!0),this.addField_SFFloat(e,"quality",2)},{fieldChanged:function(e){"family"!=e&&"horizontal"!=e&&"justify"!=e&&"language"!=e&&"leftToRight"!=e&&"size"!=e&&"spacing"!=e&&"style"!=e&&"topToBottom"!=e||this._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){e.setAllDirty()})})}})),x3dom.nodeTypes.FontStyle.defaultNode=function(){return x3dom.nodeTypes.FontStyle._defaultNode||(x3dom.nodeTypes.FontStyle._defaultNode=new x3dom.nodeTypes.FontStyle,x3dom.nodeTypes.FontStyle._defaultNode.nodeChanged()),x3dom.nodeTypes.FontStyle._defaultNode},x3dom.registerNodeType("Text","Text",defineClass(x3dom.nodeTypes.X3DGeometryNode,function(e){x3dom.nodeTypes.Text.superClass.call(this,e),this.addField_MFString(e,"string",[]),this.addField_MFFloat(e,"length",[]),this.addField_SFFloat(e,"maxExtent",0),this.addField_SFNode("fontStyle",x3dom.nodeTypes.X3DFontStyleNode),this._mesh._positions[0]=[0,0,0,1,0,0,1,1,0,0,1,0],this._mesh._normals[0]=[0,0,1,0,0,1,0,0,1,0,0,1],this._mesh._texCoords[0]=[0,0,1,0,1,1,0,1],this._mesh._colors[0]=[],this._mesh._indices[0]=[0,1,2,2,3,0],this._mesh._invalidate=!0,this._mesh._numFaces=2,this._mesh._numCoords=4},{nodeChanged:function(){this._cf.fontStyle.node||this.addChild(x3dom.nodeTypes.FontStyle.defaultNode()),this.invalidateVolume()},fieldChanged:function(e){"string"!=e&&"length"!=e&&"maxExtent"!=e||(this.invalidateVolume(),this._parentNodes.forEach(function(e){e.setAllDirty()}))},validateGLObject:function(){this._parentNodes.forEach(function(e){e._dirty.texture=!1}),this._nameSpace.doc.needRender=!0}})),x3dom.registerNodeType("X3DSoundNode","Sound",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DSoundNode.superClass.call(this,e)})),x3dom.registerNodeType("Sound","Sound",defineClass(x3dom.nodeTypes.X3DSoundNode,function(e){x3dom.nodeTypes.Sound.superClass.call(this,e),this.addField_SFNode("source",x3dom.nodeTypes.X3DSoundSourceNode)},{nodeChanged:function(){if(!this._cf.source.node&&this._xmlNode){x3dom.debug.logInfo("No AudioClip child node given, searching for &lt;audio&gt; elements...");try{this._xmlNode.childNodes.forEach(function(e){var t,i;1===e.nodeType&&(x3dom.debug.logInfo("### Found &lt;"+e.nodeName+"&gt; tag."),"audio"===e.localName.toLowerCase())&&(t=!!(t=e.getAttribute("loop"))&&"loop"===t.toLowerCase(),i=e.cloneNode(!1),e.parentNode.removeChild(e),e=null,"Microsoft Internet Explorer"!=navigator.appName&&document.body.appendChild(i),i.addEventListener("canplaythrough",function(){i.play()},!0),i.addEventListener("ended",function(){t&&i.play()},!0))})}catch(e){x3dom.debug.logException(e)}}}})),x3dom.registerNodeType("X3DSoundSourceNode","Sound",defineClass(x3dom.nodeTypes.X3DTimeDependentNode,function(e){x3dom.nodeTypes.X3DSoundSourceNode.superClass.call(this,e)})),x3dom.registerNodeType("AudioClip","Sound",defineClass(x3dom.nodeTypes.X3DSoundSourceNode,function(e){x3dom.nodeTypes.AudioClip.superClass.call(this,e),this.addField_MFString(e,"url",[]),this.addField_SFBool(e,"enabled",!1),this.addField_SFBool(e,"loop",!1),this._audio=document.createElement("audio"),"Microsoft Internet Explorer"!=navigator.appName&&document.body.appendChild(this._audio),this._sources=[]},{nodeChanged:function(){this._createSources=function(){this._sources=[];for(var e=0;e<this._vf.url.length;e++){var t=this._nameSpace.getURL(this._vf.url[e]),i=(x3dom.debug.logInfo("Adding sound file: "+t),document.createElement("source"));i.setAttribute("src",t),this._sources.push(i),this._audio.appendChild(i)}};var t=this,i=0;this._startAudio=function(){!0===t._vf.enabled&&t._audio.play().then(function(e){clearTimeout(i)}).catch(function(e){x3dom.debug.logError(e),i=setTimeout(t._startAudio,100)})},this._stopAudio=function(){t._audio.pause()},this._audioEnded=function(){!0===t._vf.enabled&&!0===t._vf.loop&&t._startAudio()},this._audio.addEventListener("canplaythrough",this._startAudio,!0),this._audio.addEventListener("ended",this._audioEnded,!0),this._audio.addEventListener("error",function(e){x3dom.debug.logWarning("MediaEvent error:"+e)},!0),this._audio.addEventListener("pause",this._audioEnded,!0),this._createSources()},fieldChanged:function(e){if("enabled"===e)!0===this._vf.enabled?this._startAudio():this._stopAudio();else if("loop"!==e&&"url"===e){for(this._stopAudio();this._audio.hasChildNodes();)this._audio.removeChild(this._audio.firstChild);for(var t=0;t<this._vf.url.length;t++){var i=this._nameSpace.getURL(this._vf.url[t]),o=(x3dom.debug.logInfo("Adding sound file: "+i),document.createElement("source"));o.setAttribute("src",i),this._audio.appendChild(o)}this._audio.load()}},shutdown:function(){if(this._audio){for(this._audio.pause();this._audio.hasChildNodes();)this._audio.removeChild(this._audio.firstChild);document.body.removeChild(this._audio),this._audio=null}}})),x3dom.registerNodeType("X3DTextureTransformNode","Texturing",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.X3DTextureTransformNode.superClass.call(this,e)},{texTransformMatrix:function(){return this._trafo}})),x3dom.registerNodeType("TextureTransform","Texturing",defineClass(x3dom.nodeTypes.X3DTextureTransformNode,function(e){x3dom.nodeTypes.TextureTransform.superClass.call(this,e),this.addField_SFVec2f(e,"center",0,0),this.addField_SFFloat(e,"rotation",0),this.addField_SFVec2f(e,"scale",1,1),this.addField_SFVec2f(e,"translation",0,0),this._calcTrafo()},{fieldChanged:function(e){"center"!=e&&"rotation"!=e&&"scale"!=e&&"translation"!=e||this._calcTrafo()},_calcTrafo:function(){var e=new x3dom.fields.SFVec3f(-this._vf.center.x,-this._vf.center.y,0),t=new x3dom.fields.SFVec3f(this._vf.center.x,this._vf.center.y,0),i=new x3dom.fields.SFVec3f(this._vf.translation.x,this._vf.translation.y,0),o=new x3dom.fields.SFVec3f(this._vf.scale.x,this._vf.scale.y,0);this._trafo=x3dom.fields.SFMatrix4f.translation(e).mult(x3dom.fields.SFMatrix4f.scale(o)).mult(x3dom.fields.SFMatrix4f.rotationZ(this._vf.rotation)).mult(x3dom.fields.SFMatrix4f.translation(t.add(i)))}})),x3dom.registerNodeType("MatrixTextureTransform","Texturing",defineClass(x3dom.nodeTypes.X3DTextureTransformNode,function(e){x3dom.nodeTypes.MatrixTextureTransform.superClass.call(this,e),this.addField_SFMatrix4f(e,"matrix",1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this._trafo=this._vf.matrix.transpose()},{fieldChanged:function(e){"matrix"==e&&(this._trafo=this._vf.matrix.transpose())}})),x3dom.registerNodeType("TextureProperties","Texturing",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.TextureProperties.superClass.call(this,e),this.addField_SFFloat(e,"anisotropicDegree",1),this.addField_SFColorRGBA(e,"borderColor",0,0,0,0),this.addField_SFInt32(e,"borderWidth",0),this.addField_SFString(e,"boundaryModeS","REPEAT"),this.addField_SFString(e,"boundaryModeT","REPEAT"),this.addField_SFString(e,"boundaryModeR","REPEAT"),this.addField_SFString(e,"magnificationFilter","FASTEST"),this.addField_SFString(e,"minificationFilter","FASTEST"),this.addField_SFString(e,"textureCompression","FASTEST"),this.addField_SFFloat(e,"texturePriority",0),this.addField_SFBool(e,"generateMipMaps",!1)},{fieldChanged:function(e){this._vf.hasOwnProperty(e)&&(this._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){e._dirty.texture=!0})})}),this._nameSpace.doc.needRender=!0)}})),x3dom.registerNodeType("X3DTextureNode","Texturing",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.X3DTextureNode.superClass.call(this,e),this.addField_SFInt32(e,"origChannelCount",0),this.addField_MFString(e,"url",[]),this.addField_SFBool(e,"repeatS",!0),this.addField_SFBool(e,"repeatT",!0),this.addField_SFBool(e,"scale",!0),this.addField_SFString(e,"crossOrigin",""),this.addField_SFNode("textureProperties",x3dom.nodeTypes.TextureProperties),this.addField_SFBool(e,"flipY",!1),this.addField_SFInt32(e,"channel",0),this._needPerFrameUpdate=!1,this._isCanvas=!1,this._type="diffuseMap",this._blending=1==this._vf.origChannelCount||2==this._vf.origChannelCount},{invalidateGLObject:function(){this._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)?e._dirty.texture=!0:e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)?e._dirty.texture=!0:e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)&&(e._dirty.texture=!0)})})})}),this._nameSpace.doc.needRender=!0},validateGLObject:function(){this._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)?e._dirty.texture=!1:e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)?e._dirty.texture=!1:e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)&&(e._dirty.texture=!1)})})})}),this._nameSpace.doc.needRender=!0},parentAdded:function(e){e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.Shape)?e._dirty.texture=!0:e._parentNodes.forEach(function(e){e._dirty.texture=!0})})},parentRemoved:function(e){e._parentNodes.forEach(function(e){x3dom.isa(e,x3dom.nodeTypes.X3DShapeNode)?e._dirty.texture=!0:e._parentNodes.forEach(function(e){e._dirty.texture=!0})})},fieldChanged:function(e){var i;"url"!=e&&"origChannelCount"!=e&&"repeatS"!=e&&"repeatT"!=e&&"scale"!=e&&"crossOrigin"!=e&&"image"!=e||((i=this)._blending=1==i._vf.origChannelCount||2==i._vf.origChannelCount,this._parentNodes.forEach(function(e){if(x3dom.isa(e,x3dom.nodeTypes.X3DAppearanceNode))e.nodeChanged();else if(x3dom.isa(e,x3dom.nodeTypes.MultiTexture))e._parentNodes.forEach(function(e){e.nodeChanged()});else if(x3dom.isa(e,x3dom.nodeTypes.ComposedCubeMapTexture))e._parentNodes.forEach(function(e){e.nodeChanged()});else if(x3dom.isa(e,x3dom.nodeTypes.PhysicalMaterial))e._parentNodes.forEach(function(e){e.nodeChanged()});else if(void 0!==x3dom.nodeTypes.X3DVolumeDataNode)if(x3dom.isa(e,x3dom.nodeTypes.X3DVolumeRenderStyleNode)){if(i._xmlNode&&i._xmlNode.hasAttribute("containerField"))if(e._volumeDataParent)e._volumeDataParent._dirty.texture=!0;else{for(var t=e._parentNodes[0];!x3dom.isa(t,x3dom.nodeTypes.X3DVolumeDataNode)&&x3dom.isa(t,x3dom.nodeTypes.X3DNode);)t=t._parentNodes[0];x3dom.isa(t,x3dom.nodeTypes.X3DNode)&&(t._dirty.texture=!0)}}else x3dom.isa(e,x3dom.nodeTypes.X3DVolumeDataNode)&&i._xmlNode&&i._xmlNode.hasAttribute("containerField")&&(e._dirty.texture=!0)}))},getTexture:function(e){return 0===e?this:null},size:function(){return 1},setOrigChannelCount:function(t){this._parentNodes.forEach(function(e){"auto"!=e._origSortType||0!=this._vf.origChannelCount||2!=t&&4!=t||(e._vf.sortType="transparent")}.bind(this)),this._vf.origChannelCount=t,this.fieldChanged("origChannelCount")},getOrigChannelCount:function(){return this._vf.origChannelCount}})),x3dom.registerNodeType("MultiTexture","Texturing",defineClass(x3dom.nodeTypes.X3DTextureNode,function(e){x3dom.nodeTypes.MultiTexture.superClass.call(this,e),this.addField_MFNode("texture",x3dom.nodeTypes.X3DTextureNode)},{getTexture:function(e){return 0<=e&&e<this._cf.texture.nodes.length?this._cf.texture.nodes[e]:null},getTextures:function(){return this._cf.texture.nodes},size:function(){return this._cf.texture.nodes.length}})),x3dom.registerNodeType("Texture","Texturing",defineClass(x3dom.nodeTypes.X3DTextureNode,function(e){x3dom.nodeTypes.Texture.superClass.call(this,e),this.addField_SFBool(e,"hideChildren",!0),this._video=null,this._intervalID=null,this._canvas=null},{nodeChanged:function(){if(!(this._vf.url.length&&this._vf.url[0].length||!this._xmlNode)){x3dom.debug.logInfo("No Texture URL given, searching for &lt;img&gt; elements...");var i=this;try{this._xmlNode.childNodes.forEach(function(e){var t;1===e.nodeType&&((t=e.getAttribute("src"))?(i._vf.url.push(t),x3dom.debug.logInfo(i._vf.url[i._vf.url.length-1]),"video"===e.localName.toLowerCase()&&(i._needPerFrameUpdate=!0,i._video=document.createElement("video"),i._video.setAttribute("preload","auto"),i._video.setAttribute("muted","muted"),document.getElementsByTagName("body")[0].appendChild(i._video),i._video.style.display="none",i._video.style.visibility="hidden")):"canvas"===e.localName.toLowerCase()&&(i._needPerFrameUpdate=!0,i._isCanvas=!0,i._canvas=e),e.style&&i._vf.hideChildren&&(e.style.display="none",e.style.visibility="hidden"),x3dom.debug.logInfo("### Found &lt;"+e.nodeName+"&gt; tag."))})}catch(i){x3dom.debug.logException(i)}}},shutdown:function(){if(this._video){for(this._video.pauseVideo();this._video.hasChildNodes();)this._video.removeChild(this._video.firstChild);this._video.startVideo&&(this._video.startVideo=null),this._video.pauseVideo&&(this._video.pauseVideo=null),this._video=null}}})),x3dom.registerNodeType("RenderedTexture","Texturing",defineClass(x3dom.nodeTypes.X3DTextureNode,function(e){x3dom.nodeTypes.RenderedTexture.superClass.call(this,e),e?e.doc._nodeBag.renderTextures.push(this):x3dom.debug.logWarning("RenderedTexture: No runtime context found!"),this.addField_SFNode("viewpoint",x3dom.nodeTypes.X3DViewpointNode),this.addField_SFNode("background",x3dom.nodeTypes.X3DBackgroundNode),this.addField_SFNode("fog",x3dom.nodeTypes.X3DFogNode),this.addField_SFNode("scene",x3dom.nodeTypes.X3DNode),this.addField_MFNode("excludeNodes",x3dom.nodeTypes.X3DNode),this.addField_MFInt32(e,"dimensions",[128,128,4]),this.addField_SFString(e,"update","NONE"),this.addField_SFBool(e,"showNormals",!1),this.addField_SFString(e,"stereoMode","NONE"),this.addField_SFFloat(e,"interpupillaryDistance",.064),this.addField_SFFloat(e,"eyeToScreenDistance",.041),this.addField_SFFloat(e,"vScreenSize",.07074),this.addField_SFVec3f(e,"lensCenter",.15197,0,0),this.addField_SFBool(e,"depthMap",!1),this.addField_SFBool(e,"oculusRiftVersion",1),x3dom.debug.assert(3<=this._vf.dimensions.length,"RenderedTexture.dimensions requires at least 3 entries."),this._clearParents=!0,this._needRenderUpdate=!0,this.checkDepthTextureSupport=function(){this._vf.depthMap&&null===x3dom.caps.DEPTH_TEXTURE&&x3dom.debug.logWarning("RenderedTexture Node: depth texture extension not supported")},this.checkDepthTextureSupport()},{nodeChanged:function(){this._clearParents=!0,this._needRenderUpdate=!0},fieldChanged:function(e){switch(e){case"excludeNodes":this._clearParents=!0;break;case"update":"NEXT_FRAME_ONLY"!=this._vf.update.toUpperCase()&&"ALWAYS"!=this._vf.update.toUpperCase()||(this._needRenderUpdate=!0);break;case"depthMap":this.checkDepthTextureSupport(),this._x3domTexture.updateTexture(),this._needRenderUpdate=!0}},getViewMatrix:function(){this._clearParents&&this._cf.excludeNodes.nodes.length&&((o=this)._cf.excludeNodes.nodes.forEach(function(e){for(var t=0,i=e._parentNodes.length;t<i;t++)e._parentNodes[t]===o&&(e._parentNodes.splice(t,1),e.parentRemoved(o))}),this._clearParents=!1);var o,e=this._cf.scene.node,t=this._nameSpace.doc._scene,i=t.getViewpoint(),s=this._cf.viewpoint.node,n=null,e=(n=null===s||s===i?this._nameSpace.doc._viewarea.getViewMatrix():e&&e!==t?s.getViewMatrix():(i=s.getCurrentTransform(),s.getViewMatrix().mult(i.inverse())),this._vf.stereoMode.toUpperCase());return"NONE"!=e&&(t=this._vf.interpupillaryDistance/2,n=new x3dom.fields.SFMatrix4f(1,0,0,t="RIGHT_EYE"==e?-t:t,0,1,0,0,0,0,1,0,0,0,0,1).mult(n)),n},getProjectionMatrix:function(){var e,t=this._nameSpace.doc,i=t._scene.getViewpoint(),o=this._cf.viewpoint.node,s=null,n=this._vf.dimensions[0],r=this._vf.dimensions[1],a=this._vf.stereoMode.toUpperCase(),d="NONE"!=a;return null===o||o===i?(s=x3dom.fields.SFMatrix4f.copy(t._viewarea.getProjectionMatrix()),e=d?(e=2*Math.atan(this._vf.vScreenSize/(2*this._vf.eyeToScreenDistance)),1/Math.tan(e/2)):1/Math.tan(i._vf.fieldOfView/2),s._00=e/(n/r),s._11=e):s=o.getProjectionMatrix(n/r),d&&(t=this._vf.lensCenter.copy(),"RIGHT_EYE"==a&&(t.x=-t.x),s=new x3dom.fields.SFMatrix4f(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1).mult(s)),s},getWCtoCCMatrix:function(){var e=this.getViewMatrix();return this.getProjectionMatrix().mult(e)},parentRemoved:function(e){if(0===this._parentNodes.length){var t=this.findX3DDoc();if(t)for(var i=0,o=t._nodeBag.renderTextures.length;i<o;i++)t._nodeBag.renderTextures[i]===this&&t._nodeBag.renderTextures.splice(i,1)}this._cf.scene.node&&this._cf.scene.node.parentRemoved(this)},requirePingPong:function(){return!1}})),x3dom.registerNodeType("RefinementTexture","Texturing",defineClass(x3dom.nodeTypes.RenderedTexture,function(e){x3dom.nodeTypes.RefinementTexture.superClass.call(this,e),this.addField_SFString(e,"stamp0","gpuii/stamps/0.gif"),this.addField_SFString(e,"stamp1","gpuii/stamps/1.gif"),this.addField_SFBool(e,"autoRefinement",!0),this.addField_SFString(e,"format","jpg"),this.addField_SFInt32(e,"iterations",7),this.addField_SFInt32(e,"maxLevel",this._vf.iterations),this._vf.iterations%2==0&&(e=this._vf.stamp0,this._vf.stamp0=this._vf.stamp1,this._vf.stamp1=e),this._vf.iterations=11<this._vf.iterations?11:this._vf.iterations,this._vf.iterations=this._vf.iterations<3?3:this._vf.iterations,this._vf.maxLevel=11<this._vf.maxLevel?11:this._vf.maxLevel,this._vf.maxLevel=this._vf.maxLevel<3?3:this._vf.maxLevel,this._vf.maxLevel=this._vf.maxLevel>this._vf.iterations?this._vf.iterations:this._vf.maxLevel;e=[{x:4,y:8},{x:8,y:8},{x:8,y:16},{x:16,y:16},{x:16,y:32},{x:32,y:32},{x:32,y:64},{x:64,y:64},{x:64,y:128}];this._repeat=new x3dom.fields.SFVec2f(this._vf.dimensions[0]/e[this._vf.iterations-3].x,this._vf.dimensions[1]/e[this._vf.iterations-3].y),this._renderedImage=0,this._currLoadLevel=0,this._loadLevel=1},{nextLevel:function(){this._loadLevel<this._vf.maxLevel&&(this._loadLevel++,this._nameSpace.doc.needRender=!0)},requirePingPong:function(){return this._currLoadLevel<=this._vf.maxLevel&&this._renderedImage<this._loadLevel}})),x3dom.registerNodeType("PixelTexture","Texturing",defineClass(x3dom.nodeTypes.X3DTextureNode,function(e){x3dom.nodeTypes.PixelTexture.superClass.call(this,e),this.addField_SFImage(e,"image",0,0,0)},{getWidth:function(){return this._vf.image.width},getHeight:function(){return this._vf.image.height},getComponents:function(){return this._vf.image.comp},setPixel:function(e,t,i,o){o=null==o||o,this._x3domTexture?(this._x3domTexture.setPixel(e,t,[255*i.r,255*i.g,255*i.b,255*i.a],o),this._vf.image.setPixel(e,t,i)):(this._vf.image.setPixel(e,t,i),o&&this.invalidateGLObject())},getPixel:function(e,t){return this._vf.image.getPixel(e,t)},setPixels:function(e,t){t=null==t||t,this._vf.image.setPixels(e),t&&this.invalidateGLObject()},getPixels:function(){return this._vf.image.getPixels()}})),x3dom.registerNodeType("ImageTexture","Texturing",defineClass(x3dom.nodeTypes.Texture,function(e){x3dom.nodeTypes.ImageTexture.superClass.call(this,e)})),x3dom.registerNodeType("MovieTexture","Texturing",defineClass(x3dom.nodeTypes.Texture,function(e){x3dom.nodeTypes.MovieTexture.superClass.call(this,e),this.addField_SFBool(e,"loop",!1),this.addField_SFFloat(e,"speed",1),this.addField_SFTime(e,"pauseTime",0),this.addField_SFFloat(e,"pitch",1),this.addField_SFTime(e,"resumeTime",0),this.addField_SFTime(e,"startTime",0),this.addField_SFTime(e,"stopTime",0)})),x3dom.registerNodeType("X3DTextureCoordinateNode","Texturing",defineClass(x3dom.nodeTypes.X3DGeometricPropertyNode,function(e){x3dom.nodeTypes.X3DTextureCoordinateNode.superClass.call(this,e)},{fieldChanged:function(e){"texCoord"!==e&&"point"!==e&&"parameter"!==e&&"mode"!==e||this._parentNodes.forEach(function(e){e.fieldChanged("texCoord")})},parentAdded:function(e){e._mesh&&e._cf.texCoord.node!==this&&e.fieldChanged("texCoord")}})),x3dom.registerNodeType("TextureCoordinate","Texturing",defineClass(x3dom.nodeTypes.X3DTextureCoordinateNode,function(e){x3dom.nodeTypes.TextureCoordinate.superClass.call(this,e),this.addField_MFVec2f(e,"point",[])})),x3dom.registerNodeType("TextureCoordinateGenerator","Texturing",defineClass(x3dom.nodeTypes.X3DTextureCoordinateNode,function(e){x3dom.nodeTypes.TextureCoordinateGenerator.superClass.call(this,e),this.addField_SFString(e,"mode","SPHERE"),this.addField_MFFloat(e,"parameter",[])})),x3dom.registerNodeType("MultiTextureCoordinate","Texturing",defineClass(x3dom.nodeTypes.X3DTextureCoordinateNode,function(e){x3dom.nodeTypes.MultiTextureCoordinate.superClass.call(this,e),this.addField_MFNode("texCoord",x3dom.nodeTypes.X3DTextureCoordinateNode)})),x3dom.registerNodeType("ImageTextureAtlas","Texturing",defineClass(x3dom.nodeTypes.Texture,function(e){x3dom.nodeTypes.ImageTextureAtlas.superClass.call(this,e),this.addField_SFInt32(e,"numberOfSlices",0),this.addField_SFInt32(e,"slicesOverX",0),this.addField_SFInt32(e,"slicesOverY",0)})),x3dom.registerNodeType("X3DEnvironmentTextureNode","CubeMapTexturing",defineClass(x3dom.nodeTypes.X3DTextureNode,function(e){x3dom.nodeTypes.X3DEnvironmentTextureNode.superClass.call(this,e)},{getTexUrl:function(){return[]},getTexSize:function(){return-1}})),x3dom.registerNodeType("ComposedCubeMapTexture","CubeMapTexturing",defineClass(x3dom.nodeTypes.X3DEnvironmentTextureNode,function(e){x3dom.nodeTypes.ComposedCubeMapTexture.superClass.call(this,e),this.addField_SFNode("back",x3dom.nodeTypes.Texture),this.addField_SFNode("front",x3dom.nodeTypes.Texture),this.addField_SFNode("bottom",x3dom.nodeTypes.Texture),this.addField_SFNode("top",x3dom.nodeTypes.Texture),this.addField_SFNode("left",x3dom.nodeTypes.Texture),this.addField_SFNode("right",x3dom.nodeTypes.Texture),this._type="environmentMap"},{getTexUrl:function(){return[this._nameSpace.getURL(this._cf.back.node._vf.url[0]),this._nameSpace.getURL(this._cf.front.node._vf.url[0]),this._nameSpace.getURL(this._cf.bottom.node._vf.url[0]),this._nameSpace.getURL(this._cf.top.node._vf.url[0]),this._nameSpace.getURL(this._cf.left.node._vf.url[0]),this._nameSpace.getURL(this._cf.right.node._vf.url[0])]}})),x3dom.registerNodeType("GeneratedCubeMapTexture","CubeMapTexturing",defineClass(x3dom.nodeTypes.X3DEnvironmentTextureNode,function(e){x3dom.nodeTypes.GeneratedCubeMapTexture.superClass.call(this,e),this.addField_SFInt32(e,"size",128),this.addField_SFString(e,"update","NONE"),this._type="cubeMap",x3dom.debug.logWarning("GeneratedCubeMapTexture NYI")},{getTexSize:function(){return this._vf.size}})),x3dom.registerNodeType("Uniform","Shaders",defineClass(x3dom.nodeTypes.Field,function(e){x3dom.nodeTypes.Uniform.superClass.call(this,e)})),x3dom.registerNodeType("SurfaceShaderTexture","Shaders",defineClass(x3dom.nodeTypes.X3DTextureNode,function(e){x3dom.nodeTypes.SurfaceShaderTexture.superClass.call(this,e),this.addField_SFInt32(e,"textureCoordinatesId",0),this.addField_SFString(e,"channelMask","DEFAULT"),this.addField_SFBool(e,"isSRGB",!1),this.addField_SFNode("texture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("textureTransform",x3dom.nodeTypes.X3DTextureTransformNode)})),x3dom.registerNodeType("X3DShaderNode","Shaders",defineClass(x3dom.nodeTypes.X3DAppearanceChildNode,function(e){x3dom.nodeTypes.X3DShaderNode.superClass.call(this,e),this.addField_SFString(e,"language","")})),x3dom.registerNodeType("CommonSurfaceShader","Shaders",defineClass(x3dom.nodeTypes.X3DShaderNode,function(e){x3dom.nodeTypes.CommonSurfaceShader.superClass.call(this,e),this.addField_SFInt32(e,"tangentTextureCoordinatesId",-1),this.addField_SFInt32(e,"binormalTextureCoordinatesId",-1),this.addField_SFVec3f(e,"emissiveFactor",0,0,0),this.addField_SFInt32(e,"emissiveTextureId",-1),this.addField_SFInt32(e,"emissiveTextureCoordinatesId",0),this.addField_SFString(e,"emissiveTextureChannelMask","rgb"),this.addField_SFVec3f(e,"ambientFactor",.2,.2,.2),this.addField_SFInt32(e,"ambientTextureId",-1),this.addField_SFInt32(e,"ambientTextureCoordinatesId",0),this.addField_SFString(e,"ambientTextureChannelMask","rgb"),this.addField_SFVec3f(e,"diffuseFactor",.8,.8,.8),this.addField_SFInt32(e,"diffuseTextureId",-1),this.addField_SFInt32(e,"diffuseTextureCoordinatesId",0),this.addField_SFString(e,"diffuseTextureChannelMask","rgb"),this.addField_SFVec3f(e,"specularFactor",0,0,0),this.addField_SFInt32(e,"specularTextureId",-1),this.addField_SFInt32(e,"specularTextureCoordinatesId",0),this.addField_SFString(e,"specularTextureChannelMask","rgb"),this.addField_SFFloat(e,"shininessFactor",.2),this.addField_SFInt32(e,"shininessTextureId",-1),this.addField_SFInt32(e,"shininessTextureCoordinatesId",0),this.addField_SFString(e,"shininessTextureChannelMask","a"),this.addField_SFString(e,"normalFormat","UNORM"),this.addField_SFString(e,"normalSpace","TANGENT"),this.addField_SFInt32(e,"normalTextureId",-1),this.addField_SFInt32(e,"normalTextureCoordinatesId",0),this.addField_SFString(e,"normalTextureChannelMask","rgb"),this.addField_SFVec3f(e,"reflectionFactor",0,0,0),this.addField_SFInt32(e,"reflectionTextureId",-1),this.addField_SFInt32(e,"reflectionTextureCoordinatesId",0),this.addField_SFString(e,"reflectionTextureChannelMask","rgb"),this.addField_SFVec3f(e,"transmissionFactor",0,0,0),this.addField_SFInt32(e,"transmissionTextureId",-1),this.addField_SFInt32(e,"transmissionTextureCoordinatesId",0),this.addField_SFString(e,"transmissionTextureChannelMask","rgb"),this.addField_SFVec3f(e,"environmentFactor",1,1,1),this.addField_SFInt32(e,"environmentTextureId",-1),this.addField_SFInt32(e,"environmentTextureCoordinatesId",0),this.addField_SFString(e,"environmentTextureChannelMask","rgb"),this.addField_SFFloat(e,"relativeIndexOfRefraction",1),this.addField_SFFloat(e,"fresnelBlend",0),this.addField_SFString(e,"displacementAxis","y"),this.addField_SFFloat(e,"displacementFactor",255),this.addField_SFInt32(e,"displacementTextureId",-1),this.addField_SFInt32(e,"displacementTextureCoordinatesId",0),this.addField_SFNode("emissiveTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("ambientTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("diffuseTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("specularTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("shininessTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("normalTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("reflectionTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("transmissionTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("environmentTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("displacementTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFNode("diffuseDisplacementTexture",x3dom.nodeTypes.X3DTextureNode),this.addField_SFVec3f(e,"normalScale",2,2,2),this.addField_SFVec3f(e,"normalBias",-1,-1,1),this.addField_SFFloat(e,"alphaFactor",1),this.addField_SFBool(e,"invertAlphaTexture",!1),this.addField_SFInt32(e,"alphaTextureId",-1),this.addField_SFInt32(e,"alphaTextureCoordinatesId",0),this.addField_SFString(e,"alphaTextureChannelMask","a"),this.addField_SFNode("alphaTexture",x3dom.nodeTypes.X3DTextureNode),this._dirty={}},{getDiffuseMap:function(){return this._cf.diffuseTexture.node?(x3dom.isa(this._cf.diffuseTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.diffuseTexture.node._cf.texture.node._type="diffuseMap",this._cf.diffuseTexture.node._cf.texture):(this._cf.diffuseTexture.node._type="diffuseMap",this._cf.diffuseTexture)).node:null},getEnvironmentMap:function(){return this._cf.environmentTexture.node?(x3dom.isa(this._cf.environmentTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.environmentTexture.node._cf.texture.node._type="environmentMap",this._cf.environmentTexture.node._cf.texture):(this._cf.environmentTexture.node._type="environmentMap",this._cf.environmentTexture)).node:null},getNormalMap:function(){return this._cf.normalTexture.node?(x3dom.isa(this._cf.normalTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.normalTexture.node._cf.texture.node._type="normalMap",this._cf.normalTexture.node._cf.texture):(this._cf.normalTexture.node._type="normalMap",this._cf.normalTexture)).node:null},getAmbientMap:function(){return this._cf.ambientTexture.node?(x3dom.isa(this._cf.ambientTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.ambientTexture.node._cf.texture.node._type="ambientMap",this._cf.ambientTexture.node._cf.texture):(this._cf.ambientTexture.node._type="ambientMap",this._cf.ambientTexture)).node:null},getSpecularMap:function(){return this._cf.specularTexture.node?(x3dom.isa(this._cf.specularTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.specularTexture.node._cf.texture.node._type="specularMap",this._cf.specularTexture.node._cf.texture):(this._cf.specularTexture.node._type="specularMap",this._cf.specularTexture)).node:null},getShininessMap:function(){return this._cf.shininessTexture.node?(x3dom.isa(this._cf.shininessTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.shininessTexture.node._cf.texture.node._type="shininessMap",this._cf.shininessTexture.node._cf.texture):(this._cf.shininessTexture.node._type="shininessMap",this._cf.shininessTexture)).node:null},getAlphaMap:function(){return this._cf.alphaTexture.node?(x3dom.isa(this._cf.alphaTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.alphaTexture.node._cf.texture.node._type="alphaMap",this._cf.alphaTexture.node._cf.texture):(this._cf.alphaTexture.node._type="alphaMap",this._cf.alphaTexture)).node:null},getDisplacementMap:function(){return this._cf.displacementTexture.node?(x3dom.isa(this._cf.displacementTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.displacementTexture.node._cf.texture.node._type="displacementMap",this._cf.displacementTexture.node._cf.texture):(this._cf.displacementTexture.node._type="displacementMap",this._cf.displacementTexture)).node:null},getDiffuseDisplacementMap:function(){return this._cf.diffuseDisplacementTexture.node?(x3dom.isa(this._cf.diffuseDisplacementTexture.node,x3dom.nodeTypes.SurfaceShaderTexture)?(this._cf.diffuseDisplacementTexture.node._cf.texture.node._type="diffuseDisplacementMap",this._cf.diffuseDisplacementTexture.node._cf.texture):(this._cf.diffuseDisplacementTexture.node._type="diffuseDisplacementMap",this._cf.diffuseDisplacementTexture)).node:null},getTextures:function(){var e=[],t=this.getDiffuseMap(),t=(t&&e.push(t),this.getNormalMap()),t=(t&&e.push(t),this.getSpecularMap()),t=(t&&e.push(t),this.getShininessMap()),t=(t&&e.push(t),this.getEnvironmentMap()),t=(t&&e.push(t),this.getDisplacementMap()),t=(t&&e.push(t),this.getDiffuseDisplacementMap());return t&&e.push(t),e},needTexcoords:function(){return!!(this.getDiffuseMap()||this.getNormalMap()||this.getSpecularMap()||this.getShininessMap()||this.getDisplacementMap()||this.getDiffuseDisplacementMap()||this.getEnvironmentMap())}})),x3dom.registerNodeType("ComposedShader","Shaders",defineClass(x3dom.nodeTypes.X3DShaderNode,function(e){x3dom.nodeTypes.ComposedShader.superClass.call(this,e),this.addField_MFNode("fields",x3dom.nodeTypes.Field),this.addField_MFNode("parts",x3dom.nodeTypes.ShaderPart),this._vertex=null,this._fragment=null,this._id=null,x3dom.nodeTypes.ComposedShader.ShaderInfoMsgShown||(x3dom.debug.logInfo("Current ComposedShader node implementation limitations:\nVertex attributes (if given in the standard X3D fields 'coord', 'color', 'normal', 'texCoord'), matrices and texture are provided as follows...\n(see also <a href='http://x3dom.org/x3dom/doc/help/composedShader.html'>http://x3dom.org/x3dom/doc/help/composedShader.html</a>)\n    attribute vec3 position;\n    attribute vec3 normal;\n    attribute vec2 texcoord;\n    attribute vec3 color;\n    uniform mat4 modelViewProjectionMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 normalMatrix;\n    uniform mat4 viewMatrix;\n    uniform sampler2D tex;\n"),x3dom.nodeTypes.ComposedShader.ShaderInfoMsgShown=!0)},{nodeChanged:function(){for(var e=this._cf.parts.nodes.length,t=0;t<e;t++)"vertex"==this._cf.parts.nodes[t]._vf.type.toLowerCase()?(this._vertex=this._cf.parts.nodes[t],this._id=this._cf.parts.nodes[t]._id):"fragment"==this._cf.parts.nodes[t]._vf.type.toLowerCase()&&(this._fragment=this._cf.parts.nodes[t],this._id+=" - "+this._cf.parts.nodes[t]._id);var i={},e=this._cf.fields.nodes.length;for(t=0;t<e;t++){var o=this._cf.fields.nodes[t]._vf.name,s=(i.xmlNode=this._cf.fields.nodes[t]._xmlNode,!1);null==i.xmlNode&&(i.xmlNode=document.createElement("field"),s=!0),i.xmlNode.setAttribute(o,this._cf.fields.nodes[t]._vf.value),this["addField_"+this._cf.fields.nodes[t]._vf.type](i,o),s&&(i.xmlNode=null)}this._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){e._cleanupGLObjects&&e._cleanupGLObjects(),e.setAllDirty()})})},fieldChanged:function(e){for(var t=this._cf.fields.nodes.length,i=0;i<t;i++){var o=this._cf.fields.nodes[i]._vf.name;if(o===e){var s=this._cf.fields.nodes[i]._vf.value;try{this._vf[o].setValueByStr(s)}catch(e){try{switch((typeof this._vf[o]).toString()){case"number":this._vf[o]=+s;break;case"boolean":this._vf[o]="true"===s.toLowerCase();break;case"string":this._vf[o]=s}}catch(e){x3dom.debug.logError("setValueByStr() NYI for "+typeof this._vf[o])}}break}}if("url"===e){for(i=0;i<t;i++)"vertex"==this._cf.parts.nodes[i]._vf.type.toLowerCase()?(this._vertex=this._cf.parts.nodes[i],this._id=this._cf.parts.nodes[i]._id):"fragment"==this._cf.parts.nodes[i]._vf.type.toLowerCase()&&(this._fragment=this._cf.parts.nodes[i],this._id+=" - "+this._cf.parts.nodes[i]._id);this._parentNodes.forEach(function(e){e._parentNodes.forEach(function(e){e._cleanupGLObjects&&e._cleanupGLObjects(),e.setAllDirty()})})}},parentAdded:function(e){e.nodeChanged()}})),x3dom.nodeTypes.ComposedShader.ShaderInfoMsgShown=!1,x3dom.registerNodeType("ShaderPart","Shaders",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.ShaderPart.superClass.call(this,e),this.addField_MFString(e,"url",[]),this.addField_SFString(e,"type","VERTEX"),this._id=e&&e.xmlNode&&""!=e.xmlNode.id?e.xmlNode.id:++x3dom.nodeTypes.Shape.shaderPartID,x3dom.debug.assert("vertex"==this._vf.type.toLowerCase()||"fragment"==this._vf.type.toLowerCase(),"Unknown shader part type!")},{nodeChanged:function(){var e={};if(e.xmlNode=this._xmlNode,null!=e.xmlNode){var t=this;if(t._vf.url.length&&-1==t._vf.url[0].indexOf("\n")){var i=new XMLHttpRequest,o=t._nameSpace.getURL(t._vf.url[0]),s=t._id;t._id="default",t._vf.url=new x3dom.fields.MFString([this._getDefaultShader()]),i.open("GET",o,!1),i.onload=function(){t._vf.url=new x3dom.fields.MFString([]),t._vf.url.push(i.response),t._id=s,t.fieldChanged("url")},i.onerror=function(){x3dom.debug.logError("Could not load file '"+t._vf.url[0]+"'.")},x3dom.RequestManager.addRequest(i)}else{t._vf.url.length&&(t._vf.url=new x3dom.fields.MFString([]));try{t._vf.url.push(e.xmlNode.childNodes[1].nodeValue),e.xmlNode.removeChild(e.xmlNode.childNodes[1])}catch(i){e.xmlNode.childNodes.forEach(function(e){3===e.nodeType?t._vf.url.push(e.nodeValue):4===e.nodeType&&t._vf.url.push(e.data),e.parentNode.removeChild(e)})}}}this._parentNodes.forEach(function(e){e.nodeChanged()})},fieldChanged:function(e){"url"===e&&this._parentNodes.forEach(function(e){e.fieldChanged("url")})},parentAdded:function(e){e.nodeChanged()},_getDefaultShader:function(){return"vertex"==this._vf.type.toLowerCase()?"attribute vec3 position;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}\n":"fragment"==this._vf.type.toLowerCase()?"precision highp float;\nvoid main(void) {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n":void 0}})),x3dom.registerNodeType("X3DVertexAttributeNode","Shaders",defineClass(x3dom.nodeTypes.X3DGeometricPropertyNode,function(e){x3dom.nodeTypes.X3DVertexAttributeNode.superClass.call(this,e),this.addField_SFString(e,"name","")})),x3dom.registerNodeType("FloatVertexAttribute","Shaders",defineClass(x3dom.nodeTypes.X3DVertexAttributeNode,function(e){x3dom.nodeTypes.FloatVertexAttribute.superClass.call(this,e),this.addField_SFInt32(e,"numComponents",4),this.addField_MFFloat(e,"value",[])})),x3dom.registerNodeType("X3DSpatialGeometryNode","Geometry3D",defineClass(x3dom.nodeTypes.X3DGeometryNode,function(e){x3dom.nodeTypes.X3DSpatialGeometryNode.superClass.call(this,e)})),x3dom.registerNodeType("Plane","Geometry3D",defineClass(x3dom.nodeTypes.X3DSpatialGeometryNode,function(e){x3dom.nodeTypes.Plane.superClass.call(this,e),this.addField_SFVec2f(e,"size",2,2),this.addField_SFVec2f(e,"subdivision",1,1),this.addField_SFVec3f(e,"center",0,0,0),this.addField_MFString(e,"primType",["TRIANGLES"]),this._vf.primType.length&&(this._mesh._primType=this._vf.primType[0]);var t=this._vf.size.x,i=this._vf.size.y,o=this._vf.subdivision.x,s=this._vf.subdivision.y,n=this._vf.ccw,r=["Plane",t,i,o,s,this._vf.center.x,this._vf.center.y,this._vf.center.z,n].join("-");if(e&&this._vf.useGeoCache&&void 0!==x3dom.geoCache[r])this._mesh=x3dom.geoCache[r];else{var a=0,d=0,l=t/o,h=i/s,u=n?1:-1;for(t/=2,i/=2,d=0;d<=s;d++)for(a=0;a<=o;a++)this._mesh._positions[0].push(this._vf.center.x+a*l-t),this._mesh._positions[0].push(this._vf.center.y+d*h-i),this._mesh._positions[0].push(this._vf.center.z),this._mesh._normals[0].push(0),this._mesh._normals[0].push(0),this._mesh._normals[0].push(u),this._mesh._texCoords[0].push(a/o),this._mesh._texCoords[0].push(d/s);for(d=1;d<=s;d++)for(a=0;a<o;a++)this._mesh._indices[0].push((d-1)*(o+1)+a),this._mesh._indices[0].push((d-1)*(o+1)+a+1),this._mesh._indices[0].push(d*(o+1)+a),this._mesh._indices[0].push(d*(o+1)+a),this._mesh._indices[0].push((d-1)*(o+1)+a+1),this._mesh._indices[0].push(d*(o+1)+a+1);this._mesh._invalidate=!0,this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3,x3dom.geoCache[r]=this._mesh}},{fieldChanged:function(e){if("size"==e||"center"==e){this._mesh._positions[0]=[];var t=this._vf.size.x,i=this._vf.size.y,o=0,s=0,n=t/(a=this._vf.subdivision.x),r=i/(d=this._vf.subdivision.y);for(t/=2,i/=2,s=0;s<=d;s++)for(o=0;o<=a;o++)this._mesh._positions[0].push(this._vf.center.x+o*n-t),this._mesh._positions[0].push(this._vf.center.y+s*r-i),this._mesh._positions[0].push(this._vf.center.z);this.invalidateVolume(),this._mesh._numCoords=this._mesh._positions[0].length/3,this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()})}else if("subdivision"==e){this._mesh._positions[0]=[],this._mesh._indices[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[];var t=this._vf.size.x,i=this._vf.size.y,a=this._vf.subdivision.x,d=this._vf.subdivision.y,l=this._vf.ccw?1:-1,o=0,s=0,n=t/a,r=i/d;for(t/=2,i/=2,s=0;s<=d;s++)for(o=0;o<=a;o++)this._mesh._positions[0].push(this._vf.center.x+o*n-t),this._mesh._positions[0].push(this._vf.center.y+s*r-i),this._mesh._positions[0].push(this._vf.center.z),this._mesh._normals[0].push(0),this._mesh._normals[0].push(0),this._mesh._normals[0].push(l),this._mesh._texCoords[0].push(o/a),this._mesh._texCoords[0].push(s/d);for(s=1;s<=d;s++)for(o=0;o<a;o++)this._mesh._indices[0].push((s-1)*(a+1)+o),this._mesh._indices[0].push((s-1)*(a+1)+o+1),this._mesh._indices[0].push(s*(a+1)+o),this._mesh._indices[0].push(s*(a+1)+o),this._mesh._indices[0].push((s-1)*(a+1)+o+1),this._mesh._indices[0].push(s*(a+1)+o+1);this.invalidateVolume(),this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3,this._parentNodes.forEach(function(e){e.setAllDirty(),e.invalidateVolume()})}}})),x3dom.registerNodeType("Box","Geometry3D",defineClass(x3dom.nodeTypes.X3DSpatialGeometryNode,function(e){x3dom.nodeTypes.Box.superClass.call(this,e),this.addField_SFVec3f(e,"size",2,2,2),this.addField_SFBool(e,"hasHelperColors",!1);var e=this._vf.size.x,t=this._vf.size.y,i=this._vf.size.z,o=this._vf.ccw,s=["Box",e,t,i,o].join("-");this._vf.useGeoCache&&void 0!==x3dom.geoCache[s]?this._mesh=x3dom.geoCache[s]:(this._mesh._positions[0]=[-(e/=2),-(t/=2),-(i/=2),-e,t,-i,e,t,-i,e,-t,-i,-e,-t,i,-e,t,i,e,t,i,e,-t,i,-e,-t,-i,-e,-t,i,-e,t,i,-e,t,-i,e,-t,-i,e,-t,i,e,t,i,e,t,-i,-e,t,-i,-e,t,i,e,t,i,e,t,-i,-e,-t,-i,-e,-t,i,e,-t,i,e,-t,-i],this._mesh._normals[0]=o?[0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0],this._mesh._texCoords[0]=[1,0,1,1,0,1,0,0,0,0,0,1,1,1,1,0,0,0,1,0,1,1,0,1,1,0,0,0,0,1,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,1,0],this._vf.hasHelperColors&&(this._mesh._colors[0]=[0,0,0,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0,0,0,0,0,1,0,1,1,0,1,0,1,0,0,1,0,1,1,1,1,1,1,0,0,1,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,0,1,1,0,0]),this._mesh._indices[0]=[0,1,2,2,3,0,4,7,5,5,7,6,8,9,10,10,11,8,12,14,13,14,12,15,16,17,18,18,19,16,20,22,21,22,20,23],this._mesh._invalidate=!0,this._mesh._numFaces=12,this._mesh._numCoords=24,x3dom.geoCache[s]=this._mesh)},{fieldChanged:function(e){var t,i,o;"size"===e?(t=this._vf.size.x/2,i=this._vf.size.y/2,o=this._vf.size.z/2,this._mesh._positions[0]=[-t,-i,-o,-t,i,-o,t,i,-o,t,-i,-o,-t,-i,o,-t,i,o,t,i,o,t,-i,o,-t,-i,-o,-t,-i,o,-t,i,o,-t,i,-o,t,-i,-o,t,-i,o,t,i,o,t,i,-o,-t,i,-o,-t,i,o,t,i,o,t,i,-o,-t,-i,-o,-t,-i,o,t,-i,o,t,-i,-o],this.invalidateVolume(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()})):"hasHelperColors"===e&&(this._vf.hasHelperColors?this._mesh._colors[0]=[0,0,0,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0,0,0,0,0,1,0,1,1,0,1,0,1,0,0,1,0,1,1,1,1,1,1,0,0,1,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,0,1,1,0,0]:this._mesh._colors[0]=[],this._parentNodes.forEach(function(e){e._dirty.colors=!0}))}})),x3dom.registerNodeType("Sphere","Geometry3D",defineClass(x3dom.nodeTypes.X3DSpatialGeometryNode,function(e){x3dom.nodeTypes.Sphere.superClass.call(this,e),this.addField_SFFloat(e,"radius",e?1:1e3),this.addField_SFVec2f(e,"subdivision",24,24),this._qfactors={low:.3,medium:.5,high:1},void 0===e&&this.nodeChanged()},{nodeChanged:function(){var e=1,e=(this._nameSpace&&(e=this._nameSpace.doc.properties.getProperty("PrimitiveQuality","Medium")),e=x3dom.Utils.isNumber(e)?parseFloat(e):this._qfactors[e.toLowerCase()]||.5,this._quality=e,["Sphere",this._vf.radius,this._vf.subdivision.x,this._vf.subdivision.y,e,this._vf.ccw].join("-"));this._vf.useGeoCache&&void 0!==x3dom.geoCache[e]?this._mesh=x3dom.geoCache[e]:(this._regenerateMesh(),this._mesh._invalidate=!0,this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3,x3dom.geoCache[e]=this._mesh)},_regenerateMesh:function(){this._mesh._positions[0]=[],this._mesh._indices[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[];for(var e,t,i,o,s,n,r,a,d,l=this._vf.radius,h=this._vf.ccw?1:-1,u=this._vf.subdivision.x,f=this._vf.subdivision.y,c=Math.floor(u*this._quality),_=Math.floor(f*this._quality),m=0;m<=c;m++)for(t=m*Math.PI/c,i=Math.sin(t),o=Math.cos(t),e=0;e<=_;e++)s=this._calcXYZ(e,_,i,o),n=this._uFromlong(e,_),r=m/c,this._mesh._positions[0].push(l*s.x,l*s.y,l*s.z),this._mesh._normals[0].push(h*s.x,h*s.y,h*s.z),this._mesh._texCoords[0].push(n,r);for(m=0;m<c;m++)for(e=0;e<_;e++)d=(a=m*(_+1)+e)+_+1,this._mesh._indices[0].push(a,d,a+1),this._mesh._indices[0].push(d,d+1,a+1)},_calcXYZ:function(e,t,i,o){e=.5*Math.PI+2*e*Math.PI/t;return{x:-Math.cos(e)*i,y:-o,z:-Math.sin(e)*i}},_uFromlong:function(e,t){return 1-e/t},fieldChanged:function(e){if("radius"===e){this._mesh._positions[0]=[];for(var t,i,o,s,n,r=this._vf.radius,a=this._vf.subdivision.x,d=this._vf.subdivision.y,l=this._quality,h=Math.floor(a*l),u=Math.floor(d*l),f=0;f<=h;f++)for(i=f*Math.PI/h,o=Math.sin(i),s=Math.cos(i),t=0;t<=u;t++)n=this._calcXYZ(t,u,o,s),this._mesh._positions[0].push(r*n.x,r*n.y,r*n.z);this.invalidateVolume(),this._mesh._numCoords=this._mesh._positions[0].length/3,this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()})}else"subdivision"===e&&(this._regenerateMesh(),this.invalidateVolume(),this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3,l="Sphere_"+(r=this._vf.radius)+"-"+(a=this._vf.subdivision.x)+"-"+(d=this._vf.subdivision.y),x3dom.geoCache[l]=this._mesh,this._parentNodes.forEach(function(e){e.setAllDirty(),e.invalidateVolume()}))}})),x3dom.registerNodeType("Torus","Geometry3D",defineClass(x3dom.nodeTypes.X3DSpatialGeometryNode,function(e){x3dom.nodeTypes.Torus.superClass.call(this,e);var t=2*Math.PI,i=(this.addField_SFFloat(e,"innerRadius",.5),this.addField_SFFloat(e,"outerRadius",1),this.addField_SFFloat(e,"angle",t),this.addField_SFBool(e,"caps",!0),this.addField_SFVec2f(e,"subdivision",24,24),this.addField_SFBool(e,"insideOutsideRadius",!1),this._vf.angle<0?this._vf.angle=0:this._vf.angle>t&&(this._vf.angle=t),this._origCCW=this._vf.ccw,this._vf.innerRadius),o=this._vf.outerRadius,s=(1==this._vf.insideOutsideRadius&&(o<i&&(e=i,i=o,o=e),o=i+(e=(o-i)/2),i=e,this._vf.ccw=!this._origCCW),this._vf.subdivision.x),n=this._vf.subdivision.y,r=this._vf.ccw?1:-1,s=Math.max(3,Math.round(this._vf.angle/t*s)),e=["Torus_",i,o,this._vf.angle,this._vf.subdivision,this._vf.caps,r].join("_");if(this._vf.useGeoCache&&void 0!==x3dom.geoCache[e])this._mesh=x3dom.geoCache[e];else{for(var a,d,l,h,u,f=this._vf.angle/s,c=t/n,_=0,m=0;_<=s;_++,m+=f)for(x=Math.cos(m),g=Math.sin(m),d=a=0;a<=n;a++,d+=c)l=Math.cos(d),h=Math.sin(d),u=o+i*l,this._vf.insideOutsideRadius?(this._mesh._positions[0].push(x*u,i*h,-g*u),this._mesh._normals[0].push(r*x*l,r*h,r*-g*l)):(this._mesh._positions[0].push(x*u,-g*u,i*h),this._mesh._normals[0].push(r*x*l,r*-g*l,r*h)),this._mesh._texCoords[0].push(-_/s,a/n);for(_=0;_<n;_++)for(a=0;a<s;a++)this._mesh._indices[0].push(a*(n+1)+_),this._mesh._indices[0].push(a*(n+1)+_+1),this._mesh._indices[0].push((a+1)*(n+1)+_),this._mesh._indices[0].push(a*(n+1)+_+1),this._mesh._indices[0].push((a+1)*(n+1)+_+1),this._mesh._indices[0].push((a+1)*(n+1)+_);if(this._vf.angle<t&&1==this._vf.caps){var p=this._mesh._positions[0].length/3;for(this._vf.insideOutsideRadius?(this._mesh._positions[0].push(o,0,0),this._mesh._normals[0].push(0,0,+r)):(this._mesh._positions[0].push(o,0,0),this._mesh._normals[0].push(0,+r,0)),this._mesh._texCoords[0].push(.5,.5),d=a=0;a<=n;a++,d+=c)l=Math.cos(d),h=Math.sin(d),u=o+i*l,this._vf.insideOutsideRadius?(this._mesh._positions[0].push(u,h*i,0),this._mesh._normals[0].push(0,0,+r)):(this._mesh._positions[0].push(u,0,h*i),this._mesh._normals[0].push(0,+r,0)),this._mesh._texCoords[0].push(.5*(1+l),.5*(1-h)),0<a&&(this._mesh._indices[0].push(p),this._mesh._indices[0].push(p+a),this._mesh._indices[0].push(p+a-1)),a==n&&(this._mesh._indices[0].push(p),this._mesh._indices[0].push(p+1),this._mesh._indices[0].push(p+a));var x=Math.cos(this._vf.angle),g=Math.sin(this._vf.angle),p=this._mesh._positions[0].length/3,v=-g,y=-x;for(this._vf.insideOutsideRadius?(this._mesh._positions[0].push(x*o,0,-g*o),this._mesh._normals[0].push(r*v,0,r*y)):(this._mesh._positions[0].push(x*o,-g*o,0),this._mesh._normals[0].push(r*v,r*y,0)),this._mesh._texCoords[0].push(.5,.5),d=a=0;a<=n;a++,d+=c)l=Math.cos(d),h=Math.sin(d),u=o+i*l,this._vf.insideOutsideRadius?(this._mesh._positions[0].push(x*u,h*i,-g*u),this._mesh._normals[0].push(r*v,0,r*y)):(this._mesh._positions[0].push(x*u,-g*u,h*i),this._mesh._normals[0].push(r*v,r*y,0)),this._mesh._texCoords[0].push(1-.5*(1+l),.5*(1-h)),0<a&&(this._mesh._indices[0].push(p),this._mesh._indices[0].push(p+a-1),this._mesh._indices[0].push(p+a)),a==n&&(this._mesh._indices[0].push(p),this._mesh._indices[0].push(p+a),this._mesh._indices[0].push(p+1))}this._mesh._invalidate=!0,this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3,x3dom.geoCache[e]=this._mesh}},{fieldChanged:function(e){if("innerRadius"==e||"outerRadius"==e||"subdivision"==e||"angle"==e||"insideOutsideRadius"==e||"caps"==e){var t,i,o,s,n,r,a,d,e=2*Math.PI,l=(this._vf.angle<0?this._vf.angle=0:this._vf.angle>e&&(this._vf.angle=e),this._vf.innerRadius),h=this._vf.outerRadius,u=(1==this._vf.insideOutsideRadius?(h<l&&(t=l,l=h,h=t),h=l+(t=(h-l)/2),l=t,this._vf.ccw=!this._origCCW):this._vf.ccw=this._origCCW,this._vf.subdivision.x),f=this._vf.subdivision.y,c=this._vf.ccw?1:-1,u=Math.max(3,Math.round(this._vf.angle/e*u)),_=this._vf.angle/u,m=e/f;for(this._mesh._positions[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[],this._mesh._indices[0]=[],s=i=0;i<=u;i++,s+=_)for(x=Math.cos(s),g=Math.sin(s),n=o=0;o<=f;o++,n+=m)r=Math.cos(n),a=Math.sin(n),d=h+l*r,this._vf.insideOutsideRadius?(this._mesh._positions[0].push(x*d,l*a,-g*d),this._mesh._normals[0].push(c*x*r,c*a,c*-g*r)):(this._mesh._positions[0].push(x*d,-g*d,l*a),this._mesh._normals[0].push(c*x*r,c*-g*r,c*a)),this._mesh._texCoords[0].push(-i/u,o/f);for(i=0;i<f;i++)for(o=0;o<u;o++)this._mesh._indices[0].push(o*(f+1)+i),this._mesh._indices[0].push(o*(f+1)+i+1),this._mesh._indices[0].push((o+1)*(f+1)+i),this._mesh._indices[0].push(o*(f+1)+i+1),this._mesh._indices[0].push((o+1)*(f+1)+i+1),this._mesh._indices[0].push((o+1)*(f+1)+i);if(this._vf.angle<e&&1==this._vf.caps){var p=this._mesh._positions[0].length/3;for(this._vf.insideOutsideRadius?(this._mesh._positions[0].push(h,0,0),this._mesh._normals[0].push(0,0,c)):(this._mesh._positions[0].push(h,0,0),this._mesh._normals[0].push(0,c,0)),this._mesh._texCoords[0].push(.5,.5),n=o=0;o<=f;o++,n+=m)r=Math.cos(n),a=Math.sin(n),d=h+l*r,this._vf.insideOutsideRadius?(this._mesh._positions[0].push(d,a*l,0),this._mesh._normals[0].push(0,0,c)):(this._mesh._positions[0].push(d,0,a*l),this._mesh._normals[0].push(0,c,0)),this._mesh._texCoords[0].push(.5*(1+r),.5*(1-a)),0<o&&(this._mesh._indices[0].push(p),this._mesh._indices[0].push(p+o),this._mesh._indices[0].push(p+o-1)),o==f&&(this._mesh._indices[0].push(p),this._mesh._indices[0].push(p+1),this._mesh._indices[0].push(p+o));var x=Math.cos(this._vf.angle),g=Math.sin(this._vf.angle),p=this._mesh._positions[0].length/3,v=-g,y=-x;for(this._vf.insideOutsideRadius?(this._mesh._positions[0].push(x*h,0,-g*h),this._mesh._normals[0].push(c*v,0,c*y)):(this._mesh._positions[0].push(x*h,-g*h,0),this._mesh._normals[0].push(c*v,c*y,0)),this._mesh._texCoords[0].push(.5,.5),n=o=0;o<=f;o++,n+=m)r=Math.cos(n),a=Math.sin(n),d=h+l*r,this._vf.insideOutsideRadius?(this._mesh._positions[0].push(x*d,a*l,-g*d),this._mesh._normals[0].push(c*v,0,c*y)):(this._mesh._positions[0].push(x*d,-g*d,a*l),this._mesh._normals[0].push(c*v,c*y,0)),this._mesh._texCoords[0].push(1-.5*(1+r),.5*(1-a)),0<o&&(this._mesh._indices[0].push(p),this._mesh._indices[0].push(p+o-1),this._mesh._indices[0].push(p+o)),o==f&&(this._mesh._indices[0].push(p),this._mesh._indices[0].push(p+o),this._mesh._indices[0].push(p+1))}this.invalidateVolume(),this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3,this._parentNodes.forEach(function(e){e.setAllDirty(),e.invalidateVolume()})}}})),x3dom.registerNodeType("Cone","Geometry3D",defineClass(x3dom.nodeTypes.X3DSpatialGeometryNode,function(e){x3dom.nodeTypes.Cone.superClass.call(this,e),this.addField_SFFloat(e,"bottomRadius",1),this.addField_SFFloat(e,"topRadius",0),this.addField_SFFloat(e,"height",2),this.addField_SFBool(e,"bottom",!0),this.addField_SFBool(e,"side",!0),this.addField_SFBool(e,"top",!0),this.addField_SFFloat(e,"subdivision",32);e=["Cone",this._vf.bottomRadius,this._vf.height,this._vf.top,this._vf.bottom,this._vf.side,this._vf.topRadius,this._vf.subdivision,this._vf.ccw].join("_");this._vf.useGeoCache&&void 0!==x3dom.geoCache[e]?this._mesh=x3dom.geoCache[e]:(this._calcMesh(),this._mesh._invalidate=!0,x3dom.geoCache[e]=this._mesh)},{_calcMesh:function(){var e,t,i,o,s,n=this._vf.bottomRadius,r=this._vf.height,a=this._vf.topRadius,d=this._vf.subdivision,l=this._vf.ccw?1:-1,h=2*Math.PI/d,u=(n-a)/r,f=1/Math.sqrt(1+u*u),c=0,_=0;if(this._vf.side&&0<r)for(var m=0,p=0,c=0,_=0;c<=d;c++)e=c*h,t=Math.sin(e),i=-Math.cos(e),a>x3dom.fields.Eps&&(m=t*a,p=i*a),this._mesh._positions[0].push(m,r/2,p),this._mesh._normals[0].push(l*t/f,l*u/f,l*i/f),this._mesh._texCoords[0].push(1-c/d,1),this._mesh._positions[0].push(t*n,-r/2,i*n),this._mesh._normals[0].push(l*t/f,l*u/f,l*i/f),this._mesh._texCoords[0].push(1-c/d,0),0<c&&(this._mesh._indices[0].push(_),this._mesh._indices[0].push(_+2),this._mesh._indices[0].push(_+1),this._mesh._indices[0].push(_+1),this._mesh._indices[0].push(_+2),this._mesh._indices[0].push(_+3),_+=2);if(this._vf.bottom&&0<n){for(s=this._mesh._positions[0].length/3,c=d-1;0<=c;c--)e=c*h,t=n*Math.sin(e),i=-n*Math.cos(e),this._mesh._positions[0].push(t,-r/2,i),this._mesh._normals[0].push(0,-1*l,0),this._mesh._texCoords[0].push(t/n/2+.5,i/n/2+.5);for(o=s+1,c=2;c<d;c++)this._mesh._indices[0].push(o),this._mesh._indices[0].push(s),this._mesh._indices[0].push(o=s+c)}if(this._vf.top&&a>x3dom.fields.Eps){for(s=this._mesh._positions[0].length/3,c=d-1;0<=c;c--)e=c*h,t=a*Math.sin(e),i=-a*Math.cos(e),this._mesh._positions[0].push(t,r/2,i),this._mesh._normals[0].push(0,l,0),this._mesh._texCoords[0].push(t/a/2+.5,1-i/a/2+.5);for(o=s+1,c=2;c<d;c++)this._mesh._indices[0].push(s),this._mesh._indices[0].push(o),this._mesh._indices[0].push(o=s+c)}this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3},fieldChanged:function(e){"bottomRadius"!=e&&"topRadius"!=e&&"height"!=e&&"subdivision"!=e&&"bottom"!=e&&"top"!=e&&"side"!=e||(this._mesh._positions[0]=[],this._mesh._indices[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[],this._calcMesh(),this.invalidateVolume(),this._parentNodes.forEach(function(e){e.setAllDirty(),e.invalidateVolume()}))}})),x3dom.registerNodeType("Cylinder","Geometry3D",defineClass(x3dom.nodeTypes.X3DSpatialGeometryNode,function(e){x3dom.nodeTypes.Cylinder.superClass.call(this,e),this.addField_SFFloat(e,"radius",1),this.addField_SFFloat(e,"height",2),this.addField_SFBool(e,"bottom",!0),this.addField_SFBool(e,"top",!0),this.addField_SFFloat(e,"subdivision",32),this.addField_SFBool(e,"side",!0);var e=this._vf.subdivision,t=this._vf.ccw,e=["Cylinder",this._vf.radius,this._vf.height,this._vf.bottom,this._vf.top,this._vf.side,e,t].join("_");this._vf.useGeoCache&&void 0!==x3dom.geoCache[e]?this._mesh=x3dom.geoCache[e]:(this._calcMesh(),this._mesh._invalidate=!0,x3dom.geoCache[e]=this._mesh)},{_calcMesh:function(){var e,t,i,o,s=this._vf.radius,n=this._vf.height/2,r=this._vf.subdivision,a=this._vf.ccw?1:-1,d=2*Math.PI/r,l=0;if(this._vf.side)for(l=o=0;o<=r;o++)e=o*d,t=Math.sin(e),i=-Math.cos(e),this._mesh._positions[0].push(t*s,-n,i*s),this._mesh._normals[0].push(a*t,0,a*i),this._mesh._texCoords[0].push(1-o/r,0),this._mesh._positions[0].push(t*s,n,i*s),this._mesh._normals[0].push(a*t,0,a*i),this._mesh._texCoords[0].push(1-o/r,1),0<o&&(this._mesh._indices[0].push(l+0,l+1,l+2),this._mesh._indices[0].push(l+2,l+1,l+3),l+=2);if(0<s){var h,u=this._mesh._positions[0].length/3;if(this._vf.top){for(o=r-1;0<=o;o--)e=o*d,t=s*Math.sin(e),i=-s*Math.cos(e),this._mesh._positions[0].push(t,n,i),this._mesh._normals[0].push(0,a,0),this._mesh._texCoords[0].push(t/s/2+.5,-i/s/2+.5);for(h=u+1,o=2;o<r;o++)this._mesh._indices[0].push(u),this._mesh._indices[0].push(h),this._mesh._indices[0].push(h=u+o);u=this._mesh._positions[0].length/3}if(this._vf.bottom){for(o=r-1;0<=o;o--)e=o*d,t=s*Math.sin(e),i=-s*Math.cos(e),this._mesh._positions[0].push(t,-n,i),this._mesh._normals[0].push(0,-1*a,0),this._mesh._texCoords[0].push(t/s/2+.5,i/s/2+.5);for(h=u+1,o=2;o<r;o++)this._mesh._indices[0].push(h),this._mesh._indices[0].push(u),this._mesh._indices[0].push(h=u+o)}}this._mesh._numFaces=this._mesh._indices[0].length/3,this._mesh._numCoords=this._mesh._positions[0].length/3},fieldChanged:function(e){if("radius"===e||"height"===e){this._mesh._positions[0]=[];var t,i,o,s,n=this._vf.radius,r=this._vf.height/2,a=this._vf.subdivision,d=2*Math.PI/a;if(this._vf.side)for(s=0;s<=a;s++)t=s*d,i=Math.sin(t),o=-Math.cos(t),this._mesh._positions[0].push(i*n,-r,o*n),this._mesh._positions[0].push(i*n,r,o*n);if(0<n&&(this._mesh._positions[0].length,this._vf.top))for(s=a-1;0<=s;s--)t=s*d,i=n*Math.sin(t),o=-n*Math.cos(t),this._mesh._positions[0].push(i,r,o);if(this._vf.bottom)for(s=a-1;0<=s;s--)t=s*d,i=n*Math.sin(t),o=-n*Math.cos(t),this._mesh._positions[0].push(i,-r,o);this.invalidateVolume(),this._mesh._numCoords=this._mesh._positions[0].length/3,this._parentNodes.forEach(function(e){e._dirty.positions=!0,e.invalidateVolume()})}else"subdivision"!==e&&"bottom"!==e&&"top"!==e&&"side"!==e||(this._mesh._positions[0]=[],this._mesh._indices[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[],this._calcMesh(),this.invalidateVolume(),this._parentNodes.forEach(function(e){e.setAllDirty(),e.invalidateVolume()}))}})),x3dom.registerNodeType("X3DBinaryContainerGeometryNode","Geometry3D",defineClass(x3dom.nodeTypes.X3DSpatialGeometryNode,function(e){x3dom.nodeTypes.X3DBinaryContainerGeometryNode.superClass.call(this,e),this.addField_SFVec3f(e,"position",0,0,0),this.addField_SFVec3f(e,"size",1,1,1),this.addField_MFInt32(e,"vertexCount",[0]),this.addField_MFString(e,"primType",["TRIANGLES"]),this._mesh._invalidate=!1,this._mesh._numCoords=0,this._mesh._numFaces=0,this._diameter=this._vf.size.length()},{getMin:function(){var e=this._mesh._vol;return e.isValid()||e.setBoundsByCenterSize(this._vf.position,this._vf.size),e.min},getMax:function(){var e=this._mesh._vol;return e.isValid()||e.setBoundsByCenterSize(this._vf.position,this._vf.size),e.max},getVolume:function(){var e=this._mesh._vol;return e.isValid()||e.setBoundsByCenterSize(this._vf.position,this._vf.size),e},invalidateVolume:function(){},getCenter:function(){return this._vf.position},getDiameter:function(){return this._diameter},needLighting:function(){var e=this._vf.primType.length&&0<=this._vf.primType[0].indexOf("TRIANGLE");return this._vf.lit&&e}})),x3dom.registerNodeType("BinaryGeometry","Geometry3D",defineClass(x3dom.nodeTypes.X3DBinaryContainerGeometryNode,function(e){x3dom.nodeTypes.BinaryGeometry.superClass.call(this,e),this.addField_SFString(e,"index",""),this.addField_SFString(e,"coord",""),this.addField_SFString(e,"normal",""),this.addField_SFString(e,"texCoord",""),this.addField_SFString(e,"color",""),this.addField_SFString(e,"tangent",""),this.addField_SFString(e,"binormal",""),this.addField_SFString(e,"indexType","Uint16"),this.addField_SFString(e,"coordType","Float32"),this.addField_SFString(e,"normalType","Float32"),this.addField_SFString(e,"texCoordType","Float32"),this.addField_SFString(e,"colorType","Float32"),this.addField_SFString(e,"tangentType","Float32"),this.addField_SFString(e,"binormalType","Float32"),this.addField_SFBool(e,"normalAsSphericalCoordinates",!1),this.addField_SFBool(e,"rgbaColors",!1),this.addField_SFInt32(e,"numTexCoordComponents",2),this.addField_SFBool(e,"normalPerVertex",!0),this.addField_SFBool(e,"idsPerVertex",!1),this.addField_SFBool(e,"compressed",!1),this._hasStrideOffset=!1,this._mesh._numPosComponents=this._vf.normalAsSphericalCoordinates?4:3,this._mesh._numTexComponents=this._vf.numTexCoordComponents,this._mesh._numColComponents=this._vf.rgbaColors?4:3,this._mesh._numNormComponents=this._vf.normalAsSphericalCoordinates?2:3;for(var t=this._vertexCountSum=0;t<this._vf.vertexCount.length;++t)this._vertexCountSum+=this._vf.vertexCount[t]},{parentAdded:function(e){var t,i,o=this._vf.coord.lastIndexOf("#"),s=this._vf.coord.lastIndexOf("+");0<=o&&0<=s?(t=+this._vf.coord.substring(++o,s),i=+this._vf.coord.substring(s),e._coordStrideOffset=[i,t],this._hasStrideOffset=!0,t/8-Math.floor(t/8)==0&&(this._mesh._numPosComponents=4)):0<=s&&(i=+this._vf.coord.substring(s),e._coordStrideOffset=[i,0],i/8-Math.floor(i/8)==0)&&(this._mesh._numPosComponents=4),o=this._vf.normal.lastIndexOf("#"),s=this._vf.normal.lastIndexOf("+"),0<=o&&0<=s?(t=+this._vf.normal.substring(++o,s),i=+this._vf.normal.substring(s),e._normalStrideOffset=[i,t]):0<=s&&(i=+this._vf.normal.substring(s),e._normalStrideOffset=[i,0]),o=this._vf.texCoord.lastIndexOf("#"),s=this._vf.texCoord.lastIndexOf("+"),0<=o&&0<=s?(t=+this._vf.texCoord.substring(++o,s),i=+this._vf.texCoord.substring(s),e._texCoordStrideOffset=[i,t]):0<=s&&(i=+this._vf.texCoord.substring(s),e._texCoordStrideOffset=[i,0]),o=this._vf.color.lastIndexOf("#"),s=this._vf.color.lastIndexOf("+"),0<=o&&0<=s?(t=+this._vf.color.substring(++o,s),i=+this._vf.color.substring(s),e._colorStrideOffset=[i,t]):0<=s&&(i=+this._vf.color.substring(s),e._colorStrideOffset=[i,0]),"Uint16"==this._vf.indexType||x3dom.caps.INDEX_UINT||x3dom.debug.logWarning("Index type "+this._vf.indexType+" problematic")},doIntersect:function(e){var t=this.getMin(),i=this.getMax();return!!(e.intersect(t,i)&&e.enter<e.dist)&&(e.dist=e.enter,e.hitObject=this,e.hitPoint=e.pos.add(e.dir.multiply(e.enter)),!0)},getPrecisionMax:function(e){switch(this._vf[e]){case"Int8":return 127;case"Uint8":return 255;case"Int16":return 32767;case"Uint16":return 65535;case"Int32":return 2147483647;case"Uint32":return 4294967295;default:return 1}}})),x3dom.registerNodeType("PopGeometryLevel","Geometry3D",defineClass(x3dom.nodeTypes.X3DGeometricPropertyNode,function(e){x3dom.nodeTypes.PopGeometryLevel.superClass.call(this,e),this.addField_SFString(e,"src",""),this.addField_SFInt32(e,"numIndices",0),this.addField_SFInt32(e,"vertexDataBufferOffset",0)},{getSrc:function(){return this._vf.src},getNumIndices:function(){return this._vf.numIndices},getVertexDataBufferOffset:function(){return this._vf.vertexDataBufferOffset}})),x3dom.registerNodeType("PopGeometry","Geometry3D",defineClass(x3dom.nodeTypes.X3DBinaryContainerGeometryNode,function(e){x3dom.nodeTypes.PopGeometry.superClass.call(this,e),this.addField_SFVec3f(e,"tightSize",1,1,1),this.addField_SFVec3f(e,"maxBBSize",1,1,1),this.addField_SFVec3f(e,"bbMinModF",0,0,0),this.addField_SFVec3f(e,"bbMaxModF",1,1,1),this.addField_SFVec3f(e,"bbMin",0,0,0),this.addField_SFVec3f(e,"bbShiftVec",0,0,0),this._vf.bbMinModF.x>this._vf.bbMaxModF.x&&(this._vf.bbShiftVec.x=1),this._vf.bbMinModF.y>this._vf.bbMaxModF.y&&(this._vf.bbShiftVec.y=1),this._vf.bbMinModF.z>this._vf.bbMaxModF.z&&(this._vf.bbShiftVec.z=1),this.addField_MFNode("levels",x3dom.nodeTypes.PopGeometryLevel),this.addField_SFInt32(e,"attributeStride",0),this.addField_SFInt32(e,"positionOffset",0),this.addField_SFInt32(e,"normalOffset",0),this.addField_SFInt32(e,"texcoordOffset",0),this.addField_SFInt32(e,"colorOffset",0),this.addField_SFInt32(e,"numAnchorVertices",0),this.addField_SFInt32(e,"positionPrecision",2),this.addField_SFInt32(e,"normalPrecision",1),this.addField_SFInt32(e,"texcoordPrecision",2),this.addField_SFInt32(e,"colorPrecision",1),this.addField_SFInt32(e,"minPrecisionLevel",-1),this.addField_SFInt32(e,"maxPrecisionLevel",-1),this.addField_SFFloat(e,"precisionFactor",1),this.addField_SFString(e,"coordType","Uint16"),this.addField_SFString(e,"normalType","Uint8"),this.addField_SFString(e,"texCoordType","Uint16"),this.addField_SFString(e,"colorType","Uint8"),this.addField_SFInt32(e,"vertexBufferSize",0),this.addField_SFBool(e,"indexedRendering",!0),this.addField_SFBool(e,"sphericalNormals",!1),this.addField_MFInt32(e,"originalVertexCount",[0]);for(var t=0;t<this._vf.vertexCount.length;++t)this._vf.originalVertexCount[t]=this._vf.vertexCount[t];this._vf.maxBBSize=x3dom.fields.SFVec3f.copy(this._vf.size),this._vf.size=this._vf.tightSize,this._diameter=this._vf.size.length(),this._bbMinBySize=[Math.floor(this._vf.bbMin.x/this._vf.maxBBSize.x),Math.floor(this._vf.bbMin.y/this._vf.maxBBSize.y),Math.floor(this._vf.bbMin.z/this._vf.maxBBSize.z)],this._volRadius=this._vf.size.length()/2,this._volLargestRadius=this._vf.maxBBSize.length()/2,this._mesh._numPosComponents=this._vf.sphericalNormals?4:3,this._mesh._numNormComponents=this._vf.sphericalNormals?2:3,this._mesh._numTexComponents=2,this._mesh._numColComponents=3,x3dom.nodeTypes.PopGeometry.numTotalVerts+=this.getVertexCount(),x3dom.nodeTypes.PopGeometry.numTotalTris+=(this.hasIndex()?this.getTotalNumberOfIndices():this.getVertexCount())/3},{forceUpdateCoverage:function(){return!0},getBBoxShiftVec:function(){return this._vf.bbShiftVec},getBBoxSize:function(){return this._vf.size},hasIndex:function(){return this._vf.indexedRendering},getTotalNumberOfIndices:function(){if(this._vf.indexedRendering){for(var e=0,t=0;t<this._vf.originalVertexCount.length;++t)e+=this._vf.originalVertexCount[t];return e}return 0},getVertexCount:function(){for(var e=0,t=0;t<this._vf.originalVertexCount.length;++t)e+=this._vf.originalVertexCount[t];return e},adaptVertexCount:function(e){for(var t=0,i=0;i<this._vf.originalVertexCount.length;++i){if(!(this._vf.originalVertexCount[i]+t<=e)){this._vf.vertexCount[i]=e-t;break}this._vf.vertexCount[i]=this._vf.originalVertexCount[i],t+=this._vf.originalVertexCount[i]}},hasNormal:function(){return 0!=this._vf.normalOffset&&!this._vf.sphericalNormals},hasTexCoord:function(){return 0!=this._vf.texcoordOffset},hasColor:function(){return 0!=this._vf.colorOffset},getPositionPrecision:function(){return this._vf.positionPrecision},getNormalPrecision:function(){return this._vf.normalPrecision},getTexCoordPrecision:function(){return this._vf.texcoordPrecision},getColorPrecision:function(){return this._vf.colorPrecision},getAttributeStride:function(){return this._vf.attributeStride},getPositionOffset:function(){return this._vf.positionOffset},getNormalOffset:function(){return this._vf.normalOffset},getTexCoordOffset:function(){return this._vf.texcoordOffset},getColorOffset:function(){return this._vf.colorOffset},getBufferTypeStringFromByteCount:function(e){switch(e){case 1:return"Uint8";case 2:return"Uint16";default:return 0}},getDataURLs:function(){for(var e=[],t=0;t<this._cf.levels.nodes.length;++t)e.push(this._cf.levels.nodes[t].getSrc());return e},getNumIndicesByLevel:function(e){return this._cf.levels.nodes[e].getNumIndices()},getNumLevels:function(e){return this._cf.levels.nodes.length},getVertexDataBufferOffset:function(e){return this._cf.levels.nodes[e].getVertexDataBufferOffset()},getPrecisionMax:function(e){switch(this._vf[e]){case"Uint8":return 255;case"Uint16":return 65535;default:return 1}}})),x3dom.nodeTypes.PopGeometry.ErrorToleranceFactor=1,x3dom.nodeTypes.PopGeometry.PrecisionFactorOnMove=1,x3dom.nodeTypes.PopGeometry.numRenderedVerts=0,x3dom.nodeTypes.PopGeometry.numRenderedTris=0,x3dom.nodeTypes.PopGeometry.numTotalVerts=0,x3dom.nodeTypes.PopGeometry.numTotalTris=0,x3dom.nodeTypes.PopGeometry.powLUT=[32768,16384,8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1],x3dom.registerNodeType("IndexedFaceSet","Geometry3D",defineClass(x3dom.nodeTypes.X3DComposedGeometryNode,function(e){x3dom.nodeTypes.IndexedFaceSet.superClass.call(this,e),this.addField_SFFloat(e,"creaseAngle",0),this.addField_SFBool(e,"convex",!0),this.addField_MFInt32(e,"coordIndex",[]),this.addField_MFInt32(e,"normalIndex",[]),this.addField_MFInt32(e,"colorIndex",[]),this.addField_MFInt32(e,"texCoordIndex",[])},{nodeChanged:function(){(new Date).getTime(),this.handleAttribs();var e=this._vf.coordIndex;e.length&&-1!=e[e.length-1]&&e.push(-1);var t,i,o,s=this._vf.normalIndex,n=this._vf.texCoordIndex,r=this._vf.colorIndex,a=!1,d=!1,l=!1,h=!1,u=!1,f=!1,c=this._vf.colorPerVertex,_=this._vf.normalPerVertex,m=(0<s.length&&(d=!0),0<n.length&&(h=!0),0<r.length&&(f=!0),this._cf.coord.node),m=(x3dom.debug.assert(m),t=m.getPoints(),this._cf.normal.node),m=(m?(a=!0,i=m._vf.vector):a=!1,""),p=2,x=this._cf.texCoord.node;if(x=x3dom.isa(x,x3dom.nodeTypes.MultiTextureCoordinate)&&x._cf.texCoord.nodes.length?x._cf.texCoord.nodes[0]:x)if(x._vf.point){for(var l=!0,g=x._vf.point,L=h?Math.max(...n)+1:t.length,O=g.length,v=O;v<L;v++)x3dom.debug.logWarning("IFS "+(this._DEF||"")+": more tex. coords. required, guessing "+v+"1th coord."),g.push(g[v%O]);x3dom.isa(x,x3dom.nodeTypes.TextureCoordinate3D)&&(p=3)}else x._vf.mode&&(m=x._vf.mode);else l=!1;this._mesh._numTexComponents=p;var v,y,T,b,S,F,E,M,B,C,w,A,R,D,N=3,x=this._cf.color.node;if(x?(u=!0,o=x._vf.color,x3dom.isa(x,x3dom.nodeTypes.ColorRGBA)&&(N=4)):u=!1,this._mesh._numColComponents=N,this._mesh._indices[0]=[],this._mesh._positions[0]=[],this._mesh._normals[0]=[],this._mesh._texCoords[0]=[],this._mesh._colors[0]=[],this._vf.creaseAngle<=x3dom.fields.Eps||t.length>x3dom.Utils.maxIndexableCoords||a&&d||l&&h||u&&f){if(this._vf.creaseAngle<=x3dom.fields.Eps&&x3dom.debug.logWarning("Fallback to inefficient multi-index mode since creaseAngle=0."),this._vf.convex)for(I=y=0,this._mesh._multiIndIndices=[],this._mesh._posSize=t.length,v=0;v<e.length;++v)if(-1!=e[v])switch(d&&x3dom.debug.assert(-1!=s[v]),h&&x3dom.debug.assert(-1!=n[v]),f&&x3dom.debug.assert(-1!=r[v]),y){case 0:T=+e[v],F=d&&_?+s[v]:d&&!_?+s[I]:_?T:I,B=h?+n[v]:T,A=f&&c?+r[v]:f&&!c?+r[I]:c?T:I,y=1;break;case 1:b=+e[v],E=d&&_?+s[v]:d&&!_?+s[I]:_?b:I,C=h?+n[v]:b,R=f&&c?+r[v]:f&&!c?+r[I]:c?b:I,y=2;break;case 2:S=+e[v],M=d&&_?+s[v]:d&&!_?+s[I]:_?S:I,w=h?+n[v]:S,D=f&&c?+r[v]:f&&!c?+r[I]:c?S:I,y=3,this._mesh._positions[0].push(t[T].x),this._mesh._positions[0].push(t[T].y),this._mesh._positions[0].push(t[T].z),this._mesh._positions[0].push(t[b].x),this._mesh._positions[0].push(t[b].y),this._mesh._positions[0].push(t[b].z),this._mesh._positions[0].push(t[S].x),this._mesh._positions[0].push(t[S].y),this._mesh._positions[0].push(t[S].z),a&&(this._mesh._normals[0].push(i[F].x),this._mesh._normals[0].push(i[F].y),this._mesh._normals[0].push(i[F].z),this._mesh._normals[0].push(i[E].x),this._mesh._normals[0].push(i[E].y),this._mesh._normals[0].push(i[E].z),this._mesh._normals[0].push(i[M].x),this._mesh._normals[0].push(i[M].y),this._mesh._normals[0].push(i[M].z)),this._mesh._multiIndIndices.push(T,b,S),u&&(this._mesh._colors[0].push(o[A].r),this._mesh._colors[0].push(o[A].g),this._mesh._colors[0].push(o[A].b),4===N&&this._mesh._colors[0].push(o[A].a),this._mesh._colors[0].push(o[R].r),this._mesh._colors[0].push(o[R].g),this._mesh._colors[0].push(o[R].b),4===N&&this._mesh._colors[0].push(o[R].a),this._mesh._colors[0].push(o[D].r),this._mesh._colors[0].push(o[D].g),this._mesh._colors[0].push(o[D].b),4===N)&&this._mesh._colors[0].push(o[D].a),l&&(this._mesh._texCoords[0].push(g[B].x),this._mesh._texCoords[0].push(g[B].y),3===p&&this._mesh._texCoords[0].push(g[B].z),this._mesh._texCoords[0].push(g[C].x),this._mesh._texCoords[0].push(g[C].y),3===p&&this._mesh._texCoords[0].push(g[C].z),this._mesh._texCoords[0].push(g[w].x),this._mesh._texCoords[0].push(g[w].y),3===p)&&this._mesh._texCoords[0].push(g[w].z);break;case 3:b=S,C=w,_&&(E=M),c&&(R=D),S=+e[v],d&&_?M=+s[v]:d&&!_||(M=_?S:I),w=h?+n[v]:S,f&&c?D=+r[v]:f&&!c||(D=c?S:I),this._mesh._positions[0].push(t[T].x),this._mesh._positions[0].push(t[T].y),this._mesh._positions[0].push(t[T].z),this._mesh._positions[0].push(t[b].x),this._mesh._positions[0].push(t[b].y),this._mesh._positions[0].push(t[b].z),this._mesh._positions[0].push(t[S].x),this._mesh._positions[0].push(t[S].y),this._mesh._positions[0].push(t[S].z),a&&(this._mesh._normals[0].push(i[F].x),this._mesh._normals[0].push(i[F].y),this._mesh._normals[0].push(i[F].z),this._mesh._normals[0].push(i[E].x),this._mesh._normals[0].push(i[E].y),this._mesh._normals[0].push(i[E].z),this._mesh._normals[0].push(i[M].x),this._mesh._normals[0].push(i[M].y),this._mesh._normals[0].push(i[M].z)),this._mesh._multiIndIndices.push(T,b,S),u&&(this._mesh._colors[0].push(o[A].r),this._mesh._colors[0].push(o[A].g),this._mesh._colors[0].push(o[A].b),4===N&&this._mesh._colors[0].push(o[A].a),this._mesh._colors[0].push(o[R].r),this._mesh._colors[0].push(o[R].g),this._mesh._colors[0].push(o[R].b),4===N&&this._mesh._colors[0].push(o[R].a),this._mesh._colors[0].push(o[D].r),this._mesh._colors[0].push(o[D].g),this._mesh._colors[0].push(o[D].b),4===N)&&this._mesh._colors[0].push(o[D].a),l&&(this._mesh._texCoords[0].push(g[B].x),this._mesh._texCoords[0].push(g[B].y),3===p&&this._mesh._texCoords[0].push(g[B].z),this._mesh._texCoords[0].push(g[C].x),this._mesh._texCoords[0].push(g[C].y),3===p&&this._mesh._texCoords[0].push(g[C].z),this._mesh._texCoords[0].push(g[w].x),this._mesh._texCoords[0].push(g[w].y),3===p)&&this._mesh._texCoords[0].push(g[w].z)}else y=0,I++;else{var U=new x3dom.DoublyLinkedList,X={},I=0;for(this._mesh._multiIndIndices=[],v=0;v<e.length;++v)if(-1!=e[v])a&&(X.normals=d&&_?i[s[v]]:d&&!_?i[s[I]]:i[e[v]]),u&&(X.colors=f&&c?o[r[v]]:f&&!c?o[r[I]]:c?o[e[v]]:o[I]),l&&(X.texCoords=h?g[n[v]]:g[e[v]]),U.appendNode(new x3dom.DoublyLinkedList.ListNode(t[e[v]],e[v],X.normals,X.colors,X.texCoords));else{for(var P=x3dom.EarClipping.getMultiIndexes(U),V=0;V<P.indices.length;V++)this._mesh._multiIndIndices.push(P.indices[V]),this._mesh._positions[0].push(P.point[V].x,P.point[V].y,P.point[V].z),a&&this._mesh._normals[0].push(P.normals[V].x,P.normals[V].y,P.normals[V].z),u&&(this._mesh._colors[0].push(P.colors[V].r,P.colors[V].g,P.colors[V].b),4===N)&&this._mesh._colors[0].push(P.colors[V].a),l&&(this._mesh._texCoords[0].push(P.texCoords[V].x,P.texCoords[V].y),3===p)&&this._mesh._texCoords[0].push(P.texCoords[V].z);U=new x3dom.DoublyLinkedList,I++}this._mesh.splitMesh()}a||this._mesh.calcNormals(this._vf.creaseAngle,this._vf.ccw),l||this._mesh.calcTexCoords(m)}else{if(y=0,this._vf.convex)for(v=0;v<e.length;++v)if(-1!=e[v])switch(y){case 0:F=+e[v],y=1;break;case 1:E=+e[v],y=2;break;case 2:M=+e[v],y=3,this._mesh._indices[0].push(F,E,M);break;case 3:E=M,M=+e[v],this._mesh._indices[0].push(F,E,M)}else y=0;else for(U=new x3dom.DoublyLinkedList,v=0;v<e.length;++v)if(-1!=e[v])U.appendNode(new x3dom.DoublyLinkedList.ListNode(t[e[v]],e[v]));else{var k=x3dom.EarClipping.getIndexes(U);for(V=0;V<k.length;V++)this._mesh._indices[0].push(k[V]);U=new x3dom.DoublyLinkedList}this._mesh._positions[0]=t.toGL(),a?this._mesh._normals[0]=i.toGL():this._mesh.calcNormals(this._vf.creaseAngle,this._vf.ccw),l?(this._mesh._texCoords[0]=g.toGL(),this._mesh._numTexComponents=p):this._mesh.calcTexCoords(m),u&&(this._mesh._colors[0]=o.toGL(),this._mesh._numColComponents=N)}for(this.invalidateVolume(),this._mesh._numFaces=0,v=this._mesh._numCoords=0;v<this._mesh._positions.length;v++){var G=this._mesh._indices[v].length,z=this._mesh._positions[v].length/3;this._mesh._numCoords+=z,this._mesh._numFaces+=0<G?G/3:z/3}},fieldChanged:function(e){if("coord"==e||"normal"==e||"texCoord"==e||"color"==e||"coordIndex"==e){var t=this._cf.coord.node._vf.point,L=t.length,i=this._cf.texCoord.node;if(x3dom.isa(i,x3dom.nodeTypes.MultiTextureCoordinate)&&i._cf.texCoord.nodes.length&&(i=i._cf.texCoord.nodes[0]),(this._vf.creaseAngle<=x3dom.fields.Eps||L>x3dom.Utils.maxIndexableCoords||0<this._vf.normalIndex.length&&this._cf.normal.node||0<this._vf.texCoordIndex.length&&i||0<this._vf.colorIndex.length&&this._cf.color.node)&&this._mesh._multiIndIndices){var o=!this._cf.normal.node&&"none"!=this._vf.normalUpdateMode.toLowerCase(),L=this._mesh._multiIndIndices.length;if(this._mesh._positions[0]=[],this._mesh._indices[0]=[],"coord"==e&&L){for(v=0;v<L;v+=3){var O=this._mesh._multiIndIndices[v],B=this._mesh._multiIndIndices[v+1],U=this._mesh._multiIndIndices[v+2],O=t[O],B=t[B],U=t[U];this._mesh._positions[0].push(O.x,O.y,O.z),this._mesh._positions[0].push(B.x,B.y,B.z),this._mesh._positions[0].push(U.x,U.y,U.z)}o&&this._mesh.calcNormals(this._vf.creaseAngle,this._vf.ccw),this.invalidateVolume(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,o&&(e._dirty.normals=!0)})}else{this._mesh._normals[0]=[],this._mesh._texCoords[0]=[],this._mesh._colors[0]=[];var s,n,r,a=this._vf.coordIndex,d=this._vf.normalIndex,l=this._vf.texCoordIndex,h=this._vf.colorIndex,u=!1,f=!1,X=!1,c=!1,k=!1,_=!1,m=this._vf.colorPerVertex,p=this._vf.normalPerVertex,G=(0<d.length&&(f=!0),0<l.length&&(c=!0),0<h.length&&(_=!0),this._cf.coord.node),G=(x3dom.debug.assert(G),s=G.getPoints(),this._cf.normal.node),G=(G?(u=!0,n=G._vf.vector):u=!1,""),x=2,i=this._cf.texCoord.node;if(i=x3dom.isa(i,x3dom.nodeTypes.MultiTextureCoordinate)&&i._cf.texCoord.nodes.length?i._cf.texCoord.nodes[0]:i)if(i._vf.point){for(var X=!0,g=i._vf.point,z=c?Math.max(...l)+1:s.length,H=g.length,v=H;v<z;v++)g.push(g[v%H]);x3dom.isa(i,x3dom.nodeTypes.TextureCoordinate3D)&&(x=3)}else i._vf.mode&&(G=i._vf.mode);else X=!1;this._mesh._numTexComponents=x;var v,y,T,b,S,F,E,M,j,C,w,A,R,D,N=3,W=this._cf.color.node;if(W?(k=!0,r=W._vf.color,x3dom.isa(W,x3dom.nodeTypes.ColorRGBA)&&(N=4)):k=!1,this._mesh._numColComponents=N,this._vf.convex)for(I=Q=y=0,this._mesh._multiIndIndices=[],this._mesh._posSize=s.length,v=0;v<a.length;++v)if(-1!=a[v])switch(f&&x3dom.debug.assert(-1!=d[v]),c&&x3dom.debug.assert(-1!=l[v]),_&&x3dom.debug.assert(-1!=h[v]),y){case 0:T=+a[v],F=f&&p?+d[v]:f&&!p?+d[I]:p?T:I,j=c?+l[v]:T,A=_&&m?+h[v]:_&&!m?+h[I]:m?T:I,y=1;break;case 1:b=+a[v],E=f&&p?+d[v]:f&&!p?+d[I]:p?b:I,C=c?+l[v]:b,R=_&&m?+h[v]:_&&!m?+h[I]:m?b:I,y=2;break;case 2:S=+a[v],M=f&&p?+d[v]:f&&!p?+d[I]:p?S:I,w=c?+l[v]:S,D=_&&m?+h[v]:_&&!m?+h[I]:m?S:I,y=3,this._mesh._positions[0].push(s[T].x),this._mesh._positions[0].push(s[T].y),this._mesh._positions[0].push(s[T].z),this._mesh._positions[0].push(s[b].x),this._mesh._positions[0].push(s[b].y),this._mesh._positions[0].push(s[b].z),this._mesh._positions[0].push(s[S].x),this._mesh._positions[0].push(s[S].y),this._mesh._positions[0].push(s[S].z),u&&(this._mesh._normals[0].push(n[F].x),this._mesh._normals[0].push(n[F].y),this._mesh._normals[0].push(n[F].z),this._mesh._normals[0].push(n[E].x),this._mesh._normals[0].push(n[E].y),this._mesh._normals[0].push(n[E].z),this._mesh._normals[0].push(n[M].x),this._mesh._normals[0].push(n[M].y),this._mesh._normals[0].push(n[M].z)),this._mesh._multiIndIndices.push(T,b,S),k&&(this._mesh._colors[0].push(r[A].r),this._mesh._colors[0].push(r[A].g),this._mesh._colors[0].push(r[A].b),4===N&&this._mesh._colors[0].push(r[A].a),this._mesh._colors[0].push(r[R].r),this._mesh._colors[0].push(r[R].g),this._mesh._colors[0].push(r[R].b),4===N&&this._mesh._colors[0].push(r[R].a),this._mesh._colors[0].push(r[D].r),this._mesh._colors[0].push(r[D].g),this._mesh._colors[0].push(r[D].b),4===N)&&this._mesh._colors[0].push(r[D].a),X&&(this._mesh._texCoords[0].push(g[j].x),this._mesh._texCoords[0].push(g[j].y),3===x&&this._mesh._texCoords[0].push(g[j].z),this._mesh._texCoords[0].push(g[C].x),this._mesh._texCoords[0].push(g[C].y),3===x&&this._mesh._texCoords[0].push(g[C].z),this._mesh._texCoords[0].push(g[w].x),this._mesh._texCoords[0].push(g[w].y),3===x)&&this._mesh._texCoords[0].push(g[w].z);break;case 3:b=S,C=w,p&&(E=M),m&&(R=D),S=+a[v],f&&p?M=+d[v]:f&&!p||(M=p?S:I),w=c?+l[v]:S,_&&m?D=+h[v]:_&&!m||(D=m?S:I),this._mesh._positions[0].push(s[T].x),this._mesh._positions[0].push(s[T].y),this._mesh._positions[0].push(s[T].z),this._mesh._positions[0].push(s[b].x),this._mesh._positions[0].push(s[b].y),this._mesh._positions[0].push(s[b].z),this._mesh._positions[0].push(s[S].x),this._mesh._positions[0].push(s[S].y),this._mesh._positions[0].push(s[S].z),u&&(this._mesh._normals[0].push(n[F].x),this._mesh._normals[0].push(n[F].y),this._mesh._normals[0].push(n[F].z),this._mesh._normals[0].push(n[E].x),this._mesh._normals[0].push(n[E].y),this._mesh._normals[0].push(n[E].z),this._mesh._normals[0].push(n[M].x),this._mesh._normals[0].push(n[M].y),this._mesh._normals[0].push(n[M].z)),this._mesh._multiIndIndices.push(T,b,S),k&&(this._mesh._colors[0].push(r[A].r),this._mesh._colors[0].push(r[A].g),this._mesh._colors[0].push(r[A].b),4===N&&this._mesh._colors[0].push(r[A].a),this._mesh._colors[0].push(r[R].r),this._mesh._colors[0].push(r[R].g),this._mesh._colors[0].push(r[R].b),4===N&&this._mesh._colors[0].push(r[R].a),this._mesh._colors[0].push(r[D].r),this._mesh._colors[0].push(r[D].g),this._mesh._colors[0].push(r[D].b),4===N)&&this._mesh._colors[0].push(r[D].a),X&&(this._mesh._texCoords[0].push(g[j].x),this._mesh._texCoords[0].push(g[j].y),3===x&&this._mesh._texCoords[0].push(g[j].z),this._mesh._texCoords[0].push(g[C].x),this._mesh._texCoords[0].push(g[C].y),3===x&&this._mesh._texCoords[0].push(g[C].z),this._mesh._texCoords[0].push(g[w].x),this._mesh._texCoords[0].push(g[w].y),3===x)&&this._mesh._texCoords[0].push(g[w].z)}else y=0,I++;else{var Y=new x3dom.DoublyLinkedList,q={},Q=0,I=0;for(v=0;v<a.length;++v)if(-1!=a[v])u&&(q.normals=f&&p?n[d[v]]:f&&!p?n[d[I]]:n[a[v]]),k&&(q.colors=_&&m?r[h[v]]:_&&!m?r[h[I]]:r[a[v]]),X&&(q.texCoords=c?g[l[v]]:g[a[v]]),Y.appendNode(new x3dom.DoublyLinkedList.ListNode(s[a[v]],a[v],q.normals,q.colors,q.texCoords));else{for(var P=x3dom.EarClipping.getMultiIndexes(Y),V=0;V<P.indices.length;V++)this._mesh._indices[0].push(Q),Q++,this._mesh._positions[0].push(P.point[V].x,P.point[V].y,P.point[V].z),u&&this._mesh._normals[0].push(P.normals[V].x,P.normals[V].y,P.normals[V].z),k&&(this._mesh._colors[0].push(P.colors[V].r,P.colors[V].g,P.colors[V].b),4===N)&&this._mesh._colors[0].push(P.colors[V].a),X&&(this._mesh._texCoords[0].push(P.texCoords[V].x,P.texCoords[V].y),3===x)&&this._mesh._texCoords[0].push(P.texCoords[V].z);Y=new x3dom.DoublyLinkedList,I++}this._mesh.splitMesh()}for(u||this._mesh.calcNormals(this._vf.creaseAngle,this._vf.ccw),X||this._mesh.calcTexCoords(G),this.invalidateVolume(),this._mesh._numFaces=0,v=this._mesh._numCoords=0;v<this._mesh._positions.length;v++){var K=this._mesh._indices[v].length,Z=this._mesh._positions[v].length/3;this._mesh._numCoords+=Z,this._mesh._numFaces+=0<K?K/3:Z/3}this._parentNodes.forEach(function(e){e.setGeoDirty()})}}else if("coord"==e)o=!this._cf.normal.node&&"none"!=this._vf.normalUpdateMode.toLowerCase(),this._mesh._positions[0]=t.toGL(),o&&this._mesh.calcNormals(this._vf.creaseAngle,this._vf.ccw),this.invalidateVolume(),this._parentNodes.forEach(function(e){e._dirty.positions=!0,o&&(e._dirty.normals=!0),e.invalidateVolume()});else if("color"==e)t=this._cf.color.node._vf.color,this._mesh._colors[0]=t.toGL(),this._parentNodes.forEach(function(e){e._dirty.colors=!0});else if("normal"==e)t=this._cf.normal.node._vf.vector,this._mesh._normals[0]=t.toGL(),this._parentNodes.forEach(function(e){e._dirty.normals=!0});else if("texCoord"==e)i=this._cf.texCoord.node,t=(i=x3dom.isa(i,x3dom.nodeTypes.MultiTextureCoordinate)&&i._cf.texCoord.nodes.length?i._cf.texCoord.nodes[0]:i)._vf.point,this._mesh._texCoords[0]=t.toGL(),this._parentNodes.forEach(function(e){e._dirty.texcoords=!0});else if("coordIndex"==e){for(o=!this._cf.normal.node&&"none"!=this._vf.normalUpdateMode.toLowerCase(),L=(a=this._vf.coordIndex).length,this._mesh._indices[y=0]=[],v=0;v<L;++v)if(-1==a[v])y=0;else switch(y){case 0:T=+a[v],y=1;break;case 1:b=+a[v],y=2;break;case 2:S=+a[v],y=3,this._mesh._indices[0].push(T,b,S);break;case 3:b=S,S=+a[v],this._mesh._indices[0].push(T,b,S)}o&&this._mesh.calcNormals(this._vf.creaseAngle,this._vf.ccw),this._parentNodes.forEach(function(e){e._dirty.indexes=!0,o&&(e._dirty.normals=!0)})}}else x3dom.debug.logWarning("IndexedFaceSet: fieldChanged for "+e+" not yet implemented!")}})),x3dom.registerNodeType("BufferGeometry","Geometry3D",defineClass(x3dom.nodeTypes.X3DBinaryContainerGeometryNode,function(e){x3dom.nodeTypes.BufferGeometry.superClass.call(this,e),this.addField_SFString(e,"buffer",""),this.addField_SFBool(e,"draco",!1),this.addField_MFNode("views",x3dom.nodeTypes.BufferView),this.addField_MFNode("accessors",x3dom.nodeTypes.BufferAccessor),this._hasColor=!1,this._hasMultiTexCoord=!1,this._indexed=!1},{parentAdded:function(e){},nodeChanged:function(){},doIntersect:function(e){var t=this.getMin(),i=this.getMax();return!!(e.intersect(t,i)&&e.enter<e.dist)&&(e.dist=e.enter,e.hitObject=this,e.hitPoint=e.pos.add(e.dir.multiply(e.enter)),!0)},hasColor:function(){return this._hasColor},hasMultiTexCoord:function(){return this._hasMultiTexCoord},getPrecisionMax:function(e){switch(this._vf[e]){case"Int8":return 127;case"Uint8":return 255;case"Int16":return 32767;case"Uint16":return 65535;case"Int32":return 2147483647;case"Uint32":return 4294967295;default:return 1}}})),x3dom.registerNodeType("BufferView","Geometry3D",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BufferView.superClass.call(this,e),this.addField_SFInt32(e,"target",34962),this.addField_SFInt32(e,"byteOffset",0),this.addField_SFInt32(e,"byteStride",0),this.addField_SFInt32(e,"byteLength",0),this.addField_SFInt32(e,"idx",0),this.addField_SFInt32(e,"dracoId",0)},{parentAdded:function(e){}})),x3dom.registerNodeType("BufferAccessor","Geometry3D",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BufferAccessor.superClass.call(this,e),this.addField_SFString(e,"bufferType",""),this.addField_SFInt32(e,"view",0),this.addField_SFInt32(e,"byteOffset",0),this.addField_SFInt32(e,"byteStride",0),this.addField_SFInt32(e,"components",0),this.addField_SFInt32(e,"componentType",5126),this.addField_SFInt32(e,"count",0),this.addField_SFBool(e,"normalized",!1)},{parentAdded:function(e){switch(this._vf.bufferType){case"COLOR_0":case"COLOR":e._hasColor=!0;break;case"INDEX":e._indexed=!0;break;case"TEXCOORD_1":e._hasMultiTexCoord=!0}}})),x3dom.registerNodeType("X3DTexture3DNode","Texturing3D",defineClass(x3dom.nodeTypes.X3DTextureNode,function(e){x3dom.nodeTypes.X3DTexture3DNode.superClass.call(this,e)})),x3dom.registerNodeType("ComposedTexture3D","Texturing3D",defineClass(x3dom.nodeTypes.X3DTexture3DNode,function(e){x3dom.nodeTypes.ComposedTexture3D.superClass.call(this,e),this.addField_MFNode("texture",x3dom.nodeTypes.X3DTexture3DNode)})),x3dom.registerNodeType("ImageTexture3D","Texturing3D",defineClass(x3dom.nodeTypes.X3DTexture3DNode,function(e){x3dom.nodeTypes.ImageTexture3D.superClass.call(this,e)})),x3dom.registerNodeType("PixelTexture3D","Texturing3D",defineClass(x3dom.nodeTypes.X3DTexture3DNode,function(e){x3dom.nodeTypes.PixelTexture3D.superClass.call(this,e)})),x3dom.registerNodeType("TextureCoordinate3D","Texturing3D",defineClass(x3dom.nodeTypes.X3DTextureCoordinateNode,function(e){x3dom.nodeTypes.TextureCoordinate3D.superClass.call(this,e),this.addField_MFVec3f(e,"point",[])})),x3dom.registerNodeType("TextureTransform3D","Texturing3D",defineClass(x3dom.nodeTypes.X3DTextureTransformNode,function(e){x3dom.nodeTypes.TextureTransform3D.superClass.call(this,e),this.addField_SFVec3f(e,"center",0,0,0),this.addField_SFRotation(e,"rotation",0,0,1,0),this.addField_SFVec3f(e,"scale",1,1,1),this.addField_SFVec3f(e,"translation",0,0,0),this.addField_SFRotation(e,"scaleOrientation",0,0,1,0)})),x3dom.registerNodeType("TextureTransformMatrix3D","Texturing3D",defineClass(x3dom.nodeTypes.X3DTextureTransformNode,function(e){x3dom.nodeTypes.TextureTransformMatrix3D.superClass.call(this,e),this.addField_SFMatrix4f(e,"matrix",1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)})),x3dom.registerNodeType("X3DPointingDeviceSensorNode","PointingDeviceSensor",defineClass(x3dom.nodeTypes.X3DSensorNode,function(e){x3dom.nodeTypes.X3DPointingDeviceSensorNode.superClass.call(this,e),this._isOver=!1},{pointerPressedOverSibling:function(e){this._vf.enabled&&(this._vf.isActive=!0,this.postMessage("isActive",!0),this._isOver=!0)},pointerMoved:function(e){},pointerMovedOver:function(e){this._vf.enabled&&this.postMessage("isOver",!0)},pointerMovedOut:function(e){this._vf.enabled&&(this.postMessage("isOver",!1),this._isOver=!1)},pointerReleased:function(){this._vf.enabled&&(this._vf.isActive=!1,this.postMessage("isActive",!1),this._isOver)&&this.postMessage("touchTime",Date.now()/1e3)}})),x3dom.registerNodeType("X3DDragSensorNode","PointingDeviceSensor",defineClass(x3dom.nodeTypes.X3DPointingDeviceSensorNode,function(e){x3dom.nodeTypes.X3DDragSensorNode.superClass.call(this,e),this.addField_SFBool(e,"autoOffset",!0),this._lastX=-1,this._lastY=-1},{pointerPressedOverSibling:function(e){x3dom.nodeTypes.X3DPointingDeviceSensorNode.prototype.pointerPressedOverSibling.call(this,e),this._lastX=e.layerX,this._lastY=e.layerY,this._startDragging(e.viewarea,e.layerX,e.layerX,e.worldX,e.worldY,e.worldZ)},pointerMoved:function(e){x3dom.nodeTypes.X3DPointingDeviceSensorNode.prototype.pointerMoved.call(this,e),this._vf.isActive&&this._vf.enabled&&this._process2DDrag(e.layerX,e.layerY,e.layerX-this._lastX,e.layerY-this._lastY)},pointerReleased:function(){x3dom.nodeTypes.X3DPointingDeviceSensorNode.prototype.pointerReleased.call(this),this._stopDragging()},_startDragging:function(e,t,i,o,s,n){},_process2DDrag:function(e,t,i,o){},_stopDragging:function(){}})),x3dom.registerNodeType("X3DTouchSensorNode","PointingDeviceSensor",defineClass(x3dom.nodeTypes.X3DPointingDeviceSensorNode,function(e){x3dom.nodeTypes.X3DTouchSensorNode.superClass.call(this,e)},{})),x3dom.registerNodeType("TouchSensor","PointingDeviceSensor",defineClass(x3dom.nodeTypes.X3DTouchSensorNode,function(e){x3dom.nodeTypes.TouchSensor.superClass.call(this,e),this._hitPoint=new x3dom.fields.SFVec3f,this._hitNormal=new x3dom.fields.SFVec3f,this._hitRotation=new x3dom.fields.Quaternion,this._up=new x3dom.fields.SFVec3f(0,1,0)},{pointerMoved:function(e){this._vf.enabled&&(this.postMessage("hitPoint_changed",this._hitPoint.fromArray(e.hitPnt)),this._hitNormal.set(e.normalX,e.normalY,e.normalZ),this.postMessage("hitNormal_changed",this._hitNormal),this.postMessage("hitRotation_changed",x3dom.fields.Quaternion.rotateFromTo(this._up,this._hitNormal)))}})),x3dom.registerNodeType("PlaneSensor","PointingDeviceSensor",defineClass(x3dom.nodeTypes.X3DDragSensorNode,function(e){x3dom.nodeTypes.PlaneSensor.superClass.call(this,e),this.addField_SFRotation(e,"axisRotation",0,0,1,0),this.addField_SFVec2f(e,"minPosition",0,0),this.addField_SFVec2f(e,"maxPosition",-1,-1),this.addField_SFVec3f(e,"offset",0,0,0),this.addField_SFString(e,"planeOrientation","XY"),this._rotationMatrix=this._vf.axisRotation.toMatrix(),this._worldToLocalMatrix=null,this._initialPlaneIntersection=null,this._planeNormal=null,this._viewArea=null,this._currentTranslation=new x3dom.fields.SFVec3f(0,0,0),this._lineModeAxis=null,this._vf.minPosition.x==this._vf.maxPosition.x&&(this._lineModeAxis=new x3dom.fields.SFVec3f(0,1,0)),this._vf.minPosition.y==this._vf.maxPosition.y&&(this._lineModeAxis=new x3dom.fields.SFVec3f(1,0,0))},{getCurrentTransform:function(){var e=x3dom.nodeTypes.X3DDragSensorNode.prototype.getCurrentTransform.call(this);return this._rotationMatrix.mult(e)},_startDragging:function(e,t,i,o,s,n){var r;x3dom.nodeTypes.X3DDragSensorNode.prototype._startDragging.call(this,e,t,i,o,s,n),this._viewArea=e,this._viewMat=this._viewArea.getViewMatrix(),this._viewMatInv=this._viewMat.inverse(),this._currentTranslation=new x3dom.fields.SFVec3f(0,0,0).add(this._vf.offset),this._localToWorldMatrix=this.getCurrentTransform(),this._worldToLocalMatrix=this._localToWorldMatrix.inverse(),this._initialPlaneIntersection=this._worldToLocalMatrix.multMatrixPnt(new x3dom.fields.SFVec3f(o,s,n)),this._planeNormal=new x3dom.fields.SFVec3f(0,0,1),"screen"==this._vf.planeOrientation?(r=e.calcViewRay(e._width/2,e._height/2),this._planeNormal=this._worldToLocalMatrix.multMatrixVec(r.dir.normalize())):this._lineModeAxis&&(r=e.calcViewRay(t,i),o=this._worldToLocalMatrix.multMatrixVec(r.dir.normalize()),s=this._lineModeAxis,this._planeNormal=s.cross(s.cross(o)))},_process2DDrag:function(e,t,i,o){x3dom.nodeTypes.X3DDragSensorNode.prototype._process2DDrag.call(this,e,t,i,o);i=null;function s(e,t,i){t.x<=i.x&&(e.x=Math.min(e.x,i.x),e.x=Math.max(e.x,t.x)),t.y<=i.y&&(e.y=Math.min(e.y,i.y),e.y=Math.max(e.y,t.y))}this._initialPlaneIntersection&&((o=this._viewArea.calcViewRay(e,t)).pos=this._worldToLocalMatrix.multMatrixPnt(o.pos),o.dir=this._worldToLocalMatrix.multMatrixVec(o.dir.normalize()),Math.abs(this._planeNormal.dot(o.dir))<.1||(i=(i=o.intersectPlane(this._initialPlaneIntersection,this._planeNormal))||o.intersectPlane(this._initialPlaneIntersection,this._planeNormal.negate()))&&(this._currentTranslation=i.subtract(this._initialPlaneIntersection),this._currentTranslation=this._currentTranslation.add(this._vf.offset),e=this._vf.minPosition,t=this._vf.maxPosition,"screen"==this._vf.planeOrientation?(e.x<=t.x||e.y<=t.y)&&(o=this._localToWorldMatrix.multMatrixVec(this._currentTranslation),s(o=this._viewMat.multMatrixVec(o),e,t),o=this._viewMatInv.multMatrixVec(o),this._currentTranslation=this._worldToLocalMatrix.multMatrixVec(o)):(s(this._currentTranslation,e,t),this._currentTranslation.z=0),this.postMessage("translation_changed",x3dom.fields.SFVec3f.copy(this._currentTranslation)),this.postMessage("trackPoint_changed",i)))},_stopDragging:function(){x3dom.nodeTypes.X3DDragSensorNode.prototype._stopDragging.call(this),this._vf.autoOffset&&(this._vf.offset=x3dom.fields.SFVec3f.copy(this._currentTranslation),this.postMessage("offset_changed",this._vf.offset))}})),x3dom.registerNodeType("SphereSensor","PointingDeviceSensor",defineClass(x3dom.nodeTypes.X3DDragSensorNode,function(e){x3dom.nodeTypes.SphereSensor.superClass.call(this,e),this.addField_SFRotation(e,"offset",0,1,0,0),this._currentRotation=null,this._rotationMatrix=this._vf.offset.toMatrix()},{getCurrentTransform:function(){return x3dom.nodeTypes.X3DDragSensorNode.prototype.getCurrentTransform.call(this).mult(this._rotationMatrix)},_startDragging:function(e,t,i,o,s,n){x3dom.nodeTypes.X3DDragSensorNode.prototype._startDragging.call(this,e,t,i,o,s,n),this._currentRotation=new x3dom.fields.Quaternion,this._viewArea=e,this._localOrigin=new x3dom.fields.SFVec3f(0,0,0),this._inverseToWorldMatrix=this.getCurrentTransform().inverse();t=this._inverseToWorldMatrix.multMatrixPnt(new x3dom.fields.SFVec3f(o,s,n));this._initialSphereIntersectionVector=t.subtract(this._localOrigin),this._sphereRadius=this._initialSphereIntersectionVector.length(),this._initialSphereIntersectionVector=this._initialSphereIntersectionVector.normalize()},_process2DDrag:function(e,t,i,o){x3dom.nodeTypes.X3DDragSensorNode.prototype._process2DDrag.call(this,e,t,i,o);i=this._viewArea.calcViewRay(e,t);i.pos=this._inverseToWorldMatrix.multMatrixPnt(i.pos),i.dir=this._inverseToWorldMatrix.multMatrixVec(i.dir);var s,o=i.dir.dot(i.dir),e=2*i.dir.dot(i.pos.subtract(this._localOrigin)),t=e*e-4*o*(i.pos.dot(i.pos)-2*this._localOrigin.dot(i.pos)+this._localOrigin.dot(this._localOrigin)-this._sphereRadius*this._sphereRadius);0<=t&&(s=(-e+Math.sqrt(t))/(2*o),e=(-e-Math.sqrt(t))/(2*o),1<=(s=Math.min(s,e)))&&(t=i.pos.add(i.dir.multiply(s)).subtract(this._localOrigin).normalize(),this._currentRotation=x3dom.fields.Quaternion.rotateFromTo(this._initialSphereIntersectionVector,t),this._currentRotation=this._currentRotation.multiply(this._vf.offset),this.postMessage("rotation_changed",this._currentRotation))},_stopDragging:function(){x3dom.nodeTypes.X3DDragSensorNode.prototype._stopDragging.call(this),this._vf.autoOffset&&(this._vf.offset=this._currentRotation,this.postMessage("offset_changed",this._vf.offset)),this._currentRotation=new x3dom.fields.Quaternion}})),x3dom.registerNodeType("CylinderSensor","PointingDeviceSensor",defineClass(x3dom.nodeTypes.X3DDragSensorNode,function(e){x3dom.nodeTypes.CylinderSensor.superClass.call(this,e),this.addField_SFFloat(e,"offset",0),this.addField_SFRotation(e,"axisRotation",0,1,0,0),this.addField_SFFloat(e,"diskAngle",.262),this.addField_SFFloat(e,"minAngle",0),this.addField_SFFloat(e,"maxAngle",-1),this._rotationMatrix=this._vf.axisRotation.toMatrix(),this._inverseToWorldMatrix=null,this._initialCylinderIntersectionVector=null,this._viewArea=null,this._cylinderRadius=0,this._yAxisLine=null,this._cylinderMode=!0,this._currentRotationAngle=0},{getCurrentTransform:function(){return x3dom.nodeTypes.X3DDragSensorNode.prototype.getCurrentTransform.call(this).mult(this._rotationMatrix)},_startDragging:function(e,t,i,o,s,n){x3dom.nodeTypes.X3DDragSensorNode.prototype._startDragging.call(this,e,t,i,o,s,n),this._currentRotation=new x3dom.fields.Quaternion,this._viewArea=e,this._yAxisLine=new x3dom.fields.Line(new x3dom.fields.SFVec3f(0,0,0),new x3dom.fields.SFVec3f(0,1,0)),this._inverseToWorldMatrix=this.getCurrentTransform().inverse();t=this._inverseToWorldMatrix.multMatrixPnt(new x3dom.fields.SFVec3f(o,s,n)),i=this._yAxisLine.closestPoint(t);this._initialCylinderIntersectionVector=t.subtract(i),this._cylinderRadius=this._initialCylinderIntersectionVector.length(),this._initialCylinderIntersectionVector=this._initialCylinderIntersectionVector.normalize()},_process2DDrag:function(e,t,i,o){x3dom.nodeTypes.X3DDragSensorNode.prototype._process2DDrag.call(this,e,t,i,o),this._cylinderMode&&((i=this._viewArea.calcViewRay(e,t)).pos=this._inverseToWorldMatrix.multMatrixPnt(i.pos),i.dir=this._inverseToWorldMatrix.multMatrixVec(i.dir),o=i.dir.subtract(this._yAxisLine.dir.multiply(i.dir.dot(this._yAxisLine.dir))),e=i.pos.subtract(this._yAxisLine.pos).add(this._yAxisLine.dir.multiply(this._yAxisLine.dir.dot(this._yAxisLine.pos.subtract(i.pos)))),0<=(e=(t=2*o.dot(e)/o.dot(o))*t*.25-(e.dot(e)-this._cylinderRadius*this._cylinderRadius)/o.dot(o)))&&(o=.5*-t+(e=Math.sqrt(e)),0<(o=Math.min(o,.5*-t-e)))&&(t=i.pos.add(i.dir.multiply(o)),e=this._yAxisLine.closestPoint(t),i=t.subtract(e).normalize(),this._currentRotation=x3dom.fields.Quaternion.rotateFromTo(this._initialCylinderIntersectionVector,i),o=x3dom.fields.Quaternion.axisAngle(this._yAxisLine.dir,this._vf.offset),this._currentRotation=this._currentRotation.multiply(o),this.postMessage("rotation_changed",this._currentRotation))},_stopDragging:function(){x3dom.nodeTypes.X3DDragSensorNode.prototype._stopDragging.call(this),this._vf.autoOffset&&(this._vf.offset=this._currentRotation.angle(),this.postMessage("offset_changed",this._vf.offset))}})),x3dom.registerNodeType("X3DSequencerNode","EventUtilities",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DSequencerNode.superClass.call(this,e),this.addField_SFBool(e,"next",!1),this.addField_SFBool(e,"previous",!1),this.addField_MFFloat(e,"key",[]),this.addField_SFFloat(e,"set_fraction",0),this._keyIndex=-1,this._key_changed=!1,this._keyValue_changed=!1},{findInterval:function(e){var t=this._vf.key.length-1;if(!(e<this._vf.key[0])){if(e>=this._vf.key[t])return t;for(var i=0;i<t;++i)if(this._vf.key[i]<=e&&e<this._vf.key[i+1])return i}return 0},fieldChanged:function(e){if("set_fraction"!==e)return"next"===e&&this._vf.next?(this._keyIndex=(this._keyIndex+1)%this._vf.key.length,void this.postMessage("value_changed",this._vf.keyValue[this._keyIndex])):"previous"===e&&this._vf.previous?(this._keyIndex=(this._keyIndex-1+this._vf.key.length)%this._vf.key.length,void this.postMessage("value_changed",this._vf.keyValue[this._keyIndex])):"key"===e?this._key_changed?void(this._key_changed=!1):(this._key_changed=!0,void this.postMessage("key",this._vf.key)):"keyValue"===e?this._keyValue_changed?void(this._keyValue_changed=!1):(this._keyValue_changed=!0,void this.postMessage("keyValue",this._vf.keyValue)):void 0;e=this.findInterval(this._vf.set_fraction);e!==this._keyIndex&&(this._keyIndex=e,this.postMessage("value_changed",this._vf.keyValue[e]))}})),x3dom.registerNodeType("X3DTriggerNode","EventUtilities",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DTriggerNode.superClass.call(this,e)})),x3dom.registerNodeType("BooleanFilter","EventUtilities",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.BooleanFilter.superClass.call(this,e),this.addField_SFBool(e,"set_boolean"),this.addField_SFBool(e,"inputFalse"),this.addField_SFBool(e,"inputTrue"),this.addField_SFBool(e,"inputNegate")},{fieldChanged:function(e){if("set_boolean"===e)return e=this._vf.set_boolean,this._vf.inputNegate=!e,this.postMessage("inputNegate",!e),e?(this._vf.inputTrue=!0,void this.postMessage("inputTrue",!0)):(this._vf.inputFalse=!1,void this.postMessage("inputFalse",!1))}})),x3dom.registerNodeType("BooleanSequencer","EventUtilities",defineClass(x3dom.nodeTypes.X3DSequencerNode,function(e){x3dom.nodeTypes.BooleanSequencer.superClass.call(this,e),this.addField_MFBoolean(e,"keyValue",[])},{})),x3dom.registerNodeType("BooleanToggle","EventUtilities",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.BooleanToggle.superClass.call(this,e),this.addField_SFBool(e,"set_boolean"),this.addField_SFBool(e,"toggle",!1)},{fieldChanged:function(e){"set_boolean"!==e?"toggle"===e&&this.postMessage("toggle",this._vf.toggle):this._vf.set_boolean&&(e=!this._vf.toggle,this._vf.toggle=e,this.postMessage("toggle",e))}})),x3dom.registerNodeType("BooleanTrigger","EventUtilities",defineClass(x3dom.nodeTypes.X3DTriggerNode,function(e){x3dom.nodeTypes.BooleanTrigger.superClass.call(this,e),this.addField_SFTime(e,"set_triggerTime")},{fieldChanged:function(e){"set_triggerTime"===e&&this.postMessage("triggerTrue",!0)}})),x3dom.registerNodeType("IntegerSequencer","EventUtilities",defineClass(x3dom.nodeTypes.X3DSequencerNode,function(e){x3dom.nodeTypes.IntegerSequencer.superClass.call(this,e),this.addField_MFInt32(e,"keyValue",[])},{})),x3dom.registerNodeType("IntegerTrigger","EventUtilities",defineClass(x3dom.nodeTypes.X3DTriggerNode,function(e){x3dom.nodeTypes.IntegerTrigger.superClass.call(this,e),this.addField_SFBool(e,"set_boolean"),this.addField_SFInt32(e,"integerKey",-1)},{fieldChanged:function(e){"set_boolean"===e&&this.postMessage("triggerValue",this._vf.integerKey)}})),x3dom.registerNodeType("TimeTrigger","EventUtilities",defineClass(x3dom.nodeTypes.X3DTriggerNode,function(e){x3dom.nodeTypes.TimeTrigger.superClass.call(this,e),this.addField_SFBool(e,"set_boolean")},{fieldChanged:function(e){"set_boolean"===e&&this.postMessage("triggerTime",Date.now()/1e3)}}))</script><style>X3D,x3d{position:relative;cursor:pointer;margin:0;padding:0;outline:0;display:block}.x3dom-canvas:hover,X3D:hover,x3d:hover{-webkit-user-select:none;-webkit-touch-callout:none}.x3dom-canvas{border:none;cursor:pointer;cursor:-webkit-grab;cursor:grab;width:100%;height:100%}.x3dom-canvas-mousedown{cursor:-webkit-grabbing;cursor:grabbing}.x3dom-canvas:focus{outline:0}.x3dom-progress{left:16px;top:16px;position:absolute;color:#646464;font-family:Helvetica,sans-serif;font-size:14px;font-weight:700;z-index:100;display:flex;justify-content:center;align-items:center;background:rgba(255,255,255,.1);padding:12px;border-radius:5px;pointer-events:none;transition:opacity .2s ease-in-out}.x3dom-progress-spinner{border:2px solid #f3f3f3;border-top:2px solid #646464;border-radius:50%;width:16px;height:16px;animation:spin 1s linear infinite;margin-right:12px}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.x3dom-vr{position:absolute;display:none;bottom:5px;right:15px;width:48px;height:48px;background-color:#ccc;opacity:.9;-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 24 24' style='enable-background:new 0 0 24 24;' xml:space='preserve'%3E%3Cpath id='XMLID_9_' style='fill:%23FFFFFF;' d='M20.2,6.1c-2.7,0-5.4,0-8.2,0c-2.8,0-5.5,0-8.3,0c-1,0-1.5,0.6-1.5,1.5 c0,2.8,0,5.6,0,8.5c0,0.9,0.6,1.5,1.5,1.5c1.7,0,3.3,0,5,0c0.6,0,0.9-0.2,1.1-0.8c0.3-0.8,0.7-1.7,1-2.5c0.2-0.6,0.6-0.9,1.2-0.9 c0.6,0,1,0.4,1.2,1c0.3,0.8,0.5,1.5,0.8,2.3c0.3,0.8,0.5,0.9,1.3,0.9c1.6,0,3.2,0,4.7,0c1.2,0,1.7-0.5,1.7-1.8c0-2.7,0-5.4,0-8 C21.8,6.6,21.4,6.1,20.2,6.1z M7.8,14.3c-1.2,0-2.2-0.9-2.2-2.1c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2C10,13.3,9,14.3,7.8,14.3z M16.2,14.3c-1.2,0-2.2-1-2.2-2.2c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2C18.4,13.4,17.4,14.3,16.2,14.3z'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 24 24' style='enable-background:new 0 0 24 24;' xml:space='preserve'%3E%3Cpath id='XMLID_9_' style='fill:%23FFFFFF;' d='M20.2,6.1c-2.7,0-5.4,0-8.2,0c-2.8,0-5.5,0-8.3,0c-1,0-1.5,0.6-1.5,1.5 c0,2.8,0,5.6,0,8.5c0,0.9,0.6,1.5,1.5,1.5c1.7,0,3.3,0,5,0c0.6,0,0.9-0.2,1.1-0.8c0.3-0.8,0.7-1.7,1-2.5c0.2-0.6,0.6-0.9,1.2-0.9 c0.6,0,1,0.4,1.2,1c0.3,0.8,0.5,1.5,0.8,2.3c0.3,0.8,0.5,0.9,1.3,0.9c1.6,0,3.2,0,4.7,0c1.2,0,1.7-0.5,1.7-1.8c0-2.7,0-5.4,0-8 C21.8,6.6,21.4,6.1,20.2,6.1z M7.8,14.3c-1.2,0-2.2-0.9-2.2-2.1c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2C10,13.3,9,14.3,7.8,14.3z M16.2,14.3c-1.2,0-2.2-1-2.2-2.2c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2C18.4,13.4,17.4,14.3,16.2,14.3z'/%3E%3C/svg%3E")}.x3dom-vr:hover{background-color:#999}#x3dom-state-viewer{position:absolute;margin:2px;padding:5px;width:135px;top:0;right:0;opacity:.9;background-color:#323232;z-index:1000;font-family:Arial,sans-serif;color:#c8c8c8;font-weight:700;text-transform:uppercase;cursor:help}.x3dom-states-head{display:block;font-size:26px}.x3dom-states-rendermode-software{font-size:10px;margin:0 0 2px 2px}.x3dom-states-rendermode-hardware{font-size:10px;margin:0 0 2px 2px}.x3dom-states-head2{font-size:10px}.x3dom-states-list{float:left;width:100%;border-top:1px solid #c8c8c8;list-style:none;font-size:9px;line-height:16px;margin:0;padding:0;padding-top:2px}.x3dom-states-item{width:100%;float:left}.x3dom-states-item-title{float:left;margin-left:2px}.x3dom-states-item-value{float:right;margin-right:2px}.x3dom-touch-marker{display:inline;padding:5px;border-radius:10px;position:absolute;font-family:Helvetica,sans-serif;line-height:10px;font-size:10px;color:#ff8c00;background:#fff8dc;opacity:.6;border:2px solid orange;z-index:200}.x3dom-log{position:absolute;bottom:16px;left:50%;transform:translateX(-50%);width:90%;border:2px solid #6b8e23;height:200px;padding:4px;overflow:auto;white-space:pre-wrap;font-family:sans-serif;font-size:x-small;color:#0f0;background-color:#000;opacity:.8;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}.x3dom-nox3d{font-family:Helvetica,sans-serif;font-size:14px;background-color:#eb7a7a;padding:1em;opacity:.75}.x3dom-nox3d p{color:#fff;font-size:14px}.x3dom-nox3d a{color:#fff;font-size:14px}</style><style>*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-scroll-snap-strictness:proximity;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000}::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-scroll-snap-strictness:proximity;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000}/*! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com*/*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.button{margin-inline-end:.5rem;margin-bottom:.5rem;border-radius:.5rem;border-width:1px;--tw-border-opacity:1;border-color:rgb(75 85 99/var(--tw-border-opacity,1));padding:.625rem 1.25rem;text-align:center;font-size:.875rem;line-height:1.25rem;font-weight:500;--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity,1))}.button:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99/var(--tw-bg-opacity,1));--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.button:focus{outline:2px solid transparent;outline-offset:2px;--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000);--tw-ring-opacity:1;--tw-ring-color:rgb(31 41 55/var(--tw-ring-opacity,1))}.crystal-table{position:relative;width:-moz-fit-content;width:fit-content;max-width:36rem;overflow-x:auto}.crystal-table>table{width:100%;text-align:left;font-size:.875rem;line-height:1.25rem;--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity,1))}.crystal-table>table th{--tw-border-opacity:1;font-weight:500;--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.crystal-table>table td,.crystal-table>table th{border-width:1px;border-color:rgb(55 65 81/var(--tw-border-opacity,1));padding:.5rem 1rem}.crystal-table>table td{--tw-border-opacity:1}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.visible{visibility:visible}.relative{position:relative}.mx-auto{margin-left:auto;margin-right:auto}.my-5{margin-top:1.25rem;margin-bottom:1.25rem}.me-2{margin-inline-end:.5rem}.ms-3{margin-inline-start:.75rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.hidden{display:none}.h-5{height:1.25rem}.h-6{height:1.5rem}.w-11{width:2.75rem}.w-5{width:1.25rem}.max-w-7xl{max-width:80rem}.grow{flex-grow:1}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.cursor-pointer{cursor:pointer}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-5{gap:1.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity,1))}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99/var(--tw-border-opacity,1))}.border-gray-700{--tw-border-opacity:1;border-color:rgb(55 65 81/var(--tw-border-opacity,1))}.bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity,1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39/var(--tw-bg-opacity,1))}.p-4{padding:1rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.pb-3{padding-bottom:.75rem}.pt-5{padding-top:1.25rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-sm{font-size:.875rem;line-height:1.25rem}.font-medium{font-weight:500}.text-gray-200{--tw-text-opacity:1;color:rgb(229 231 235/var(--tw-text-opacity,1))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity,1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity,1))}.after\:absolute:after{content:var(--tw-content);position:absolute}.after\:start-\[2px\]:after{content:var(--tw-content);inset-inline-start:2px}.after\:top-\[2px\]:after{content:var(--tw-content);top:2px}.after\:h-5:after{content:var(--tw-content);height:1.25rem}.after\:w-5:after{content:var(--tw-content);width:1.25rem}.after\:rounded-full:after{content:var(--tw-content);border-radius:9999px}.after\:border:after{content:var(--tw-content);border-width:1px}.after\:border-gray-300:after{content:var(--tw-content);--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity,1))}.after\:bg-white:after{content:var(--tw-content);--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.after\:transition-all:after{content:var(--tw-content);transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.after\:content-\[\'\'\]:after{--tw-content:"";content:var(--tw-content)}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99/var(--tw-bg-opacity,1))}.hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity,1))}.hover\:text-gray-300:hover{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity,1))}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.peer:checked~.peer-checked\:bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.peer:checked~.peer-checked\:bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity,1))}.peer:checked~.peer-checked\:bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity,1))}.peer:checked~.peer-checked\:text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246/var(--tw-text-opacity,1))}.peer:checked~.peer-checked\:text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.peer:checked~.peer-checked\:after\:translate-x-full:after{content:var(--tw-content);--tw-translate-x:100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.peer:checked~.peer-checked\:after\:border-white:after{content:var(--tw-content);--tw-border-opacity:1;border-color:rgb(255 255 255/var(--tw-border-opacity,1))}.peer:focus~.peer-focus\:outline-none{outline:2px solid transparent;outline-offset:2px}.peer:focus~.peer-focus\:ring-4{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.peer:focus~.peer-focus\:ring-blue-800{--tw-ring-opacity:1;--tw-ring-color:rgb(30 64 175/var(--tw-ring-opacity,1))}@media (min-width:768px){.md\:flex-row{flex-direction:row}.md\:flex-col{flex-direction:column}}</style><title>3DEE Crystals - 3D Visualization of Common Crystal Structures used in Electrical Engineering</title><meta name="description" content="3DEE Crystals - 3D Visualization of Common Crystal Structures used in Electrical Engineering"></head><body class="text-gray-200 bg-gray-900"><main class="max-w-7xl mx-auto px-3"><div class="flex items-center justify-between pt-5 pb-3"><div><a href="/"><h1 class="text-3xl">3DEE Crystals</h1></a><h2 class="text-md">3D Visualization of Common Crystal Structures used in Electrical Engineering</h2></div><div><a href="https://github.com/QGAI/3dee-crystals" class="hover:text-gray-300" target="_blank"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path></svg></a></div></div><nav id="nav" class="border-b border-gray-700"><ul class="flex flex-wrap text-sm font-medium text-gray-400"><li class="me-2"><label><input type="radio" class="sr-only peer" name="tab" value="sc" autocomplete="off" checked="checked"><div class="inline-block p-4 rounded-t-lg hover:bg-gray-800 hover:text-gray-300 cursor-pointer peer-checked:bg-gray-800 peer-checked:text-blue-500">Simple Cubic (SC)</div></label></li><li class="me-2"><label><input type="radio" class="sr-only peer" name="tab" value="bcc" autocomplete="off"><div class="inline-block p-4 rounded-t-lg hover:bg-gray-800 hover:text-gray-300 cursor-pointer peer-checked:bg-gray-800 peer-checked:text-blue-500">Body-centered Cubic (BCC)</div></label></li><li class="me-2"><label><input type="radio" class="sr-only peer" name="tab" value="fcc" autocomplete="off"><div class="inline-block p-4 rounded-t-lg hover:bg-gray-800 hover:text-gray-300 cursor-pointer peer-checked:bg-gray-800 peer-checked:text-blue-500">Face-centered Cubic (FCC)</div></label></li><li class="me-2"><label><input type="radio" class="sr-only peer" name="tab" value="dc" autocomplete="off"><div class="inline-block p-4 rounded-t-lg hover:bg-gray-800 hover:text-gray-300 cursor-pointer peer-checked:bg-gray-800 peer-checked:text-blue-500">Diamond cubic (DC)</div></label></li><li class="me-2"><label><input type="radio" class="sr-only peer" name="tab" value="hcp" autocomplete="off"><div class="inline-block p-4 rounded-t-lg hover:bg-gray-800 hover:text-gray-300 cursor-pointer peer-checked:bg-gray-800 peer-checked:text-blue-500">Hexagonal Close Packed (HCP)</div></label></li><li class="me-2"><label><input type="radio" class="sr-only peer" name="tab" value="nacl" autocomplete="off"><div class="inline-block p-4 rounded-t-lg hover:bg-gray-800 hover:text-gray-300 cursor-pointer peer-checked:bg-gray-800 peer-checked:text-blue-500">NaCl</div></label></li></ul></nav><div class="bg-gray-900"><div><div class="my-5 hidden" data-nav-view="sc"><div class="flex flex-wrap gap-2"><label><input type="radio" class="sr-only peer view" name="sc" value="sc" autocomplete="off" checked="checked"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Default View</div></label> <label><input type="radio" class="sr-only peer view" name="sc" value="sc-cn" autocomplete="off"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Coordination Number View</div></label></div></div><div class="my-5 hidden" data-nav-view="bcc"><div class="flex flex-wrap gap-2"><label><input type="radio" class="sr-only peer view" name="bcc" value="bcc" autocomplete="off" checked="checked"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Default View</div></label> <label><input type="radio" class="sr-only peer view" name="bcc" value="bcc-cn" autocomplete="off"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Coordination Number View</div></label></div></div><div class="my-5 hidden" data-nav-view="fcc"><div class="flex flex-wrap gap-2"><label><input type="radio" class="sr-only peer view" name="fcc" value="fcc" autocomplete="off" checked="checked"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Default View</div></label> <label><input type="radio" class="sr-only peer view" name="fcc" value="fcc-cn" autocomplete="off"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Coordination Number View</div></label></div></div><div class="my-5 hidden" data-nav-view="dc"><div class="flex flex-wrap gap-2"><label><input type="radio" class="sr-only peer view" name="dc" value="dc" autocomplete="off" checked="checked"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Default View</div></label> <label><input type="radio" class="sr-only peer view" name="dc" value="dc-cn" autocomplete="off"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Coordination Number View</div></label></div></div><div class="my-5 hidden" data-nav-view="hcp"><div class="flex flex-wrap gap-2"><label><input type="radio" class="sr-only peer view" name="hcp" value="hcp" autocomplete="off" checked="checked"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Default View</div></label> <label><input type="radio" class="sr-only peer view" name="hcp" value="hcp-cn" autocomplete="off"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Coordination Number View</div></label></div></div><div class="my-5 hidden" data-nav-view="nacl"><div class="flex flex-wrap gap-2"><label><input type="radio" class="sr-only peer view" name="nacl" value="nacl" autocomplete="off" checked="checked"><div class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white">Default View</div></label></div></div></div><div class="flex flex-col md:flex-row gap-5"><div class="grow border border-gray-300"><x3d height="600px"><scene><viewpoint></viewpoint><transform render="false" visible="false"><shape><indexedfaceset def="half-1" solid="false" creaseangle="3.14" coordindex="0,25,1,-1,25,26,1,-1,1,26,2,-1,26,27,2,-1,2,27,3,-1,27,28,3,-1,3,28,4,-1,28,29,4,-1,4,29,5,-1,29,30,5,-1,5,30,6,-1,30,31,6,-1,6,31,7,-1,31,32,7,-1,7,32,8,-1,32,33,8,-1,8,33,9,-1,33,34,9,-1,9,34,10,-1,34,35,10,-1,10,35,11,-1,35,36,11,-1,11,36,12,-1,36,37,12,-1,12,37,13,-1,37,38,13,-1,13,38,14,-1,38,39,14,-1,14,39,15,-1,39,40,15,-1,15,40,16,-1,40,41,16,-1,16,41,17,-1,41,42,17,-1,17,42,18,-1,42,43,18,-1,18,43,19,-1,43,44,19,-1,19,44,20,-1,44,45,20,-1,20,45,21,-1,45,46,21,-1,21,46,22,-1,46,47,22,-1,22,47,23,-1,47,48,23,-1,23,48,24,-1,48,49,24,-1,25,50,26,-1,50,51,26,-1,26,51,27,-1,51,52,27,-1,27,52,28,-1,52,53,28,-1,28,53,29,-1,53,54,29,-1,29,54,30,-1,54,55,30,-1,30,55,31,-1,55,56,31,-1,31,56,32,-1,56,57,32,-1,32,57,33,-1,57,58,33,-1,33,58,34,-1,58,59,34,-1,34,59,35,-1,59,60,35,-1,35,60,36,-1,60,61,36,-1,36,61,37,-1,61,62,37,-1,37,62,38,-1,62,63,38,-1,38,63,39,-1,63,64,39,-1,39,64,40,-1,64,65,40,-1,40,65,41,-1,65,66,41,-1,41,66,42,-1,66,67,42,-1,42,67,43,-1,67,68,43,-1,43,68,44,-1,68,69,44,-1,44,69,45,-1,69,70,45,-1,45,70,46,-1,70,71,46,-1,46,71,47,-1,71,72,47,-1,47,72,48,-1,72,73,48,-1,48,73,49,-1,73,74,49,-1,50,75,51,-1,75,76,51,-1,51,76,52,-1,76,77,52,-1,52,77,53,-1,77,78,53,-1,53,78,54,-1,78,79,54,-1,54,79,55,-1,79,80,55,-1,55,80,56,-1,80,81,56,-1,56,81,57,-1,81,82,57,-1,57,82,58,-1,82,83,58,-1,58,83,59,-1,83,84,59,-1,59,84,60,-1,84,85,60,-1,60,85,61,-1,85,86,61,-1,61,86,62,-1,86,87,62,-1,62,87,63,-1,87,88,63,-1,63,88,64,-1,88,89,64,-1,64,89,65,-1,89,90,65,-1,65,90,66,-1,90,91,66,-1,66,91,67,-1,91,92,67,-1,67,92,68,-1,92,93,68,-1,68,93,69,-1,93,94,69,-1,69,94,70,-1,94,95,70,-1,70,95,71,-1,95,96,71,-1,71,96,72,-1,96,97,72,-1,72,97,73,-1,97,98,73,-1,73,98,74,-1,98,99,74,-1,75,100,76,-1,100,101,76,-1,76,101,77,-1,101,102,77,-1,77,102,78,-1,102,103,78,-1,78,103,79,-1,103,104,79,-1,79,104,80,-1,104,105,80,-1,80,105,81,-1,105,106,81,-1,81,106,82,-1,106,107,82,-1,82,107,83,-1,107,108,83,-1,83,108,84,-1,108,109,84,-1,84,109,85,-1,109,110,85,-1,85,110,86,-1,110,111,86,-1,86,111,87,-1,111,112,87,-1,87,112,88,-1,112,113,88,-1,88,113,89,-1,113,114,89,-1,89,114,90,-1,114,115,90,-1,90,115,91,-1,115,116,91,-1,91,116,92,-1,116,117,92,-1,92,117,93,-1,117,118,93,-1,93,118,94,-1,118,119,94,-1,94,119,95,-1,119,120,95,-1,95,120,96,-1,120,121,96,-1,96,121,97,-1,121,122,97,-1,97,122,98,-1,122,123,98,-1,98,123,99,-1,123,124,99,-1,100,125,101,-1,125,126,101,-1,101,126,102,-1,126,127,102,-1,102,127,103,-1,127,128,103,-1,103,128,104,-1,128,129,104,-1,104,129,105,-1,129,130,105,-1,105,130,106,-1,130,131,106,-1,106,131,107,-1,131,132,107,-1,107,132,108,-1,132,133,108,-1,108,133,109,-1,133,134,109,-1,109,134,110,-1,134,135,110,-1,110,135,111,-1,135,136,111,-1,111,136,112,-1,136,137,112,-1,112,137,113,-1,137,138,113,-1,113,138,114,-1,138,139,114,-1,114,139,115,-1,139,140,115,-1,115,140,116,-1,140,141,116,-1,116,141,117,-1,141,142,117,-1,117,142,118,-1,142,143,118,-1,118,143,119,-1,143,144,119,-1,119,144,120,-1,144,145,120,-1,120,145,121,-1,145,146,121,-1,121,146,122,-1,146,147,122,-1,122,147,123,-1,147,148,123,-1,123,148,124,-1,148,149,124,-1,125,150,126,-1,150,151,126,-1,126,151,127,-1,151,152,127,-1,127,152,128,-1,152,153,128,-1,128,153,129,-1,153,154,129,-1,129,154,130,-1,154,155,130,-1,130,155,131,-1,155,156,131,-1,131,156,132,-1,156,157,132,-1,132,157,133,-1,157,158,133,-1,133,158,134,-1,158,159,134,-1,134,159,135,-1,159,160,135,-1,135,160,136,-1,160,161,136,-1,136,161,137,-1,161,162,137,-1,137,162,138,-1,162,163,138,-1,138,163,139,-1,163,164,139,-1,139,164,140,-1,164,165,140,-1,140,165,141,-1,165,166,141,-1,141,166,142,-1,166,167,142,-1,142,167,143,-1,167,168,143,-1,143,168,144,-1,168,169,144,-1,144,169,145,-1,169,170,145,-1,145,170,146,-1,170,171,146,-1,146,171,147,-1,171,172,147,-1,147,172,148,-1,172,173,148,-1,148,173,149,-1,173,174,149,-1,150,175,151,-1,175,176,151,-1,151,176,152,-1,176,177,152,-1,152,177,153,-1,177,178,153,-1,153,178,154,-1,178,179,154,-1,154,179,155,-1,179,180,155,-1,155,180,156,-1,180,181,156,-1,156,181,157,-1,181,182,157,-1,157,182,158,-1,182,183,158,-1,158,183,159,-1,183,184,159,-1,159,184,160,-1,184,185,160,-1,160,185,161,-1,185,186,161,-1,161,186,162,-1,186,187,162,-1,162,187,163,-1,187,188,163,-1,163,188,164,-1,188,189,164,-1,164,189,165,-1,189,190,165,-1,165,190,166,-1,190,191,166,-1,166,191,167,-1,191,192,167,-1,167,192,168,-1,192,193,168,-1,168,193,169,-1,193,194,169,-1,169,194,170,-1,194,195,170,-1,170,195,171,-1,195,196,171,-1,171,196,172,-1,196,197,172,-1,172,197,173,-1,197,198,173,-1,173,198,174,-1,198,199,174,-1,175,200,176,-1,200,201,176,-1,176,201,177,-1,201,202,177,-1,177,202,178,-1,202,203,178,-1,178,203,179,-1,203,204,179,-1,179,204,180,-1,204,205,180,-1,180,205,181,-1,205,206,181,-1,181,206,182,-1,206,207,182,-1,182,207,183,-1,207,208,183,-1,183,208,184,-1,208,209,184,-1,184,209,185,-1,209,210,185,-1,185,210,186,-1,210,211,186,-1,186,211,187,-1,211,212,187,-1,187,212,188,-1,212,213,188,-1,188,213,189,-1,213,214,189,-1,189,214,190,-1,214,215,190,-1,190,215,191,-1,215,216,191,-1,191,216,192,-1,216,217,192,-1,192,217,193,-1,217,218,193,-1,193,218,194,-1,218,219,194,-1,194,219,195,-1,219,220,195,-1,195,220,196,-1,220,221,196,-1,196,221,197,-1,221,222,197,-1,197,222,198,-1,222,223,198,-1,198,223,199,-1,223,224,199,-1,200,225,201,-1,225,226,201,-1,201,226,202,-1,226,227,202,-1,202,227,203,-1,227,228,203,-1,203,228,204,-1,228,229,204,-1,204,229,205,-1,229,230,205,-1,205,230,206,-1,230,231,206,-1,206,231,207,-1,231,232,207,-1,207,232,208,-1,232,233,208,-1,208,233,209,-1,233,234,209,-1,209,234,210,-1,234,235,210,-1,210,235,211,-1,235,236,211,-1,211,236,212,-1,236,237,212,-1,212,237,213,-1,237,238,213,-1,213,238,214,-1,238,239,214,-1,214,239,215,-1,239,240,215,-1,215,240,216,-1,240,241,216,-1,216,241,217,-1,241,242,217,-1,217,242,218,-1,242,243,218,-1,218,243,219,-1,243,244,219,-1,219,244,220,-1,244,245,220,-1,220,245,221,-1,245,246,221,-1,221,246,222,-1,246,247,222,-1,222,247,223,-1,247,248,223,-1,223,248,224,-1,248,249,224,-1,225,250,226,-1,250,251,226,-1,226,251,227,-1,251,252,227,-1,227,252,228,-1,252,253,228,-1,228,253,229,-1,253,254,229,-1,229,254,230,-1,254,255,230,-1,230,255,231,-1,255,256,231,-1,231,256,232,-1,256,257,232,-1,232,257,233,-1,257,258,233,-1,233,258,234,-1,258,259,234,-1,234,259,235,-1,259,260,235,-1,235,260,236,-1,260,261,236,-1,236,261,237,-1,261,262,237,-1,237,262,238,-1,262,263,238,-1,238,263,239,-1,263,264,239,-1,239,264,240,-1,264,265,240,-1,240,265,241,-1,265,266,241,-1,241,266,242,-1,266,267,242,-1,242,267,243,-1,267,268,243,-1,243,268,244,-1,268,269,244,-1,244,269,245,-1,269,270,245,-1,245,270,246,-1,270,271,246,-1,246,271,247,-1,271,272,247,-1,247,272,248,-1,272,273,248,-1,248,273,249,-1,273,274,249,-1,250,275,251,-1,275,276,251,-1,251,276,252,-1,276,277,252,-1,252,277,253,-1,277,278,253,-1,253,278,254,-1,278,279,254,-1,254,279,255,-1,279,280,255,-1,255,280,256,-1,280,281,256,-1,256,281,257,-1,281,282,257,-1,257,282,258,-1,282,283,258,-1,258,283,259,-1,283,284,259,-1,259,284,260,-1,284,285,260,-1,260,285,261,-1,285,286,261,-1,261,286,262,-1,286,287,262,-1,262,287,263,-1,287,288,263,-1,263,288,264,-1,288,289,264,-1,264,289,265,-1,289,290,265,-1,265,290,266,-1,290,291,266,-1,266,291,267,-1,291,292,267,-1,267,292,268,-1,292,293,268,-1,268,293,269,-1,293,294,269,-1,269,294,270,-1,294,295,270,-1,270,295,271,-1,295,296,271,-1,271,296,272,-1,296,297,272,-1,272,297,273,-1,297,298,273,-1,273,298,274,-1,298,299,274,-1,275,300,276,-1,300,301,276,-1,276,301,277,-1,301,302,277,-1,277,302,278,-1,302,303,278,-1,278,303,279,-1,303,304,279,-1,279,304,280,-1,304,305,280,-1,280,305,281,-1,305,306,281,-1,281,306,282,-1,306,307,282,-1,282,307,283,-1,307,308,283,-1,283,308,284,-1,308,309,284,-1,284,309,285,-1,309,310,285,-1,285,310,286,-1,310,311,286,-1,286,311,287,-1,311,312,287,-1,287,312,288,-1,312,313,288,-1,288,313,289,-1,313,314,289,-1,289,314,290,-1,314,315,290,-1,290,315,291,-1,315,316,291,-1,291,316,292,-1,316,317,292,-1,292,317,293,-1,317,318,293,-1,293,318,294,-1,318,319,294,-1,294,319,295,-1,319,320,295,-1,295,320,296,-1,320,321,296,-1,296,321,297,-1,321,322,297,-1,297,322,298,-1,322,323,298,-1,298,323,299,-1,323,324,299,-1,300,325,301,-1,325,326,301,-1,301,326,302,-1,326,327,302,-1,302,327,303,-1,327,328,303,-1,303,328,304,-1,328,329,304,-1,304,329,305,-1,329,330,305,-1,305,330,306,-1,330,331,306,-1,306,331,307,-1,331,332,307,-1,307,332,308,-1,332,333,308,-1,308,333,309,-1,333,334,309,-1,309,334,310,-1,334,335,310,-1,310,335,311,-1,335,336,311,-1,311,336,312,-1,336,337,312,-1,312,337,313,-1,337,338,313,-1,313,338,314,-1,338,339,314,-1,314,339,315,-1,339,340,315,-1,315,340,316,-1,340,341,316,-1,316,341,317,-1,341,342,317,-1,317,342,318,-1,342,343,318,-1,318,343,319,-1,343,344,319,-1,319,344,320,-1,344,345,320,-1,320,345,321,-1,345,346,321,-1,321,346,322,-1,346,347,322,-1,322,347,323,-1,347,348,323,-1,323,348,324,-1,348,349,324,-1,325,350,326,-1,350,351,326,-1,326,351,327,-1,351,352,327,-1,327,352,328,-1,352,353,328,-1,328,353,329,-1,353,354,329,-1,329,354,330,-1,354,355,330,-1,330,355,331,-1,355,356,331,-1,331,356,332,-1,356,357,332,-1,332,357,333,-1,357,358,333,-1,333,358,334,-1,358,359,334,-1,334,359,335,-1,359,360,335,-1,335,360,336,-1,360,361,336,-1,336,361,337,-1,361,362,337,-1,337,362,338,-1,362,363,338,-1,338,363,339,-1,363,364,339,-1,339,364,340,-1,364,365,340,-1,340,365,341,-1,365,366,341,-1,341,366,342,-1,366,367,342,-1,342,367,343,-1,367,368,343,-1,343,368,344,-1,368,369,344,-1,344,369,345,-1,369,370,345,-1,345,370,346,-1,370,371,346,-1,346,371,347,-1,371,372,347,-1,347,372,348,-1,372,373,348,-1,348,373,349,-1,373,374,349,-1,350,375,351,-1,375,376,351,-1,351,376,352,-1,376,377,352,-1,352,377,353,-1,377,378,353,-1,353,378,354,-1,378,379,354,-1,354,379,355,-1,379,380,355,-1,355,380,356,-1,380,381,356,-1,356,381,357,-1,381,382,357,-1,357,382,358,-1,382,383,358,-1,358,383,359,-1,383,384,359,-1,359,384,360,-1,384,385,360,-1,360,385,361,-1,385,386,361,-1,361,386,362,-1,386,387,362,-1,362,387,363,-1,387,388,363,-1,363,388,364,-1,388,389,364,-1,364,389,365,-1,389,390,365,-1,365,390,366,-1,390,391,366,-1,366,391,367,-1,391,392,367,-1,367,392,368,-1,392,393,368,-1,368,393,369,-1,393,394,369,-1,369,394,370,-1,394,395,370,-1,370,395,371,-1,395,396,371,-1,371,396,372,-1,396,397,372,-1,372,397,373,-1,397,398,373,-1,373,398,374,-1,398,399,374,-1,375,400,376,-1,400,401,376,-1,376,401,377,-1,401,402,377,-1,377,402,378,-1,402,403,378,-1,378,403,379,-1,403,404,379,-1,379,404,380,-1,404,405,380,-1,380,405,381,-1,405,406,381,-1,381,406,382,-1,406,407,382,-1,382,407,383,-1,407,408,383,-1,383,408,384,-1,408,409,384,-1,384,409,385,-1,409,410,385,-1,385,410,386,-1,410,411,386,-1,386,411,387,-1,411,412,387,-1,387,412,388,-1,412,413,388,-1,388,413,389,-1,413,414,389,-1,389,414,390,-1,414,415,390,-1,390,415,391,-1,415,416,391,-1,391,416,392,-1,416,417,392,-1,392,417,393,-1,417,418,393,-1,393,418,394,-1,418,419,394,-1,394,419,395,-1,419,420,395,-1,395,420,396,-1,420,421,396,-1,396,421,397,-1,421,422,397,-1,397,422,398,-1,422,423,398,-1,398,423,399,-1,423,424,399,-1,400,425,401,-1,425,426,401,-1,401,426,402,-1,426,427,402,-1,402,427,403,-1,427,428,403,-1,403,428,404,-1,428,429,404,-1,404,429,405,-1,429,430,405,-1,405,430,406,-1,430,431,406,-1,406,431,407,-1,431,432,407,-1,407,432,408,-1,432,433,408,-1,408,433,409,-1,433,434,409,-1,409,434,410,-1,434,435,410,-1,410,435,411,-1,435,436,411,-1,411,436,412,-1,436,437,412,-1,412,437,413,-1,437,438,413,-1,413,438,414,-1,438,439,414,-1,414,439,415,-1,439,440,415,-1,415,440,416,-1,440,441,416,-1,416,441,417,-1,441,442,417,-1,417,442,418,-1,442,443,418,-1,418,443,419,-1,443,444,419,-1,419,444,420,-1,444,445,420,-1,420,445,421,-1,445,446,421,-1,421,446,422,-1,446,447,422,-1,422,447,423,-1,447,448,423,-1,423,448,424,-1,448,449,424,-1,425,450,426,-1,450,451,426,-1,426,451,427,-1,451,452,427,-1,427,452,428,-1,452,453,428,-1,428,453,429,-1,453,454,429,-1,429,454,430,-1,454,455,430,-1,430,455,431,-1,455,456,431,-1,431,456,432,-1,456,457,432,-1,432,457,433,-1,457,458,433,-1,433,458,434,-1,458,459,434,-1,434,459,435,-1,459,460,435,-1,435,460,436,-1,460,461,436,-1,436,461,437,-1,461,462,437,-1,437,462,438,-1,462,463,438,-1,438,463,439,-1,463,464,439,-1,439,464,440,-1,464,465,440,-1,440,465,441,-1,465,466,441,-1,441,466,442,-1,466,467,442,-1,442,467,443,-1,467,468,443,-1,443,468,444,-1,468,469,444,-1,444,469,445,-1,469,470,445,-1,445,470,446,-1,470,471,446,-1,446,471,447,-1,471,472,447,-1,447,472,448,-1,472,473,448,-1,448,473,449,-1,473,474,449,-1,450,475,451,-1,475,476,451,-1,451,476,452,-1,476,477,452,-1,452,477,453,-1,477,478,453,-1,453,478,454,-1,478,479,454,-1,454,479,455,-1,479,480,455,-1,455,480,456,-1,480,481,456,-1,456,481,457,-1,481,482,457,-1,457,482,458,-1,482,483,458,-1,458,483,459,-1,483,484,459,-1,459,484,460,-1,484,485,460,-1,460,485,461,-1,485,486,461,-1,461,486,462,-1,486,487,462,-1,462,487,463,-1,487,488,463,-1,463,488,464,-1,488,489,464,-1,464,489,465,-1,489,490,465,-1,465,490,466,-1,490,491,466,-1,466,491,467,-1,491,492,467,-1,467,492,468,-1,492,493,468,-1,468,493,469,-1,493,494,469,-1,469,494,470,-1,494,495,470,-1,470,495,471,-1,495,496,471,-1,471,496,472,-1,496,497,472,-1,472,497,473,-1,497,498,473,-1,473,498,474,-1,498,499,474,-1,475,500,476,-1,500,501,476,-1,476,501,477,-1,501,502,477,-1,477,502,478,-1,502,503,478,-1,478,503,479,-1,503,504,479,-1,479,504,480,-1,504,505,480,-1,480,505,481,-1,505,506,481,-1,481,506,482,-1,506,507,482,-1,482,507,483,-1,507,508,483,-1,483,508,484,-1,508,509,484,-1,484,509,485,-1,509,510,485,-1,485,510,486,-1,510,511,486,-1,486,511,487,-1,511,512,487,-1,487,512,488,-1,512,513,488,-1,488,513,489,-1,513,514,489,-1,489,514,490,-1,514,515,490,-1,490,515,491,-1,515,516,491,-1,491,516,492,-1,516,517,492,-1,492,517,493,-1,517,518,493,-1,493,518,494,-1,518,519,494,-1,494,519,495,-1,519,520,495,-1,495,520,496,-1,520,521,496,-1,496,521,497,-1,521,522,497,-1,497,522,498,-1,522,523,498,-1,498,523,499,-1,523,524,499,-1,500,525,501,-1,525,526,501,-1,501,526,502,-1,526,527,502,-1,502,527,503,-1,527,528,503,-1,503,528,504,-1,528,529,504,-1,504,529,505,-1,529,530,505,-1,505,530,506,-1,530,531,506,-1,506,531,507,-1,531,532,507,-1,507,532,508,-1,532,533,508,-1,508,533,509,-1,533,534,509,-1,509,534,510,-1,534,535,510,-1,510,535,511,-1,535,536,511,-1,511,536,512,-1,536,537,512,-1,512,537,513,-1,537,538,513,-1,513,538,514,-1,538,539,514,-1,514,539,515,-1,539,540,515,-1,515,540,516,-1,540,541,516,-1,516,541,517,-1,541,542,517,-1,517,542,518,-1,542,543,518,-1,518,543,519,-1,543,544,519,-1,519,544,520,-1,544,545,520,-1,520,545,521,-1,545,546,521,-1,521,546,522,-1,546,547,522,-1,522,547,523,-1,547,548,523,-1,523,548,524,-1,548,549,524,-1,525,550,526,-1,550,551,526,-1,526,551,527,-1,551,552,527,-1,527,552,528,-1,552,553,528,-1,528,553,529,-1,553,554,529,-1,529,554,530,-1,554,555,530,-1,530,555,531,-1,555,556,531,-1,531,556,532,-1,556,557,532,-1,532,557,533,-1,557,558,533,-1,533,558,534,-1,558,559,534,-1,534,559,535,-1,559,560,535,-1,535,560,536,-1,560,561,536,-1,536,561,537,-1,561,562,537,-1,537,562,538,-1,562,563,538,-1,538,563,539,-1,563,564,539,-1,539,564,540,-1,564,565,540,-1,540,565,541,-1,565,566,541,-1,541,566,542,-1,566,567,542,-1,542,567,543,-1,567,568,543,-1,543,568,544,-1,568,569,544,-1,544,569,545,-1,569,570,545,-1,545,570,546,-1,570,571,546,-1,546,571,547,-1,571,572,547,-1,547,572,548,-1,572,573,548,-1,548,573,549,-1,573,574,549,-1,550,575,551,-1,575,576,551,-1,551,576,552,-1,576,577,552,-1,552,577,553,-1,577,578,553,-1,553,578,554,-1,578,579,554,-1,554,579,555,-1,579,580,555,-1,555,580,556,-1,580,581,556,-1,556,581,557,-1,581,582,557,-1,557,582,558,-1,582,583,558,-1,558,583,559,-1,583,584,559,-1,559,584,560,-1,584,585,560,-1,560,585,561,-1,585,586,561,-1,561,586,562,-1,586,587,562,-1,562,587,563,-1,587,588,563,-1,563,588,564,-1,588,589,564,-1,564,589,565,-1,589,590,565,-1,565,590,566,-1,590,591,566,-1,566,591,567,-1,591,592,567,-1,567,592,568,-1,592,593,568,-1,568,593,569,-1,593,594,569,-1,569,594,570,-1,594,595,570,-1,570,595,571,-1,595,596,571,-1,571,596,572,-1,596,597,572,-1,572,597,573,-1,597,598,573,-1,573,598,574,-1,598,599,574,-1,575,600,576,-1,600,601,576,-1,576,601,577,-1,601,602,577,-1,577,602,578,-1,602,603,578,-1,578,603,579,-1,603,604,579,-1,579,604,580,-1,604,605,580,-1,580,605,581,-1,605,606,581,-1,581,606,582,-1,606,607,582,-1,582,607,583,-1,607,608,583,-1,583,608,584,-1,608,609,584,-1,584,609,585,-1,609,610,585,-1,585,610,586,-1,610,611,586,-1,586,611,587,-1,611,612,587,-1,587,612,588,-1,612,613,588,-1,588,613,589,-1,613,614,589,-1,589,614,590,-1,614,615,590,-1,590,615,591,-1,615,616,591,-1,591,616,592,-1,616,617,592,-1,592,617,593,-1,617,618,593,-1,593,618,594,-1,618,619,594,-1,594,619,595,-1,619,620,595,-1,595,620,596,-1,620,621,596,-1,596,621,597,-1,621,622,597,-1,597,622,598,-1,622,623,598,-1,598,623,599,-1,623,624,599,-1"><coordinate point="0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0.065403,0.997859,0,0.063175,0.997859,0.016928,0.056641,0.997859,0.032702,0.046247,0.997859,0.046247,0.032702,0.997859,0.056641,0.016928,0.997859,0.063175,0,0.997859,0.065403,-0.016928,0.997859,0.063175,-0.032702,0.997859,0.056641,-0.046247,0.997859,0.046247,-0.056641,0.997859,0.032702,-0.063175,0.997859,0.016928,-0.065403,0.997859,0,-0.063175,0.997859,-0.016928,-0.056641,0.997859,-0.032702,-0.046247,0.997859,-0.046247,-0.032702,0.997859,-0.056641,-0.016928,0.997859,-0.063175,0,0.997859,-0.065403,0.016928,0.997859,-0.063175,0.032702,0.997859,-0.056641,0.046247,0.997859,-0.046247,0.056641,0.997859,-0.032702,0.063175,0.997859,-0.016928,0.065403,0.997859,0,0.130526,0.991445,0,0.126079,0.991445,0.033783,0.113039,0.991445,0.065263,0.092296,0.991445,0.092296,0.065263,0.991445,0.113039,0.033783,0.991445,0.126079,0,0.991445,0.130526,-0.033783,0.991445,0.126079,-0.065263,0.991445,0.113039,-0.092296,0.991445,0.092296,-0.113039,0.991445,0.065263,-0.126079,0.991445,0.033783,-0.130526,0.991445,0,-0.126079,0.991445,-0.033783,-0.113039,0.991445,-0.065263,-0.092296,0.991445,-0.092296,-0.065263,0.991445,-0.113039,-0.033783,0.991445,-0.126079,0,0.991445,-0.130526,0.033783,0.991445,-0.126079,0.065263,0.991445,-0.113039,0.092296,0.991445,-0.092296,0.113039,0.991445,-0.065263,0.126079,0.991445,-0.033783,0.130526,0.991445,0,0.19509,0.980785,0,0.188443,0.980785,0.050493,0.168953,0.980785,0.097545,0.13795,0.980785,0.13795,0.097545,0.980785,0.168953,0.050493,0.980785,0.188443,0,0.980785,0.19509,-0.050493,0.980785,0.188443,-0.097545,0.980785,0.168953,-0.13795,0.980785,0.13795,-0.168953,0.980785,0.097545,-0.188443,0.980785,0.050493,-0.19509,0.980785,0,-0.188443,0.980785,-0.050493,-0.168953,0.980785,-0.097545,-0.13795,0.980785,-0.13795,-0.097545,0.980785,-0.168953,-0.050493,0.980785,-0.188443,0,0.980785,-0.19509,0.050493,0.980785,-0.188443,0.097545,0.980785,-0.168953,0.13795,0.980785,-0.13795,0.168953,0.980785,-0.097545,0.188443,0.980785,-0.050493,0.19509,0.980785,0,0.258819,0.965926,0,0.25,0.965926,0.066987,0.224144,0.965926,0.12941,0.183013,0.965926,0.183013,0.12941,0.965926,0.224144,0.066987,0.965926,0.25,0,0.965926,0.258819,-0.066987,0.965926,0.25,-0.12941,0.965926,0.224144,-0.183013,0.965926,0.183013,-0.224144,0.965926,0.12941,-0.25,0.965926,0.066987,-0.258819,0.965926,0,-0.25,0.965926,-0.066987,-0.224144,0.965926,-0.12941,-0.183013,0.965926,-0.183013,-0.12941,0.965926,-0.224144,-0.066987,0.965926,-0.25,0,0.965926,-0.258819,0.066987,0.965926,-0.25,0.12941,0.965926,-0.224144,0.183013,0.965926,-0.183013,0.224144,0.965926,-0.12941,0.25,0.965926,-0.066987,0.258819,0.965926,0,0.321439,0.94693,0,0.310487,0.94693,0.083195,0.278375,0.94693,0.16072,0.227292,0.94693,0.227292,0.16072,0.94693,0.278375,0.083195,0.94693,0.310487,0,0.94693,0.321439,-0.083195,0.94693,0.310487,-0.16072,0.94693,0.278375,-0.227292,0.94693,0.227292,-0.278375,0.94693,0.16072,-0.310487,0.94693,0.083195,-0.321439,0.94693,0,-0.310487,0.94693,-0.083195,-0.278375,0.94693,-0.16072,-0.227292,0.94693,-0.227292,-0.16072,0.94693,-0.278375,-0.083195,0.94693,-0.310487,0,0.94693,-0.321439,0.083195,0.94693,-0.310487,0.16072,0.94693,-0.278375,0.227292,0.94693,-0.227292,0.278375,0.94693,-0.16072,0.310487,0.94693,-0.083195,0.321439,0.94693,0,0.382683,0.92388,0,0.369644,0.92388,0.099046,0.331414,0.92388,0.191342,0.270598,0.92388,0.270598,0.191342,0.92388,0.331414,0.099046,0.92388,0.369644,0,0.92388,0.382683,-0.099046,0.92388,0.369644,-0.191342,0.92388,0.331414,-0.270598,0.92388,0.270598,-0.331414,0.92388,0.191342,-0.369644,0.92388,0.099046,-0.382683,0.92388,0,-0.369644,0.92388,-0.099046,-0.331414,0.92388,-0.191342,-0.270598,0.92388,-0.270598,-0.191342,0.92388,-0.331414,-0.099046,0.92388,-0.369644,0,0.92388,-0.382683,0.099046,0.92388,-0.369644,0.191342,0.92388,-0.331414,0.270598,0.92388,-0.270598,0.331414,0.92388,-0.191342,0.369644,0.92388,-0.099046,0.382683,0.92388,0,0.442289,0.896873,0,0.427218,0.896873,0.114473,0.383033,0.896873,0.221144,0.312745,0.896873,0.312745,0.221144,0.896873,0.383033,0.114473,0.896873,0.427218,0,0.896873,0.442289,-0.114473,0.896873,0.427218,-0.221144,0.896873,0.383033,-0.312745,0.896873,0.312745,-0.383033,0.896873,0.221144,-0.427218,0.896873,0.114473,-0.442289,0.896873,0,-0.427218,0.896873,-0.114473,-0.383033,0.896873,-0.221144,-0.312745,0.896873,-0.312745,-0.221144,0.896873,-0.383033,-0.114473,0.896873,-0.427218,0,0.896873,-0.442289,0.114473,0.896873,-0.427218,0.221144,0.896873,-0.383033,0.312745,0.896873,-0.312745,0.383033,0.896873,-0.221144,0.427218,0.896873,-0.114473,0.442289,0.896873,0,0.5,0.866025,0,0.482963,0.866025,0.12941,0.433013,0.866025,0.25,0.353553,0.866025,0.353553,0.25,0.866025,0.433013,0.12941,0.866025,0.482963,0,0.866025,0.5,-0.12941,0.866025,0.482963,-0.25,0.866025,0.433013,-0.353553,0.866025,0.353553,-0.433013,0.866025,0.25,-0.482963,0.866025,0.12941,-0.5,0.866025,0,-0.482963,0.866025,-0.12941,-0.433013,0.866025,-0.25,-0.353553,0.866025,-0.353553,-0.25,0.866025,-0.433013,-0.12941,0.866025,-0.482963,0,0.866025,-0.5,0.12941,0.866025,-0.482963,0.25,0.866025,-0.433013,0.353553,0.866025,-0.353553,0.433013,0.866025,-0.25,0.482963,0.866025,-0.12941,0.5,0.866025,0,0.55557,0.83147,0,0.53664,0.83147,0.143792,0.481138,0.83147,0.277785,0.392847,0.83147,0.392847,0.277785,0.83147,0.481138,0.143792,0.83147,0.53664,0,0.83147,0.55557,-0.143792,0.83147,0.53664,-0.277785,0.83147,0.481138,-0.392847,0.83147,0.392847,-0.481138,0.83147,0.277785,-0.53664,0.83147,0.143792,-0.55557,0.83147,0,-0.53664,0.83147,-0.143792,-0.481138,0.83147,-0.277785,-0.392847,0.83147,-0.392847,-0.277785,0.83147,-0.481138,-0.143792,0.83147,-0.53664,0,0.83147,-0.55557,0.143792,0.83147,-0.53664,0.277785,0.83147,-0.481138,0.392847,0.83147,-0.392847,0.481138,0.83147,-0.277785,0.53664,0.83147,-0.143792,0.55557,0.83147,0,0.608761,0.793353,0,0.588018,0.793353,0.157559,0.527203,0.793353,0.304381,0.430459,0.793353,0.430459,0.304381,0.793353,0.527203,0.157559,0.793353,0.588018,0,0.793353,0.608761,-0.157559,0.793353,0.588018,-0.304381,0.793353,0.527203,-0.430459,0.793353,0.430459,-0.527203,0.793353,0.304381,-0.588018,0.793353,0.157559,-0.608761,0.793353,0,-0.588018,0.793353,-0.157559,-0.527203,0.793353,-0.304381,-0.430459,0.793353,-0.430459,-0.304381,0.793353,-0.527203,-0.157559,0.793353,-0.588018,0,0.793353,-0.608761,0.157559,0.793353,-0.588018,0.304381,0.793353,-0.527203,0.430459,0.793353,-0.430459,0.527203,0.793353,-0.304381,0.588018,0.793353,-0.157559,0.608761,0.793353,0,0.659346,0.75184,0,0.636879,0.75184,0.170651,0.57101,0.75184,0.329673,0.466228,0.75184,0.466228,0.329673,0.75184,0.57101,0.170651,0.75184,0.636879,0,0.75184,0.659346,-0.170651,0.75184,0.636879,-0.329673,0.75184,0.57101,-0.466228,0.75184,0.466228,-0.57101,0.75184,0.329673,-0.636879,0.75184,0.170651,-0.659346,0.75184,0,-0.636879,0.75184,-0.170651,-0.57101,0.75184,-0.329673,-0.466228,0.75184,-0.466228,-0.329673,0.75184,-0.57101,-0.170651,0.75184,-0.636879,0,0.75184,-0.659346,0.170651,0.75184,-0.636879,0.329673,0.75184,-0.57101,0.466228,0.75184,-0.466228,0.57101,0.75184,-0.329673,0.636879,0.75184,-0.170651,0.659346,0.75184,0,0.707107,0.707107,0,0.683013,0.707107,0.183013,0.612372,0.707107,0.353553,0.5,0.707107,0.5,0.353553,0.707107,0.612372,0.183013,0.707107,0.683013,0,0.707107,0.707107,-0.183013,0.707107,0.683013,-0.353553,0.707107,0.612372,-0.5,0.707107,0.5,-0.612372,0.707107,0.353553,-0.683013,0.707107,0.183013,-0.707107,0.707107,0,-0.683013,0.707107,-0.183013,-0.612372,0.707107,-0.353553,-0.5,0.707107,-0.5,-0.353553,0.707107,-0.612372,-0.183013,0.707107,-0.683013,0,0.707107,-0.707107,0.183013,0.707107,-0.683013,0.353553,0.707107,-0.612372,0.5,0.707107,-0.5,0.612372,0.707107,-0.353553,0.683013,0.707107,-0.183013,0.707107,0.707107,0,0.75184,0.659346,0,0.726221,0.659346,0.19459,0.651112,0.659346,0.37592,0.531631,0.659346,0.531631,0.37592,0.659346,0.651112,0.19459,0.659346,0.726221,0,0.659346,0.75184,-0.19459,0.659346,0.726221,-0.37592,0.659346,0.651112,-0.531631,0.659346,0.531631,-0.651112,0.659346,0.37592,-0.726221,0.659346,0.19459,-0.75184,0.659346,0,-0.726221,0.659346,-0.19459,-0.651112,0.659346,-0.37592,-0.531631,0.659346,-0.531631,-0.37592,0.659346,-0.651112,-0.19459,0.659346,-0.726221,0,0.659346,-0.75184,0.19459,0.659346,-0.726221,0.37592,0.659346,-0.651112,0.531631,0.659346,-0.531631,0.651112,0.659346,-0.37592,0.726221,0.659346,-0.19459,0.75184,0.659346,0,0.793353,0.608761,0,0.76632,0.608761,0.205335,0.687064,0.608761,0.396677,0.560986,0.608761,0.560986,0.396677,0.608761,0.687064,0.205335,0.608761,0.76632,0,0.608761,0.793353,-0.205335,0.608761,0.76632,-0.396677,0.608761,0.687064,-0.560986,0.608761,0.560986,-0.687064,0.608761,0.396677,-0.76632,0.608761,0.205335,-0.793353,0.608761,0,-0.76632,0.608761,-0.205335,-0.687064,0.608761,-0.396677,-0.560986,0.608761,-0.560986,-0.396677,0.608761,-0.687064,-0.205335,0.608761,-0.76632,0,0.608761,-0.793353,0.205335,0.608761,-0.76632,0.396677,0.608761,-0.687064,0.560986,0.608761,-0.560986,0.687064,0.608761,-0.396677,0.76632,0.608761,-0.205335,0.793353,0.608761,0,0.83147,0.55557,0,0.803138,0.55557,0.2152,0.720074,0.55557,0.415735,0.587938,0.55557,0.587938,0.415735,0.55557,0.720074,0.2152,0.55557,0.803138,0,0.55557,0.83147,-0.2152,0.55557,0.803138,-0.415735,0.55557,0.720074,-0.587938,0.55557,0.587938,-0.720074,0.55557,0.415735,-0.803138,0.55557,0.2152,-0.83147,0.55557,0,-0.803138,0.55557,-0.2152,-0.720074,0.55557,-0.415735,-0.587938,0.55557,-0.587938,-0.415735,0.55557,-0.720074,-0.2152,0.55557,-0.803138,0,0.55557,-0.83147,0.2152,0.55557,-0.803138,0.415735,0.55557,-0.720074,0.587938,0.55557,-0.587938,0.720074,0.55557,-0.415735,0.803138,0.55557,-0.2152,0.83147,0.55557,0,0.866025,0.5,0,0.836516,0.5,0.224144,0.75,0.5,0.433013,0.612372,0.5,0.612372,0.433013,0.5,0.75,0.224144,0.5,0.836516,0,0.5,0.866025,-0.224144,0.5,0.836516,-0.433013,0.5,0.75,-0.612372,0.5,0.612372,-0.75,0.5,0.433013,-0.836516,0.5,0.224144,-0.866025,0.5,0,-0.836516,0.5,-0.224144,-0.75,0.5,-0.433013,-0.612372,0.5,-0.612372,-0.433013,0.5,-0.75,-0.224144,0.5,-0.836516,0,0.5,-0.866025,0.224144,0.5,-0.836516,0.433013,0.5,-0.75,0.612372,0.5,-0.612372,0.75,0.5,-0.433013,0.836516,0.5,-0.224144,0.866025,0.5,0,0.896873,0.442289,0,0.866313,0.442289,0.232128,0.776715,0.442289,0.448436,0.634185,0.442289,0.634185,0.448436,0.442289,0.776715,0.232128,0.442289,0.866313,0,0.442289,0.896873,-0.232128,0.442289,0.866313,-0.448436,0.442289,0.776715,-0.634185,0.442289,0.634185,-0.776715,0.442289,0.448436,-0.866313,0.442289,0.232128,-0.896873,0.442289,0,-0.866313,0.442289,-0.232128,-0.776715,0.442289,-0.448436,-0.634185,0.442289,-0.634185,-0.448436,0.442289,-0.776715,-0.232128,0.442289,-0.866313,0,0.442289,-0.896873,0.232128,0.442289,-0.866313,0.448436,0.442289,-0.776715,0.634185,0.442289,-0.634185,0.776715,0.442289,-0.448436,0.866313,0.442289,-0.232128,0.896873,0.442289,0,0.92388,0.382683,0,0.892399,0.382683,0.239118,0.800103,0.382683,0.46194,0.653281,0.382683,0.653281,0.46194,0.382683,0.800103,0.239118,0.382683,0.892399,0,0.382683,0.92388,-0.239118,0.382683,0.892399,-0.46194,0.382683,0.800103,-0.653281,0.382683,0.653281,-0.800103,0.382683,0.46194,-0.892399,0.382683,0.239118,-0.92388,0.382683,0,-0.892399,0.382683,-0.239118,-0.800103,0.382683,-0.46194,-0.653281,0.382683,-0.653281,-0.46194,0.382683,-0.800103,-0.239118,0.382683,-0.892399,0,0.382683,-0.92388,0.239118,0.382683,-0.892399,0.46194,0.382683,-0.800103,0.653281,0.382683,-0.653281,0.800103,0.382683,-0.46194,0.892399,0.382683,-0.239118,0.92388,0.382683,0,0.94693,0.321439,0,0.914664,0.321439,0.245084,0.820066,0.321439,0.473465,0.669581,0.321439,0.669581,0.473465,0.321439,0.820066,0.245084,0.321439,0.914664,0,0.321439,0.94693,-0.245084,0.321439,0.914664,-0.473465,0.321439,0.820066,-0.669581,0.321439,0.669581,-0.820066,0.321439,0.473465,-0.914664,0.321439,0.245084,-0.94693,0.321439,0,-0.914664,0.321439,-0.245084,-0.820066,0.321439,-0.473465,-0.669581,0.321439,-0.669581,-0.473465,0.321439,-0.820066,-0.245084,0.321439,-0.914664,0,0.321439,-0.94693,0.245084,0.321439,-0.914664,0.473465,0.321439,-0.820066,0.669581,0.321439,-0.669581,0.820066,0.321439,-0.473465,0.914664,0.321439,-0.245084,0.94693,0.321439,0,0.965926,0.258819,0,0.933013,0.258819,0.25,0.836516,0.258819,0.482963,0.683013,0.258819,0.683013,0.482963,0.258819,0.836516,0.25,0.258819,0.933013,0,0.258819,0.965926,-0.25,0.258819,0.933013,-0.482963,0.258819,0.836516,-0.683013,0.258819,0.683013,-0.836516,0.258819,0.482963,-0.933013,0.258819,0.25,-0.965926,0.258819,0,-0.933013,0.258819,-0.25,-0.836516,0.258819,-0.482963,-0.683013,0.258819,-0.683013,-0.482963,0.258819,-0.836516,-0.25,0.258819,-0.933013,0,0.258819,-0.965926,0.25,0.258819,-0.933013,0.482963,0.258819,-0.836516,0.683013,0.258819,-0.683013,0.836516,0.258819,-0.482963,0.933013,0.258819,-0.25,0.965926,0.258819,0,0.980785,0.19509,0,0.947366,0.19509,0.253846,0.849385,0.19509,0.490393,0.69352,0.19509,0.69352,0.490393,0.19509,0.849385,0.253846,0.19509,0.947366,0,0.19509,0.980785,-0.253846,0.19509,0.947366,-0.490393,0.19509,0.849385,-0.69352,0.19509,0.69352,-0.849385,0.19509,0.490393,-0.947366,0.19509,0.253846,-0.980785,0.19509,0,-0.947366,0.19509,-0.253846,-0.849385,0.19509,-0.490393,-0.69352,0.19509,-0.69352,-0.490393,0.19509,-0.849385,-0.253846,0.19509,-0.947366,0,0.19509,-0.980785,0.253846,0.19509,-0.947366,0.490393,0.19509,-0.849385,0.69352,0.19509,-0.69352,0.849385,0.19509,-0.490393,0.947366,0.19509,-0.253846,0.980785,0.19509,0,0.991445,0.130526,0,0.957662,0.130526,0.256605,0.858616,0.130526,0.495722,0.701057,0.130526,0.701057,0.495722,0.130526,0.858616,0.256605,0.130526,0.957662,0,0.130526,0.991445,-0.256605,0.130526,0.957662,-0.495722,0.130526,0.858616,-0.701057,0.130526,0.701057,-0.858616,0.130526,0.495722,-0.957662,0.130526,0.256605,-0.991445,0.130526,0,-0.957662,0.130526,-0.256605,-0.858616,0.130526,-0.495722,-0.701057,0.130526,-0.701057,-0.495722,0.130526,-0.858616,-0.256605,0.130526,-0.957662,0,0.130526,-0.991445,0.256605,0.130526,-0.957662,0.495722,0.130526,-0.858616,0.701057,0.130526,-0.701057,0.858616,0.130526,-0.495722,0.957662,0.130526,-0.256605,0.991445,0.130526,0,0.997859,0.065403,0,0.963858,0.065403,0.258265,0.864171,0.065403,0.498929,0.705593,0.065403,0.705593,0.498929,0.065403,0.864171,0.258265,0.065403,0.963858,0,0.065403,0.997859,-0.258265,0.065403,0.963858,-0.498929,0.065403,0.864171,-0.705593,0.065403,0.705593,-0.864171,0.065403,0.498929,-0.963858,0.065403,0.258265,-0.997859,0.065403,0,-0.963858,0.065403,-0.258265,-0.864171,0.065403,-0.498929,-0.705593,0.065403,-0.705593,-0.498929,0.065403,-0.864171,-0.258265,0.065403,-0.963858,0,0.065403,-0.997859,0.258265,0.065403,-0.963858,0.498929,0.065403,-0.864171,0.705593,0.065403,-0.705593,0.864171,0.065403,-0.498929,0.963858,0.065403,-0.258265,0.997859,0.065403,0,1,0,0,0.965926,0,0.258819,0.866025,0,0.5,0.707107,0,0.707107,0.5,0,0.866025,0.258819,0,0.965926,0,0,1,-0.258819,0,0.965926,-0.5,0,0.866025,-0.707107,0,0.707107,-0.866025,0,0.5,-0.965926,0,0.258819,-1,0,0,-0.965926,0,-0.258819,-0.866025,0,-0.5,-0.707107,0,-0.707107,-0.5,0,-0.866025,-0.258819,0,-0.965926,0,0,-1,0.258819,0,-0.965926,0.5,0,-0.866025,0.707107,0,-0.707107,0.866025,0,-0.5,0.965926,0,-0.258819,1,0,0"></coordinate></indexedfaceset></shape></transform><transform render="false" visible="false"><shape><indexedfaceset def="half-2" solid="false" creaseangle="0" coordindex="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,-1"><coordinate point="1,0,0,0.965926,0,0.258819,0.866025,0,0.5,0.707107,0,0.707107,0.5,0,0.866025,0.258819,0,0.965926,0,0,1,-0.258819,0,0.965926,-0.5,0,0.866025,-0.707107,0,0.707107,-0.866025,0,0.5,-0.965926,0,0.258819,-1,0,0,-0.965926,0,-0.258819,-0.866025,0,-0.5,-0.707107,0,-0.707107,-0.5,0,-0.866025,-0.258819,0,-0.965926,0,0,-1,0.258819,0,-0.965926,0.5,0,-0.866025,0.707107,0,-0.707107,0.866025,0,-0.5,0.965926,0,-0.258819,1,0,0"></coordinate></indexedfaceset></shape></transform><transform render="false" visible="false"><shape><indexedfaceset def="quarter-1" solid="false" creaseangle="3.14" coordindex="0,25,1,-1,25,26,1,-1,1,26,2,-1,26,27,2,-1,2,27,3,-1,27,28,3,-1,3,28,4,-1,28,29,4,-1,4,29,5,-1,29,30,5,-1,5,30,6,-1,30,31,6,-1,6,31,7,-1,31,32,7,-1,7,32,8,-1,32,33,8,-1,8,33,9,-1,33,34,9,-1,9,34,10,-1,34,35,10,-1,10,35,11,-1,35,36,11,-1,11,36,12,-1,36,37,12,-1,12,37,13,-1,37,38,13,-1,13,38,14,-1,38,39,14,-1,14,39,15,-1,39,40,15,-1,15,40,16,-1,40,41,16,-1,16,41,17,-1,41,42,17,-1,17,42,18,-1,42,43,18,-1,18,43,19,-1,43,44,19,-1,19,44,20,-1,44,45,20,-1,20,45,21,-1,45,46,21,-1,21,46,22,-1,46,47,22,-1,22,47,23,-1,47,48,23,-1,23,48,24,-1,48,49,24,-1,25,50,26,-1,50,51,26,-1,26,51,27,-1,51,52,27,-1,27,52,28,-1,52,53,28,-1,28,53,29,-1,53,54,29,-1,29,54,30,-1,54,55,30,-1,30,55,31,-1,55,56,31,-1,31,56,32,-1,56,57,32,-1,32,57,33,-1,57,58,33,-1,33,58,34,-1,58,59,34,-1,34,59,35,-1,59,60,35,-1,35,60,36,-1,60,61,36,-1,36,61,37,-1,61,62,37,-1,37,62,38,-1,62,63,38,-1,38,63,39,-1,63,64,39,-1,39,64,40,-1,64,65,40,-1,40,65,41,-1,65,66,41,-1,41,66,42,-1,66,67,42,-1,42,67,43,-1,67,68,43,-1,43,68,44,-1,68,69,44,-1,44,69,45,-1,69,70,45,-1,45,70,46,-1,70,71,46,-1,46,71,47,-1,71,72,47,-1,47,72,48,-1,72,73,48,-1,48,73,49,-1,73,74,49,-1,50,75,51,-1,75,76,51,-1,51,76,52,-1,76,77,52,-1,52,77,53,-1,77,78,53,-1,53,78,54,-1,78,79,54,-1,54,79,55,-1,79,80,55,-1,55,80,56,-1,80,81,56,-1,56,81,57,-1,81,82,57,-1,57,82,58,-1,82,83,58,-1,58,83,59,-1,83,84,59,-1,59,84,60,-1,84,85,60,-1,60,85,61,-1,85,86,61,-1,61,86,62,-1,86,87,62,-1,62,87,63,-1,87,88,63,-1,63,88,64,-1,88,89,64,-1,64,89,65,-1,89,90,65,-1,65,90,66,-1,90,91,66,-1,66,91,67,-1,91,92,67,-1,67,92,68,-1,92,93,68,-1,68,93,69,-1,93,94,69,-1,69,94,70,-1,94,95,70,-1,70,95,71,-1,95,96,71,-1,71,96,72,-1,96,97,72,-1,72,97,73,-1,97,98,73,-1,73,98,74,-1,98,99,74,-1,75,100,76,-1,100,101,76,-1,76,101,77,-1,101,102,77,-1,77,102,78,-1,102,103,78,-1,78,103,79,-1,103,104,79,-1,79,104,80,-1,104,105,80,-1,80,105,81,-1,105,106,81,-1,81,106,82,-1,106,107,82,-1,82,107,83,-1,107,108,83,-1,83,108,84,-1,108,109,84,-1,84,109,85,-1,109,110,85,-1,85,110,86,-1,110,111,86,-1,86,111,87,-1,111,112,87,-1,87,112,88,-1,112,113,88,-1,88,113,89,-1,113,114,89,-1,89,114,90,-1,114,115,90,-1,90,115,91,-1,115,116,91,-1,91,116,92,-1,116,117,92,-1,92,117,93,-1,117,118,93,-1,93,118,94,-1,118,119,94,-1,94,119,95,-1,119,120,95,-1,95,120,96,-1,120,121,96,-1,96,121,97,-1,121,122,97,-1,97,122,98,-1,122,123,98,-1,98,123,99,-1,123,124,99,-1,100,125,101,-1,125,126,101,-1,101,126,102,-1,126,127,102,-1,102,127,103,-1,127,128,103,-1,103,128,104,-1,128,129,104,-1,104,129,105,-1,129,130,105,-1,105,130,106,-1,130,131,106,-1,106,131,107,-1,131,132,107,-1,107,132,108,-1,132,133,108,-1,108,133,109,-1,133,134,109,-1,109,134,110,-1,134,135,110,-1,110,135,111,-1,135,136,111,-1,111,136,112,-1,136,137,112,-1,112,137,113,-1,137,138,113,-1,113,138,114,-1,138,139,114,-1,114,139,115,-1,139,140,115,-1,115,140,116,-1,140,141,116,-1,116,141,117,-1,141,142,117,-1,117,142,118,-1,142,143,118,-1,118,143,119,-1,143,144,119,-1,119,144,120,-1,144,145,120,-1,120,145,121,-1,145,146,121,-1,121,146,122,-1,146,147,122,-1,122,147,123,-1,147,148,123,-1,123,148,124,-1,148,149,124,-1,125,150,126,-1,150,151,126,-1,126,151,127,-1,151,152,127,-1,127,152,128,-1,152,153,128,-1,128,153,129,-1,153,154,129,-1,129,154,130,-1,154,155,130,-1,130,155,131,-1,155,156,131,-1,131,156,132,-1,156,157,132,-1,132,157,133,-1,157,158,133,-1,133,158,134,-1,158,159,134,-1,134,159,135,-1,159,160,135,-1,135,160,136,-1,160,161,136,-1,136,161,137,-1,161,162,137,-1,137,162,138,-1,162,163,138,-1,138,163,139,-1,163,164,139,-1,139,164,140,-1,164,165,140,-1,140,165,141,-1,165,166,141,-1,141,166,142,-1,166,167,142,-1,142,167,143,-1,167,168,143,-1,143,168,144,-1,168,169,144,-1,144,169,145,-1,169,170,145,-1,145,170,146,-1,170,171,146,-1,146,171,147,-1,171,172,147,-1,147,172,148,-1,172,173,148,-1,148,173,149,-1,173,174,149,-1,150,175,151,-1,175,176,151,-1,151,176,152,-1,176,177,152,-1,152,177,153,-1,177,178,153,-1,153,178,154,-1,178,179,154,-1,154,179,155,-1,179,180,155,-1,155,180,156,-1,180,181,156,-1,156,181,157,-1,181,182,157,-1,157,182,158,-1,182,183,158,-1,158,183,159,-1,183,184,159,-1,159,184,160,-1,184,185,160,-1,160,185,161,-1,185,186,161,-1,161,186,162,-1,186,187,162,-1,162,187,163,-1,187,188,163,-1,163,188,164,-1,188,189,164,-1,164,189,165,-1,189,190,165,-1,165,190,166,-1,190,191,166,-1,166,191,167,-1,191,192,167,-1,167,192,168,-1,192,193,168,-1,168,193,169,-1,193,194,169,-1,169,194,170,-1,194,195,170,-1,170,195,171,-1,195,196,171,-1,171,196,172,-1,196,197,172,-1,172,197,173,-1,197,198,173,-1,173,198,174,-1,198,199,174,-1,175,200,176,-1,200,201,176,-1,176,201,177,-1,201,202,177,-1,177,202,178,-1,202,203,178,-1,178,203,179,-1,203,204,179,-1,179,204,180,-1,204,205,180,-1,180,205,181,-1,205,206,181,-1,181,206,182,-1,206,207,182,-1,182,207,183,-1,207,208,183,-1,183,208,184,-1,208,209,184,-1,184,209,185,-1,209,210,185,-1,185,210,186,-1,210,211,186,-1,186,211,187,-1,211,212,187,-1,187,212,188,-1,212,213,188,-1,188,213,189,-1,213,214,189,-1,189,214,190,-1,214,215,190,-1,190,215,191,-1,215,216,191,-1,191,216,192,-1,216,217,192,-1,192,217,193,-1,217,218,193,-1,193,218,194,-1,218,219,194,-1,194,219,195,-1,219,220,195,-1,195,220,196,-1,220,221,196,-1,196,221,197,-1,221,222,197,-1,197,222,198,-1,222,223,198,-1,198,223,199,-1,223,224,199,-1,200,225,201,-1,225,226,201,-1,201,226,202,-1,226,227,202,-1,202,227,203,-1,227,228,203,-1,203,228,204,-1,228,229,204,-1,204,229,205,-1,229,230,205,-1,205,230,206,-1,230,231,206,-1,206,231,207,-1,231,232,207,-1,207,232,208,-1,232,233,208,-1,208,233,209,-1,233,234,209,-1,209,234,210,-1,234,235,210,-1,210,235,211,-1,235,236,211,-1,211,236,212,-1,236,237,212,-1,212,237,213,-1,237,238,213,-1,213,238,214,-1,238,239,214,-1,214,239,215,-1,239,240,215,-1,215,240,216,-1,240,241,216,-1,216,241,217,-1,241,242,217,-1,217,242,218,-1,242,243,218,-1,218,243,219,-1,243,244,219,-1,219,244,220,-1,244,245,220,-1,220,245,221,-1,245,246,221,-1,221,246,222,-1,246,247,222,-1,222,247,223,-1,247,248,223,-1,223,248,224,-1,248,249,224,-1,225,250,226,-1,250,251,226,-1,226,251,227,-1,251,252,227,-1,227,252,228,-1,252,253,228,-1,228,253,229,-1,253,254,229,-1,229,254,230,-1,254,255,230,-1,230,255,231,-1,255,256,231,-1,231,256,232,-1,256,257,232,-1,232,257,233,-1,257,258,233,-1,233,258,234,-1,258,259,234,-1,234,259,235,-1,259,260,235,-1,235,260,236,-1,260,261,236,-1,236,261,237,-1,261,262,237,-1,237,262,238,-1,262,263,238,-1,238,263,239,-1,263,264,239,-1,239,264,240,-1,264,265,240,-1,240,265,241,-1,265,266,241,-1,241,266,242,-1,266,267,242,-1,242,267,243,-1,267,268,243,-1,243,268,244,-1,268,269,244,-1,244,269,245,-1,269,270,245,-1,245,270,246,-1,270,271,246,-1,246,271,247,-1,271,272,247,-1,247,272,248,-1,272,273,248,-1,248,273,249,-1,273,274,249,-1,250,275,251,-1,275,276,251,-1,251,276,252,-1,276,277,252,-1,252,277,253,-1,277,278,253,-1,253,278,254,-1,278,279,254,-1,254,279,255,-1,279,280,255,-1,255,280,256,-1,280,281,256,-1,256,281,257,-1,281,282,257,-1,257,282,258,-1,282,283,258,-1,258,283,259,-1,283,284,259,-1,259,284,260,-1,284,285,260,-1,260,285,261,-1,285,286,261,-1,261,286,262,-1,286,287,262,-1,262,287,263,-1,287,288,263,-1,263,288,264,-1,288,289,264,-1,264,289,265,-1,289,290,265,-1,265,290,266,-1,290,291,266,-1,266,291,267,-1,291,292,267,-1,267,292,268,-1,292,293,268,-1,268,293,269,-1,293,294,269,-1,269,294,270,-1,294,295,270,-1,270,295,271,-1,295,296,271,-1,271,296,272,-1,296,297,272,-1,272,297,273,-1,297,298,273,-1,273,298,274,-1,298,299,274,-1,275,300,276,-1,300,301,276,-1,276,301,277,-1,301,302,277,-1,277,302,278,-1,302,303,278,-1,278,303,279,-1,303,304,279,-1,279,304,280,-1,304,305,280,-1,280,305,281,-1,305,306,281,-1,281,306,282,-1,306,307,282,-1,282,307,283,-1,307,308,283,-1,283,308,284,-1,308,309,284,-1,284,309,285,-1,309,310,285,-1,285,310,286,-1,310,311,286,-1,286,311,287,-1,311,312,287,-1,287,312,288,-1,312,313,288,-1,288,313,289,-1,313,314,289,-1,289,314,290,-1,314,315,290,-1,290,315,291,-1,315,316,291,-1,291,316,292,-1,316,317,292,-1,292,317,293,-1,317,318,293,-1,293,318,294,-1,318,319,294,-1,294,319,295,-1,319,320,295,-1,295,320,296,-1,320,321,296,-1,296,321,297,-1,321,322,297,-1,297,322,298,-1,322,323,298,-1,298,323,299,-1,323,324,299,-1,300,325,301,-1,325,326,301,-1,301,326,302,-1,326,327,302,-1,302,327,303,-1,327,328,303,-1,303,328,304,-1,328,329,304,-1,304,329,305,-1,329,330,305,-1,305,330,306,-1,330,331,306,-1,306,331,307,-1,331,332,307,-1,307,332,308,-1,332,333,308,-1,308,333,309,-1,333,334,309,-1,309,334,310,-1,334,335,310,-1,310,335,311,-1,335,336,311,-1,311,336,312,-1,336,337,312,-1,312,337,313,-1,337,338,313,-1,313,338,314,-1,338,339,314,-1,314,339,315,-1,339,340,315,-1,315,340,316,-1,340,341,316,-1,316,341,317,-1,341,342,317,-1,317,342,318,-1,342,343,318,-1,318,343,319,-1,343,344,319,-1,319,344,320,-1,344,345,320,-1,320,345,321,-1,345,346,321,-1,321,346,322,-1,346,347,322,-1,322,347,323,-1,347,348,323,-1,323,348,324,-1,348,349,324,-1,325,350,326,-1,350,351,326,-1,326,351,327,-1,351,352,327,-1,327,352,328,-1,352,353,328,-1,328,353,329,-1,353,354,329,-1,329,354,330,-1,354,355,330,-1,330,355,331,-1,355,356,331,-1,331,356,332,-1,356,357,332,-1,332,357,333,-1,357,358,333,-1,333,358,334,-1,358,359,334,-1,334,359,335,-1,359,360,335,-1,335,360,336,-1,360,361,336,-1,336,361,337,-1,361,362,337,-1,337,362,338,-1,362,363,338,-1,338,363,339,-1,363,364,339,-1,339,364,340,-1,364,365,340,-1,340,365,341,-1,365,366,341,-1,341,366,342,-1,366,367,342,-1,342,367,343,-1,367,368,343,-1,343,368,344,-1,368,369,344,-1,344,369,345,-1,369,370,345,-1,345,370,346,-1,370,371,346,-1,346,371,347,-1,371,372,347,-1,347,372,348,-1,372,373,348,-1,348,373,349,-1,373,374,349,-1,350,375,351,-1,375,376,351,-1,351,376,352,-1,376,377,352,-1,352,377,353,-1,377,378,353,-1,353,378,354,-1,378,379,354,-1,354,379,355,-1,379,380,355,-1,355,380,356,-1,380,381,356,-1,356,381,357,-1,381,382,357,-1,357,382,358,-1,382,383,358,-1,358,383,359,-1,383,384,359,-1,359,384,360,-1,384,385,360,-1,360,385,361,-1,385,386,361,-1,361,386,362,-1,386,387,362,-1,362,387,363,-1,387,388,363,-1,363,388,364,-1,388,389,364,-1,364,389,365,-1,389,390,365,-1,365,390,366,-1,390,391,366,-1,366,391,367,-1,391,392,367,-1,367,392,368,-1,392,393,368,-1,368,393,369,-1,393,394,369,-1,369,394,370,-1,394,395,370,-1,370,395,371,-1,395,396,371,-1,371,396,372,-1,396,397,372,-1,372,397,373,-1,397,398,373,-1,373,398,374,-1,398,399,374,-1,375,400,376,-1,400,401,376,-1,376,401,377,-1,401,402,377,-1,377,402,378,-1,402,403,378,-1,378,403,379,-1,403,404,379,-1,379,404,380,-1,404,405,380,-1,380,405,381,-1,405,406,381,-1,381,406,382,-1,406,407,382,-1,382,407,383,-1,407,408,383,-1,383,408,384,-1,408,409,384,-1,384,409,385,-1,409,410,385,-1,385,410,386,-1,410,411,386,-1,386,411,387,-1,411,412,387,-1,387,412,388,-1,412,413,388,-1,388,413,389,-1,413,414,389,-1,389,414,390,-1,414,415,390,-1,390,415,391,-1,415,416,391,-1,391,416,392,-1,416,417,392,-1,392,417,393,-1,417,418,393,-1,393,418,394,-1,418,419,394,-1,394,419,395,-1,419,420,395,-1,395,420,396,-1,420,421,396,-1,396,421,397,-1,421,422,397,-1,397,422,398,-1,422,423,398,-1,398,423,399,-1,423,424,399,-1,400,425,401,-1,425,426,401,-1,401,426,402,-1,426,427,402,-1,402,427,403,-1,427,428,403,-1,403,428,404,-1,428,429,404,-1,404,429,405,-1,429,430,405,-1,405,430,406,-1,430,431,406,-1,406,431,407,-1,431,432,407,-1,407,432,408,-1,432,433,408,-1,408,433,409,-1,433,434,409,-1,409,434,410,-1,434,435,410,-1,410,435,411,-1,435,436,411,-1,411,436,412,-1,436,437,412,-1,412,437,413,-1,437,438,413,-1,413,438,414,-1,438,439,414,-1,414,439,415,-1,439,440,415,-1,415,440,416,-1,440,441,416,-1,416,441,417,-1,441,442,417,-1,417,442,418,-1,442,443,418,-1,418,443,419,-1,443,444,419,-1,419,444,420,-1,444,445,420,-1,420,445,421,-1,445,446,421,-1,421,446,422,-1,446,447,422,-1,422,447,423,-1,447,448,423,-1,423,448,424,-1,448,449,424,-1,425,450,426,-1,450,451,426,-1,426,451,427,-1,451,452,427,-1,427,452,428,-1,452,453,428,-1,428,453,429,-1,453,454,429,-1,429,454,430,-1,454,455,430,-1,430,455,431,-1,455,456,431,-1,431,456,432,-1,456,457,432,-1,432,457,433,-1,457,458,433,-1,433,458,434,-1,458,459,434,-1,434,459,435,-1,459,460,435,-1,435,460,436,-1,460,461,436,-1,436,461,437,-1,461,462,437,-1,437,462,438,-1,462,463,438,-1,438,463,439,-1,463,464,439,-1,439,464,440,-1,464,465,440,-1,440,465,441,-1,465,466,441,-1,441,466,442,-1,466,467,442,-1,442,467,443,-1,467,468,443,-1,443,468,444,-1,468,469,444,-1,444,469,445,-1,469,470,445,-1,445,470,446,-1,470,471,446,-1,446,471,447,-1,471,472,447,-1,447,472,448,-1,472,473,448,-1,448,473,449,-1,473,474,449,-1,450,475,451,-1,475,476,451,-1,451,476,452,-1,476,477,452,-1,452,477,453,-1,477,478,453,-1,453,478,454,-1,478,479,454,-1,454,479,455,-1,479,480,455,-1,455,480,456,-1,480,481,456,-1,456,481,457,-1,481,482,457,-1,457,482,458,-1,482,483,458,-1,458,483,459,-1,483,484,459,-1,459,484,460,-1,484,485,460,-1,460,485,461,-1,485,486,461,-1,461,486,462,-1,486,487,462,-1,462,487,463,-1,487,488,463,-1,463,488,464,-1,488,489,464,-1,464,489,465,-1,489,490,465,-1,465,490,466,-1,490,491,466,-1,466,491,467,-1,491,492,467,-1,467,492,468,-1,492,493,468,-1,468,493,469,-1,493,494,469,-1,469,494,470,-1,494,495,470,-1,470,495,471,-1,495,496,471,-1,471,496,472,-1,496,497,472,-1,472,497,473,-1,497,498,473,-1,473,498,474,-1,498,499,474,-1,475,500,476,-1,500,501,476,-1,476,501,477,-1,501,502,477,-1,477,502,478,-1,502,503,478,-1,478,503,479,-1,503,504,479,-1,479,504,480,-1,504,505,480,-1,480,505,481,-1,505,506,481,-1,481,506,482,-1,506,507,482,-1,482,507,483,-1,507,508,483,-1,483,508,484,-1,508,509,484,-1,484,509,485,-1,509,510,485,-1,485,510,486,-1,510,511,486,-1,486,511,487,-1,511,512,487,-1,487,512,488,-1,512,513,488,-1,488,513,489,-1,513,514,489,-1,489,514,490,-1,514,515,490,-1,490,515,491,-1,515,516,491,-1,491,516,492,-1,516,517,492,-1,492,517,493,-1,517,518,493,-1,493,518,494,-1,518,519,494,-1,494,519,495,-1,519,520,495,-1,495,520,496,-1,520,521,496,-1,496,521,497,-1,521,522,497,-1,497,522,498,-1,522,523,498,-1,498,523,499,-1,523,524,499,-1,500,525,501,-1,525,526,501,-1,501,526,502,-1,526,527,502,-1,502,527,503,-1,527,528,503,-1,503,528,504,-1,528,529,504,-1,504,529,505,-1,529,530,505,-1,505,530,506,-1,530,531,506,-1,506,531,507,-1,531,532,507,-1,507,532,508,-1,532,533,508,-1,508,533,509,-1,533,534,509,-1,509,534,510,-1,534,535,510,-1,510,535,511,-1,535,536,511,-1,511,536,512,-1,536,537,512,-1,512,537,513,-1,537,538,513,-1,513,538,514,-1,538,539,514,-1,514,539,515,-1,539,540,515,-1,515,540,516,-1,540,541,516,-1,516,541,517,-1,541,542,517,-1,517,542,518,-1,542,543,518,-1,518,543,519,-1,543,544,519,-1,519,544,520,-1,544,545,520,-1,520,545,521,-1,545,546,521,-1,521,546,522,-1,546,547,522,-1,522,547,523,-1,547,548,523,-1,523,548,524,-1,548,549,524,-1,525,550,526,-1,550,551,526,-1,526,551,527,-1,551,552,527,-1,527,552,528,-1,552,553,528,-1,528,553,529,-1,553,554,529,-1,529,554,530,-1,554,555,530,-1,530,555,531,-1,555,556,531,-1,531,556,532,-1,556,557,532,-1,532,557,533,-1,557,558,533,-1,533,558,534,-1,558,559,534,-1,534,559,535,-1,559,560,535,-1,535,560,536,-1,560,561,536,-1,536,561,537,-1,561,562,537,-1,537,562,538,-1,562,563,538,-1,538,563,539,-1,563,564,539,-1,539,564,540,-1,564,565,540,-1,540,565,541,-1,565,566,541,-1,541,566,542,-1,566,567,542,-1,542,567,543,-1,567,568,543,-1,543,568,544,-1,568,569,544,-1,544,569,545,-1,569,570,545,-1,545,570,546,-1,570,571,546,-1,546,571,547,-1,571,572,547,-1,547,572,548,-1,572,573,548,-1,548,573,549,-1,573,574,549,-1,550,575,551,-1,575,576,551,-1,551,576,552,-1,576,577,552,-1,552,577,553,-1,577,578,553,-1,553,578,554,-1,578,579,554,-1,554,579,555,-1,579,580,555,-1,555,580,556,-1,580,581,556,-1,556,581,557,-1,581,582,557,-1,557,582,558,-1,582,583,558,-1,558,583,559,-1,583,584,559,-1,559,584,560,-1,584,585,560,-1,560,585,561,-1,585,586,561,-1,561,586,562,-1,586,587,562,-1,562,587,563,-1,587,588,563,-1,563,588,564,-1,588,589,564,-1,564,589,565,-1,589,590,565,-1,565,590,566,-1,590,591,566,-1,566,591,567,-1,591,592,567,-1,567,592,568,-1,592,593,568,-1,568,593,569,-1,593,594,569,-1,569,594,570,-1,594,595,570,-1,570,595,571,-1,595,596,571,-1,571,596,572,-1,596,597,572,-1,572,597,573,-1,597,598,573,-1,573,598,574,-1,598,599,574,-1,575,600,576,-1,600,601,576,-1,576,601,577,-1,601,602,577,-1,577,602,578,-1,602,603,578,-1,578,603,579,-1,603,604,579,-1,579,604,580,-1,604,605,580,-1,580,605,581,-1,605,606,581,-1,581,606,582,-1,606,607,582,-1,582,607,583,-1,607,608,583,-1,583,608,584,-1,608,609,584,-1,584,609,585,-1,609,610,585,-1,585,610,586,-1,610,611,586,-1,586,611,587,-1,611,612,587,-1,587,612,588,-1,612,613,588,-1,588,613,589,-1,613,614,589,-1,589,614,590,-1,614,615,590,-1,590,615,591,-1,615,616,591,-1,591,616,592,-1,616,617,592,-1,592,617,593,-1,617,618,593,-1,593,618,594,-1,618,619,594,-1,594,619,595,-1,619,620,595,-1,595,620,596,-1,620,621,596,-1,596,621,597,-1,621,622,597,-1,597,622,598,-1,622,623,598,-1,598,623,599,-1,623,624,599,-1"><coordinate point="0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0.065403,0.997859,0,0.064844,0.997859,0.008537,0.063175,0.997859,0.016928,0.060425,0.997859,0.025029,0.056641,0.997859,0.032702,0.051888,0.997859,0.039815,0.046247,0.997859,0.046247,0.039815,0.997859,0.051888,0.032702,0.997859,0.056641,0.025029,0.997859,0.060425,0.016928,0.997859,0.063175,0.008537,0.997859,0.064844,0,0.997859,0.065403,-0.008537,0.997859,0.064844,-0.016928,0.997859,0.063175,-0.025029,0.997859,0.060425,-0.032702,0.997859,0.056641,-0.039815,0.997859,0.051888,-0.046247,0.997859,0.046247,-0.051888,0.997859,0.039815,-0.056641,0.997859,0.032702,-0.060425,0.997859,0.025029,-0.063175,0.997859,0.016928,-0.064844,0.997859,0.008537,-0.065403,0.997859,0,0.130526,0.991445,0,0.12941,0.991445,0.017037,0.126079,0.991445,0.033783,0.12059,0.991445,0.04995,0.113039,0.991445,0.065263,0.103553,0.991445,0.079459,0.092296,0.991445,0.092296,0.079459,0.991445,0.103553,0.065263,0.991445,0.113039,0.04995,0.991445,0.12059,0.033783,0.991445,0.126079,0.017037,0.991445,0.12941,0,0.991445,0.130526,-0.017037,0.991445,0.12941,-0.033783,0.991445,0.126079,-0.04995,0.991445,0.12059,-0.065263,0.991445,0.113039,-0.079459,0.991445,0.103553,-0.092296,0.991445,0.092296,-0.103553,0.991445,0.079459,-0.113039,0.991445,0.065263,-0.12059,0.991445,0.04995,-0.126079,0.991445,0.033783,-0.12941,0.991445,0.017037,-0.130526,0.991445,0,0.19509,0.980785,0,0.193421,0.980785,0.025464,0.188443,0.980785,0.050493,0.18024,0.980785,0.074658,0.168953,0.980785,0.097545,0.154776,0.980785,0.118763,0.13795,0.980785,0.13795,0.118763,0.980785,0.154776,0.097545,0.980785,0.168953,0.074658,0.980785,0.18024,0.050493,0.980785,0.188443,0.025464,0.980785,0.193421,0,0.980785,0.19509,-0.025464,0.980785,0.193421,-0.050493,0.980785,0.188443,-0.074658,0.980785,0.18024,-0.097545,0.980785,0.168953,-0.118763,0.980785,0.154776,-0.13795,0.980785,0.13795,-0.154776,0.980785,0.118763,-0.168953,0.980785,0.097545,-0.18024,0.980785,0.074658,-0.188443,0.980785,0.050493,-0.193421,0.980785,0.025464,-0.19509,0.980785,0,0.258819,0.965926,0,0.256605,0.965926,0.033783,0.25,0.965926,0.066987,0.239118,0.965926,0.099046,0.224144,0.965926,0.12941,0.205335,0.965926,0.157559,0.183013,0.965926,0.183013,0.157559,0.965926,0.205335,0.12941,0.965926,0.224144,0.099046,0.965926,0.239118,0.066987,0.965926,0.25,0.033783,0.965926,0.256605,0,0.965926,0.258819,-0.033783,0.965926,0.256605,-0.066987,0.965926,0.25,-0.099046,0.965926,0.239118,-0.12941,0.965926,0.224144,-0.157559,0.965926,0.205335,-0.183013,0.965926,0.183013,-0.205335,0.965926,0.157559,-0.224144,0.965926,0.12941,-0.239118,0.965926,0.099046,-0.25,0.965926,0.066987,-0.256605,0.965926,0.033783,-0.258819,0.965926,0,0.321439,0.94693,0,0.31869,0.94693,0.041956,0.310487,0.94693,0.083195,0.296971,0.94693,0.12301,0.278375,0.94693,0.16072,0.255015,0.94693,0.19568,0.227292,0.94693,0.227292,0.19568,0.94693,0.255015,0.16072,0.94693,0.278375,0.12301,0.94693,0.296971,0.083195,0.94693,0.310487,0.041956,0.94693,0.31869,0,0.94693,0.321439,-0.041956,0.94693,0.31869,-0.083195,0.94693,0.310487,-0.12301,0.94693,0.296971,-0.16072,0.94693,0.278375,-0.19568,0.94693,0.255015,-0.227292,0.94693,0.227292,-0.255015,0.94693,0.19568,-0.278375,0.94693,0.16072,-0.296971,0.94693,0.12301,-0.310487,0.94693,0.083195,-0.31869,0.94693,0.041956,-0.321439,0.94693,0,0.382683,0.92388,0,0.37941,0.92388,0.04995,0.369644,0.92388,0.099046,0.353553,0.92388,0.146447,0.331414,0.92388,0.191342,0.303603,0.92388,0.232963,0.270598,0.92388,0.270598,0.232963,0.92388,0.303603,0.191342,0.92388,0.331414,0.146447,0.92388,0.353553,0.099046,0.92388,0.369644,0.04995,0.92388,0.37941,0,0.92388,0.382683,-0.04995,0.92388,0.37941,-0.099046,0.92388,0.369644,-0.146447,0.92388,0.353553,-0.191342,0.92388,0.331414,-0.232963,0.92388,0.303603,-0.270598,0.92388,0.270598,-0.303603,0.92388,0.232963,-0.331414,0.92388,0.191342,-0.353553,0.92388,0.146447,-0.369644,0.92388,0.099046,-0.37941,0.92388,0.04995,-0.382683,0.92388,0,0.442289,0.896873,0,0.438505,0.896873,0.05773,0.427218,0.896873,0.114473,0.408621,0.896873,0.169257,0.383033,0.896873,0.221144,0.350891,0.896873,0.269248,0.312745,0.896873,0.312745,0.269248,0.896873,0.350891,0.221144,0.896873,0.383033,0.169257,0.896873,0.408621,0.114473,0.896873,0.427218,0.05773,0.896873,0.438505,0,0.896873,0.442289,-0.05773,0.896873,0.438505,-0.114473,0.896873,0.427218,-0.169257,0.896873,0.408621,-0.221144,0.896873,0.383033,-0.269248,0.896873,0.350891,-0.312745,0.896873,0.312745,-0.350891,0.896873,0.269248,-0.383033,0.896873,0.221144,-0.408621,0.896873,0.169257,-0.427218,0.896873,0.114473,-0.438505,0.896873,0.05773,-0.442289,0.896873,0,0.5,0.866025,0,0.495722,0.866025,0.065263,0.482963,0.866025,0.12941,0.46194,0.866025,0.191342,0.433013,0.866025,0.25,0.396677,0.866025,0.304381,0.353553,0.866025,0.353553,0.304381,0.866025,0.396677,0.25,0.866025,0.433013,0.191342,0.866025,0.46194,0.12941,0.866025,0.482963,0.065263,0.866025,0.495722,0,0.866025,0.5,-0.065263,0.866025,0.495722,-0.12941,0.866025,0.482963,-0.191342,0.866025,0.46194,-0.25,0.866025,0.433013,-0.304381,0.866025,0.396677,-0.353553,0.866025,0.353553,-0.396677,0.866025,0.304381,-0.433013,0.866025,0.25,-0.46194,0.866025,0.191342,-0.482963,0.866025,0.12941,-0.495722,0.866025,0.065263,-0.5,0.866025,0,0.55557,0.83147,0,0.550817,0.83147,0.072516,0.53664,0.83147,0.143792,0.51328,0.83147,0.212608,0.481138,0.83147,0.277785,0.440764,0.83147,0.33821,0.392847,0.83147,0.392847,0.33821,0.83147,0.440764,0.277785,0.83147,0.481138,0.212608,0.83147,0.51328,0.143792,0.83147,0.53664,0.072516,0.83147,0.550817,0,0.83147,0.55557,-0.072516,0.83147,0.550817,-0.143792,0.83147,0.53664,-0.212608,0.83147,0.51328,-0.277785,0.83147,0.481138,-0.33821,0.83147,0.440764,-0.392847,0.83147,0.392847,-0.440764,0.83147,0.33821,-0.481138,0.83147,0.277785,-0.51328,0.83147,0.212608,-0.53664,0.83147,0.143792,-0.550817,0.83147,0.072516,-0.55557,0.83147,0,0.608761,0.793353,0,0.603553,0.793353,0.079459,0.588018,0.793353,0.157559,0.562422,0.793353,0.232963,0.527203,0.793353,0.304381,0.482963,0.793353,0.37059,0.430459,0.793353,0.430459,0.37059,0.793353,0.482963,0.304381,0.793353,0.527203,0.232963,0.793353,0.562422,0.157559,0.793353,0.588018,0.079459,0.793353,0.603553,0,0.793353,0.608761,-0.079459,0.793353,0.603553,-0.157559,0.793353,0.588018,-0.232963,0.793353,0.562422,-0.304381,0.793353,0.527203,-0.37059,0.793353,0.482963,-0.430459,0.793353,0.430459,-0.482963,0.793353,0.37059,-0.527203,0.793353,0.304381,-0.562422,0.793353,0.232963,-0.588018,0.793353,0.157559,-0.603553,0.793353,0.079459,-0.608761,0.793353,0,0.659346,0.75184,0,0.653705,0.75184,0.086062,0.636879,0.75184,0.170651,0.609156,0.75184,0.252321,0.57101,0.75184,0.329673,0.523094,0.75184,0.401384,0.466228,0.75184,0.466228,0.401384,0.75184,0.523094,0.329673,0.75184,0.57101,0.252321,0.75184,0.609156,0.170651,0.75184,0.636879,0.086062,0.75184,0.653705,0,0.75184,0.659346,-0.086062,0.75184,0.653705,-0.170651,0.75184,0.636879,-0.252321,0.75184,0.609156,-0.329673,0.75184,0.57101,-0.401384,0.75184,0.523094,-0.466228,0.75184,0.466228,-0.523094,0.75184,0.401384,-0.57101,0.75184,0.329673,-0.609156,0.75184,0.252321,-0.636879,0.75184,0.170651,-0.653705,0.75184,0.086062,-0.659346,0.75184,0,0.707107,0.707107,0,0.701057,0.707107,0.092296,0.683013,0.707107,0.183013,0.653281,0.707107,0.270598,0.612372,0.707107,0.353553,0.560986,0.707107,0.430459,0.5,0.707107,0.5,0.430459,0.707107,0.560986,0.353553,0.707107,0.612372,0.270598,0.707107,0.653281,0.183013,0.707107,0.683013,0.092296,0.707107,0.701057,0,0.707107,0.707107,-0.092296,0.707107,0.701057,-0.183013,0.707107,0.683013,-0.270598,0.707107,0.653281,-0.353553,0.707107,0.612372,-0.430459,0.707107,0.560986,-0.5,0.707107,0.5,-0.560986,0.707107,0.430459,-0.612372,0.707107,0.353553,-0.653281,0.707107,0.270598,-0.683013,0.707107,0.183013,-0.701057,0.707107,0.092296,-0.707107,0.707107,0,0.75184,0.659346,0,0.745408,0.659346,0.098135,0.726221,0.659346,0.19459,0.694609,0.659346,0.287717,0.651112,0.659346,0.37592,0.596475,0.659346,0.457691,0.531631,0.659346,0.531631,0.457691,0.659346,0.596475,0.37592,0.659346,0.651112,0.287717,0.659346,0.694609,0.19459,0.659346,0.726221,0.098135,0.659346,0.745408,0,0.659346,0.75184,-0.098135,0.659346,0.745408,-0.19459,0.659346,0.726221,-0.287717,0.659346,0.694609,-0.37592,0.659346,0.651112,-0.457691,0.659346,0.596475,-0.531631,0.659346,0.531631,-0.596475,0.659346,0.457691,-0.651112,0.659346,0.37592,-0.694609,0.659346,0.287717,-0.726221,0.659346,0.19459,-0.745408,0.659346,0.098135,-0.75184,0.659346,0,0.793353,0.608761,0,0.786566,0.608761,0.103553,0.76632,0.608761,0.205335,0.732963,0.608761,0.303603,0.687064,0.608761,0.396677,0.62941,0.608761,0.482963,0.560986,0.608761,0.560986,0.482963,0.608761,0.62941,0.396677,0.608761,0.687064,0.303603,0.608761,0.732963,0.205335,0.608761,0.76632,0.103553,0.608761,0.786566,0,0.608761,0.793353,-0.103553,0.608761,0.786566,-0.205335,0.608761,0.76632,-0.303603,0.608761,0.732963,-0.396677,0.608761,0.687064,-0.482963,0.608761,0.62941,-0.560986,0.608761,0.560986,-0.62941,0.608761,0.482963,-0.687064,0.608761,0.396677,-0.732963,0.608761,0.303603,-0.76632,0.608761,0.205335,-0.786566,0.608761,0.103553,-0.793353,0.608761,0,0.83147,0.55557,0,0.824356,0.55557,0.108529,0.803138,0.55557,0.2152,0.768178,0.55557,0.31819,0.720074,0.55557,0.415735,0.659649,0.55557,0.506167,0.587938,0.55557,0.587938,0.506167,0.55557,0.659649,0.415735,0.55557,0.720074,0.31819,0.55557,0.768178,0.2152,0.55557,0.803138,0.108529,0.55557,0.824356,0,0.55557,0.83147,-0.108529,0.55557,0.824356,-0.2152,0.55557,0.803138,-0.31819,0.55557,0.768178,-0.415735,0.55557,0.720074,-0.506167,0.55557,0.659649,-0.587938,0.55557,0.587938,-0.659649,0.55557,0.506167,-0.720074,0.55557,0.415735,-0.768178,0.55557,0.31819,-0.803138,0.55557,0.2152,-0.824356,0.55557,0.108529,-0.83147,0.55557,0,0.866025,0.5,0,0.858616,0.5,0.113039,0.836516,0.5,0.224144,0.800103,0.5,0.331414,0.75,0.5,0.433013,0.687064,0.5,0.527203,0.612372,0.5,0.612372,0.527203,0.5,0.687064,0.433013,0.5,0.75,0.331414,0.5,0.800103,0.224144,0.5,0.836516,0.113039,0.5,0.858616,0,0.5,0.866025,-0.113039,0.5,0.858616,-0.224144,0.5,0.836516,-0.331414,0.5,0.800103,-0.433013,0.5,0.75,-0.527203,0.5,0.687064,-0.612372,0.5,0.612372,-0.687064,0.5,0.527203,-0.75,0.5,0.433013,-0.800103,0.5,0.331414,-0.836516,0.5,0.224144,-0.858616,0.5,0.113039,-0.866025,0.5,0,0.896873,0.442289,0,0.8892,0.442289,0.117065,0.866313,0.442289,0.232128,0.828602,0.442289,0.343218,0.776715,0.442289,0.448436,0.711537,0.442289,0.545982,0.634185,0.442289,0.634185,0.545982,0.442289,0.711537,0.448436,0.442289,0.776715,0.343218,0.442289,0.828602,0.232128,0.442289,0.866313,0.117065,0.442289,0.8892,0,0.442289,0.896873,-0.117065,0.442289,0.8892,-0.232128,0.442289,0.866313,-0.343218,0.442289,0.828602,-0.448436,0.442289,0.776715,-0.545982,0.442289,0.711537,-0.634185,0.442289,0.634185,-0.711537,0.442289,0.545982,-0.776715,0.442289,0.448436,-0.828602,0.442289,0.343218,-0.866313,0.442289,0.232128,-0.8892,0.442289,0.117065,-0.896873,0.442289,0,0.92388,0.382683,0,0.915976,0.382683,0.12059,0.892399,0.382683,0.239118,0.853553,0.382683,0.353553,0.800103,0.382683,0.46194,0.732963,0.382683,0.562422,0.653281,0.382683,0.653281,0.562422,0.382683,0.732963,0.46194,0.382683,0.800103,0.353553,0.382683,0.853553,0.239118,0.382683,0.892399,0.12059,0.382683,0.915976,0,0.382683,0.92388,-0.12059,0.382683,0.915976,-0.239118,0.382683,0.892399,-0.353553,0.382683,0.853553,-0.46194,0.382683,0.800103,-0.562422,0.382683,0.732963,-0.653281,0.382683,0.653281,-0.732963,0.382683,0.562422,-0.800103,0.382683,0.46194,-0.853553,0.382683,0.353553,-0.892399,0.382683,0.239118,-0.915976,0.382683,0.12059,-0.92388,0.382683,0,0.94693,0.321439,0,0.938829,0.321439,0.123599,0.914664,0.321439,0.245084,0.874849,0.321439,0.362374,0.820066,0.321439,0.473465,0.75125,0.321439,0.576455,0.669581,0.321439,0.669581,0.576455,0.321439,0.75125,0.473465,0.321439,0.820066,0.362374,0.321439,0.874849,0.245084,0.321439,0.914664,0.123599,0.321439,0.938829,0,0.321439,0.94693,-0.123599,0.321439,0.938829,-0.245084,0.321439,0.914664,-0.362374,0.321439,0.874849,-0.473465,0.321439,0.820066,-0.576455,0.321439,0.75125,-0.669581,0.321439,0.669581,-0.75125,0.321439,0.576455,-0.820066,0.321439,0.473465,-0.874849,0.321439,0.362374,-0.914664,0.321439,0.245084,-0.938829,0.321439,0.123599,-0.94693,0.321439,0,0.965926,0.258819,0,0.957662,0.258819,0.126079,0.933013,0.258819,0.25,0.892399,0.258819,0.369644,0.836516,0.258819,0.482963,0.76632,0.258819,0.588018,0.683013,0.258819,0.683013,0.588018,0.258819,0.76632,0.482963,0.258819,0.836516,0.369644,0.258819,0.892399,0.25,0.258819,0.933013,0.126079,0.258819,0.957662,0,0.258819,0.965926,-0.126079,0.258819,0.957662,-0.25,0.258819,0.933013,-0.369644,0.258819,0.892399,-0.482963,0.258819,0.836516,-0.588018,0.258819,0.76632,-0.683013,0.258819,0.683013,-0.76632,0.258819,0.588018,-0.836516,0.258819,0.482963,-0.892399,0.258819,0.369644,-0.933013,0.258819,0.25,-0.957662,0.258819,0.126079,-0.965926,0.258819,0,0.980785,0.19509,0,0.972395,0.19509,0.128018,0.947366,0.19509,0.253846,0.906127,0.19509,0.37533,0.849385,0.19509,0.490393,0.778109,0.19509,0.597064,0.69352,0.19509,0.69352,0.597064,0.19509,0.778109,0.490393,0.19509,0.849385,0.37533,0.19509,0.906127,0.253846,0.19509,0.947366,0.128018,0.19509,0.972395,0,0.19509,0.980785,-0.128018,0.19509,0.972395,-0.253846,0.19509,0.947366,-0.37533,0.19509,0.906127,-0.490393,0.19509,0.849385,-0.597064,0.19509,0.778109,-0.69352,0.19509,0.69352,-0.778109,0.19509,0.597064,-0.849385,0.19509,0.490393,-0.906127,0.19509,0.37533,-0.947366,0.19509,0.253846,-0.972395,0.19509,0.128018,-0.980785,0.19509,0,0.991445,0.130526,0,0.982963,0.130526,0.12941,0.957662,0.130526,0.256605,0.915976,0.130526,0.37941,0.858616,0.130526,0.495722,0.786566,0.130526,0.603553,0.701057,0.130526,0.701057,0.603553,0.130526,0.786566,0.495722,0.130526,0.858616,0.37941,0.130526,0.915976,0.256605,0.130526,0.957662,0.12941,0.130526,0.982963,0,0.130526,0.991445,-0.12941,0.130526,0.982963,-0.256605,0.130526,0.957662,-0.37941,0.130526,0.915976,-0.495722,0.130526,0.858616,-0.603553,0.130526,0.786566,-0.701057,0.130526,0.701057,-0.786566,0.130526,0.603553,-0.858616,0.130526,0.495722,-0.915976,0.130526,0.37941,-0.957662,0.130526,0.256605,-0.982963,0.130526,0.12941,-0.991445,0.130526,0,0.997859,0.065403,0,0.989322,0.065403,0.130247,0.963858,0.065403,0.258265,0.921901,0.065403,0.381864,0.864171,0.065403,0.498929,0.791655,0.065403,0.607458,0.705593,0.065403,0.705593,0.607458,0.065403,0.791655,0.498929,0.065403,0.864171,0.381864,0.065403,0.921901,0.258265,0.065403,0.963858,0.130247,0.065403,0.989322,0,0.065403,0.997859,-0.130247,0.065403,0.989322,-0.258265,0.065403,0.963858,-0.381864,0.065403,0.921901,-0.498929,0.065403,0.864171,-0.607458,0.065403,0.791655,-0.705593,0.065403,0.705593,-0.791655,0.065403,0.607458,-0.864171,0.065403,0.498929,-0.921901,0.065403,0.381864,-0.963858,0.065403,0.258265,-0.989322,0.065403,0.130247,-0.997859,0.065403,0,1,0,0,0.991445,0,0.130526,0.965926,0,0.258819,0.92388,0,0.382683,0.866025,0,0.5,0.793353,0,0.608761,0.707107,0,0.707107,0.608761,0,0.793353,0.5,0,0.866025,0.382683,0,0.92388,0.258819,0,0.965926,0.130526,0,0.991445,0,0,1,-0.130526,0,0.991445,-0.258819,0,0.965926,-0.382683,0,0.92388,-0.5,0,0.866025,-0.608761,0,0.793353,-0.707107,0,0.707107,-0.793353,0,0.608761,-0.866025,0,0.5,-0.92388,0,0.382683,-0.965926,0,0.258819,-0.991445,0,0.130526,-1,0,0"></coordinate></indexedfaceset></shape></transform><transform render="false" visible="false"><shape><indexedfaceset def="quarter-2" solid="false" creaseangle="0" coordindex="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,-1,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,-1,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,-1,0,75,24,-1,25,75,49,-1,50,75,74,-1"><coordinate point="1,0,0,0.991445,0,0.130526,0.965926,0,0.258819,0.92388,0,0.382683,0.866025,0,0.5,0.793353,0,0.608761,0.707107,0,0.707107,0.608761,0,0.793353,0.5,0,0.866025,0.382683,0,0.92388,0.258819,0,0.965926,0.130526,0,0.991445,0,0,1,-0.130526,0,0.991445,-0.258819,0,0.965926,-0.382683,0,0.92388,-0.5,0,0.866025,-0.608761,0,0.793353,-0.707107,0,0.707107,-0.793353,0,0.608761,-0.866025,0,0.5,-0.92388,0,0.382683,-0.965926,0,0.258819,-0.991445,0,0.130526,-1,0,0,0,1,0,0.065403,0.997859,0,0.130526,0.991445,0,0.19509,0.980785,0,0.258819,0.965926,0,0.321439,0.94693,0,0.382683,0.92388,0,0.442289,0.896873,0,0.5,0.866025,0,0.55557,0.83147,0,0.608761,0.793353,0,0.659346,0.75184,0,0.707107,0.707107,0,0.75184,0.659346,0,0.793353,0.608761,0,0.83147,0.55557,0,0.866025,0.5,0,0.896873,0.442289,0,0.92388,0.382683,0,0.94693,0.321439,0,0.965926,0.258819,0,0.980785,0.19509,0,0.991445,0.130526,0,0.997859,0.065403,0,1,0,0,0,1,0,-0.065403,0.997859,0,-0.130526,0.991445,0,-0.19509,0.980785,0,-0.258819,0.965926,0,-0.321439,0.94693,0,-0.382683,0.92388,0,-0.442289,0.896873,0,-0.5,0.866025,0,-0.55557,0.83147,0,-0.608761,0.793353,0,-0.659346,0.75184,0,-0.707107,0.707107,0,-0.75184,0.659346,0,-0.793353,0.608761,0,-0.83147,0.55557,0,-0.866025,0.5,0,-0.896873,0.442289,0,-0.92388,0.382683,0,-0.94693,0.321439,0,-0.965926,0.258819,0,-0.980785,0.19509,0,-0.991445,0.130526,0,-0.997859,0.065403,0,-1,0,0,0,0,0"></coordinate></indexedfaceset></shape></transform><transform render="false" visible="false"><shape><indexedfaceset def="octant-1" solid="false" creaseangle="3.14" coordindex="0,25,1,-1,25,26,1,-1,1,26,2,-1,26,27,2,-1,2,27,3,-1,27,28,3,-1,3,28,4,-1,28,29,4,-1,4,29,5,-1,29,30,5,-1,5,30,6,-1,30,31,6,-1,6,31,7,-1,31,32,7,-1,7,32,8,-1,32,33,8,-1,8,33,9,-1,33,34,9,-1,9,34,10,-1,34,35,10,-1,10,35,11,-1,35,36,11,-1,11,36,12,-1,36,37,12,-1,12,37,13,-1,37,38,13,-1,13,38,14,-1,38,39,14,-1,14,39,15,-1,39,40,15,-1,15,40,16,-1,40,41,16,-1,16,41,17,-1,41,42,17,-1,17,42,18,-1,42,43,18,-1,18,43,19,-1,43,44,19,-1,19,44,20,-1,44,45,20,-1,20,45,21,-1,45,46,21,-1,21,46,22,-1,46,47,22,-1,22,47,23,-1,47,48,23,-1,23,48,24,-1,48,49,24,-1,25,50,26,-1,50,51,26,-1,26,51,27,-1,51,52,27,-1,27,52,28,-1,52,53,28,-1,28,53,29,-1,53,54,29,-1,29,54,30,-1,54,55,30,-1,30,55,31,-1,55,56,31,-1,31,56,32,-1,56,57,32,-1,32,57,33,-1,57,58,33,-1,33,58,34,-1,58,59,34,-1,34,59,35,-1,59,60,35,-1,35,60,36,-1,60,61,36,-1,36,61,37,-1,61,62,37,-1,37,62,38,-1,62,63,38,-1,38,63,39,-1,63,64,39,-1,39,64,40,-1,64,65,40,-1,40,65,41,-1,65,66,41,-1,41,66,42,-1,66,67,42,-1,42,67,43,-1,67,68,43,-1,43,68,44,-1,68,69,44,-1,44,69,45,-1,69,70,45,-1,45,70,46,-1,70,71,46,-1,46,71,47,-1,71,72,47,-1,47,72,48,-1,72,73,48,-1,48,73,49,-1,73,74,49,-1,50,75,51,-1,75,76,51,-1,51,76,52,-1,76,77,52,-1,52,77,53,-1,77,78,53,-1,53,78,54,-1,78,79,54,-1,54,79,55,-1,79,80,55,-1,55,80,56,-1,80,81,56,-1,56,81,57,-1,81,82,57,-1,57,82,58,-1,82,83,58,-1,58,83,59,-1,83,84,59,-1,59,84,60,-1,84,85,60,-1,60,85,61,-1,85,86,61,-1,61,86,62,-1,86,87,62,-1,62,87,63,-1,87,88,63,-1,63,88,64,-1,88,89,64,-1,64,89,65,-1,89,90,65,-1,65,90,66,-1,90,91,66,-1,66,91,67,-1,91,92,67,-1,67,92,68,-1,92,93,68,-1,68,93,69,-1,93,94,69,-1,69,94,70,-1,94,95,70,-1,70,95,71,-1,95,96,71,-1,71,96,72,-1,96,97,72,-1,72,97,73,-1,97,98,73,-1,73,98,74,-1,98,99,74,-1,75,100,76,-1,100,101,76,-1,76,101,77,-1,101,102,77,-1,77,102,78,-1,102,103,78,-1,78,103,79,-1,103,104,79,-1,79,104,80,-1,104,105,80,-1,80,105,81,-1,105,106,81,-1,81,106,82,-1,106,107,82,-1,82,107,83,-1,107,108,83,-1,83,108,84,-1,108,109,84,-1,84,109,85,-1,109,110,85,-1,85,110,86,-1,110,111,86,-1,86,111,87,-1,111,112,87,-1,87,112,88,-1,112,113,88,-1,88,113,89,-1,113,114,89,-1,89,114,90,-1,114,115,90,-1,90,115,91,-1,115,116,91,-1,91,116,92,-1,116,117,92,-1,92,117,93,-1,117,118,93,-1,93,118,94,-1,118,119,94,-1,94,119,95,-1,119,120,95,-1,95,120,96,-1,120,121,96,-1,96,121,97,-1,121,122,97,-1,97,122,98,-1,122,123,98,-1,98,123,99,-1,123,124,99,-1,100,125,101,-1,125,126,101,-1,101,126,102,-1,126,127,102,-1,102,127,103,-1,127,128,103,-1,103,128,104,-1,128,129,104,-1,104,129,105,-1,129,130,105,-1,105,130,106,-1,130,131,106,-1,106,131,107,-1,131,132,107,-1,107,132,108,-1,132,133,108,-1,108,133,109,-1,133,134,109,-1,109,134,110,-1,134,135,110,-1,110,135,111,-1,135,136,111,-1,111,136,112,-1,136,137,112,-1,112,137,113,-1,137,138,113,-1,113,138,114,-1,138,139,114,-1,114,139,115,-1,139,140,115,-1,115,140,116,-1,140,141,116,-1,116,141,117,-1,141,142,117,-1,117,142,118,-1,142,143,118,-1,118,143,119,-1,143,144,119,-1,119,144,120,-1,144,145,120,-1,120,145,121,-1,145,146,121,-1,121,146,122,-1,146,147,122,-1,122,147,123,-1,147,148,123,-1,123,148,124,-1,148,149,124,-1,125,150,126,-1,150,151,126,-1,126,151,127,-1,151,152,127,-1,127,152,128,-1,152,153,128,-1,128,153,129,-1,153,154,129,-1,129,154,130,-1,154,155,130,-1,130,155,131,-1,155,156,131,-1,131,156,132,-1,156,157,132,-1,132,157,133,-1,157,158,133,-1,133,158,134,-1,158,159,134,-1,134,159,135,-1,159,160,135,-1,135,160,136,-1,160,161,136,-1,136,161,137,-1,161,162,137,-1,137,162,138,-1,162,163,138,-1,138,163,139,-1,163,164,139,-1,139,164,140,-1,164,165,140,-1,140,165,141,-1,165,166,141,-1,141,166,142,-1,166,167,142,-1,142,167,143,-1,167,168,143,-1,143,168,144,-1,168,169,144,-1,144,169,145,-1,169,170,145,-1,145,170,146,-1,170,171,146,-1,146,171,147,-1,171,172,147,-1,147,172,148,-1,172,173,148,-1,148,173,149,-1,173,174,149,-1,150,175,151,-1,175,176,151,-1,151,176,152,-1,176,177,152,-1,152,177,153,-1,177,178,153,-1,153,178,154,-1,178,179,154,-1,154,179,155,-1,179,180,155,-1,155,180,156,-1,180,181,156,-1,156,181,157,-1,181,182,157,-1,157,182,158,-1,182,183,158,-1,158,183,159,-1,183,184,159,-1,159,184,160,-1,184,185,160,-1,160,185,161,-1,185,186,161,-1,161,186,162,-1,186,187,162,-1,162,187,163,-1,187,188,163,-1,163,188,164,-1,188,189,164,-1,164,189,165,-1,189,190,165,-1,165,190,166,-1,190,191,166,-1,166,191,167,-1,191,192,167,-1,167,192,168,-1,192,193,168,-1,168,193,169,-1,193,194,169,-1,169,194,170,-1,194,195,170,-1,170,195,171,-1,195,196,171,-1,171,196,172,-1,196,197,172,-1,172,197,173,-1,197,198,173,-1,173,198,174,-1,198,199,174,-1,175,200,176,-1,200,201,176,-1,176,201,177,-1,201,202,177,-1,177,202,178,-1,202,203,178,-1,178,203,179,-1,203,204,179,-1,179,204,180,-1,204,205,180,-1,180,205,181,-1,205,206,181,-1,181,206,182,-1,206,207,182,-1,182,207,183,-1,207,208,183,-1,183,208,184,-1,208,209,184,-1,184,209,185,-1,209,210,185,-1,185,210,186,-1,210,211,186,-1,186,211,187,-1,211,212,187,-1,187,212,188,-1,212,213,188,-1,188,213,189,-1,213,214,189,-1,189,214,190,-1,214,215,190,-1,190,215,191,-1,215,216,191,-1,191,216,192,-1,216,217,192,-1,192,217,193,-1,217,218,193,-1,193,218,194,-1,218,219,194,-1,194,219,195,-1,219,220,195,-1,195,220,196,-1,220,221,196,-1,196,221,197,-1,221,222,197,-1,197,222,198,-1,222,223,198,-1,198,223,199,-1,223,224,199,-1,200,225,201,-1,225,226,201,-1,201,226,202,-1,226,227,202,-1,202,227,203,-1,227,228,203,-1,203,228,204,-1,228,229,204,-1,204,229,205,-1,229,230,205,-1,205,230,206,-1,230,231,206,-1,206,231,207,-1,231,232,207,-1,207,232,208,-1,232,233,208,-1,208,233,209,-1,233,234,209,-1,209,234,210,-1,234,235,210,-1,210,235,211,-1,235,236,211,-1,211,236,212,-1,236,237,212,-1,212,237,213,-1,237,238,213,-1,213,238,214,-1,238,239,214,-1,214,239,215,-1,239,240,215,-1,215,240,216,-1,240,241,216,-1,216,241,217,-1,241,242,217,-1,217,242,218,-1,242,243,218,-1,218,243,219,-1,243,244,219,-1,219,244,220,-1,244,245,220,-1,220,245,221,-1,245,246,221,-1,221,246,222,-1,246,247,222,-1,222,247,223,-1,247,248,223,-1,223,248,224,-1,248,249,224,-1,225,250,226,-1,250,251,226,-1,226,251,227,-1,251,252,227,-1,227,252,228,-1,252,253,228,-1,228,253,229,-1,253,254,229,-1,229,254,230,-1,254,255,230,-1,230,255,231,-1,255,256,231,-1,231,256,232,-1,256,257,232,-1,232,257,233,-1,257,258,233,-1,233,258,234,-1,258,259,234,-1,234,259,235,-1,259,260,235,-1,235,260,236,-1,260,261,236,-1,236,261,237,-1,261,262,237,-1,237,262,238,-1,262,263,238,-1,238,263,239,-1,263,264,239,-1,239,264,240,-1,264,265,240,-1,240,265,241,-1,265,266,241,-1,241,266,242,-1,266,267,242,-1,242,267,243,-1,267,268,243,-1,243,268,244,-1,268,269,244,-1,244,269,245,-1,269,270,245,-1,245,270,246,-1,270,271,246,-1,246,271,247,-1,271,272,247,-1,247,272,248,-1,272,273,248,-1,248,273,249,-1,273,274,249,-1,250,275,251,-1,275,276,251,-1,251,276,252,-1,276,277,252,-1,252,277,253,-1,277,278,253,-1,253,278,254,-1,278,279,254,-1,254,279,255,-1,279,280,255,-1,255,280,256,-1,280,281,256,-1,256,281,257,-1,281,282,257,-1,257,282,258,-1,282,283,258,-1,258,283,259,-1,283,284,259,-1,259,284,260,-1,284,285,260,-1,260,285,261,-1,285,286,261,-1,261,286,262,-1,286,287,262,-1,262,287,263,-1,287,288,263,-1,263,288,264,-1,288,289,264,-1,264,289,265,-1,289,290,265,-1,265,290,266,-1,290,291,266,-1,266,291,267,-1,291,292,267,-1,267,292,268,-1,292,293,268,-1,268,293,269,-1,293,294,269,-1,269,294,270,-1,294,295,270,-1,270,295,271,-1,295,296,271,-1,271,296,272,-1,296,297,272,-1,272,297,273,-1,297,298,273,-1,273,298,274,-1,298,299,274,-1,275,300,276,-1,300,301,276,-1,276,301,277,-1,301,302,277,-1,277,302,278,-1,302,303,278,-1,278,303,279,-1,303,304,279,-1,279,304,280,-1,304,305,280,-1,280,305,281,-1,305,306,281,-1,281,306,282,-1,306,307,282,-1,282,307,283,-1,307,308,283,-1,283,308,284,-1,308,309,284,-1,284,309,285,-1,309,310,285,-1,285,310,286,-1,310,311,286,-1,286,311,287,-1,311,312,287,-1,287,312,288,-1,312,313,288,-1,288,313,289,-1,313,314,289,-1,289,314,290,-1,314,315,290,-1,290,315,291,-1,315,316,291,-1,291,316,292,-1,316,317,292,-1,292,317,293,-1,317,318,293,-1,293,318,294,-1,318,319,294,-1,294,319,295,-1,319,320,295,-1,295,320,296,-1,320,321,296,-1,296,321,297,-1,321,322,297,-1,297,322,298,-1,322,323,298,-1,298,323,299,-1,323,324,299,-1,300,325,301,-1,325,326,301,-1,301,326,302,-1,326,327,302,-1,302,327,303,-1,327,328,303,-1,303,328,304,-1,328,329,304,-1,304,329,305,-1,329,330,305,-1,305,330,306,-1,330,331,306,-1,306,331,307,-1,331,332,307,-1,307,332,308,-1,332,333,308,-1,308,333,309,-1,333,334,309,-1,309,334,310,-1,334,335,310,-1,310,335,311,-1,335,336,311,-1,311,336,312,-1,336,337,312,-1,312,337,313,-1,337,338,313,-1,313,338,314,-1,338,339,314,-1,314,339,315,-1,339,340,315,-1,315,340,316,-1,340,341,316,-1,316,341,317,-1,341,342,317,-1,317,342,318,-1,342,343,318,-1,318,343,319,-1,343,344,319,-1,319,344,320,-1,344,345,320,-1,320,345,321,-1,345,346,321,-1,321,346,322,-1,346,347,322,-1,322,347,323,-1,347,348,323,-1,323,348,324,-1,348,349,324,-1,325,350,326,-1,350,351,326,-1,326,351,327,-1,351,352,327,-1,327,352,328,-1,352,353,328,-1,328,353,329,-1,353,354,329,-1,329,354,330,-1,354,355,330,-1,330,355,331,-1,355,356,331,-1,331,356,332,-1,356,357,332,-1,332,357,333,-1,357,358,333,-1,333,358,334,-1,358,359,334,-1,334,359,335,-1,359,360,335,-1,335,360,336,-1,360,361,336,-1,336,361,337,-1,361,362,337,-1,337,362,338,-1,362,363,338,-1,338,363,339,-1,363,364,339,-1,339,364,340,-1,364,365,340,-1,340,365,341,-1,365,366,341,-1,341,366,342,-1,366,367,342,-1,342,367,343,-1,367,368,343,-1,343,368,344,-1,368,369,344,-1,344,369,345,-1,369,370,345,-1,345,370,346,-1,370,371,346,-1,346,371,347,-1,371,372,347,-1,347,372,348,-1,372,373,348,-1,348,373,349,-1,373,374,349,-1,350,375,351,-1,375,376,351,-1,351,376,352,-1,376,377,352,-1,352,377,353,-1,377,378,353,-1,353,378,354,-1,378,379,354,-1,354,379,355,-1,379,380,355,-1,355,380,356,-1,380,381,356,-1,356,381,357,-1,381,382,357,-1,357,382,358,-1,382,383,358,-1,358,383,359,-1,383,384,359,-1,359,384,360,-1,384,385,360,-1,360,385,361,-1,385,386,361,-1,361,386,362,-1,386,387,362,-1,362,387,363,-1,387,388,363,-1,363,388,364,-1,388,389,364,-1,364,389,365,-1,389,390,365,-1,365,390,366,-1,390,391,366,-1,366,391,367,-1,391,392,367,-1,367,392,368,-1,392,393,368,-1,368,393,369,-1,393,394,369,-1,369,394,370,-1,394,395,370,-1,370,395,371,-1,395,396,371,-1,371,396,372,-1,396,397,372,-1,372,397,373,-1,397,398,373,-1,373,398,374,-1,398,399,374,-1,375,400,376,-1,400,401,376,-1,376,401,377,-1,401,402,377,-1,377,402,378,-1,402,403,378,-1,378,403,379,-1,403,404,379,-1,379,404,380,-1,404,405,380,-1,380,405,381,-1,405,406,381,-1,381,406,382,-1,406,407,382,-1,382,407,383,-1,407,408,383,-1,383,408,384,-1,408,409,384,-1,384,409,385,-1,409,410,385,-1,385,410,386,-1,410,411,386,-1,386,411,387,-1,411,412,387,-1,387,412,388,-1,412,413,388,-1,388,413,389,-1,413,414,389,-1,389,414,390,-1,414,415,390,-1,390,415,391,-1,415,416,391,-1,391,416,392,-1,416,417,392,-1,392,417,393,-1,417,418,393,-1,393,418,394,-1,418,419,394,-1,394,419,395,-1,419,420,395,-1,395,420,396,-1,420,421,396,-1,396,421,397,-1,421,422,397,-1,397,422,398,-1,422,423,398,-1,398,423,399,-1,423,424,399,-1,400,425,401,-1,425,426,401,-1,401,426,402,-1,426,427,402,-1,402,427,403,-1,427,428,403,-1,403,428,404,-1,428,429,404,-1,404,429,405,-1,429,430,405,-1,405,430,406,-1,430,431,406,-1,406,431,407,-1,431,432,407,-1,407,432,408,-1,432,433,408,-1,408,433,409,-1,433,434,409,-1,409,434,410,-1,434,435,410,-1,410,435,411,-1,435,436,411,-1,411,436,412,-1,436,437,412,-1,412,437,413,-1,437,438,413,-1,413,438,414,-1,438,439,414,-1,414,439,415,-1,439,440,415,-1,415,440,416,-1,440,441,416,-1,416,441,417,-1,441,442,417,-1,417,442,418,-1,442,443,418,-1,418,443,419,-1,443,444,419,-1,419,444,420,-1,444,445,420,-1,420,445,421,-1,445,446,421,-1,421,446,422,-1,446,447,422,-1,422,447,423,-1,447,448,423,-1,423,448,424,-1,448,449,424,-1,425,450,426,-1,450,451,426,-1,426,451,427,-1,451,452,427,-1,427,452,428,-1,452,453,428,-1,428,453,429,-1,453,454,429,-1,429,454,430,-1,454,455,430,-1,430,455,431,-1,455,456,431,-1,431,456,432,-1,456,457,432,-1,432,457,433,-1,457,458,433,-1,433,458,434,-1,458,459,434,-1,434,459,435,-1,459,460,435,-1,435,460,436,-1,460,461,436,-1,436,461,437,-1,461,462,437,-1,437,462,438,-1,462,463,438,-1,438,463,439,-1,463,464,439,-1,439,464,440,-1,464,465,440,-1,440,465,441,-1,465,466,441,-1,441,466,442,-1,466,467,442,-1,442,467,443,-1,467,468,443,-1,443,468,444,-1,468,469,444,-1,444,469,445,-1,469,470,445,-1,445,470,446,-1,470,471,446,-1,446,471,447,-1,471,472,447,-1,447,472,448,-1,472,473,448,-1,448,473,449,-1,473,474,449,-1,450,475,451,-1,475,476,451,-1,451,476,452,-1,476,477,452,-1,452,477,453,-1,477,478,453,-1,453,478,454,-1,478,479,454,-1,454,479,455,-1,479,480,455,-1,455,480,456,-1,480,481,456,-1,456,481,457,-1,481,482,457,-1,457,482,458,-1,482,483,458,-1,458,483,459,-1,483,484,459,-1,459,484,460,-1,484,485,460,-1,460,485,461,-1,485,486,461,-1,461,486,462,-1,486,487,462,-1,462,487,463,-1,487,488,463,-1,463,488,464,-1,488,489,464,-1,464,489,465,-1,489,490,465,-1,465,490,466,-1,490,491,466,-1,466,491,467,-1,491,492,467,-1,467,492,468,-1,492,493,468,-1,468,493,469,-1,493,494,469,-1,469,494,470,-1,494,495,470,-1,470,495,471,-1,495,496,471,-1,471,496,472,-1,496,497,472,-1,472,497,473,-1,497,498,473,-1,473,498,474,-1,498,499,474,-1,475,500,476,-1,500,501,476,-1,476,501,477,-1,501,502,477,-1,477,502,478,-1,502,503,478,-1,478,503,479,-1,503,504,479,-1,479,504,480,-1,504,505,480,-1,480,505,481,-1,505,506,481,-1,481,506,482,-1,506,507,482,-1,482,507,483,-1,507,508,483,-1,483,508,484,-1,508,509,484,-1,484,509,485,-1,509,510,485,-1,485,510,486,-1,510,511,486,-1,486,511,487,-1,511,512,487,-1,487,512,488,-1,512,513,488,-1,488,513,489,-1,513,514,489,-1,489,514,490,-1,514,515,490,-1,490,515,491,-1,515,516,491,-1,491,516,492,-1,516,517,492,-1,492,517,493,-1,517,518,493,-1,493,518,494,-1,518,519,494,-1,494,519,495,-1,519,520,495,-1,495,520,496,-1,520,521,496,-1,496,521,497,-1,521,522,497,-1,497,522,498,-1,522,523,498,-1,498,523,499,-1,523,524,499,-1,500,525,501,-1,525,526,501,-1,501,526,502,-1,526,527,502,-1,502,527,503,-1,527,528,503,-1,503,528,504,-1,528,529,504,-1,504,529,505,-1,529,530,505,-1,505,530,506,-1,530,531,506,-1,506,531,507,-1,531,532,507,-1,507,532,508,-1,532,533,508,-1,508,533,509,-1,533,534,509,-1,509,534,510,-1,534,535,510,-1,510,535,511,-1,535,536,511,-1,511,536,512,-1,536,537,512,-1,512,537,513,-1,537,538,513,-1,513,538,514,-1,538,539,514,-1,514,539,515,-1,539,540,515,-1,515,540,516,-1,540,541,516,-1,516,541,517,-1,541,542,517,-1,517,542,518,-1,542,543,518,-1,518,543,519,-1,543,544,519,-1,519,544,520,-1,544,545,520,-1,520,545,521,-1,545,546,521,-1,521,546,522,-1,546,547,522,-1,522,547,523,-1,547,548,523,-1,523,548,524,-1,548,549,524,-1,525,550,526,-1,550,551,526,-1,526,551,527,-1,551,552,527,-1,527,552,528,-1,552,553,528,-1,528,553,529,-1,553,554,529,-1,529,554,530,-1,554,555,530,-1,530,555,531,-1,555,556,531,-1,531,556,532,-1,556,557,532,-1,532,557,533,-1,557,558,533,-1,533,558,534,-1,558,559,534,-1,534,559,535,-1,559,560,535,-1,535,560,536,-1,560,561,536,-1,536,561,537,-1,561,562,537,-1,537,562,538,-1,562,563,538,-1,538,563,539,-1,563,564,539,-1,539,564,540,-1,564,565,540,-1,540,565,541,-1,565,566,541,-1,541,566,542,-1,566,567,542,-1,542,567,543,-1,567,568,543,-1,543,568,544,-1,568,569,544,-1,544,569,545,-1,569,570,545,-1,545,570,546,-1,570,571,546,-1,546,571,547,-1,571,572,547,-1,547,572,548,-1,572,573,548,-1,548,573,549,-1,573,574,549,-1,550,575,551,-1,575,576,551,-1,551,576,552,-1,576,577,552,-1,552,577,553,-1,577,578,553,-1,553,578,554,-1,578,579,554,-1,554,579,555,-1,579,580,555,-1,555,580,556,-1,580,581,556,-1,556,581,557,-1,581,582,557,-1,557,582,558,-1,582,583,558,-1,558,583,559,-1,583,584,559,-1,559,584,560,-1,584,585,560,-1,560,585,561,-1,585,586,561,-1,561,586,562,-1,586,587,562,-1,562,587,563,-1,587,588,563,-1,563,588,564,-1,588,589,564,-1,564,589,565,-1,589,590,565,-1,565,590,566,-1,590,591,566,-1,566,591,567,-1,591,592,567,-1,567,592,568,-1,592,593,568,-1,568,593,569,-1,593,594,569,-1,569,594,570,-1,594,595,570,-1,570,595,571,-1,595,596,571,-1,571,596,572,-1,596,597,572,-1,572,597,573,-1,597,598,573,-1,573,598,574,-1,598,599,574,-1,575,600,576,-1,600,601,576,-1,576,601,577,-1,601,602,577,-1,577,602,578,-1,602,603,578,-1,578,603,579,-1,603,604,579,-1,579,604,580,-1,604,605,580,-1,580,605,581,-1,605,606,581,-1,581,606,582,-1,606,607,582,-1,582,607,583,-1,607,608,583,-1,583,608,584,-1,608,609,584,-1,584,609,585,-1,609,610,585,-1,585,610,586,-1,610,611,586,-1,586,611,587,-1,611,612,587,-1,587,612,588,-1,612,613,588,-1,588,613,589,-1,613,614,589,-1,589,614,590,-1,614,615,590,-1,590,615,591,-1,615,616,591,-1,591,616,592,-1,616,617,592,-1,592,617,593,-1,617,618,593,-1,593,618,594,-1,618,619,594,-1,594,619,595,-1,619,620,595,-1,595,620,596,-1,620,621,596,-1,596,621,597,-1,621,622,597,-1,597,622,598,-1,622,623,598,-1,598,623,599,-1,623,624,599,-1"><coordinate point="0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0.065403,0.997859,0,0.065263,0.997859,0.004278,0.064844,0.997859,0.008537,0.064146,0.997859,0.01276,0.063175,0.997859,0.016928,0.061932,0.997859,0.021023,0.060425,0.997859,0.025029,0.058658,0.997859,0.028927,0.056641,0.997859,0.032702,0.054381,0.997859,0.036336,0.051888,0.997859,0.039815,0.049173,0.997859,0.043123,0.046247,0.997859,0.046247,0.043123,0.997859,0.049173,0.039815,0.997859,0.051888,0.036336,0.997859,0.054381,0.032702,0.997859,0.056641,0.028927,0.997859,0.058658,0.025029,0.997859,0.060425,0.021023,0.997859,0.061932,0.016928,0.997859,0.063175,0.01276,0.997859,0.064146,0.008537,0.997859,0.064844,0.004278,0.997859,0.065263,0,0.997859,0.065403,0.130526,0.991445,0,0.130247,0.991445,0.008537,0.12941,0.991445,0.017037,0.128018,0.991445,0.025464,0.126079,0.991445,0.033783,0.123599,0.991445,0.041956,0.12059,0.991445,0.04995,0.117065,0.991445,0.05773,0.113039,0.991445,0.065263,0.108529,0.991445,0.072516,0.103553,0.991445,0.079459,0.098135,0.991445,0.086062,0.092296,0.991445,0.092296,0.086062,0.991445,0.098135,0.079459,0.991445,0.103553,0.072516,0.991445,0.108529,0.065263,0.991445,0.113039,0.05773,0.991445,0.117065,0.04995,0.991445,0.12059,0.041956,0.991445,0.123599,0.033783,0.991445,0.126079,0.025464,0.991445,0.128018,0.017037,0.991445,0.12941,0.008537,0.991445,0.130247,0,0.991445,0.130526,0.19509,0.980785,0,0.194673,0.980785,0.01276,0.193421,0.980785,0.025464,0.191342,0.980785,0.03806,0.188443,0.980785,0.050493,0.184737,0.980785,0.06271,0.18024,0.980785,0.074658,0.174971,0.980785,0.086286,0.168953,0.980785,0.097545,0.162212,0.980785,0.108386,0.154776,0.980785,0.118763,0.146677,0.980785,0.128632,0.13795,0.980785,0.13795,0.128632,0.980785,0.146677,0.118763,0.980785,0.154776,0.108386,0.980785,0.162212,0.097545,0.980785,0.168953,0.086286,0.980785,0.174971,0.074658,0.980785,0.18024,0.06271,0.980785,0.184737,0.050493,0.980785,0.188443,0.03806,0.980785,0.191342,0.025464,0.980785,0.193421,0.01276,0.980785,0.194673,0,0.980785,0.19509,0.258819,0.965926,0,0.258265,0.965926,0.016928,0.256605,0.965926,0.033783,0.253846,0.965926,0.050493,0.25,0.965926,0.066987,0.245084,0.965926,0.083195,0.239118,0.965926,0.099046,0.232128,0.965926,0.114473,0.224144,0.965926,0.12941,0.2152,0.965926,0.143792,0.205335,0.965926,0.157559,0.19459,0.965926,0.170651,0.183013,0.965926,0.183013,0.170651,0.965926,0.19459,0.157559,0.965926,0.205335,0.143792,0.965926,0.2152,0.12941,0.965926,0.224144,0.114473,0.965926,0.232128,0.099046,0.965926,0.239118,0.083195,0.965926,0.245084,0.066987,0.965926,0.25,0.050493,0.965926,0.253846,0.033783,0.965926,0.256605,0.016928,0.965926,0.258265,0,0.965926,0.258819,0.321439,0.94693,0,0.320751,0.94693,0.021023,0.31869,0.94693,0.041956,0.315263,0.94693,0.06271,0.310487,0.94693,0.083195,0.304381,0.94693,0.103323,0.296971,0.94693,0.12301,0.28829,0.94693,0.142169,0.278375,0.94693,0.16072,0.267267,0.94693,0.178582,0.255015,0.94693,0.19568,0.241671,0.94693,0.21194,0.227292,0.94693,0.227292,0.21194,0.94693,0.241671,0.19568,0.94693,0.255015,0.178582,0.94693,0.267267,0.16072,0.94693,0.278375,0.142169,0.94693,0.28829,0.12301,0.94693,0.296971,0.103323,0.94693,0.304381,0.083195,0.94693,0.310487,0.06271,0.94693,0.315263,0.041956,0.94693,0.31869,0.021023,0.94693,0.320751,0,0.94693,0.321439,0.382683,0.92388,0,0.381864,0.92388,0.025029,0.37941,0.92388,0.04995,0.37533,0.92388,0.074658,0.369644,0.92388,0.099046,0.362374,0.92388,0.12301,0.353553,0.92388,0.146447,0.343218,0.92388,0.169257,0.331414,0.92388,0.191342,0.31819,0.92388,0.212608,0.303603,0.92388,0.232963,0.287717,0.92388,0.252321,0.270598,0.92388,0.270598,0.252321,0.92388,0.287717,0.232963,0.92388,0.303603,0.212608,0.92388,0.31819,0.191342,0.92388,0.331414,0.169257,0.92388,0.343218,0.146447,0.92388,0.353553,0.12301,0.92388,0.362374,0.099046,0.92388,0.369644,0.074658,0.92388,0.37533,0.04995,0.92388,0.37941,0.025029,0.92388,0.381864,0,0.92388,0.382683,0.442289,0.896873,0,0.441342,0.896873,0.028927,0.438505,0.896873,0.05773,0.43379,0.896873,0.086286,0.427218,0.896873,0.114473,0.418816,0.896873,0.142169,0.408621,0.896873,0.169257,0.396677,0.896873,0.195619,0.383033,0.896873,0.221144,0.36775,0.896873,0.245722,0.350891,0.896873,0.269248,0.33253,0.896873,0.291621,0.312745,0.896873,0.312745,0.291621,0.896873,0.33253,0.269248,0.896873,0.350891,0.245722,0.896873,0.36775,0.221144,0.896873,0.383033,0.195619,0.896873,0.396677,0.169257,0.896873,0.408621,0.142169,0.896873,0.418816,0.114473,0.896873,0.427218,0.086286,0.896873,0.43379,0.05773,0.896873,0.438505,0.028927,0.896873,0.441342,0,0.896873,0.442289,0.5,0.866025,0,0.498929,0.866025,0.032702,0.495722,0.866025,0.065263,0.490393,0.866025,0.097545,0.482963,0.866025,0.12941,0.473465,0.866025,0.16072,0.46194,0.866025,0.191342,0.448436,0.866025,0.221144,0.433013,0.866025,0.25,0.415735,0.866025,0.277785,0.396677,0.866025,0.304381,0.37592,0.866025,0.329673,0.353553,0.866025,0.353553,0.329673,0.866025,0.37592,0.304381,0.866025,0.396677,0.277785,0.866025,0.415735,0.25,0.866025,0.433013,0.221144,0.866025,0.448436,0.191342,0.866025,0.46194,0.16072,0.866025,0.473465,0.12941,0.866025,0.482963,0.097545,0.866025,0.490393,0.065263,0.866025,0.495722,0.032702,0.866025,0.498929,0,0.866025,0.5,0.55557,0.83147,0,0.554381,0.83147,0.036336,0.550817,0.83147,0.072516,0.544895,0.83147,0.108386,0.53664,0.83147,0.143792,0.526086,0.83147,0.178582,0.51328,0.83147,0.212608,0.498276,0.83147,0.245722,0.481138,0.83147,0.277785,0.46194,0.83147,0.308658,0.440764,0.83147,0.33821,0.4177,0.83147,0.366313,0.392847,0.83147,0.392847,0.366313,0.83147,0.4177,0.33821,0.83147,0.440764,0.308658,0.83147,0.46194,0.277785,0.83147,0.481138,0.245722,0.83147,0.498276,0.212608,0.83147,0.51328,0.178582,0.83147,0.526086,0.143792,0.83147,0.53664,0.108386,0.83147,0.544895,0.072516,0.83147,0.550817,0.036336,0.83147,0.554381,0,0.83147,0.55557,0.608761,0.793353,0,0.607458,0.793353,0.039815,0.603553,0.793353,0.079459,0.597064,0.793353,0.118763,0.588018,0.793353,0.157559,0.576455,0.793353,0.19568,0.562422,0.793353,0.232963,0.545982,0.793353,0.269248,0.527203,0.793353,0.304381,0.506167,0.793353,0.33821,0.482963,0.793353,0.37059,0.457691,0.793353,0.401384,0.430459,0.793353,0.430459,0.401384,0.793353,0.457691,0.37059,0.793353,0.482963,0.33821,0.793353,0.506167,0.304381,0.793353,0.527203,0.269248,0.793353,0.545982,0.232963,0.793353,0.562422,0.19568,0.793353,0.576455,0.157559,0.793353,0.588018,0.118763,0.793353,0.597064,0.079459,0.793353,0.603553,0.039815,0.793353,0.607458,0,0.793353,0.608761,0.659346,0.75184,0,0.657934,0.75184,0.043123,0.653705,0.75184,0.086062,0.646677,0.75184,0.128632,0.636879,0.75184,0.170651,0.624354,0.75184,0.21194,0.609156,0.75184,0.252321,0.591349,0.75184,0.291621,0.57101,0.75184,0.329673,0.548226,0.75184,0.366313,0.523094,0.75184,0.401384,0.495722,0.75184,0.434737,0.466228,0.75184,0.466228,0.434737,0.75184,0.495722,0.401384,0.75184,0.523094,0.366313,0.75184,0.548226,0.329673,0.75184,0.57101,0.291621,0.75184,0.591349,0.252321,0.75184,0.609156,0.21194,0.75184,0.624354,0.170651,0.75184,0.636879,0.128632,0.75184,0.646677,0.086062,0.75184,0.653705,0.043123,0.75184,0.657934,0,0.75184,0.659346,0.707107,0.707107,0,0.705593,0.707107,0.046247,0.701057,0.707107,0.092296,0.69352,0.707107,0.13795,0.683013,0.707107,0.183013,0.669581,0.707107,0.227292,0.653281,0.707107,0.270598,0.634185,0.707107,0.312745,0.612372,0.707107,0.353553,0.587938,0.707107,0.392847,0.560986,0.707107,0.430459,0.531631,0.707107,0.466228,0.5,0.707107,0.5,0.466228,0.707107,0.531631,0.430459,0.707107,0.560986,0.392847,0.707107,0.587938,0.353553,0.707107,0.612372,0.312745,0.707107,0.634185,0.270598,0.707107,0.653281,0.227292,0.707107,0.669581,0.183013,0.707107,0.683013,0.13795,0.707107,0.69352,0.092296,0.707107,0.701057,0.046247,0.707107,0.705593,0,0.707107,0.707107,0.75184,0.659346,0,0.75023,0.659346,0.049173,0.745408,0.659346,0.098135,0.737393,0.659346,0.146677,0.726221,0.659346,0.19459,0.71194,0.659346,0.241671,0.694609,0.659346,0.287717,0.674305,0.659346,0.33253,0.651112,0.659346,0.37592,0.625132,0.659346,0.4177,0.596475,0.659346,0.457691,0.565263,0.659346,0.495722,0.531631,0.659346,0.531631,0.495722,0.659346,0.565263,0.457691,0.659346,0.596475,0.4177,0.659346,0.625132,0.37592,0.659346,0.651112,0.33253,0.659346,0.674305,0.287717,0.659346,0.694609,0.241671,0.659346,0.71194,0.19459,0.659346,0.726221,0.146677,0.659346,0.737393,0.098135,0.659346,0.745408,0.049173,0.659346,0.75023,0,0.659346,0.75184,0.793353,0.608761,0,0.791655,0.608761,0.051888,0.786566,0.608761,0.103553,0.778109,0.608761,0.154776,0.76632,0.608761,0.205335,0.75125,0.608761,0.255015,0.732963,0.608761,0.303603,0.711537,0.608761,0.350891,0.687064,0.608761,0.396677,0.659649,0.608761,0.440764,0.62941,0.608761,0.482963,0.596475,0.608761,0.523094,0.560986,0.608761,0.560986,0.523094,0.608761,0.596475,0.482963,0.608761,0.62941,0.440764,0.608761,0.659649,0.396677,0.608761,0.687064,0.350891,0.608761,0.711537,0.303603,0.608761,0.732963,0.255015,0.608761,0.75125,0.205335,0.608761,0.76632,0.154776,0.608761,0.778109,0.103553,0.608761,0.786566,0.051888,0.608761,0.791655,0,0.608761,0.793353,0.83147,0.55557,0,0.829689,0.55557,0.054381,0.824356,0.55557,0.108529,0.815493,0.55557,0.162212,0.803138,0.55557,0.2152,0.787344,0.55557,0.267267,0.768178,0.55557,0.31819,0.745722,0.55557,0.36775,0.720074,0.55557,0.415735,0.691342,0.55557,0.46194,0.659649,0.55557,0.506167,0.625132,0.55557,0.548226,0.587938,0.55557,0.587938,0.548226,0.55557,0.625132,0.506167,0.55557,0.659649,0.46194,0.55557,0.691342,0.415735,0.55557,0.720074,0.36775,0.55557,0.745722,0.31819,0.55557,0.768178,0.267267,0.55557,0.787344,0.2152,0.55557,0.803138,0.162212,0.55557,0.815493,0.108529,0.55557,0.824356,0.054381,0.55557,0.829689,0,0.55557,0.83147,0.866025,0.5,0,0.864171,0.5,0.056641,0.858616,0.5,0.113039,0.849385,0.5,0.168953,0.836516,0.5,0.224144,0.820066,0.5,0.278375,0.800103,0.5,0.331414,0.776715,0.5,0.383033,0.75,0.5,0.433013,0.720074,0.5,0.481138,0.687064,0.5,0.527203,0.651112,0.5,0.57101,0.612372,0.5,0.612372,0.57101,0.5,0.651112,0.527203,0.5,0.687064,0.481138,0.5,0.720074,0.433013,0.5,0.75,0.383033,0.5,0.776715,0.331414,0.5,0.800103,0.278375,0.5,0.820066,0.224144,0.5,0.836516,0.168953,0.5,0.849385,0.113039,0.5,0.858616,0.056641,0.5,0.864171,0,0.5,0.866025,0.896873,0.442289,0,0.894952,0.442289,0.058658,0.8892,0.442289,0.117065,0.87964,0.442289,0.174971,0.866313,0.442289,0.232128,0.849276,0.442289,0.28829,0.828602,0.442289,0.343218,0.804381,0.442289,0.396677,0.776715,0.442289,0.448436,0.745722,0.442289,0.498276,0.711537,0.442289,0.545982,0.674305,0.442289,0.591349,0.634185,0.442289,0.634185,0.591349,0.442289,0.674305,0.545982,0.442289,0.711537,0.498276,0.442289,0.745722,0.448436,0.442289,0.776715,0.396677,0.442289,0.804381,0.343218,0.442289,0.828602,0.28829,0.442289,0.849276,0.232128,0.442289,0.866313,0.174971,0.442289,0.87964,0.117065,0.442289,0.8892,0.058658,0.442289,0.894952,0,0.442289,0.896873,0.92388,0.382683,0,0.921901,0.382683,0.060425,0.915976,0.382683,0.12059,0.906127,0.382683,0.18024,0.892399,0.382683,0.239118,0.874849,0.382683,0.296971,0.853553,0.382683,0.353553,0.828602,0.382683,0.408621,0.800103,0.382683,0.46194,0.768178,0.382683,0.51328,0.732963,0.382683,0.562422,0.694609,0.382683,0.609156,0.653281,0.382683,0.653281,0.609156,0.382683,0.694609,0.562422,0.382683,0.732963,0.51328,0.382683,0.768178,0.46194,0.382683,0.800103,0.408621,0.382683,0.828602,0.353553,0.382683,0.853553,0.296971,0.382683,0.874849,0.239118,0.382683,0.892399,0.18024,0.382683,0.906127,0.12059,0.382683,0.915976,0.060425,0.382683,0.921901,0,0.382683,0.92388,0.94693,0.321439,0,0.944903,0.321439,0.061932,0.938829,0.321439,0.123599,0.928735,0.321439,0.184737,0.914664,0.321439,0.245084,0.896677,0.321439,0.304381,0.874849,0.321439,0.362374,0.849276,0.321439,0.418816,0.820066,0.321439,0.473465,0.787344,0.321439,0.526086,0.75125,0.321439,0.576455,0.71194,0.321439,0.624354,0.669581,0.321439,0.669581,0.624354,0.321439,0.71194,0.576455,0.321439,0.75125,0.526086,0.321439,0.787344,0.473465,0.321439,0.820066,0.418816,0.321439,0.849276,0.362374,0.321439,0.874849,0.304381,0.321439,0.896677,0.245084,0.321439,0.914664,0.184737,0.321439,0.928735,0.123599,0.321439,0.938829,0.061932,0.321439,0.944903,0,0.321439,0.94693,0.965926,0.258819,0,0.963858,0.258819,0.063175,0.957662,0.258819,0.126079,0.947366,0.258819,0.188443,0.933013,0.258819,0.25,0.914664,0.258819,0.310487,0.892399,0.258819,0.369644,0.866313,0.258819,0.427218,0.836516,0.258819,0.482963,0.803138,0.258819,0.53664,0.76632,0.258819,0.588018,0.726221,0.258819,0.636879,0.683013,0.258819,0.683013,0.636879,0.258819,0.726221,0.588018,0.258819,0.76632,0.53664,0.258819,0.803138,0.482963,0.258819,0.836516,0.427218,0.258819,0.866313,0.369644,0.258819,0.892399,0.310487,0.258819,0.914664,0.25,0.258819,0.933013,0.188443,0.258819,0.947366,0.126079,0.258819,0.957662,0.063175,0.258819,0.963858,0,0.258819,0.965926,0.980785,0.19509,0,0.978685,0.19509,0.064146,0.972395,0.19509,0.128018,0.96194,0.19509,0.191342,0.947366,0.19509,0.253846,0.928735,0.19509,0.315263,0.906127,0.19509,0.37533,0.87964,0.19509,0.43379,0.849385,0.19509,0.490393,0.815493,0.19509,0.544895,0.778109,0.19509,0.597064,0.737393,0.19509,0.646677,0.69352,0.19509,0.69352,0.646677,0.19509,0.737393,0.597064,0.19509,0.778109,0.544895,0.19509,0.815493,0.490393,0.19509,0.849385,0.43379,0.19509,0.87964,0.37533,0.19509,0.906127,0.315263,0.19509,0.928735,0.253846,0.19509,0.947366,0.191342,0.19509,0.96194,0.128018,0.19509,0.972395,0.064146,0.19509,0.978685,0,0.19509,0.980785,0.991445,0.130526,0,0.989322,0.130526,0.064844,0.982963,0.130526,0.12941,0.972395,0.130526,0.193421,0.957662,0.130526,0.256605,0.938829,0.130526,0.31869,0.915976,0.130526,0.37941,0.8892,0.130526,0.438505,0.858616,0.130526,0.495722,0.824356,0.130526,0.550817,0.786566,0.130526,0.603553,0.745408,0.130526,0.653705,0.701057,0.130526,0.701057,0.653705,0.130526,0.745408,0.603553,0.130526,0.786566,0.550817,0.130526,0.824356,0.495722,0.130526,0.858616,0.438505,0.130526,0.8892,0.37941,0.130526,0.915976,0.31869,0.130526,0.938829,0.256605,0.130526,0.957662,0.193421,0.130526,0.972395,0.12941,0.130526,0.982963,0.064844,0.130526,0.989322,0,0.130526,0.991445,0.997859,0.065403,0,0.995722,0.065403,0.065263,0.989322,0.065403,0.130247,0.978685,0.065403,0.194673,0.963858,0.065403,0.258265,0.944903,0.065403,0.320751,0.921901,0.065403,0.381864,0.894952,0.065403,0.441342,0.864171,0.065403,0.498929,0.829689,0.065403,0.554381,0.791655,0.065403,0.607458,0.75023,0.065403,0.657934,0.705593,0.065403,0.705593,0.657934,0.065403,0.75023,0.607458,0.065403,0.791655,0.554381,0.065403,0.829689,0.498929,0.065403,0.864171,0.441342,0.065403,0.894952,0.381864,0.065403,0.921901,0.320751,0.065403,0.944903,0.258265,0.065403,0.963858,0.194673,0.065403,0.978685,0.130247,0.065403,0.989322,0.065263,0.065403,0.995722,0,0.065403,0.997859,1,0,0,0.997859,0,0.065403,0.991445,0,0.130526,0.980785,0,0.19509,0.965926,0,0.258819,0.94693,0,0.321439,0.92388,0,0.382683,0.896873,0,0.442289,0.866025,0,0.5,0.83147,0,0.55557,0.793353,0,0.608761,0.75184,0,0.659346,0.707107,0,0.707107,0.659346,0,0.75184,0.608761,0,0.793353,0.55557,0,0.83147,0.5,0,0.866025,0.442289,0,0.896873,0.382683,0,0.92388,0.321439,0,0.94693,0.258819,0,0.965926,0.19509,0,0.980785,0.130526,0,0.991445,0.065403,0,0.997859,0,0,1"></coordinate></indexedfaceset></shape></transform><transform render="false" visible="false"><shape><indexedfaceset def="octant-2" solid="false" creaseangle="0" coordindex="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,-1,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,-1,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,-1,0,75,24,-1,25,75,49,-1,50,75,74,-1"><coordinate point="1,0,0,0.997859,0,0.065403,0.991445,0,0.130526,0.980785,0,0.19509,0.965926,0,0.258819,0.94693,0,0.321439,0.92388,0,0.382683,0.896873,0,0.442289,0.866025,0,0.5,0.83147,0,0.55557,0.793353,0,0.608761,0.75184,0,0.659346,0.707107,0,0.707107,0.659346,0,0.75184,0.608761,0,0.793353,0.55557,0,0.83147,0.5,0,0.866025,0.442289,0,0.896873,0.382683,0,0.92388,0.321439,0,0.94693,0.258819,0,0.965926,0.19509,0,0.980785,0.130526,0,0.991445,0.065403,0,0.997859,0,0,1,0,1,0,0.065403,0.997859,0,0.130526,0.991445,0,0.19509,0.980785,0,0.258819,0.965926,0,0.321439,0.94693,0,0.382683,0.92388,0,0.442289,0.896873,0,0.5,0.866025,0,0.55557,0.83147,0,0.608761,0.793353,0,0.659346,0.75184,0,0.707107,0.707107,0,0.75184,0.659346,0,0.793353,0.608761,0,0.83147,0.55557,0,0.866025,0.5,0,0.896873,0.442289,0,0.92388,0.382683,0,0.94693,0.321439,0,0.965926,0.258819,0,0.980785,0.19509,0,0.991445,0.130526,0,0.997859,0.065403,0,1,0,0,0,1,0,0,0.997859,0.065403,0,0.991445,0.130526,0,0.980785,0.19509,0,0.965926,0.258819,0,0.94693,0.321439,0,0.92388,0.382683,0,0.896873,0.442289,0,0.866025,0.5,0,0.83147,0.55557,0,0.793353,0.608761,0,0.75184,0.659346,0,0.707107,0.707107,0,0.659346,0.75184,0,0.608761,0.793353,0,0.55557,0.83147,0,0.5,0.866025,0,0.442289,0.896873,0,0.382683,0.92388,0,0.321439,0.94693,0,0.258819,0.965926,0,0.19509,0.980785,0,0.130526,0.991445,0,0.065403,0.997859,0,0,1,0,0,0"></coordinate></indexedfaceset></shape></transform><transform render="false" visible="false"><shape><indexedfaceset def="hex-1" solid="false" creaseangle="3.14" coordindex="0,25,1,-1,25,26,1,-1,1,26,2,-1,26,27,2,-1,2,27,3,-1,27,28,3,-1,3,28,4,-1,28,29,4,-1,4,29,5,-1,29,30,5,-1,5,30,6,-1,30,31,6,-1,6,31,7,-1,31,32,7,-1,7,32,8,-1,32,33,8,-1,8,33,9,-1,33,34,9,-1,9,34,10,-1,34,35,10,-1,10,35,11,-1,35,36,11,-1,11,36,12,-1,36,37,12,-1,12,37,13,-1,37,38,13,-1,13,38,14,-1,38,39,14,-1,14,39,15,-1,39,40,15,-1,15,40,16,-1,40,41,16,-1,16,41,17,-1,41,42,17,-1,17,42,18,-1,42,43,18,-1,18,43,19,-1,43,44,19,-1,19,44,20,-1,44,45,20,-1,20,45,21,-1,45,46,21,-1,21,46,22,-1,46,47,22,-1,22,47,23,-1,47,48,23,-1,23,48,24,-1,48,49,24,-1,25,50,26,-1,50,51,26,-1,26,51,27,-1,51,52,27,-1,27,52,28,-1,52,53,28,-1,28,53,29,-1,53,54,29,-1,29,54,30,-1,54,55,30,-1,30,55,31,-1,55,56,31,-1,31,56,32,-1,56,57,32,-1,32,57,33,-1,57,58,33,-1,33,58,34,-1,58,59,34,-1,34,59,35,-1,59,60,35,-1,35,60,36,-1,60,61,36,-1,36,61,37,-1,61,62,37,-1,37,62,38,-1,62,63,38,-1,38,63,39,-1,63,64,39,-1,39,64,40,-1,64,65,40,-1,40,65,41,-1,65,66,41,-1,41,66,42,-1,66,67,42,-1,42,67,43,-1,67,68,43,-1,43,68,44,-1,68,69,44,-1,44,69,45,-1,69,70,45,-1,45,70,46,-1,70,71,46,-1,46,71,47,-1,71,72,47,-1,47,72,48,-1,72,73,48,-1,48,73,49,-1,73,74,49,-1,50,75,51,-1,75,76,51,-1,51,76,52,-1,76,77,52,-1,52,77,53,-1,77,78,53,-1,53,78,54,-1,78,79,54,-1,54,79,55,-1,79,80,55,-1,55,80,56,-1,80,81,56,-1,56,81,57,-1,81,82,57,-1,57,82,58,-1,82,83,58,-1,58,83,59,-1,83,84,59,-1,59,84,60,-1,84,85,60,-1,60,85,61,-1,85,86,61,-1,61,86,62,-1,86,87,62,-1,62,87,63,-1,87,88,63,-1,63,88,64,-1,88,89,64,-1,64,89,65,-1,89,90,65,-1,65,90,66,-1,90,91,66,-1,66,91,67,-1,91,92,67,-1,67,92,68,-1,92,93,68,-1,68,93,69,-1,93,94,69,-1,69,94,70,-1,94,95,70,-1,70,95,71,-1,95,96,71,-1,71,96,72,-1,96,97,72,-1,72,97,73,-1,97,98,73,-1,73,98,74,-1,98,99,74,-1,75,100,76,-1,100,101,76,-1,76,101,77,-1,101,102,77,-1,77,102,78,-1,102,103,78,-1,78,103,79,-1,103,104,79,-1,79,104,80,-1,104,105,80,-1,80,105,81,-1,105,106,81,-1,81,106,82,-1,106,107,82,-1,82,107,83,-1,107,108,83,-1,83,108,84,-1,108,109,84,-1,84,109,85,-1,109,110,85,-1,85,110,86,-1,110,111,86,-1,86,111,87,-1,111,112,87,-1,87,112,88,-1,112,113,88,-1,88,113,89,-1,113,114,89,-1,89,114,90,-1,114,115,90,-1,90,115,91,-1,115,116,91,-1,91,116,92,-1,116,117,92,-1,92,117,93,-1,117,118,93,-1,93,118,94,-1,118,119,94,-1,94,119,95,-1,119,120,95,-1,95,120,96,-1,120,121,96,-1,96,121,97,-1,121,122,97,-1,97,122,98,-1,122,123,98,-1,98,123,99,-1,123,124,99,-1,100,125,101,-1,125,126,101,-1,101,126,102,-1,126,127,102,-1,102,127,103,-1,127,128,103,-1,103,128,104,-1,128,129,104,-1,104,129,105,-1,129,130,105,-1,105,130,106,-1,130,131,106,-1,106,131,107,-1,131,132,107,-1,107,132,108,-1,132,133,108,-1,108,133,109,-1,133,134,109,-1,109,134,110,-1,134,135,110,-1,110,135,111,-1,135,136,111,-1,111,136,112,-1,136,137,112,-1,112,137,113,-1,137,138,113,-1,113,138,114,-1,138,139,114,-1,114,139,115,-1,139,140,115,-1,115,140,116,-1,140,141,116,-1,116,141,117,-1,141,142,117,-1,117,142,118,-1,142,143,118,-1,118,143,119,-1,143,144,119,-1,119,144,120,-1,144,145,120,-1,120,145,121,-1,145,146,121,-1,121,146,122,-1,146,147,122,-1,122,147,123,-1,147,148,123,-1,123,148,124,-1,148,149,124,-1,125,150,126,-1,150,151,126,-1,126,151,127,-1,151,152,127,-1,127,152,128,-1,152,153,128,-1,128,153,129,-1,153,154,129,-1,129,154,130,-1,154,155,130,-1,130,155,131,-1,155,156,131,-1,131,156,132,-1,156,157,132,-1,132,157,133,-1,157,158,133,-1,133,158,134,-1,158,159,134,-1,134,159,135,-1,159,160,135,-1,135,160,136,-1,160,161,136,-1,136,161,137,-1,161,162,137,-1,137,162,138,-1,162,163,138,-1,138,163,139,-1,163,164,139,-1,139,164,140,-1,164,165,140,-1,140,165,141,-1,165,166,141,-1,141,166,142,-1,166,167,142,-1,142,167,143,-1,167,168,143,-1,143,168,144,-1,168,169,144,-1,144,169,145,-1,169,170,145,-1,145,170,146,-1,170,171,146,-1,146,171,147,-1,171,172,147,-1,147,172,148,-1,172,173,148,-1,148,173,149,-1,173,174,149,-1,150,175,151,-1,175,176,151,-1,151,176,152,-1,176,177,152,-1,152,177,153,-1,177,178,153,-1,153,178,154,-1,178,179,154,-1,154,179,155,-1,179,180,155,-1,155,180,156,-1,180,181,156,-1,156,181,157,-1,181,182,157,-1,157,182,158,-1,182,183,158,-1,158,183,159,-1,183,184,159,-1,159,184,160,-1,184,185,160,-1,160,185,161,-1,185,186,161,-1,161,186,162,-1,186,187,162,-1,162,187,163,-1,187,188,163,-1,163,188,164,-1,188,189,164,-1,164,189,165,-1,189,190,165,-1,165,190,166,-1,190,191,166,-1,166,191,167,-1,191,192,167,-1,167,192,168,-1,192,193,168,-1,168,193,169,-1,193,194,169,-1,169,194,170,-1,194,195,170,-1,170,195,171,-1,195,196,171,-1,171,196,172,-1,196,197,172,-1,172,197,173,-1,197,198,173,-1,173,198,174,-1,198,199,174,-1,175,200,176,-1,200,201,176,-1,176,201,177,-1,201,202,177,-1,177,202,178,-1,202,203,178,-1,178,203,179,-1,203,204,179,-1,179,204,180,-1,204,205,180,-1,180,205,181,-1,205,206,181,-1,181,206,182,-1,206,207,182,-1,182,207,183,-1,207,208,183,-1,183,208,184,-1,208,209,184,-1,184,209,185,-1,209,210,185,-1,185,210,186,-1,210,211,186,-1,186,211,187,-1,211,212,187,-1,187,212,188,-1,212,213,188,-1,188,213,189,-1,213,214,189,-1,189,214,190,-1,214,215,190,-1,190,215,191,-1,215,216,191,-1,191,216,192,-1,216,217,192,-1,192,217,193,-1,217,218,193,-1,193,218,194,-1,218,219,194,-1,194,219,195,-1,219,220,195,-1,195,220,196,-1,220,221,196,-1,196,221,197,-1,221,222,197,-1,197,222,198,-1,222,223,198,-1,198,223,199,-1,223,224,199,-1,200,225,201,-1,225,226,201,-1,201,226,202,-1,226,227,202,-1,202,227,203,-1,227,228,203,-1,203,228,204,-1,228,229,204,-1,204,229,205,-1,229,230,205,-1,205,230,206,-1,230,231,206,-1,206,231,207,-1,231,232,207,-1,207,232,208,-1,232,233,208,-1,208,233,209,-1,233,234,209,-1,209,234,210,-1,234,235,210,-1,210,235,211,-1,235,236,211,-1,211,236,212,-1,236,237,212,-1,212,237,213,-1,237,238,213,-1,213,238,214,-1,238,239,214,-1,214,239,215,-1,239,240,215,-1,215,240,216,-1,240,241,216,-1,216,241,217,-1,241,242,217,-1,217,242,218,-1,242,243,218,-1,218,243,219,-1,243,244,219,-1,219,244,220,-1,244,245,220,-1,220,245,221,-1,245,246,221,-1,221,246,222,-1,246,247,222,-1,222,247,223,-1,247,248,223,-1,223,248,224,-1,248,249,224,-1,225,250,226,-1,250,251,226,-1,226,251,227,-1,251,252,227,-1,227,252,228,-1,252,253,228,-1,228,253,229,-1,253,254,229,-1,229,254,230,-1,254,255,230,-1,230,255,231,-1,255,256,231,-1,231,256,232,-1,256,257,232,-1,232,257,233,-1,257,258,233,-1,233,258,234,-1,258,259,234,-1,234,259,235,-1,259,260,235,-1,235,260,236,-1,260,261,236,-1,236,261,237,-1,261,262,237,-1,237,262,238,-1,262,263,238,-1,238,263,239,-1,263,264,239,-1,239,264,240,-1,264,265,240,-1,240,265,241,-1,265,266,241,-1,241,266,242,-1,266,267,242,-1,242,267,243,-1,267,268,243,-1,243,268,244,-1,268,269,244,-1,244,269,245,-1,269,270,245,-1,245,270,246,-1,270,271,246,-1,246,271,247,-1,271,272,247,-1,247,272,248,-1,272,273,248,-1,248,273,249,-1,273,274,249,-1,250,275,251,-1,275,276,251,-1,251,276,252,-1,276,277,252,-1,252,277,253,-1,277,278,253,-1,253,278,254,-1,278,279,254,-1,254,279,255,-1,279,280,255,-1,255,280,256,-1,280,281,256,-1,256,281,257,-1,281,282,257,-1,257,282,258,-1,282,283,258,-1,258,283,259,-1,283,284,259,-1,259,284,260,-1,284,285,260,-1,260,285,261,-1,285,286,261,-1,261,286,262,-1,286,287,262,-1,262,287,263,-1,287,288,263,-1,263,288,264,-1,288,289,264,-1,264,289,265,-1,289,290,265,-1,265,290,266,-1,290,291,266,-1,266,291,267,-1,291,292,267,-1,267,292,268,-1,292,293,268,-1,268,293,269,-1,293,294,269,-1,269,294,270,-1,294,295,270,-1,270,295,271,-1,295,296,271,-1,271,296,272,-1,296,297,272,-1,272,297,273,-1,297,298,273,-1,273,298,274,-1,298,299,274,-1,275,300,276,-1,300,301,276,-1,276,301,277,-1,301,302,277,-1,277,302,278,-1,302,303,278,-1,278,303,279,-1,303,304,279,-1,279,304,280,-1,304,305,280,-1,280,305,281,-1,305,306,281,-1,281,306,282,-1,306,307,282,-1,282,307,283,-1,307,308,283,-1,283,308,284,-1,308,309,284,-1,284,309,285,-1,309,310,285,-1,285,310,286,-1,310,311,286,-1,286,311,287,-1,311,312,287,-1,287,312,288,-1,312,313,288,-1,288,313,289,-1,313,314,289,-1,289,314,290,-1,314,315,290,-1,290,315,291,-1,315,316,291,-1,291,316,292,-1,316,317,292,-1,292,317,293,-1,317,318,293,-1,293,318,294,-1,318,319,294,-1,294,319,295,-1,319,320,295,-1,295,320,296,-1,320,321,296,-1,296,321,297,-1,321,322,297,-1,297,322,298,-1,322,323,298,-1,298,323,299,-1,323,324,299,-1,300,325,301,-1,325,326,301,-1,301,326,302,-1,326,327,302,-1,302,327,303,-1,327,328,303,-1,303,328,304,-1,328,329,304,-1,304,329,305,-1,329,330,305,-1,305,330,306,-1,330,331,306,-1,306,331,307,-1,331,332,307,-1,307,332,308,-1,332,333,308,-1,308,333,309,-1,333,334,309,-1,309,334,310,-1,334,335,310,-1,310,335,311,-1,335,336,311,-1,311,336,312,-1,336,337,312,-1,312,337,313,-1,337,338,313,-1,313,338,314,-1,338,339,314,-1,314,339,315,-1,339,340,315,-1,315,340,316,-1,340,341,316,-1,316,341,317,-1,341,342,317,-1,317,342,318,-1,342,343,318,-1,318,343,319,-1,343,344,319,-1,319,344,320,-1,344,345,320,-1,320,345,321,-1,345,346,321,-1,321,346,322,-1,346,347,322,-1,322,347,323,-1,347,348,323,-1,323,348,324,-1,348,349,324,-1,325,350,326,-1,350,351,326,-1,326,351,327,-1,351,352,327,-1,327,352,328,-1,352,353,328,-1,328,353,329,-1,353,354,329,-1,329,354,330,-1,354,355,330,-1,330,355,331,-1,355,356,331,-1,331,356,332,-1,356,357,332,-1,332,357,333,-1,357,358,333,-1,333,358,334,-1,358,359,334,-1,334,359,335,-1,359,360,335,-1,335,360,336,-1,360,361,336,-1,336,361,337,-1,361,362,337,-1,337,362,338,-1,362,363,338,-1,338,363,339,-1,363,364,339,-1,339,364,340,-1,364,365,340,-1,340,365,341,-1,365,366,341,-1,341,366,342,-1,366,367,342,-1,342,367,343,-1,367,368,343,-1,343,368,344,-1,368,369,344,-1,344,369,345,-1,369,370,345,-1,345,370,346,-1,370,371,346,-1,346,371,347,-1,371,372,347,-1,347,372,348,-1,372,373,348,-1,348,373,349,-1,373,374,349,-1,350,375,351,-1,375,376,351,-1,351,376,352,-1,376,377,352,-1,352,377,353,-1,377,378,353,-1,353,378,354,-1,378,379,354,-1,354,379,355,-1,379,380,355,-1,355,380,356,-1,380,381,356,-1,356,381,357,-1,381,382,357,-1,357,382,358,-1,382,383,358,-1,358,383,359,-1,383,384,359,-1,359,384,360,-1,384,385,360,-1,360,385,361,-1,385,386,361,-1,361,386,362,-1,386,387,362,-1,362,387,363,-1,387,388,363,-1,363,388,364,-1,388,389,364,-1,364,389,365,-1,389,390,365,-1,365,390,366,-1,390,391,366,-1,366,391,367,-1,391,392,367,-1,367,392,368,-1,392,393,368,-1,368,393,369,-1,393,394,369,-1,369,394,370,-1,394,395,370,-1,370,395,371,-1,395,396,371,-1,371,396,372,-1,396,397,372,-1,372,397,373,-1,397,398,373,-1,373,398,374,-1,398,399,374,-1,375,400,376,-1,400,401,376,-1,376,401,377,-1,401,402,377,-1,377,402,378,-1,402,403,378,-1,378,403,379,-1,403,404,379,-1,379,404,380,-1,404,405,380,-1,380,405,381,-1,405,406,381,-1,381,406,382,-1,406,407,382,-1,382,407,383,-1,407,408,383,-1,383,408,384,-1,408,409,384,-1,384,409,385,-1,409,410,385,-1,385,410,386,-1,410,411,386,-1,386,411,387,-1,411,412,387,-1,387,412,388,-1,412,413,388,-1,388,413,389,-1,413,414,389,-1,389,414,390,-1,414,415,390,-1,390,415,391,-1,415,416,391,-1,391,416,392,-1,416,417,392,-1,392,417,393,-1,417,418,393,-1,393,418,394,-1,418,419,394,-1,394,419,395,-1,419,420,395,-1,395,420,396,-1,420,421,396,-1,396,421,397,-1,421,422,397,-1,397,422,398,-1,422,423,398,-1,398,423,399,-1,423,424,399,-1,400,425,401,-1,425,426,401,-1,401,426,402,-1,426,427,402,-1,402,427,403,-1,427,428,403,-1,403,428,404,-1,428,429,404,-1,404,429,405,-1,429,430,405,-1,405,430,406,-1,430,431,406,-1,406,431,407,-1,431,432,407,-1,407,432,408,-1,432,433,408,-1,408,433,409,-1,433,434,409,-1,409,434,410,-1,434,435,410,-1,410,435,411,-1,435,436,411,-1,411,436,412,-1,436,437,412,-1,412,437,413,-1,437,438,413,-1,413,438,414,-1,438,439,414,-1,414,439,415,-1,439,440,415,-1,415,440,416,-1,440,441,416,-1,416,441,417,-1,441,442,417,-1,417,442,418,-1,442,443,418,-1,418,443,419,-1,443,444,419,-1,419,444,420,-1,444,445,420,-1,420,445,421,-1,445,446,421,-1,421,446,422,-1,446,447,422,-1,422,447,423,-1,447,448,423,-1,423,448,424,-1,448,449,424,-1,425,450,426,-1,450,451,426,-1,426,451,427,-1,451,452,427,-1,427,452,428,-1,452,453,428,-1,428,453,429,-1,453,454,429,-1,429,454,430,-1,454,455,430,-1,430,455,431,-1,455,456,431,-1,431,456,432,-1,456,457,432,-1,432,457,433,-1,457,458,433,-1,433,458,434,-1,458,459,434,-1,434,459,435,-1,459,460,435,-1,435,460,436,-1,460,461,436,-1,436,461,437,-1,461,462,437,-1,437,462,438,-1,462,463,438,-1,438,463,439,-1,463,464,439,-1,439,464,440,-1,464,465,440,-1,440,465,441,-1,465,466,441,-1,441,466,442,-1,466,467,442,-1,442,467,443,-1,467,468,443,-1,443,468,444,-1,468,469,444,-1,444,469,445,-1,469,470,445,-1,445,470,446,-1,470,471,446,-1,446,471,447,-1,471,472,447,-1,447,472,448,-1,472,473,448,-1,448,473,449,-1,473,474,449,-1,450,475,451,-1,475,476,451,-1,451,476,452,-1,476,477,452,-1,452,477,453,-1,477,478,453,-1,453,478,454,-1,478,479,454,-1,454,479,455,-1,479,480,455,-1,455,480,456,-1,480,481,456,-1,456,481,457,-1,481,482,457,-1,457,482,458,-1,482,483,458,-1,458,483,459,-1,483,484,459,-1,459,484,460,-1,484,485,460,-1,460,485,461,-1,485,486,461,-1,461,486,462,-1,486,487,462,-1,462,487,463,-1,487,488,463,-1,463,488,464,-1,488,489,464,-1,464,489,465,-1,489,490,465,-1,465,490,466,-1,490,491,466,-1,466,491,467,-1,491,492,467,-1,467,492,468,-1,492,493,468,-1,468,493,469,-1,493,494,469,-1,469,494,470,-1,494,495,470,-1,470,495,471,-1,495,496,471,-1,471,496,472,-1,496,497,472,-1,472,497,473,-1,497,498,473,-1,473,498,474,-1,498,499,474,-1,475,500,476,-1,500,501,476,-1,476,501,477,-1,501,502,477,-1,477,502,478,-1,502,503,478,-1,478,503,479,-1,503,504,479,-1,479,504,480,-1,504,505,480,-1,480,505,481,-1,505,506,481,-1,481,506,482,-1,506,507,482,-1,482,507,483,-1,507,508,483,-1,483,508,484,-1,508,509,484,-1,484,509,485,-1,509,510,485,-1,485,510,486,-1,510,511,486,-1,486,511,487,-1,511,512,487,-1,487,512,488,-1,512,513,488,-1,488,513,489,-1,513,514,489,-1,489,514,490,-1,514,515,490,-1,490,515,491,-1,515,516,491,-1,491,516,492,-1,516,517,492,-1,492,517,493,-1,517,518,493,-1,493,518,494,-1,518,519,494,-1,494,519,495,-1,519,520,495,-1,495,520,496,-1,520,521,496,-1,496,521,497,-1,521,522,497,-1,497,522,498,-1,522,523,498,-1,498,523,499,-1,523,524,499,-1,500,525,501,-1,525,526,501,-1,501,526,502,-1,526,527,502,-1,502,527,503,-1,527,528,503,-1,503,528,504,-1,528,529,504,-1,504,529,505,-1,529,530,505,-1,505,530,506,-1,530,531,506,-1,506,531,507,-1,531,532,507,-1,507,532,508,-1,532,533,508,-1,508,533,509,-1,533,534,509,-1,509,534,510,-1,534,535,510,-1,510,535,511,-1,535,536,511,-1,511,536,512,-1,536,537,512,-1,512,537,513,-1,537,538,513,-1,513,538,514,-1,538,539,514,-1,514,539,515,-1,539,540,515,-1,515,540,516,-1,540,541,516,-1,516,541,517,-1,541,542,517,-1,517,542,518,-1,542,543,518,-1,518,543,519,-1,543,544,519,-1,519,544,520,-1,544,545,520,-1,520,545,521,-1,545,546,521,-1,521,546,522,-1,546,547,522,-1,522,547,523,-1,547,548,523,-1,523,548,524,-1,548,549,524,-1,525,550,526,-1,550,551,526,-1,526,551,527,-1,551,552,527,-1,527,552,528,-1,552,553,528,-1,528,553,529,-1,553,554,529,-1,529,554,530,-1,554,555,530,-1,530,555,531,-1,555,556,531,-1,531,556,532,-1,556,557,532,-1,532,557,533,-1,557,558,533,-1,533,558,534,-1,558,559,534,-1,534,559,535,-1,559,560,535,-1,535,560,536,-1,560,561,536,-1,536,561,537,-1,561,562,537,-1,537,562,538,-1,562,563,538,-1,538,563,539,-1,563,564,539,-1,539,564,540,-1,564,565,540,-1,540,565,541,-1,565,566,541,-1,541,566,542,-1,566,567,542,-1,542,567,543,-1,567,568,543,-1,543,568,544,-1,568,569,544,-1,544,569,545,-1,569,570,545,-1,545,570,546,-1,570,571,546,-1,546,571,547,-1,571,572,547,-1,547,572,548,-1,572,573,548,-1,548,573,549,-1,573,574,549,-1,550,575,551,-1,575,576,551,-1,551,576,552,-1,576,577,552,-1,552,577,553,-1,577,578,553,-1,553,578,554,-1,578,579,554,-1,554,579,555,-1,579,580,555,-1,555,580,556,-1,580,581,556,-1,556,581,557,-1,581,582,557,-1,557,582,558,-1,582,583,558,-1,558,583,559,-1,583,584,559,-1,559,584,560,-1,584,585,560,-1,560,585,561,-1,585,586,561,-1,561,586,562,-1,586,587,562,-1,562,587,563,-1,587,588,563,-1,563,588,564,-1,588,589,564,-1,564,589,565,-1,589,590,565,-1,565,590,566,-1,590,591,566,-1,566,591,567,-1,591,592,567,-1,567,592,568,-1,592,593,568,-1,568,593,569,-1,593,594,569,-1,569,594,570,-1,594,595,570,-1,570,595,571,-1,595,596,571,-1,571,596,572,-1,596,597,572,-1,572,597,573,-1,597,598,573,-1,573,598,574,-1,598,599,574,-1,575,600,576,-1,600,601,576,-1,576,601,577,-1,601,602,577,-1,577,602,578,-1,602,603,578,-1,578,603,579,-1,603,604,579,-1,579,604,580,-1,604,605,580,-1,580,605,581,-1,605,606,581,-1,581,606,582,-1,606,607,582,-1,582,607,583,-1,607,608,583,-1,583,608,584,-1,608,609,584,-1,584,609,585,-1,609,610,585,-1,585,610,586,-1,610,611,586,-1,586,611,587,-1,611,612,587,-1,587,612,588,-1,612,613,588,-1,588,613,589,-1,613,614,589,-1,589,614,590,-1,614,615,590,-1,590,615,591,-1,615,616,591,-1,591,616,592,-1,616,617,592,-1,592,617,593,-1,617,618,593,-1,593,618,594,-1,618,619,594,-1,594,619,595,-1,619,620,595,-1,595,620,596,-1,620,621,596,-1,596,621,597,-1,621,622,597,-1,597,622,598,-1,622,623,598,-1,598,623,599,-1,623,624,599,-1"><coordinate point="0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0.065403,0.997859,0,0.065154,0.997859,0.0057,0.06441,0.997859,0.011357,0.063175,0.997859,0.016928,0.061459,0.997859,0.022369,0.059275,0.997859,0.027641,0.056641,0.997859,0.032702,0.053575,0.997859,0.037514,0.050102,0.997859,0.04204,0.046247,0.997859,0.046247,0.04204,0.997859,0.050102,0.037514,0.997859,0.053575,0.032702,0.997859,0.056641,0.027641,0.997859,0.059275,0.022369,0.997859,0.061459,0.016928,0.997859,0.063175,0.011357,0.997859,0.06441,0.0057,0.997859,0.065154,0,0.997859,0.065403,-0.0057,0.997859,0.065154,-0.011357,0.997859,0.06441,-0.016928,0.997859,0.063175,-0.022369,0.997859,0.061459,-0.027641,0.997859,0.059275,-0.032702,0.997859,0.056641,0.130526,0.991445,0,0.13003,0.991445,0.011376,0.128543,0.991445,0.022666,0.126079,0.991445,0.033783,0.122654,0.991445,0.044643,0.118297,0.991445,0.055163,0.113039,0.991445,0.065263,0.106921,0.991445,0.074867,0.099989,0.991445,0.083901,0.092296,0.991445,0.092296,0.083901,0.991445,0.099989,0.074867,0.991445,0.106921,0.065263,0.991445,0.113039,0.055163,0.991445,0.118297,0.044643,0.991445,0.122654,0.033783,0.991445,0.126079,0.022666,0.991445,0.128543,0.011376,0.991445,0.13003,0,0.991445,0.130526,-0.011376,0.991445,0.13003,-0.022666,0.991445,0.128543,-0.033783,0.991445,0.126079,-0.044643,0.991445,0.122654,-0.055163,0.991445,0.118297,-0.065263,0.991445,0.113039,0.19509,0.980785,0,0.194348,0.980785,0.017003,0.192126,0.980785,0.033877,0.188443,0.980785,0.050493,0.183325,0.980785,0.066725,0.176812,0.980785,0.082449,0.168953,0.980785,0.097545,0.159809,0.980785,0.111899,0.149448,0.980785,0.125402,0.13795,0.980785,0.13795,0.125402,0.980785,0.149448,0.111899,0.980785,0.159809,0.097545,0.980785,0.168953,0.082449,0.980785,0.176812,0.066725,0.980785,0.183325,0.050493,0.980785,0.188443,0.033877,0.980785,0.192126,0.017003,0.980785,0.194348,0,0.980785,0.19509,-0.017003,0.980785,0.194348,-0.033877,0.980785,0.192126,-0.050493,0.980785,0.188443,-0.066725,0.980785,0.183325,-0.082449,0.980785,0.176812,-0.097545,0.980785,0.168953,0.258819,0.965926,0,0.257834,0.965926,0.022558,0.254887,0.965926,0.044943,0.25,0.965926,0.066987,0.24321,0.965926,0.088521,0.23457,0.965926,0.109382,0.224144,0.965926,0.12941,0.212012,0.965926,0.148453,0.198267,0.965926,0.166366,0.183013,0.965926,0.183013,0.166366,0.965926,0.198267,0.148453,0.965926,0.212012,0.12941,0.965926,0.224144,0.109382,0.965926,0.23457,0.088521,0.965926,0.24321,0.066987,0.965926,0.25,0.044943,0.965926,0.254887,0.022558,0.965926,0.257834,0,0.965926,0.258819,-0.022558,0.965926,0.257834,-0.044943,0.965926,0.254887,-0.066987,0.965926,0.25,-0.088521,0.965926,0.24321,-0.109382,0.965926,0.23457,-0.12941,0.965926,0.224144,0.321439,0.94693,0,0.320216,0.94693,0.028015,0.316556,0.94693,0.055817,0.310487,0.94693,0.083195,0.302054,0.94693,0.109939,0.291323,0.94693,0.135846,0.278375,0.94693,0.16072,0.263308,0.94693,0.18437,0.246237,0.94693,0.206617,0.227292,0.94693,0.227292,0.206617,0.94693,0.246237,0.18437,0.94693,0.263308,0.16072,0.94693,0.278375,0.135846,0.94693,0.291323,0.109939,0.94693,0.302054,0.083195,0.94693,0.310487,0.055817,0.94693,0.316556,0.028015,0.94693,0.320216,0,0.94693,0.321439,-0.028015,0.94693,0.320216,-0.055817,0.94693,0.316556,-0.083195,0.94693,0.310487,-0.109939,0.94693,0.302054,-0.135846,0.94693,0.291323,-0.16072,0.94693,0.278375,0.382683,0.92388,0,0.381227,0.92388,0.033353,0.37687,0.92388,0.066452,0.369644,0.92388,0.099046,0.359605,0.92388,0.130885,0.346829,0.92388,0.161729,0.331414,0.92388,0.191342,0.313476,0.92388,0.219498,0.293153,0.92388,0.245984,0.270598,0.92388,0.270598,0.245984,0.92388,0.293153,0.219498,0.92388,0.313476,0.191342,0.92388,0.331414,0.161729,0.92388,0.346829,0.130885,0.92388,0.359605,0.099046,0.92388,0.369644,0.066452,0.92388,0.37687,0.033353,0.92388,0.381227,0,0.92388,0.382683,-0.033353,0.92388,0.381227,-0.066452,0.92388,0.37687,-0.099046,0.92388,0.369644,-0.130885,0.92388,0.359605,-0.161729,0.92388,0.346829,-0.191342,0.92388,0.331414,0.442289,0.896873,0,0.440606,0.896873,0.038548,0.435569,0.896873,0.076803,0.427218,0.896873,0.114473,0.415615,0.896873,0.151272,0.40085,0.896873,0.186919,0.383033,0.896873,0.221144,0.362302,0.896873,0.253686,0.338813,0.896873,0.284298,0.312745,0.896873,0.312745,0.284298,0.896873,0.338813,0.253686,0.896873,0.362302,0.221144,0.896873,0.383033,0.186919,0.896873,0.40085,0.151272,0.896873,0.415615,0.114473,0.896873,0.427218,0.076803,0.896873,0.435569,0.038548,0.896873,0.440606,0,0.896873,0.442289,-0.038548,0.896873,0.440606,-0.076803,0.896873,0.435569,-0.114473,0.896873,0.427218,-0.151272,0.896873,0.415615,-0.186919,0.896873,0.40085,-0.221144,0.896873,0.383033,0.5,0.866025,0,0.498097,0.866025,0.043578,0.492404,0.866025,0.086824,0.482963,0.866025,0.12941,0.469846,0.866025,0.17101,0.453154,0.866025,0.211309,0.433013,0.866025,0.25,0.409576,0.866025,0.286788,0.383022,0.866025,0.321394,0.353553,0.866025,0.353553,0.321394,0.866025,0.383022,0.286788,0.866025,0.409576,0.25,0.866025,0.433013,0.211309,0.866025,0.453154,0.17101,0.866025,0.469846,0.12941,0.866025,0.482963,0.086824,0.866025,0.492404,0.043578,0.866025,0.498097,0,0.866025,0.5,-0.043578,0.866025,0.498097,-0.086824,0.866025,0.492404,-0.12941,0.866025,0.482963,-0.17101,0.866025,0.469846,-0.211309,0.866025,0.453154,-0.25,0.866025,0.433013,0.55557,0.83147,0,0.553456,0.83147,0.048421,0.54713,0.83147,0.096474,0.53664,0.83147,0.143792,0.522065,0.83147,0.190016,0.503518,0.83147,0.234794,0.481138,0.83147,0.277785,0.455096,0.83147,0.318662,0.425591,0.83147,0.357114,0.392847,0.83147,0.392847,0.357114,0.83147,0.425591,0.318662,0.83147,0.455096,0.277785,0.83147,0.481138,0.234794,0.83147,0.503518,0.190016,0.83147,0.522065,0.143792,0.83147,0.53664,0.096474,0.83147,0.54713,0.048421,0.83147,0.553456,0,0.83147,0.55557,-0.048421,0.83147,0.553456,-0.096474,0.83147,0.54713,-0.143792,0.83147,0.53664,-0.190016,0.83147,0.522065,-0.234794,0.83147,0.503518,-0.277785,0.83147,0.481138,0.608761,0.793353,0,0.606445,0.793353,0.053057,0.599513,0.793353,0.10571,0.588018,0.793353,0.157559,0.572049,0.793353,0.208209,0.551725,0.793353,0.257274,0.527203,0.793353,0.304381,0.498668,0.793353,0.349171,0.466338,0.793353,0.391304,0.430459,0.793353,0.430459,0.391304,0.793353,0.466338,0.349171,0.793353,0.498668,0.304381,0.793353,0.527203,0.257274,0.793353,0.551725,0.208209,0.793353,0.572049,0.157559,0.793353,0.588018,0.10571,0.793353,0.599513,0.053057,0.793353,0.606445,0,0.793353,0.608761,-0.053057,0.793353,0.606445,-0.10571,0.793353,0.599513,-0.157559,0.793353,0.588018,-0.208209,0.793353,0.572049,-0.257274,0.793353,0.551725,-0.304381,0.793353,0.527203,0.659346,0.75184,0,0.656837,0.75184,0.057466,0.649329,0.75184,0.114494,0.636879,0.75184,0.170651,0.619582,0.75184,0.22551,0.59757,0.75184,0.278652,0.57101,0.75184,0.329673,0.540104,0.75184,0.378185,0.505088,0.75184,0.423819,0.466228,0.75184,0.466228,0.423819,0.75184,0.505088,0.378185,0.75184,0.540104,0.329673,0.75184,0.57101,0.278652,0.75184,0.59757,0.22551,0.75184,0.619582,0.170651,0.75184,0.636879,0.114494,0.75184,0.649329,0.057466,0.75184,0.656837,0,0.75184,0.659346,-0.057466,0.75184,0.656837,-0.114494,0.75184,0.649329,-0.170651,0.75184,0.636879,-0.22551,0.75184,0.619582,-0.278652,0.75184,0.59757,-0.329673,0.75184,0.57101,0.707107,0.707107,0,0.704416,0.707107,0.061628,0.696364,0.707107,0.122788,0.683013,0.707107,0.183013,0.664463,0.707107,0.241845,0.640856,0.707107,0.298836,0.612372,0.707107,0.353553,0.579228,0.707107,0.40558,0.541675,0.707107,0.454519,0.5,0.707107,0.5,0.454519,0.707107,0.541675,0.40558,0.707107,0.579228,0.353553,0.707107,0.612372,0.298836,0.707107,0.640856,0.241845,0.707107,0.664463,0.183013,0.707107,0.683013,0.122788,0.707107,0.696364,0.061628,0.707107,0.704416,0,0.707107,0.707107,-0.061628,0.707107,0.704416,-0.122788,0.707107,0.696364,-0.183013,0.707107,0.683013,-0.241845,0.707107,0.664463,-0.298836,0.707107,0.640856,-0.353553,0.707107,0.612372,0.75184,0.659346,0,0.748979,0.659346,0.065527,0.740418,0.659346,0.130556,0.726221,0.659346,0.19459,0.706498,0.659346,0.257144,0.681398,0.659346,0.317741,0.651112,0.659346,0.37592,0.615871,0.659346,0.431238,0.575943,0.659346,0.483273,0.531631,0.659346,0.531631,0.483273,0.659346,0.575943,0.431238,0.659346,0.615871,0.37592,0.659346,0.651112,0.317741,0.659346,0.681398,0.257144,0.659346,0.706498,0.19459,0.659346,0.726221,0.130556,0.659346,0.740418,0.065527,0.659346,0.748979,0,0.659346,0.75184,-0.065527,0.659346,0.748979,-0.130556,0.659346,0.740418,-0.19459,0.659346,0.726221,-0.257144,0.659346,0.706498,-0.317741,0.659346,0.681398,-0.37592,0.659346,0.651112,0.793353,0.608761,0,0.790334,0.608761,0.069145,0.781301,0.608761,0.137764,0.76632,0.608761,0.205335,0.745508,0.608761,0.271343,0.719022,0.608761,0.335286,0.687064,0.608761,0.396677,0.649877,0.608761,0.455049,0.607744,0.608761,0.509958,0.560986,0.608761,0.560986,0.509958,0.608761,0.607744,0.455049,0.608761,0.649877,0.396677,0.608761,0.687064,0.335286,0.608761,0.719022,0.271343,0.608761,0.745508,0.205335,0.608761,0.76632,0.137764,0.608761,0.781301,0.069145,0.608761,0.790334,0,0.608761,0.793353,-0.069145,0.608761,0.790334,-0.137764,0.608761,0.781301,-0.205335,0.608761,0.76632,-0.271343,0.608761,0.745508,-0.335286,0.608761,0.719022,-0.396677,0.608761,0.687064,0.83147,0.55557,0,0.828306,0.55557,0.072467,0.818838,0.55557,0.144383,0.803138,0.55557,0.2152,0.781326,0.55557,0.284379,0.753567,0.55557,0.351394,0.720074,0.55557,0.415735,0.6811,0.55557,0.476911,0.636943,0.55557,0.534458,0.587938,0.55557,0.587938,0.534458,0.55557,0.636943,0.476911,0.55557,0.6811,0.415735,0.55557,0.720074,0.351394,0.55557,0.753567,0.284379,0.55557,0.781326,0.2152,0.55557,0.803138,0.144383,0.55557,0.818838,0.072467,0.55557,0.828306,0,0.55557,0.83147,-0.072467,0.55557,0.828306,-0.144383,0.55557,0.818838,-0.2152,0.55557,0.803138,-0.284379,0.55557,0.781326,-0.351394,0.55557,0.753567,-0.415735,0.55557,0.720074,0.866025,0.5,0,0.86273,0.5,0.075479,0.852869,0.5,0.150384,0.836516,0.5,0.224144,0.813798,0.5,0.296198,0.784886,0.5,0.365998,0.75,0.5,0.433013,0.709406,0.5,0.496732,0.663414,0.5,0.55667,0.612372,0.5,0.612372,0.55667,0.5,0.663414,0.496732,0.5,0.709406,0.433013,0.5,0.75,0.365998,0.5,0.784886,0.296198,0.5,0.813798,0.224144,0.5,0.836516,0.150384,0.5,0.852869,0.075479,0.5,0.86273,0,0.5,0.866025,-0.075479,0.5,0.86273,-0.150384,0.5,0.852869,-0.224144,0.5,0.836516,-0.296198,0.5,0.813798,-0.365998,0.5,0.784886,-0.433013,0.5,0.75,0.896873,0.442289,0,0.89346,0.442289,0.078168,0.883247,0.442289,0.15574,0.866313,0.442289,0.232128,0.842785,0.442289,0.306749,0.812843,0.442289,0.379035,0.776715,0.442289,0.448436,0.734675,0.442289,0.514425,0.687044,0.442289,0.576499,0.634185,0.442289,0.634185,0.576499,0.442289,0.687044,0.514425,0.442289,0.734675,0.448436,0.442289,0.776715,0.379035,0.442289,0.812843,0.306749,0.442289,0.842785,0.232128,0.442289,0.866313,0.15574,0.442289,0.883247,0.078168,0.442289,0.89346,0,0.442289,0.896873,-0.078168,0.442289,0.89346,-0.15574,0.442289,0.883247,-0.232128,0.442289,0.866313,-0.306749,0.442289,0.842785,-0.379035,0.442289,0.812843,-0.448436,0.442289,0.776715,0.92388,0.382683,0,0.920364,0.382683,0.080521,0.909844,0.382683,0.16043,0.892399,0.382683,0.239118,0.868163,0.382683,0.315985,0.837319,0.382683,0.390448,0.800103,0.382683,0.46194,0.756798,0.382683,0.529916,0.707733,0.382683,0.593858,0.653281,0.382683,0.653281,0.593858,0.382683,0.707733,0.529916,0.382683,0.756798,0.46194,0.382683,0.800103,0.390448,0.382683,0.837319,0.315985,0.382683,0.868163,0.239118,0.382683,0.892399,0.16043,0.382683,0.909844,0.080521,0.382683,0.920364,0,0.382683,0.92388,-0.080521,0.382683,0.920364,-0.16043,0.382683,0.909844,-0.239118,0.382683,0.892399,-0.315985,0.382683,0.868163,-0.390448,0.382683,0.837319,-0.46194,0.382683,0.800103,0.94693,0.321439,0,0.943327,0.321439,0.08253,0.932544,0.321439,0.164433,0.914664,0.321439,0.245084,0.889823,0.321439,0.323869,0.85821,0.321439,0.40019,0.820066,0.321439,0.473465,0.77568,0.321439,0.543137,0.725391,0.321439,0.608675,0.669581,0.321439,0.669581,0.608675,0.321439,0.725391,0.543137,0.321439,0.77568,0.473465,0.321439,0.820066,0.40019,0.321439,0.85821,0.323869,0.321439,0.889823,0.245084,0.321439,0.914664,0.164433,0.321439,0.932544,0.08253,0.321439,0.943327,0,0.321439,0.94693,-0.08253,0.321439,0.943327,-0.164433,0.321439,0.932544,-0.245084,0.321439,0.914664,-0.323869,0.321439,0.889823,-0.40019,0.321439,0.85821,-0.473465,0.321439,0.820066,0.965926,0.258819,0,0.96225,0.258819,0.084186,0.951251,0.258819,0.167731,0.933013,0.258819,0.25,0.907673,0.258819,0.330366,0.875426,0.258819,0.408218,0.836516,0.258819,0.482963,0.79124,0.258819,0.554032,0.739942,0.258819,0.620885,0.683013,0.258819,0.683013,0.620885,0.258819,0.739942,0.554032,0.258819,0.79124,0.482963,0.258819,0.836516,0.408218,0.258819,0.875426,0.330366,0.258819,0.907673,0.25,0.258819,0.933013,0.167731,0.258819,0.951251,0.084186,0.258819,0.96225,0,0.258819,0.965926,-0.084186,0.258819,0.96225,-0.167731,0.258819,0.951251,-0.25,0.258819,0.933013,-0.330366,0.258819,0.907673,-0.408218,0.258819,0.875426,-0.482963,0.258819,0.836516,0.980785,0.19509,0,0.977053,0.19509,0.085481,0.965885,0.19509,0.170312,0.947366,0.19509,0.253846,0.921637,0.19509,0.335448,0.888893,0.19509,0.414498,0.849385,0.19509,0.490393,0.803412,0.19509,0.562555,0.751325,0.19509,0.630437,0.69352,0.19509,0.69352,0.630437,0.19509,0.751325,0.562555,0.19509,0.803412,0.490393,0.19509,0.849385,0.414498,0.19509,0.888893,0.335448,0.19509,0.921637,0.253846,0.19509,0.947366,0.170312,0.19509,0.965885,0.085481,0.19509,0.977053,0,0.19509,0.980785,-0.085481,0.19509,0.977053,-0.170312,0.19509,0.965885,-0.253846,0.19509,0.947366,-0.335448,0.19509,0.921637,-0.414498,0.19509,0.888893,-0.490393,0.19509,0.849385,0.991445,0.130526,0,0.987672,0.130526,0.08641,0.976383,0.130526,0.172163,0.957662,0.130526,0.256605,0.931653,0.130526,0.339094,0.898554,0.130526,0.419003,0.858616,0.130526,0.495722,0.812144,0.130526,0.568669,0.759491,0.130526,0.637288,0.701057,0.130526,0.701057,0.637288,0.130526,0.759491,0.568669,0.130526,0.812144,0.495722,0.130526,0.858616,0.419003,0.130526,0.898554,0.339094,0.130526,0.931653,0.256605,0.130526,0.957662,0.172163,0.130526,0.976383,0.08641,0.130526,0.987672,0,0.130526,0.991445,-0.08641,0.130526,0.987672,-0.172163,0.130526,0.976383,-0.256605,0.130526,0.957662,-0.339094,0.130526,0.931653,-0.419003,0.130526,0.898554,-0.495722,0.130526,0.858616,0.997859,0.065403,0,0.994062,0.065403,0.086969,0.982699,0.065403,0.173276,0.963858,0.065403,0.258265,0.937681,0.065403,0.341288,0.904367,0.065403,0.421713,0.864171,0.065403,0.498929,0.817398,0.065403,0.572348,0.764404,0.065403,0.641411,0.705593,0.065403,0.705593,0.641411,0.065403,0.764404,0.572348,0.065403,0.817398,0.498929,0.065403,0.864171,0.421713,0.065403,0.904367,0.341288,0.065403,0.937681,0.258265,0.065403,0.963858,0.173276,0.065403,0.982699,0.086969,0.065403,0.994062,0,0.065403,0.997859,-0.086969,0.065403,0.994062,-0.173276,0.065403,0.982699,-0.258265,0.065403,0.963858,-0.341288,0.065403,0.937681,-0.421713,0.065403,0.904367,-0.498929,0.065403,0.864171,1,0,0,0.996195,0,0.087156,0.984808,0,0.173648,0.965926,0,0.258819,0.939693,0,0.34202,0.906308,0,0.422618,0.866025,0,0.5,0.819152,0,0.573576,0.766044,0,0.642788,0.707107,0,0.707107,0.642788,0,0.766044,0.573576,0,0.819152,0.5,0,0.866025,0.422618,0,0.906308,0.34202,0,0.939693,0.258819,0,0.965926,0.173648,0,0.984808,0.087156,0,0.996195,0,0,1,-0.087156,0,0.996195,-0.173648,0,0.984808,-0.258819,0,0.965926,-0.34202,0,0.939693,-0.422618,0,0.906308,-0.5,0,0.866025"></coordinate></indexedfaceset></shape></transform><transform render="false" visible="false"><shape><indexedfaceset def="hex-2" solid="false" creaseangle="0" coordindex="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,-1,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,-1,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,-1,0,75,24,-1,25,75,49,-1,50,75,74,-1"><coordinate point="1,0,0,0.996195,0,0.087156,0.984808,0,0.173648,0.965926,0,0.258819,0.939693,0,0.34202,0.906308,0,0.422618,0.866025,0,0.5,0.819152,0,0.573576,0.766044,0,0.642788,0.707107,0,0.707107,0.642788,0,0.766044,0.573576,0,0.819152,0.5,0,0.866025,0.422618,0,0.906308,0.34202,0,0.939693,0.258819,0,0.965926,0.173648,0,0.984808,0.087156,0,0.996195,0,0,1,-0.087156,0,0.996195,-0.173648,0,0.984808,-0.258819,0,0.965926,-0.34202,0,0.939693,-0.422618,0,0.906308,-0.5,0,0.866025,0,1,0,0.065403,0.997859,0,0.130526,0.991445,0,0.19509,0.980785,0,0.258819,0.965926,0,0.321439,0.94693,0,0.382683,0.92388,0,0.442289,0.896873,0,0.5,0.866025,0,0.55557,0.83147,0,0.608761,0.793353,0,0.659346,0.75184,0,0.707107,0.707107,0,0.75184,0.659346,0,0.793353,0.608761,0,0.83147,0.55557,0,0.866025,0.5,0,0.896873,0.442289,0,0.92388,0.382683,0,0.94693,0.321439,0,0.965926,0.258819,0,0.980785,0.19509,0,0.991445,0.130526,0,0.997859,0.065403,0,1,0,0,0,1,0,-0.032702,0.997859,0.056641,-0.065263,0.991445,0.113039,-0.097545,0.980785,0.168953,-0.12941,0.965926,0.224144,-0.16072,0.94693,0.278375,-0.191342,0.92388,0.331414,-0.221144,0.896873,0.383033,-0.25,0.866025,0.433013,-0.277785,0.83147,0.481138,-0.304381,0.793353,0.527203,-0.329673,0.75184,0.57101,-0.353553,0.707107,0.612372,-0.37592,0.659346,0.651112,-0.396677,0.608761,0.687064,-0.415735,0.55557,0.720074,-0.433013,0.5,0.75,-0.448436,0.442289,0.776715,-0.46194,0.382683,0.800103,-0.473465,0.321439,0.820066,-0.482963,0.258819,0.836516,-0.490393,0.19509,0.849385,-0.495722,0.130526,0.858616,-0.498929,0.065403,0.864171,-0.5,0,0.866025,0,0,0"></coordinate></indexedfaceset></shape></transform><transform id="sc" render="false" visible="false" data-center-of-rotation-const="0.5,0.5,0.5" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="1.81,0.5,3" data-camera-orientation="0,1,0,0.5" data-camera-position="1.81,0.5,3"><transform translation="0,0,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,0,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 -1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.15 0.15 0.15" class="segment"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 -1.57079"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="1,1,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform></transform><transform id="sc-cn" render="false" visible="false" data-center-of-rotation-const="1,1,1" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="3.03,1,5" data-camera-orientation="0,1,0,0.5" data-camera-position="3.03,1,5"><transform translation="0,0,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,0,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="2,0,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="2,0,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="2,0,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,1,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.05 0.05 0.05" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0.1,0.1,0.1"></material></appearance></shape></transform><transform translation="1,1,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="2,1,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="2,1,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="2,1,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,2,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,2,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,2,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,2,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,2,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,2,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="2,2,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="2,2,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="2,2,2" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,2" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,2" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,2" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,2" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,0,2" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,2" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,2" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,2" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,2" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,1,2" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,2,0" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,2,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,2,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,2,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,2,2" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,2,0" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,2,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,2,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,2,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,2,2" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,2,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="2,2,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 3.141593"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="1,1,1" class="cn"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="1,1,1" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="1,1,1" class="cn"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="1,1,1" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="1,1,1" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform></transform><transform id="bcc" render="false" visible="false" data-center-of-rotation-const="0.5,0.5,0.5" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="1.81,0.5,3" data-camera-orientation="0,1,0,0.5" data-camera-position="1.81,0.5,3"><transform translation="0,0,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,0,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 -1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.15 0.15 0.15" class="segment"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 -1.57079"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="1,1,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,0.5,0.5" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform></transform><transform id="bcc-cn" render="false" visible="false" data-center-of-rotation-const="0.5,0.5,0.5" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="1.81,0.5,3" data-camera-orientation="0,1,0,0.5" data-camera-position="1.81,0.5,3"><transform translation="0,0,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,0.5,0.5" scale="0.05 0.05 0.05" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0.1,0.1,0.1"></material></appearance></shape></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="cn"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="cn"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="cn"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="cn"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="cn"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="cn"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="cn"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0.5" class="cn"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.433013 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.834025" radius="0.008"></cylinder></shape></transform></transform></transform></transform></transform><transform id="fcc" render="false" visible="false" data-center-of-rotation-const="0.5,0.5,0.5" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="1.81,0.5,3" data-camera-orientation="0,1,0,0.5" data-camera-position="1.81,0.5,3"><transform translation="0,0,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,0,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 -1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.15 0.15 0.15" class="segment"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 -1.57079"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="1,1,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,0.5,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,0.5,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="1,0.5,0.5" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="1,0.5,0.5" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0.5,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 -1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,0.5,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0,0.5,0.5" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 -1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0,0.5,0.5" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,0.5" scale="0.15 0.15 0.15" class="segment"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,0.5" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,1,0.5" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,1,0.5" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0.5,0" class="inner"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="1,0.5,0.5" class="inner"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,0,0.5" class="inner"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform></transform><transform id="fcc-cn" render="false" visible="false" data-center-of-rotation-const="0.5,1,0.5" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="2.37,1,4" data-camera-orientation="0,1,0,0.5" data-camera-position="2.37,1,4"><transform translation="0,0,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,0.5,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,0.5,0.5" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,0.5,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,0.5,0.5" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,0,0.5" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,1,0.5" scale="0.05 0.05 0.05" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0.1,0.1,0.1"></material></appearance></shape></transform><transform translation="0,2,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,2,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,2,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,2,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,1.5,0" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,1.5,0.5" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,1.5,1" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,1.5,0.5" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,2,0.5" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,2,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,2,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,2,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,2,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,2,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,2,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 1.570796"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 1.570796"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -2.356194"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 2.356194"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 2.356194"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 2.356194"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,1,0.5" class="cn"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.353554 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.675107" radius="0.008"></cylinder></shape></transform></transform></transform></transform></transform><transform id="dc" render="false" visible="false" data-center-of-rotation-const="0.5,0.5,0.5" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="1.81,0.5,3" data-camera-orientation="0,1,0,0.5" data-camera-position="1.81,0.5,3"><transform translation="0,0,1" scale="0.13 0.13 0.13" class="segment"><transform rotation="0 1 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,0,1" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.13 0.13 0.13" class="segment"><transform rotation="0 1 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,1" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.13 0.13 0.13" class="segment"><transform rotation="0 1 0 -1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,0" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.13 0.13 0.13" class="segment"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.13 0.13 0.13" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,1" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.13 0.13 0.13" class="segment"><transform rotation="0 0 1 -1.57079"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="1,1,1" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.13 0.13 0.13" class="segment"><transform rotation="0 0 1 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,1,0" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.13 0.13 0.13" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,0" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,0.5,0" scale="0.13 0.13 0.13" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,0.5,0" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="1,0.5,0.5" scale="0.13 0.13 0.13" class="segment"><transform rotation="0 0 1 1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="1,0.5,0.5" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0.5,1" scale="0.13 0.13 0.13" class="segment"><transform rotation="1 0 0 -1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,0.5,1" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0,0.5,0.5" scale="0.13 0.13 0.13" class="segment"><transform rotation="0 0 1 -1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0,0.5,0.5" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,0.5" scale="0.13 0.13 0.13" class="segment"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,0.5" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,1,0.5" scale="0.13 0.13 0.13" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,1,0.5" scale="0.13 0.13 0.13" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.25,0.25,0.25" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0.75,0.25,0.75" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0.75,0.75,0.25" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0.25,0.75,0.75" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.25,0.25,0.25" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.25,0.25" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.25,0.25" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.25,0.25" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.25,0.75" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.25,0.75" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.25,0.75" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.25,0.75" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.75,0.25" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.75,0.25" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.75,0.25" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.75,0.25" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.75,0.75" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.75,0.75" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.75,0.75" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.75,0.75" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform></transform><transform id="dc-cn" render="false" visible="false" data-center-of-rotation-const="0.5,0.5,0.5" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="1.81,0.5,3" data-camera-orientation="0,1,0,0.5" data-camera-position="1.81,0.5,3"><transform translation="0,0,1" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,0.5,0" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="1,0.5,0.5" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,0.5,1" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,0.5,0.5" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,0.5" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,1,0.5" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.25,0.25,0.25" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0.75,0.25,0.75" scale="0.05 0.05 0.05" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0.1,0.1,0.1"></material></appearance></shape></transform><transform translation="0.75,0.75,0.25" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0.25,0.75,0.75" scale="0.13 0.13 0.13" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 0.785398"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.707107 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.430214 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.25,0.25,0.25" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.25,0.25" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.25,0.25" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.25,0.25" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.25,0.75" class="cn"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.25,0.75" class="cn"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.25,0.75" class="cn"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.25,0.75" class="cn"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.75,0.25" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.75,0.25" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.75,0.25" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.75,0.75,0.25" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.75,0.75" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.75,0.75" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.75,0.75" class="inner"><transform rotation="0 1 0 0.785398"><transform rotation="1 0 0 -2.186276"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.25,0.75,0.75" class="inner"><transform rotation="0 1 0 -0.785398"><transform rotation="1 0 0 -0.955317"><transform translation="0 0.216507 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.40101299999999995" radius="0.008"></cylinder></shape></transform></transform></transform></transform></transform><transform id="hcp" render="false" visible="false" data-center-of-rotation-const="0,0.81649,0" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="1.91,0.81649,3.5" data-camera-orientation="0,1,0,0.5" data-camera-position="1.91,0.81649,3.5"><transform translation="0,0,0" scale="0.2 0.2 0.2" class="segment"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,-0.86602" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 -1.04719"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0.5,0,-0.86602" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 -2.09439"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,0" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,0,0.86602" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 3.14159"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0.5,0,0.86602" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,0,0.86602" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 2.09439"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="-0.5,0,0.86602" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-1,0,0" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 1.04719"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="-1,0,0" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,0,-0.86602" scale="0.2 0.2 0.2" class="segment"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,0,-0.86602" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,1.63299,-0.86602" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 3.14159"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="0.5,1.63299,-0.86602" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1.63299,0" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 2.09439"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="1,1.63299,0" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,1.63299,0.86602" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 1.04719"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="0.5,1.63299,0.86602" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,1.63299,0.86602" scale="0.2 0.2 0.2" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="-0.5,1.63299,0.86602" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-1,1.63299,0" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 -1.04719"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="-1,1.63299,0" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,1.63299,-0.86602" scale="0.2 0.2 0.2" class="segment"><transform rotation="0 1 0 -2.09439"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="hex-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="hex-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="-0.5,1.63299,-0.86602" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1.63299,0" scale="0.2 0.2 0.2" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0,1.63299,0" scale="0.2 0.2 0.2" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0.81649,0.288675" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0,0.81649,-0.57735" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="-0.5,0.81649,0.288675" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0.5,0,-0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0,0.86602" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,0,0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-1,0,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,0,-0.86602" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,1.63299,-0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1.63299,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,1.63299,0.86602" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,1.63299,0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-1,1.63299,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,1.63299,-0.86602" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0,-0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.816495 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.64899 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.816495 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.64899 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0,0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.816495 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.64899 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,0,0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.816495 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.64899 0.016"></box></shape></transform></transform></transform></transform><transform translation="-1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.816495 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.64899 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,0,-0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.816495 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.64899 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0.81649,0.288675" class="inner"><transform rotation="0 1 0 0.523599"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,0.81649,-0.57735" class="inner"><transform rotation="0 1 0 -0.523599"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="-0.5,0.81649,0.288675" class="inner"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1.63299,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1.63299,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1.63299,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1.63299,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1.63299,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1.63299,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform></transform><transform id="hcp-cn" render="false" visible="false" data-center-of-rotation-const="0,1.63298,0" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="3.28,1.63298,6" data-camera-orientation="0,1,0,0.5" data-camera-position="3.28,1.63298,6"><transform translation="0,0,0" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,-0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,0,0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,0,0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-1,0,0" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,0,-0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,1.63298,-0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,1.63298,0" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,1.63298,0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="-0.5,1.63298,0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="-1,1.63298,0" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="-0.5,1.63298,-0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,1.63298,0" scale="0.05 0.05 0.05" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0.1,0.1,0.1"></material></appearance></shape></transform><transform translation="0.5,0.81649,0.288675" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,0.81649,-0.57735" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="-0.5,0.81649,0.288675" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,3.26598,-0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,3.26598,0" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,3.26598,0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,3.26598,0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-1,3.26598,0" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="-0.5,3.26598,-0.86602" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,2.44947,0.288675" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,2.44947,-0.57735" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="-0.5,2.44947,0.288675" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,3.26598,0" scale="0.2 0.2 0.2" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,-0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0,0.86602" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,0,0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-1,0,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,0,-0.86602" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,1.63298,-0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1.63298,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,1.63298,0.86602" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,1.63298,0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-1,1.63298,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,1.63298,-0.86602" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0,-0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.81649 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.6489800000000001 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.81649 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.6489800000000001 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0,0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.81649 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.6489800000000001 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,0,0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.81649 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.6489800000000001 0.016"></box></shape></transform></transform></transform></transform><transform translation="-1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.81649 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.6489800000000001 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,0,-0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.81649 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.6489800000000001 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,0.81649,0.288675" class="inner"><transform rotation="0 1 0 0.523599"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,0.81649,-0.57735" class="inner"><transform rotation="0 1 0 -0.523599"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="-0.5,0.81649,0.288675" class="inner"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,2.44947,0.288675" class="inner"><transform rotation="0 1 0 0.523599"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,2.44947,-0.57735" class="inner"><transform rotation="0 1 0 -0.523599"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="-0.5,2.44947,0.288675" class="inner"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0.5,3.26598,-0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,3.26598,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,3.26598,0.86602" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,3.26598,0.86602" class="edge"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-1,3.26598,0" class="edge"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,3.26598,-0.86602" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,1.63298,-0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.8165 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.649 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1.63298,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.8165 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.649 0.016"></box></shape></transform></transform></transform></transform><transform translation="0.5,1.63298,0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.8165 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.649 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,1.63298,0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.8165 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.649 0.016"></box></shape></transform></transform></transform></transform><transform translation="-1,1.63298,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.8165 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.649 0.016"></box></shape></transform></transform></transform></transform><transform translation="-0.5,1.63298,-0.86602" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.8165 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.649 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,3.26598,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,3.26598,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,3.26598,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,3.26598,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,3.26598,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,3.26598,0" class="face-hidden" render="false" visible="false"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.015995 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.9679949999999999" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.9679949999999999" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 -0.523601"><transform rotation="1 0 0 1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.9679949999999999" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.968" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 0.523601"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.9679949999999999" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 1.047198"><transform rotation="1 0 0 2.526109"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.9679949999999999" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -2.526109"><transform translation="0 0.499997 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.967994" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 -1.047198"><transform rotation="1 0 0 2.526109"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.9679949999999999" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 1.047198"><transform rotation="1 0 0 0.615483"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.9679949999999999" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -0.615483"><transform translation="0 0.499997 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.967994" radius="0.008"></cylinder></shape></transform></transform></transform></transform><transform translation="0,1.63298,0" class="cn"><transform rotation="0 1 0 -1.047198"><transform rotation="1 0 0 0.615483"><transform translation="0 0.499998 0"><shape><appearance><material diffusecolor="1,0,0"></material></appearance><cylinder height="0.9679949999999999" radius="0.008"></cylinder></shape></transform></transform></transform></transform></transform><transform id="nacl" render="false" visible="false" data-center-of-rotation-const="0.5,0.5,0.5" data-camera-orientation-const="0,1,0,0.5" data-camera-position-const="1.81,0.5,3" data-camera-orientation="0,1,0,0.5" data-camera-position="1.81,0.5,3"><transform translation="0,0,1" scale="0.1 0.1 0.1" class="segment"><transform rotation="0 1 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,0,1" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,1" scale="0.1 0.1 0.1" class="segment"><transform rotation="0 1 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,1" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,0,0" scale="0.1 0.1 0.1" class="segment"><transform rotation="0 1 0 -1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,0,0" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.1 0.1 0.1" class="segment"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,0,0" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,1" scale="0.1 0.1 0.1" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,1" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,1" scale="0.1 0.1 0.1" class="segment"><transform rotation="0 0 1 -1.57079"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform></transform><transform translation="1,1,1" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="1,1,0" scale="0.1 0.1 0.1" class="segment"><transform rotation="0 0 1 3.14159"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="1,1,0" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0,1,0" scale="0.1 0.1 0.1" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="octant-1"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape><shape><indexedfaceset use="octant-2"></indexedfaceset><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform></transform><transform translation="0,1,0" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,0,1"></material></appearance></shape></transform><transform translation="0.5,0.5,0" scale="0.1 0.1 0.1" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,0.5,0" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="1,0.5,0.5" scale="0.1 0.1 0.1" class="segment"><transform rotation="0 0 1 1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="1,0.5,0.5" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0.5,1" scale="0.1 0.1 0.1" class="segment"><transform rotation="1 0 0 -1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,0.5,1" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0,0.5,0.5" scale="0.1 0.1 0.1" class="segment"><transform rotation="0 0 1 -1.57079"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0,0.5,0.5" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,0.5" scale="0.1 0.1 0.1" class="segment"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0,0.5" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,1,0.5" scale="0.1 0.1 0.1" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="half-1"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape><shape><indexedfaceset use="half-2"></indexedfaceset><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform></transform><transform translation="0.5,1,0.5" scale="0.1 0.1 0.1" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,1,0"></material></appearance></shape></transform><transform translation="0.5,0.5,0.5" scale="0.15 0.15 0.15" class="sphere"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="0,1,0"></material></appearance></shape></transform><transform translation="0.5,0,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 -1.57079"><shape><indexedfaceset use="quarter-1"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape><shape><indexedfaceset use="quarter-2"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform></transform><transform translation="0.5,0,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,0,0.5" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 1.57079"><transform rotation="0 1 0 1.57079"><shape><indexedfaceset use="quarter-1"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape><shape><indexedfaceset use="quarter-2"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform></transform></transform><transform translation="1,0,0.5" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,0,0" scale="0.15 0.15 0.15" class="segment"><shape><indexedfaceset use="quarter-1"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape><shape><indexedfaceset use="quarter-2"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,0,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,0,0.5" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 1 0 1.57079"><shape><indexedfaceset use="quarter-1"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape><shape><indexedfaceset use="quarter-2"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform></transform><transform translation="0,0,0.5" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,1,1" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 3.14159"><shape><indexedfaceset use="quarter-1"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape><shape><indexedfaceset use="quarter-2"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform></transform><transform translation="0.5,1,1" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="1,1,0.5" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 1.57079"><transform rotation="0 1 0 -1.57079"><shape><indexedfaceset use="quarter-1"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape><shape><indexedfaceset use="quarter-2"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform></transform></transform><transform translation="1,1,0.5" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0.5,1,0" scale="0.15 0.15 0.15" class="segment"><transform rotation="1 0 0 1.57079"><shape><indexedfaceset use="quarter-1"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape><shape><indexedfaceset use="quarter-2"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform></transform><transform translation="0.5,1,0" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,1,0.5" scale="0.15 0.15 0.15" class="segment"><transform rotation="0 0 1 -1.57079"><transform rotation="0 1 0 1.57079"><shape><indexedfaceset use="quarter-1"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape><shape><indexedfaceset use="quarter-2"></indexedfaceset><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform></transform></transform><transform translation="0,1,0.5" scale="0.15 0.15 0.15" render="false" visible="false" class="sphere full"><shape><sphere radius="1"></sphere><appearance><material diffusecolor="1,0,0"></material></appearance></shape></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,1" class="edge"><transform rotation="0 1 0 1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 -1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,1,0" class="edge"><transform rotation="0 1 0 -1.570796"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,1,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 1.570796"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,1" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="1,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform><transform translation="0,0,0" class="edge"><transform rotation="0 1 0 0"><transform rotation="1 0 0 0"><transform translation="0 0.5 0"><shape><appearance><material diffusecolor="0.6,0.6,0.6"></material></appearance><box size="0.016 1.016 0.016"></box></shape></transform></transform></transform></transform></transform></scene></x3d></div><div class=""><div class="flex gap-5"><div class="hidden" data-aside="sc" data-max-radius="0.5"><div class="flex flex-wrap flex-row md:flex-col gap-5"><div class="crystal-table"><table><tbody><tr><th>Coordination Number</th><td>6</td></tr><tr><th><svg xmlns="http://www.w3.org/2000/svg" width="8.160px" height="8.200px" viewBox="0 -442 451 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-6-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-6-TEX-I-1D45F"></use></g></g></g></svg></th><td><?xml version="1.0" encoding="UTF-8" standalone="no" ?> <svg xmlns="http://www.w3.org/2000/svg" width="17.536px" height="32.632px" viewBox="0 -1117 969 1803" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-21-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-21-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(220,676)"><use data-c="1D44E" xlink:href="#MJX-21-TEX-I-1D44E"></use></g><g data-mml-node="mn" transform="translate(234.5,-686)"><use data-c="32" xlink:href="#MJX-21-TEX-N-32"></use></g><rect width="729" height="60" x="120" y="220"></rect></g></g></g></svg></td></tr><tr><th>Atoms per Unit Cell</th><td>1</td></tr><tr><th>Packing Density/Factor</th><td><svg xmlns="http://www.w3.org/2000/svg" width="74.600px" height="32.848px" viewBox="0 -1107 4121.6 1815" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-7-TEX-I-1D70B" d="M132 -11Q98 -11 98 22V33L111 61Q186 219 220 334L228 358H196Q158 358 142 355T103 336Q92 329 81 318T62 297T53 285Q51 284 38 284Q19 284 19 294Q19 300 38 329T93 391T164 429Q171 431 389 431Q549 431 553 430Q573 423 573 402Q573 371 541 360Q535 358 472 358H408L405 341Q393 269 393 222Q393 170 402 129T421 65T431 37Q431 20 417 5T381 -10Q370 -10 363 -7T347 17T331 77Q330 86 330 121Q330 170 339 226T357 318T367 358H269L268 354Q268 351 249 275T206 114T175 17Q164 -11 132 -11Z"></path><path id="MJX-7-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-7-TEX-N-2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path><path id="MJX-7-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-7-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-7-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-7-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(220,676)"><use data-c="1D70B" xlink:href="#MJX-7-TEX-I-1D70B"></use></g><g data-mml-node="mn" transform="translate(255,-686)"><use data-c="36" xlink:href="#MJX-7-TEX-N-36"></use></g><rect width="770" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1287.8,0)"><use data-c="2248" xlink:href="#MJX-7-TEX-N-2248"></use></g><g data-mml-node="mn" transform="translate(2343.6,0)"><use data-c="30" xlink:href="#MJX-7-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-7-TEX-N-2E" transform="translate(500,0)"></use><use data-c="35" xlink:href="#MJX-7-TEX-N-35" transform="translate(778,0)"></use><use data-c="32" xlink:href="#MJX-7-TEX-N-32" transform="translate(1278,0)"></use></g></g></g></svg></td></tr></tbody></table></div><div class="flex flex-col gap-5 config"><div class="hidden" data-config="sc"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="expand_radius" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Expand Radius</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="sphere_segments" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Sphere Segments</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div><div class="hidden" data-config="sc-cn"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div></div></div></div><div class="hidden" data-aside="bcc" data-max-radius="0.43301"><div class="flex flex-wrap flex-row md:flex-col gap-5"><div class="crystal-table"><table><tbody><tr><th>Coordination Number</th><td>8</td></tr><tr><th><svg xmlns="http://www.w3.org/2000/svg" width="8.160px" height="8.200px" viewBox="0 -442 451 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-6-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-6-TEX-I-1D45F"></use></g></g></g></svg></th><td><svg xmlns="http://www.w3.org/2000/svg" width="42.024px" height="32.632px" viewBox="0 -1117 2322 1803" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-15-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-15-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-15-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-15-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(220,676)"><use data-c="1D44E" xlink:href="#MJX-15-TEX-I-1D44E"></use></g><g data-mml-node="mn" transform="translate(234.5,-686)"><use data-c="34" xlink:href="#MJX-15-TEX-N-34"></use></g><rect width="729" height="60" x="120" y="220"></rect></g><g data-mml-node="msqrt" transform="translate(969,0)"><g transform="translate(853,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-15-TEX-N-33"></use></g></g><g data-mml-node="mo" transform="translate(0,136.7)"><use data-c="221A" xlink:href="#MJX-15-TEX-N-221A"></use></g><rect width="500" height="60" x="853" y="876.7"></rect></g></g></g></svg></td></tr><tr><th>Atoms per Unit Cell</th><td>2</td></tr><tr><th>Packing Density/Factor</th><td><svg xmlns="http://www.w3.org/2000/svg" width="99.088px" height="42.224px" viewBox="0 -1625 5474.6 2333" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-30-TEX-I-1D70B" d="M132 -11Q98 -11 98 22V33L111 61Q186 219 220 334L228 358H196Q158 358 142 355T103 336Q92 329 81 318T62 297T53 285Q51 284 38 284Q19 284 19 294Q19 300 38 329T93 391T164 429Q171 431 389 431Q549 431 553 430Q573 423 573 402Q573 371 541 360Q535 358 472 358H408L405 341Q393 269 393 222Q393 170 402 129T421 65T431 37Q431 20 417 5T381 -10Q370 -10 363 -7T347 17T331 77Q330 86 330 121Q330 170 339 226T357 318T367 358H269L268 354Q268 351 249 275T206 114T175 17Q164 -11 132 -11Z"></path><path id="MJX-30-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-30-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-30-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-30-TEX-N-2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path><path id="MJX-30-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-30-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-30-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><use data-c="1D70B" xlink:href="#MJX-30-TEX-I-1D70B"></use></g><g data-mml-node="msqrt" transform="translate(570,0)"><g transform="translate(853,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-30-TEX-N-33"></use></g></g><g data-mml-node="mo" transform="translate(0,89)"><use data-c="221A" xlink:href="#MJX-30-TEX-N-221A"></use></g><rect width="500" height="60" x="853" y="829"></rect></g></g><g data-mml-node="mn" transform="translate(931.5,-686)"><use data-c="38" xlink:href="#MJX-30-TEX-N-38"></use></g><rect width="2123" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2640.8,0)"><use data-c="2248" xlink:href="#MJX-30-TEX-N-2248"></use></g><g data-mml-node="mn" transform="translate(3696.6,0)"><use data-c="30" xlink:href="#MJX-30-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-30-TEX-N-2E" transform="translate(500,0)"></use><use data-c="36" xlink:href="#MJX-30-TEX-N-36" transform="translate(778,0)"></use><use data-c="38" xlink:href="#MJX-30-TEX-N-38" transform="translate(1278,0)"></use></g></g></g></svg></td></tr></tbody></table></div><div class="flex flex-col gap-5 config"><div class="hidden" data-config="bcc"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="expand_radius" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Expand Radius</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="inner_connections" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Inner Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="sphere_segments" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Sphere Segments</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div><div class="hidden" data-config="bcc-cn"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div></div></div></div><div class="hidden" data-aside="fcc" data-max-radius="0.35355"><div class="flex flex-wrap flex-row md:flex-col gap-5"><div class="crystal-table"><table><tbody><tr><th>Coordination Number</th><td>12</td></tr><tr><th><svg xmlns="http://www.w3.org/2000/svg" width="8.160px" height="8.200px" viewBox="0 -442 451 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-6-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-6-TEX-I-1D45F"></use></g></g></g></svg></th><td><svg xmlns="http://www.w3.org/2000/svg" width="42.024px" height="32.632px" viewBox="0 -1117 2322 1803" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-17-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-17-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-17-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-17-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(220,676)"><use data-c="1D44E" xlink:href="#MJX-17-TEX-I-1D44E"></use></g><g data-mml-node="mn" transform="translate(234.5,-686)"><use data-c="34" xlink:href="#MJX-17-TEX-N-34"></use></g><rect width="729" height="60" x="120" y="220"></rect></g><g data-mml-node="msqrt" transform="translate(969,0)"><g transform="translate(853,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-17-TEX-N-32"></use></g></g><g data-mml-node="mo" transform="translate(0,148.3)"><use data-c="221A" xlink:href="#MJX-17-TEX-N-221A"></use></g><rect width="500" height="60" x="853" y="888.3"></rect></g></g></g></svg></td></tr><tr><th>Atoms per Unit Cell</th><td>4</td></tr><tr><th>Packing Density/Factor</th><td><svg xmlns="http://www.w3.org/2000/svg" width="99.088px" height="42.432px" viewBox="0 -1636.5 5474.6 2344.5" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-34-TEX-I-1D70B" d="M132 -11Q98 -11 98 22V33L111 61Q186 219 220 334L228 358H196Q158 358 142 355T103 336Q92 329 81 318T62 297T53 285Q51 284 38 284Q19 284 19 294Q19 300 38 329T93 391T164 429Q171 431 389 431Q549 431 553 430Q573 423 573 402Q573 371 541 360Q535 358 472 358H408L405 341Q393 269 393 222Q393 170 402 129T421 65T431 37Q431 20 417 5T381 -10Q370 -10 363 -7T347 17T331 77Q330 86 330 121Q330 170 339 226T357 318T367 358H269L268 354Q268 351 249 275T206 114T175 17Q164 -11 132 -11Z"></path><path id="MJX-34-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-34-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-34-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-34-TEX-N-2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path><path id="MJX-34-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-34-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-34-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-34-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><use data-c="1D70B" xlink:href="#MJX-34-TEX-I-1D70B"></use></g><g data-mml-node="msqrt" transform="translate(570,0)"><g transform="translate(853,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-34-TEX-N-32"></use></g></g><g data-mml-node="mo" transform="translate(0,100.5)"><use data-c="221A" xlink:href="#MJX-34-TEX-N-221A"></use></g><rect width="500" height="60" x="853" y="840.5"></rect></g></g><g data-mml-node="mn" transform="translate(931.5,-686)"><use data-c="36" xlink:href="#MJX-34-TEX-N-36"></use></g><rect width="2123" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2640.8,0)"><use data-c="2248" xlink:href="#MJX-34-TEX-N-2248"></use></g><g data-mml-node="mn" transform="translate(3696.6,0)"><use data-c="30" xlink:href="#MJX-34-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-34-TEX-N-2E" transform="translate(500,0)"></use><use data-c="37" xlink:href="#MJX-34-TEX-N-37" transform="translate(778,0)"></use><use data-c="34" xlink:href="#MJX-34-TEX-N-34" transform="translate(1278,0)"></use></g></g></g></svg></td></tr></tbody></table></div><div class="flex flex-col gap-5 config"><div class="hidden" data-config="fcc"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="expand_radius" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Expand Radius</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="inner_connections" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Inner Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="face_connections" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Face Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="sphere_segments" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Sphere Segments</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div><div class="hidden" data-config="fcc-cn"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="face_connections" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Face Connections</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div></div></div></div><div class="hidden" data-aside="dc" data-max-radius="0.216506"><div class="flex flex-wrap flex-row md:flex-col gap-5"><div class="crystal-table"><table><tbody><tr><th>Coordination Number</th><td>4</td></tr><tr><th><svg xmlns="http://www.w3.org/2000/svg" width="8.160px" height="8.200px" viewBox="0 -442 451 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-6-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-6-TEX-I-1D45F"></use></g></g></g></svg></th><td><svg xmlns="http://www.w3.org/2000/svg" width="42.024px" height="33.032px" viewBox="0 -1117 2322 1825" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-19-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-19-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-19-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-19-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(220,676)"><use data-c="1D44E" xlink:href="#MJX-19-TEX-I-1D44E"></use></g><g data-mml-node="mn" transform="translate(234.5,-686)"><use data-c="38" xlink:href="#MJX-19-TEX-N-38"></use></g><rect width="729" height="60" x="120" y="220"></rect></g><g data-mml-node="msqrt" transform="translate(969,0)"><g transform="translate(853,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-19-TEX-N-33"></use></g></g><g data-mml-node="mo" transform="translate(0,136.7)"><use data-c="221A" xlink:href="#MJX-19-TEX-N-221A"></use></g><rect width="500" height="60" x="853" y="876.7"></rect></g></g></g></svg></td></tr><tr><th>Atoms per Unit Cell</th><td>8</td></tr><tr><th>Packing Density/Factor</th><td><svg xmlns="http://www.w3.org/2000/svg" width="99.088px" height="42.224px" viewBox="0 -1625 5474.6 2333" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-37-TEX-I-1D70B" d="M132 -11Q98 -11 98 22V33L111 61Q186 219 220 334L228 358H196Q158 358 142 355T103 336Q92 329 81 318T62 297T53 285Q51 284 38 284Q19 284 19 294Q19 300 38 329T93 391T164 429Q171 431 389 431Q549 431 553 430Q573 423 573 402Q573 371 541 360Q535 358 472 358H408L405 341Q393 269 393 222Q393 170 402 129T421 65T431 37Q431 20 417 5T381 -10Q370 -10 363 -7T347 17T331 77Q330 86 330 121Q330 170 339 226T357 318T367 358H269L268 354Q268 351 249 275T206 114T175 17Q164 -11 132 -11Z"></path><path id="MJX-37-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-37-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-37-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-37-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-37-TEX-N-2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path><path id="MJX-37-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-37-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-37-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><use data-c="1D70B" xlink:href="#MJX-37-TEX-I-1D70B"></use></g><g data-mml-node="msqrt" transform="translate(570,0)"><g transform="translate(853,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-37-TEX-N-33"></use></g></g><g data-mml-node="mo" transform="translate(0,89)"><use data-c="221A" xlink:href="#MJX-37-TEX-N-221A"></use></g><rect width="500" height="60" x="853" y="829"></rect></g></g><g data-mml-node="mn" transform="translate(681.5,-686)"><use data-c="31" xlink:href="#MJX-37-TEX-N-31"></use><use data-c="36" xlink:href="#MJX-37-TEX-N-36" transform="translate(500,0)"></use></g><rect width="2123" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2640.8,0)"><use data-c="2248" xlink:href="#MJX-37-TEX-N-2248"></use></g><g data-mml-node="mn" transform="translate(3696.6,0)"><use data-c="30" xlink:href="#MJX-37-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-37-TEX-N-2E" transform="translate(500,0)"></use><use data-c="33" xlink:href="#MJX-37-TEX-N-33" transform="translate(778,0)"></use><use data-c="34" xlink:href="#MJX-37-TEX-N-34" transform="translate(1278,0)"></use></g></g></g></svg></td></tr></tbody></table></div><div class="flex flex-col gap-5 config"><div class="hidden" data-config="dc"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="expand_radius" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Expand Radius</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="inner_connections" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Inner Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="face_connections" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Face Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="sphere_segments" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Sphere Segments</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div><div class="hidden" data-config="dc-cn"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="inner_connections" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Inner Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="face_connections" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Face Connections</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div></div></div></div><div class="hidden" data-aside="hcp" data-max-radius="0.5"><div class="flex flex-wrap flex-row md:flex-col gap-5"><div class="crystal-table"><table><tbody><tr><th>Coordination Number</th><td>12</td></tr><tr><th><svg xmlns="http://www.w3.org/2000/svg" width="8.160px" height="8.200px" viewBox="0 -442 451 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-6-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-6-TEX-I-1D45F"></use></g></g></g></svg></th><td><?xml version="1.0" encoding="UTF-8" standalone="no" ?> <svg xmlns="http://www.w3.org/2000/svg" width="17.536px" height="32.632px" viewBox="0 -1117 969 1803" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-21-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-21-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(220,676)"><use data-c="1D44E" xlink:href="#MJX-21-TEX-I-1D44E"></use></g><g data-mml-node="mn" transform="translate(234.5,-686)"><use data-c="32" xlink:href="#MJX-21-TEX-N-32"></use></g><rect width="729" height="60" x="120" y="220"></rect></g></g></g></svg></td></tr><tr><th>Atoms per Unit Cell</th><td>6</td></tr><tr><th>Packing Density/Factor</th><td><svg xmlns="http://www.w3.org/2000/svg" width="99.088px" height="42.432px" viewBox="0 -1636.5 5474.6 2344.5" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-34-TEX-I-1D70B" d="M132 -11Q98 -11 98 22V33L111 61Q186 219 220 334L228 358H196Q158 358 142 355T103 336Q92 329 81 318T62 297T53 285Q51 284 38 284Q19 284 19 294Q19 300 38 329T93 391T164 429Q171 431 389 431Q549 431 553 430Q573 423 573 402Q573 371 541 360Q535 358 472 358H408L405 341Q393 269 393 222Q393 170 402 129T421 65T431 37Q431 20 417 5T381 -10Q370 -10 363 -7T347 17T331 77Q330 86 330 121Q330 170 339 226T357 318T367 358H269L268 354Q268 351 249 275T206 114T175 17Q164 -11 132 -11Z"></path><path id="MJX-34-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-34-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-34-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-34-TEX-N-2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path><path id="MJX-34-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-34-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-34-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-34-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><use data-c="1D70B" xlink:href="#MJX-34-TEX-I-1D70B"></use></g><g data-mml-node="msqrt" transform="translate(570,0)"><g transform="translate(853,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-34-TEX-N-32"></use></g></g><g data-mml-node="mo" transform="translate(0,100.5)"><use data-c="221A" xlink:href="#MJX-34-TEX-N-221A"></use></g><rect width="500" height="60" x="853" y="840.5"></rect></g></g><g data-mml-node="mn" transform="translate(931.5,-686)"><use data-c="36" xlink:href="#MJX-34-TEX-N-36"></use></g><rect width="2123" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2640.8,0)"><use data-c="2248" xlink:href="#MJX-34-TEX-N-2248"></use></g><g data-mml-node="mn" transform="translate(3696.6,0)"><use data-c="30" xlink:href="#MJX-34-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-34-TEX-N-2E" transform="translate(500,0)"></use><use data-c="37" xlink:href="#MJX-34-TEX-N-37" transform="translate(778,0)"></use><use data-c="34" xlink:href="#MJX-34-TEX-N-34" transform="translate(1278,0)"></use></g></g></g></svg></td></tr></tbody></table></div><div class="flex flex-col gap-5 config"><div class="hidden" data-config="hcp"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="expand_radius" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Expand Radius</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="inner_connections" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Inner Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="face_connections" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Face Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="sphere_segments" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Sphere Segments</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div><div class="hidden" data-config="hcp-cn"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="inner_connections" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Inner Connections</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="face_connections" class="sr-only peer toggle" autocomplete="off"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Face Connections</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div></div></div></div><div class="hidden" data-aside="nacl" data-max-radius="0.2"><div class="flex flex-wrap flex-row md:flex-col gap-5"><div class="crystal-table"><table><tbody><tr><th>Atoms per Unit Cell</th><td><svg xmlns="http://www.w3.org/2000/svg" width="159.120px" height="15.768px" viewBox="0 -677 8791.2 871" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-51-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-51-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path><path id="MJX-51-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-51-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-51-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-51-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-51-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-51-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-51-TEX-I-1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path id="MJX-51-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-51-TEX-I-1D45B"></use></g><g data-mml-node="TeXAtom" transform="translate(633,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D441" xlink:href="#MJX-51-TEX-I-1D441"></use></g><g data-mml-node="msup" transform="translate(888,0)"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-51-TEX-I-1D44E"></use></g><g data-mml-node="TeXAtom" transform="translate(562,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="2B" xlink:href="#MJX-51-TEX-N-2B"></use></g></g></g></g></g><g data-mml-node="mo" transform="translate(2410.4,0)"><use data-c="3D" xlink:href="#MJX-51-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(3466.2,0)"><use data-c="34" xlink:href="#MJX-51-TEX-N-34"></use></g><g data-mml-node="mstyle" transform="translate(3966.2,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="mstyle" transform="translate(4133.2,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="mo" transform="translate(4300.2,0)"><use data-c="2C" xlink:href="#MJX-51-TEX-N-2C"></use></g><g data-mml-node="mstyle" transform="translate(4578.2,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="mstyle" transform="translate(4745.2,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="msub" transform="translate(5078.9,0)"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-51-TEX-I-1D45B"></use></g><g data-mml-node="TeXAtom" transform="translate(633,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-51-TEX-I-1D436"></use></g><g data-mml-node="msup" transform="translate(760,0)"><g data-mml-node="mi"><use data-c="1D459" xlink:href="#MJX-51-TEX-I-1D459"></use></g><g data-mml-node="TeXAtom" transform="translate(331,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="2212" xlink:href="#MJX-51-TEX-N-2212"></use></g></g></g></g></g><g data-mml-node="mo" transform="translate(7235.5,0)"><use data-c="3D" xlink:href="#MJX-51-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(8291.2,0)"><use data-c="34" xlink:href="#MJX-51-TEX-N-34"></use></g></g></g></svg></td></tr><tr><th>Note</th><td><svg xmlns="http://www.w3.org/2000/svg" width="91.352px" height="12.768px" viewBox="0 -540 5047 705.6" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" fill="currentColor"><defs><path id="MJX-31-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-31-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path><path id="MJX-31-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-31-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-31-TEX-N-3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path><path id="MJX-31-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-31-TEX-I-1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path id="MJX-31-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></defs><g stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-31-TEX-I-1D45F"></use></g><g data-mml-node="TeXAtom" transform="translate(484,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D441" xlink:href="#MJX-31-TEX-I-1D441"></use></g><g data-mml-node="msup" transform="translate(888,0)"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-31-TEX-I-1D44E"></use></g><g data-mml-node="TeXAtom" transform="translate(562,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="2B" xlink:href="#MJX-31-TEX-N-2B"></use></g></g></g></g></g><g data-mml-node="mo" transform="translate(2261.4,0)"><use data-c="3C" xlink:href="#MJX-31-TEX-N-3C"></use></g><g data-mml-node="msub" transform="translate(3317.2,0)"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-31-TEX-I-1D45F"></use></g><g data-mml-node="TeXAtom" transform="translate(484,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-31-TEX-I-1D436"></use></g><g data-mml-node="msup" transform="translate(760,0)"><g data-mml-node="mi"><use data-c="1D459" xlink:href="#MJX-31-TEX-I-1D459"></use></g><g data-mml-node="TeXAtom" transform="translate(331,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="2212" xlink:href="#MJX-31-TEX-N-2212"></use></g></g></g></g></g></g></g></svg></td></tr></tbody></table></div><div class="flex flex-col gap-5 config"><div class="hidden" data-config="nacl"><div class="flex flex-col gap-5"><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="edge" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Edge</span></label></div><div><label class="inline-flex items-center cursor-pointer"><input type="checkbox" name="sphere_segments" class="sr-only peer toggle" autocomplete="off" checked="checked"><div class="relative w-11 h-6 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-blue-600"></div><span class="ms-3 text-sm font-medium text-gray-300">Sphere Segments</span></label></div><div><button type="button" class="px-3 py-2 flex items-center justify-center text-sm cursor-pointer text-gray-400 peer-checked:bg-gray-700 peer-checked:text-white hover:bg-gray-600 border border-gray-600 rounded-lg hover:text-white reset-button">Reset Camera Position</button></div></div></div></div></div></div></div></div></div></div></main><script>let gCurrentTab=null,gPreviousTab=null,gCurrentView=null,gPreviousView=null,gCamera={position:[0,0,0],orientation:[0,0,0,0]},stateChanged=()=>{var e,t;null!==gPreviousTab&&document.querySelector(`div[data-nav-view=${gPreviousTab}]`).classList.add("hidden"),null!==gPreviousView&&((e=document.querySelector("#"+gPreviousView)).setAttribute("render","false"),e.setAttribute("visible","false")),null!==gPreviousTab&&document.querySelector(`div[data-aside=${gPreviousTab}]`).classList.add("hidden"),null!==gPreviousView&&document.querySelector(`.config [data-config=${gPreviousView}]`).classList.add("hidden"),null!==gPreviousView&&((t=document.querySelector("#"+gPreviousView)).dataset.cameraOrientation=gCamera.orientation,t.dataset.cameraPosition=gCamera.position),t=document.querySelector("#"+gCurrentView),(e=document.querySelector("viewpoint")).setAttribute("centerofrotation",t.dataset.centerOfRotationConst),e.setAttribute("position",t.dataset.cameraPosition),e.setAttribute("orientation",t.dataset.cameraOrientation),document.querySelector(`div[data-nav-view=${gCurrentTab}]`).classList.remove("hidden"),(t=document.querySelector("#"+gCurrentView)).setAttribute("render","true"),t.setAttribute("visible","true"),document.querySelector(`div[data-aside=${gCurrentTab}]`).classList.remove("hidden"),document.querySelector(`.config [data-config=${gCurrentView}]`).classList.remove("hidden")},addEventsForNavButtons=()=>{document.querySelectorAll('#nav input[name="tab"]').forEach(e=>{e.addEventListener("change",e=>{gPreviousTab=gCurrentTab,gCurrentTab=e.target.value,document.querySelectorAll(`input[name=${gCurrentTab}].view`).forEach(e=>{e.checked&&(gPreviousView=gCurrentView,gCurrentView=e.value)}),stateChanged()})})},addEventsForViewButtons=()=>{document.querySelectorAll(".view").forEach(e=>{e.addEventListener("change",e=>{e=e.target;gPreviousView=gCurrentView,gCurrentView=e.value,stateChanged()})})},addEventsForResetButtons=()=>{document.querySelectorAll(".config button.reset-button").forEach(e=>{e.addEventListener("click",()=>{var e=document.querySelector("viewpoint"),t=document.querySelector("#"+gCurrentView);e.bind="true",e.setAttribute("centerofrotation",t.dataset.centerOfRotationConst),e.setAttribute("position",t.dataset.cameraPositionConst),e.setAttribute("orientation",t.dataset.cameraOrientationConst)})})},addEventsForToggles=()=>{document.querySelectorAll(".config .toggle").forEach(e=>{e.addEventListener("change",e=>{e=e.target;let n=document.querySelector("x3d");var i=e=>{e=n.querySelectorAll(`#${gCurrentView} `+e);if(0!==e.length){let t=("true"!==e[0].render).toString();e.forEach(e=>e.setAttribute("render",t)),e.forEach(e=>e.setAttribute("visible",t))}};if("expand_radius"===e.name){let t=0;t=e.checked?document.querySelector(`div[data-aside=${gCurrentTab}]`).dataset.maxRadius:.15,n.querySelectorAll(`#${gCurrentView} .sphere`).forEach(e=>e.setAttribute("scale",`${t} ${t} `+t)),n.querySelectorAll(`#${gCurrentView} .segment`).forEach(e=>e.setAttribute("scale",`${t} ${t} `+t))}else if("edge"===e.name)i(".edge");else if("face_connections"===e.name)i(".face"),i(".face-hidden");else if("inner_connections"===e.name)i(".inner");else if("sphere_segments"===e.name){i=n.querySelectorAll(`#${gCurrentView} .full`),e=n.querySelectorAll(`#${gCurrentView} .segment`);let t=("true"!==i[0].render).toString(),r=("true"!==e[0].render).toString();e.forEach(e=>e.setAttribute("render",r)),e.forEach(e=>e.setAttribute("visible",r)),i.forEach(e=>e.setAttribute("render",t)),i.forEach(e=>e.setAttribute("visible",t))}})})},addViewpointChangedEvent=()=>{document.querySelector("viewpoint").addEventListener("viewpointChanged",e=>{gCamera.position=Object.values(e.position);var t=Object.values(e.orientation[0]);t.push(e.orientation[1]),gCamera.orientation=t})};document.addEventListener("DOMContentLoaded",()=>{x3dom.runtime.ready=function(){addViewpointChangedEvent(),addEventsForNavButtons(),addEventsForViewButtons(),addEventsForToggles(),addEventsForResetButtons(),document.querySelector('#nav input[name="tab"]').dispatchEvent(new Event("change"))}})</script></body></html>